{
  "id": 8,
  "language": "cc",
  "cwe": "",
  "commit_url": "https://github.com/blusno1/chromium-1/commit/a5333583f14284a411abac2fef7caed889a8bba3",
  "commit_sha": "a5333583f14284a411abac2fef7caed889a8bba3",
  "commit_msg": "Wire InstallFinished and add some InstallEvent.waitUntil tests\n\nBUG=285976\nTEST=content_browsertests:ServiceWorkerVersionBrowserTest.Install*\n\nCommitted: https://src.chromium.org/viewvc/chrome?view=rev&revision=250804\n\nReview URL: https://codereview.chromium.org/153553008\n\ngit-svn-id: svn://svn.chromium.org/chrome/trunk/src@250936 0039d316-1c4b-4281-b951-d872f2087c98",
  "pr_url": null,
  "pr_info": null,
  "file_name": "content/browser/service_worker/service_worker_browsertest.cc",
  "func_name": "",
  "raw_func_from_json": " void ServiceWorkerScriptContext::OnInstallEvent(\n     int active_version_embedded_worker_id) {\n  DidHandleInstallEvent(current_request_id_);\n }\n",
  "diff_func": "@@ -186,6 +186,31 @@ class ServiceWorkerVersionBrowserTest : public ServiceWorkerBrowserTest {\n     }\n   }\n \n+  void InstallTestHelper(const std::string& worker_url) {\n+    RunOnIOThread(base::Bind(&self::SetUpRegistrationOnIOThread, this,\n+                             worker_url));\n+\n+    // Dispatch install on a worker.\n+    ServiceWorkerStatusCode status = SERVICE_WORKER_ERROR_FAILED;\n+    base::RunLoop install_run_loop;\n+    BrowserThread::PostTask(BrowserThread::IO, FROM_HERE,\n+                            base::Bind(&self::InstallOnIOThread, this,\n+                                       install_run_loop.QuitClosure(),\n+                                       &status));\n+    install_run_loop.Run();\n+    ASSERT_EQ(SERVICE_WORKER_OK, status);\n+\n+    // Stop the worker.\n+    status = SERVICE_WORKER_ERROR_FAILED;\n+    base::RunLoop stop_run_loop;\n+    BrowserThread::PostTask(BrowserThread::IO, FROM_HERE,\n+                            base::Bind(&self::StopOnIOThread, this,\n+                                       stop_run_loop.QuitClosure(),\n+                                       &status));\n+    stop_run_loop.Run();\n+    ASSERT_EQ(SERVICE_WORKER_OK, status);\n+  }\n+\n   void SetUpRegistrationOnIOThread(const std::string& worker_url) {\n     const int64 version_id = 1L;\n     registration_ = new ServiceWorkerRegistration(\n@@ -285,28 +310,19 @@ IN_PROC_BROWSER_TEST_F(ServiceWorkerVersionBrowserTest, StartNotFound) {\n }\n \n IN_PROC_BROWSER_TEST_F(ServiceWorkerVersionBrowserTest, Install) {\n-  RunOnIOThread(base::Bind(&self::SetUpRegistrationOnIOThread, this,\n-                           \"/service_worker/worker.js\"));\n+  InstallTestHelper(\"/service_worker/worker.js\");\n+}\n \n-  // Dispatch install on a worker.\n-  ServiceWorkerStatusCode status = SERVICE_WORKER_ERROR_FAILED;\n-  base::RunLoop install_run_loop;\n-  BrowserThread::PostTask(BrowserThread::IO, FROM_HERE,\n-                          base::Bind(&self::InstallOnIOThread, this,\n-                                     install_run_loop.QuitClosure(),\n-                                     &status));\n-  install_run_loop.Run();\n-  ASSERT_EQ(SERVICE_WORKER_OK, status);\n+IN_PROC_BROWSER_TEST_F(ServiceWorkerVersionBrowserTest,\n+                       InstallWithWaitUntil_Fulfilled) {\n+  InstallTestHelper(\"/service_worker/worker_install_fulfilled.js\");\n+}\n \n-  // Stop the worker.\n-  status = SERVICE_WORKER_ERROR_FAILED;\n-  base::RunLoop stop_run_loop;\n-  BrowserThread::PostTask(BrowserThread::IO, FROM_HERE,\n-                          base::Bind(&self::StopOnIOThread, this,\n-                                     stop_run_loop.QuitClosure(),\n-                                     &status));\n-  stop_run_loop.Run();\n-  ASSERT_EQ(SERVICE_WORKER_OK, status);\n+IN_PROC_BROWSER_TEST_F(ServiceWorkerVersionBrowserTest,\n+                       InstallWithWaitUntil_Rejected) {\n+  // TODO(kinuko): This should also report back an error, but we\n+  // don't have plumbing for it yet.\n+  InstallTestHelper(\"/service_worker/worker_install_rejected.js\");\n }\n \n }  // namespace content",
  "project": "Chrome",
  "commit_id": "a5333583f14284a411abac2fef7caed889a8bba3",
  "target": 1,
  "func": " void ServiceWorkerScriptContext::OnInstallEvent(\n     int active_version_embedded_worker_id) {\n  DidHandleInstallEvent(current_request_id_);\n }\n",
  "big_vul_idx": 185011,
  "idx": 5909,
  "hash": 199087988793021330181873049420535142766,
  "Bug Filter": "Testing & Validation Updates",
  "Bug Filter Confidence": 0.95,
  "Bug Filter Response": "**Final Output:**\n\n- **Final Classification:** Testing & Validation Updates  \n- **Confidence:** 0.95"
}