{
  "id": 653,
  "language": "c",
  "cwe": "",
  "commit_url": "https://github.com/nginx/njs/commit/81af26364c21c196dd21fb5e14c7fa9ce7debd17",
  "commit_sha": "81af26364c21c196dd21fb5e14c7fa9ce7debd17",
  "commit_msg": "Fixed Object.defineProperty() when a recursive descriptor is provided.\n\nThis closes #481 issue on Github.",
  "pr_url": null,
  "pr_info": null,
  "file_name": "src/njs_array.c",
  "func_name": "",
  "raw_func_from_json": "njs_array_convert_to_slow_array(njs_vm_t *vm, njs_array_t *array)\n{\n    uint32_t           i, length;\n    njs_value_t        index, value;\n    njs_object_prop_t  *prop;\n\n    njs_set_array(&value, array);\n    array->object.fast_array = 0;\n\n    length = array->length;\n\n    for (i = 0; i < length; i++) {\n        if (njs_is_valid(&array->start[i])) {\n            njs_uint32_to_string(&index, i);\n            prop = njs_object_property_add(vm, &value, &index, 0);\n            if (njs_slow_path(prop == NULL)) {\n                return NJS_ERROR;\n            }\n\n            prop->value = array->start[i];\n        }\n    }\n\n    /* GC: release value. */\n\n    njs_mp_free(vm->mem_pool, array->start);\n    array->start = NULL;\n\n    return NJS_OK;\n}",
  "diff_func": "@@ -142,6 +142,10 @@ njs_array_convert_to_slow_array(njs_vm_t *vm, njs_array_t *array)\n     njs_value_t        index, value;\n     njs_object_prop_t  *prop;\n \n+    if (njs_slow_path(!array->object.fast_array)) {\n+        return NJS_OK;\n+    }\n+\n     njs_set_array(&value, array);\n     array->object.fast_array = 0;\n ",
  "func": "njs_array_convert_to_slow_array(njs_vm_t *vm, njs_array_t *array)\n{\n    uint32_t           i, length;\n    njs_value_t        index, value;\n    njs_object_prop_t  *prop;\n\n    njs_set_array(&value, array);\n    array->object.fast_array = 0;\n\n    length = array->length;\n\n    for (i = 0; i < length; i++) {\n        if (njs_is_valid(&array->start[i])) {\n            njs_uint32_to_string(&index, i);\n            prop = njs_object_property_add(vm, &value, &index, 0);\n            if (njs_slow_path(prop == NULL)) {\n                return NJS_ERROR;\n            }\n\n            prop->value = array->start[i];\n        }\n    }\n\n    /* GC: release value. */\n\n    njs_mp_free(vm->mem_pool, array->start);\n    array->start = NULL;\n\n    return NJS_OK;\n}",
  "project": "njs",
  "hash": 15778839275107817850632511934182345441,
  "size": 30,
  "commit_id": "81af26364c21c196dd21fb5e14c7fa9ce7debd17",
  "message": "Fixed Object.defineProperty() when a recursive descriptor is provided.\n\nThis closes #481 issue on Github.",
  "target": 1,
  "dataset": "other",
  "idx": 196817,
  "Bug Filter": "Defect Remediation & Feature Upgrades",
  "Bug Filter Confidence": 0.8,
  "Bug Filter Response": "\n\n**Final Output:**\n\nAnalysis: The patch addresses a bug in handling recursive descriptors with Object.defineProperty(). The code adds a condition to prevent issues when a recursive descriptor is provided, potentially avoiding crashes or denial of service. However, without explicit evidence of exploitability, it's classified as a defect fix.\n\nFinal Classification: Defect Remediation & Feature Upgrades\n\nConfidence Score: 0.8"
}