{
  "id": 3,
  "language": "cc",
  "cwe": "",
  "commit_url": "https://github.com/blusno1/chromium-1/commit/45bae236b03f577ed6682ef4c7ef3ee006de5e5a",
  "commit_sha": "45bae236b03f577ed6682ef4c7ef3ee006de5e5a",
  "commit_msg": "Copy setup.exe rather than moving it since it is created outside of the target directory heirarchy (regression introduced in r75899).\n\nBUG=82424\nTEST=Install system-level Chrome as some admin user X.  Switch to admin user Y and try to uninstall.\nR=robertshield@chromium.org\n\nReview URL: http://codereview.chromium.org/7011018\n\ngit-svn-id: svn://svn.chromium.org/chrome/trunk/src@85159 0039d316-1c4b-4281-b951-d872f2087c98",
  "pr_url": null,
  "pr_info": null,
  "file_name": "chrome/installer/setup/install_worker.cc",
  "func_name": "",
  "raw_func_from_json": "void AddInstallerCopyTasks(const InstallerState& installer_state,\n                           const FilePath& setup_path,\n                           const FilePath& archive_path,\n                           const FilePath& temp_path,\n                           const Version& new_version,\n                           WorkItemList* install_list) {\n  DCHECK(install_list);\n  FilePath installer_dir(installer_state.GetInstallerDirectory(new_version));\n  install_list->AddCreateDirWorkItem(installer_dir);\n\n   FilePath exe_dst(installer_dir.Append(setup_path.BaseName()));\n   FilePath archive_dst(installer_dir.Append(archive_path.BaseName()));\n \n  install_list->AddMoveTreeWorkItem(setup_path.value(), exe_dst.value(),\n                                    temp_path.value(), WorkItem::ALWAYS_MOVE);\n   install_list->AddMoveTreeWorkItem(archive_path.value(), archive_dst.value(),\n                                     temp_path.value(), WorkItem::ALWAYS_MOVE);\n }\n",
  "diff_func": "@@ -97,12 +97,14 @@ void AddInstallerCopyTasks(const InstallerState& installer_state,\n   FilePath exe_dst(installer_dir.Append(setup_path.BaseName()));\n   FilePath archive_dst(installer_dir.Append(archive_path.BaseName()));\n \n+  install_list->AddCopyTreeWorkItem(setup_path.value(), exe_dst.value(),\n+                                    temp_path.value(), WorkItem::ALWAYS);\n+\n   // In the past, we copied rather than moved for system level installs so that\n   // the permissions of %ProgramFiles% would be picked up.  Now that |temp_path|\n   // is in %ProgramFiles% for system level installs (and in %LOCALAPPDATA%\n-  // otherwise), there is no need to do this.\n-  install_list->AddMoveTreeWorkItem(setup_path.value(), exe_dst.value(),\n-                                    temp_path.value(), WorkItem::ALWAYS_MOVE);\n+  // otherwise), there is no need to do this for the archive.  Setup.exe, on\n+  // the other hand, is created elsewhere so it must always be copied.\n   install_list->AddMoveTreeWorkItem(archive_path.value(), archive_dst.value(),\n                                     temp_path.value(), WorkItem::ALWAYS_MOVE);\n }",
  "project": "Chrome",
  "commit_id": "45bae236b03f577ed6682ef4c7ef3ee006de5e5a",
  "target": 1,
  "func": "void AddInstallerCopyTasks(const InstallerState& installer_state,\n                           const FilePath& setup_path,\n                           const FilePath& archive_path,\n                           const FilePath& temp_path,\n                           const Version& new_version,\n                           WorkItemList* install_list) {\n  DCHECK(install_list);\n  FilePath installer_dir(installer_state.GetInstallerDirectory(new_version));\n  install_list->AddCreateDirWorkItem(installer_dir);\n\n   FilePath exe_dst(installer_dir.Append(setup_path.BaseName()));\n   FilePath archive_dst(installer_dir.Append(archive_path.BaseName()));\n \n  install_list->AddMoveTreeWorkItem(setup_path.value(), exe_dst.value(),\n                                    temp_path.value(), WorkItem::ALWAYS_MOVE);\n   install_list->AddMoveTreeWorkItem(archive_path.value(), archive_dst.value(),\n                                     temp_path.value(), WorkItem::ALWAYS_MOVE);\n }\n",
  "big_vul_idx": 184084,
  "idx": 5095,
  "hash": 296073909617636686988193993551614228480,
  "Bug Filter": "Defect Remediation & Feature Upgrades",
  "Bug Filter Confidence": 0.9,
  "Bug Filter Response": "\n\n**Final Output:**\n\nAnalysis: The patch modifies how setup.exe is handled during installation, changing from moving to copying to fix a regression. The issue involves correct behavior during uninstallation, not security.\n\nFinal Classification: Defect Remediation & Feature Upgrades\n\nConfidence Score: 0.9"
}