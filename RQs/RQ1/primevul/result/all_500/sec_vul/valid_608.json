{
  "id": 608,
  "language": "unknown",
  "cwe": "",
  "commit_url": "https://github.com/ProhorP/samba/commit/c300a85848350635e7ddd8129b31c4d439dc0f8a",
  "commit_sha": "c300a85848350635e7ddd8129b31c4d439dc0f8a",
  "commit_msg": "s3: smbd: Ensure change notifies can't get set unless the directory handle is open for SEC_DIR_LIST.\n\nRemove knownfail entry.\n\nCVE-2020-14318\n\nBUG: https://bugzilla.samba.org/show_bug.cgi?id=14434\n\nSigned-off-by: Jeremy Allison <jra@samba.org>",
  "pr_url": null,
  "pr_info": null,
  "file_name": "selftest/knownfail.d/smb2_notify_handle_permissions",
  "func_name": "",
  "raw_func_from_json": "NTSTATUS change_notify_create(struct files_struct *fsp,\n\t\t\t      uint32_t max_buffer_size,\n\t\t\t      uint32_t filter,\n\t\t\t      bool recursive)\n{\n\tsize_t len = fsp_fullbasepath(fsp, NULL, 0);\n\tchar fullpath[len+1];\n\tNTSTATUS status = NT_STATUS_NOT_IMPLEMENTED;\n\n\tif (fsp->notify != NULL) {\n\t\tDEBUG(1, (\"change_notify_create: fsp->notify != NULL, \"\n\t\t\t  \"fname = %s\\n\", fsp->fsp_name->base_name));\n\t\treturn NT_STATUS_INVALID_PARAMETER;\n\t}\n\n\tif (!(fsp->notify = talloc_zero(NULL, struct notify_change_buf))) {\n\t\tDEBUG(0, (\"talloc failed\\n\"));\n\t\treturn NT_STATUS_NO_MEMORY;\n\t}\n\tfsp->notify->filter = filter;\n\tfsp->notify->subdir_filter = recursive ? filter : 0;\n\tfsp->notify->max_buffer_size = max_buffer_size;\n\n\tfsp_fullbasepath(fsp, fullpath, sizeof(fullpath));\n\n\t/*\n\t * Avoid /. at the end of the path name. notify can't deal with it.\n\t */\n\tif (len > 1 && fullpath[len-1] == '.' && fullpath[len-2] == '/') {\n\t\tfullpath[len-2] = '\\0';\n\t}\n\n\tif ((fsp->notify->filter != 0) ||\n\t    (fsp->notify->subdir_filter != 0)) {\n\t\tstatus = notify_add(fsp->conn->sconn->notify_ctx,\n\t\t\t\t    fullpath, fsp->notify->filter,\n\t\t\t\t    fsp->notify->subdir_filter, fsp);\n\t}\n\n\treturn status;\n}",
  "diff_func": "@@ -1,2 +0,0 @@\n-^samba3.smb2.notify.handle-permissions\n-",
  "func": "NTSTATUS change_notify_create(struct files_struct *fsp,\n\t\t\t      uint32_t max_buffer_size,\n\t\t\t      uint32_t filter,\n\t\t\t      bool recursive)\n{\n\tsize_t len = fsp_fullbasepath(fsp, NULL, 0);\n\tchar fullpath[len+1];\n\tNTSTATUS status = NT_STATUS_NOT_IMPLEMENTED;\n\n\tif (fsp->notify != NULL) {\n\t\tDEBUG(1, (\"change_notify_create: fsp->notify != NULL, \"\n\t\t\t  \"fname = %s\\n\", fsp->fsp_name->base_name));\n\t\treturn NT_STATUS_INVALID_PARAMETER;\n\t}\n\n\tif (!(fsp->notify = talloc_zero(NULL, struct notify_change_buf))) {\n\t\tDEBUG(0, (\"talloc failed\\n\"));\n\t\treturn NT_STATUS_NO_MEMORY;\n\t}\n\tfsp->notify->filter = filter;\n\tfsp->notify->subdir_filter = recursive ? filter : 0;\n\tfsp->notify->max_buffer_size = max_buffer_size;\n\n\tfsp_fullbasepath(fsp, fullpath, sizeof(fullpath));\n\n\t/*\n\t * Avoid /. at the end of the path name. notify can't deal with it.\n\t */\n\tif (len > 1 && fullpath[len-1] == '.' && fullpath[len-2] == '/') {\n\t\tfullpath[len-2] = '\\0';\n\t}\n\n\tif ((fsp->notify->filter != 0) ||\n\t    (fsp->notify->subdir_filter != 0)) {\n\t\tstatus = notify_add(fsp->conn->sconn->notify_ctx,\n\t\t\t\t    fullpath, fsp->notify->filter,\n\t\t\t\t    fsp->notify->subdir_filter, fsp);\n\t}\n\n\treturn status;\n}",
  "project": "samba",
  "hash": 309795918628451459392198770553612485822,
  "size": 41,
  "commit_id": "c300a85848350635e7ddd8129b31c4d439dc0f8a",
  "message": "s3: smbd: Ensure change notifies can't get set unless the directory handle is open for SEC_DIR_LIST.\n\nRemove knownfail entry.\n\nCVE-2020-14318\n\nBUG: https://bugzilla.samba.org/show_bug.cgi?id=14434\n\nSigned-off-by: Jeremy Allison <jra@samba.org>",
  "target": 1,
  "dataset": "other",
  "idx": 198641,
  "Bug Filter": "Security Vulnerability Fix\n\nConfidence Score: 0.95",
  "Bug Filter Confidence": 0.95,
  "Bug Filter Response": "\n\n**Final Output:**\n\nAnalysis: The patch addresses a security vulnerability (CVE-2020-14318) by ensuring proper directory handle permissions, preventing unauthorized access. The code diff removes a failing test, indicating resolution of the issue.\n\nFinal Classification: Security Vulnerability Fix\n\nConfidence Score: 0.95"
}