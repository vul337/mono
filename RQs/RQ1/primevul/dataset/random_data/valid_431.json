{
  "id": 431,
  "language": "cc",
  "cwe": "",
  "commit_url": "https://github.com/google/asylo/commit/ed0926bff0e423cd122a18b3d2fc772817f66825",
  "commit_sha": "ed0926bff0e423cd122a18b3d2fc772817f66825",
  "commit_msg": "Check return pointer is outside enclave in realloc\n\nPiperOrigin-RevId: 333769459\nChange-Id: If53b5f4317080b8abaf5c4f80ce751f150630bcb",
  "pr_url": null,
  "pr_info": null,
  "file_name": "asylo/platform/host_call/trusted/host_calls.cc",
  "func_name": "",
  "raw_func_from_json": "void *enc_untrusted_realloc(void *ptr, size_t size) {\n  MessageWriter input;\n  input.Push(reinterpret_cast<uint64_t>(ptr));\n  input.Push(static_cast<uint64_t>(size));\n\n  MessageReader output;\n  asylo::primitives::PrimitiveStatus status =\n      asylo::host_call::NonSystemCallDispatcher(\n          asylo::host_call::kReallocHandler, &input, &output);\n  CheckStatusAndParamCount(status, output, \"enc_untrusted_realloc\", 2);\n\n  void *result = output.next<void *>();\n  int klinux_errno = output.next<int>();\n\n  // realloc only sets the errno (ENOMEM) when output pointer is null and a\n  // non-zero |size| is provided.\n  if (!result && size != 0) {\n    errno = FromkLinuxErrorNumber(klinux_errno);\n  }\n  return result;\n}",
  "diff_func": "@@ -644,6 +644,12 @@ void *enc_untrusted_realloc(void *ptr, size_t size) {\n   if (!result && size != 0) {\n     errno = FromkLinuxErrorNumber(klinux_errno);\n   }\n+\n+  if (!::asylo::primitives::TrustedPrimitives::IsOutsideEnclave(result, size)) {\n+    ::asylo::primitives::TrustedPrimitives::BestEffortAbort(\n+        \"enc_untrusted_realloc: realloc result should be in untrusted \"\n+        \"memory\");\n+  }\n   return result;\n }\n ",
  "func": "void *enc_untrusted_realloc(void *ptr, size_t size) {\n  MessageWriter input;\n  input.Push(reinterpret_cast<uint64_t>(ptr));\n  input.Push(static_cast<uint64_t>(size));\n\n  MessageReader output;\n  asylo::primitives::PrimitiveStatus status =\n      asylo::host_call::NonSystemCallDispatcher(\n          asylo::host_call::kReallocHandler, &input, &output);\n  CheckStatusAndParamCount(status, output, \"enc_untrusted_realloc\", 2);\n\n  void *result = output.next<void *>();\n  int klinux_errno = output.next<int>();\n\n  // realloc only sets the errno (ENOMEM) when output pointer is null and a\n  // non-zero |size| is provided.\n  if (!result && size != 0) {\n    errno = FromkLinuxErrorNumber(klinux_errno);\n  }\n  return result;\n}",
  "project": "asylo",
  "hash": 94898475923552834445829106214602675036,
  "size": 21,
  "commit_id": "ed0926bff0e423cd122a18b3d2fc772817f66825",
  "message": "Check return pointer is outside enclave in realloc\n\nPiperOrigin-RevId: 333769459\nChange-Id: If53b5f4317080b8abaf5c4f80ce751f150630bcb",
  "target": 1,
  "dataset": "other",
  "idx": 195842
}