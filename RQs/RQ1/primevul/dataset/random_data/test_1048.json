{
  "id": 1048,
  "language": "c",
  "cwe": "",
  "commit_url": "https://github.com/adi-g15-ibm/qemu/commit/1caff0340f49c93d535c6558a5138d20d475315c",
  "commit_sha": "1caff0340f49c93d535c6558a5138d20d475315c",
  "commit_msg": "e1000: switch to use qemu_receive_packet() for loopback\n\nThis patch switches to use qemu_receive_packet() which can detect\nreentrancy and return early.\n\nThis is intended to address CVE-2021-3416.\n\nCc: Prasad J Pandit <ppandit@redhat.com>\nCc: qemu-stable@nongnu.org\nReviewed-by: Philippe Mathieu-Daudé <philmd@redhat.com>\nSigned-off-by: Jason Wang <jasowang@redhat.com>",
  "pr_url": null,
  "pr_info": null,
  "file_name": "hw/net/e1000.c",
  "func_name": "",
  "raw_func_from_json": "e1000_send_packet(E1000State *s, const uint8_t *buf, int size)\n{\n    static const int PTCregs[6] = { PTC64, PTC127, PTC255, PTC511,\n                                    PTC1023, PTC1522 };\n\n    NetClientState *nc = qemu_get_queue(s->nic);\n    if (s->phy_reg[PHY_CTRL] & MII_CR_LOOPBACK) {\n        nc->info->receive(nc, buf, size);\n    } else {\n        qemu_send_packet(nc, buf, size);\n    }\n    inc_tx_bcast_or_mcast_count(s, buf);\n    e1000x_increase_size_stats(s->mac_reg, PTCregs, size);\n}",
  "diff_func": "@@ -546,7 +546,7 @@ e1000_send_packet(E1000State *s, const uint8_t *buf, int size)\n \n     NetClientState *nc = qemu_get_queue(s->nic);\n     if (s->phy_reg[PHY_CTRL] & MII_CR_LOOPBACK) {\n-        nc->info->receive(nc, buf, size);\n+        qemu_receive_packet(nc, buf, size);\n     } else {\n         qemu_send_packet(nc, buf, size);\n     }",
  "func": "e1000_send_packet(E1000State *s, const uint8_t *buf, int size)\n{\n    static const int PTCregs[6] = { PTC64, PTC127, PTC255, PTC511,\n                                    PTC1023, PTC1522 };\n\n    NetClientState *nc = qemu_get_queue(s->nic);\n    if (s->phy_reg[PHY_CTRL] & MII_CR_LOOPBACK) {\n        nc->info->receive(nc, buf, size);\n    } else {\n        qemu_send_packet(nc, buf, size);\n    }\n    inc_tx_bcast_or_mcast_count(s, buf);\n    e1000x_increase_size_stats(s->mac_reg, PTCregs, size);\n}",
  "project": "qemu",
  "hash": 217225372257001861692199094880241428891,
  "size": 14,
  "commit_id": "1caff0340f49c93d535c6558a5138d20d475315c",
  "message": "e1000: switch to use qemu_receive_packet() for loopback\n\nThis patch switches to use qemu_receive_packet() which can detect\nreentrancy and return early.\n\nThis is intended to address CVE-2021-3416.\n\nCc: Prasad J Pandit <ppandit@redhat.com>\nCc: qemu-stable@nongnu.org\nReviewed-by: Philippe Mathieu-Daudé <philmd@redhat.com>\nSigned-off-by: Jason Wang <jasowang@redhat.com>",
  "target": 1,
  "dataset": "other",
  "idx": 210887
}