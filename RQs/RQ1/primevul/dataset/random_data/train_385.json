{
  "id": 385,
  "language": "c",
  "cwe": "CWE-119",
  "commit_url": "https://github.com/ljalves/linux_media/commit/cea4dcfdad926a27a18e188720efe0f2c9403456",
  "commit_sha": "cea4dcfdad926a27a18e188720efe0f2c9403456",
  "commit_msg": "iscsi-target: fix heap buffer overflow on error\n\nIf a key was larger than 64 bytes, as checked by iscsi_check_key(), the\nerror response packet, generated by iscsi_add_notunderstood_response(),\nwould still attempt to copy the entire key into the packet, overflowing\nthe structure on the heap.\n\nRemote preauthentication kernel memory corruption was possible if a\ntarget was configured and listening on the network.\n\nCVE-2013-2850\n\nSigned-off-by: Kees Cook <keescook@chromium.org>\nCc: stable@vger.kernel.org\nSigned-off-by: Nicholas Bellinger <nab@linux-iscsi.org>",
  "pr_url": null,
  "pr_info": null,
  "file_name": "drivers/target/iscsi/iscsi_target_parameters.c",
  "func_name": "",
  "raw_func_from_json": "static int iscsi_add_notunderstood_response(\n\tchar *key,\n\tchar *value,\n\tstruct iscsi_param_list *param_list)\n{\n\tstruct iscsi_extra_response *extra_response;\n\n\tif (strlen(value) > VALUE_MAXLEN) {\n\t\tpr_err(\"Value for notunderstood key \\\"%s\\\" exceeds %d,\"\n\t\t\t\" protocol error.\\n\", key, VALUE_MAXLEN);\n\t\treturn -1;\n\t}\n\n\textra_response = kzalloc(sizeof(struct iscsi_extra_response), GFP_KERNEL);\n\tif (!extra_response) {\n\t\tpr_err(\"Unable to allocate memory for\"\n\t\t\t\" struct iscsi_extra_response.\\n\");\n\t\treturn -1;\n \t}\n \tINIT_LIST_HEAD(&extra_response->er_list);\n \n\tstrncpy(extra_response->key, key, strlen(key) + 1);\n\tstrncpy(extra_response->value, NOTUNDERSTOOD,\n\t\t\tstrlen(NOTUNDERSTOOD) + 1);\n \n \tlist_add_tail(&extra_response->er_list,\n \t\t\t&param_list->extra_response_list);\n\treturn 0;\n}\n",
  "diff_func": "@@ -758,9 +758,9 @@ static int iscsi_add_notunderstood_response(\n \t}\n \tINIT_LIST_HEAD(&extra_response->er_list);\n \n-\tstrncpy(extra_response->key, key, strlen(key) + 1);\n-\tstrncpy(extra_response->value, NOTUNDERSTOOD,\n-\t\t\tstrlen(NOTUNDERSTOOD) + 1);\n+\tstrlcpy(extra_response->key, key, sizeof(extra_response->key));\n+\tstrlcpy(extra_response->value, NOTUNDERSTOOD,\n+\t\tsizeof(extra_response->value));\n \n \tlist_add_tail(&extra_response->er_list,\n \t\t\t&param_list->extra_response_list);\n@@ -1629,8 +1629,6 @@ int iscsi_decode_text_input(\n \n \t\tif (phase & PHASE_SECURITY) {\n \t\t\tif (iscsi_check_for_auth_key(key) > 0) {\n-\t\t\t\tchar *tmpptr = key + strlen(key);\n-\t\t\t\t*tmpptr = '=';\n \t\t\t\tkfree(tmpbuf);\n \t\t\t\treturn 1;\n \t\t\t}",
  "project": "linux",
  "commit_id": "cea4dcfdad926a27a18e188720efe0f2c9403456",
  "target": 1,
  "func": "static int iscsi_add_notunderstood_response(\n\tchar *key,\n\tchar *value,\n\tstruct iscsi_param_list *param_list)\n{\n\tstruct iscsi_extra_response *extra_response;\n\n\tif (strlen(value) > VALUE_MAXLEN) {\n\t\tpr_err(\"Value for notunderstood key \\\"%s\\\" exceeds %d,\"\n\t\t\t\" protocol error.\\n\", key, VALUE_MAXLEN);\n\t\treturn -1;\n\t}\n\n\textra_response = kzalloc(sizeof(struct iscsi_extra_response), GFP_KERNEL);\n\tif (!extra_response) {\n\t\tpr_err(\"Unable to allocate memory for\"\n\t\t\t\" struct iscsi_extra_response.\\n\");\n\t\treturn -1;\n \t}\n \tINIT_LIST_HEAD(&extra_response->er_list);\n \n\tstrncpy(extra_response->key, key, strlen(key) + 1);\n\tstrncpy(extra_response->value, NOTUNDERSTOOD,\n\t\t\tstrlen(NOTUNDERSTOOD) + 1);\n \n \tlist_add_tail(&extra_response->er_list,\n \t\t\t&param_list->extra_response_list);\n\treturn 0;\n}\n",
  "big_vul_idx": 179222,
  "idx": 1014,
  "hash": 100762060795839649631362584880083269766
}