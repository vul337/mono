{
  "id": 644,
  "language": "c",
  "cwe": "CWE-125",
  "commit_url": "https://github.com/ljalves/linux_media/commit/81cdb259fb6d8c1c4ecfeea389ff5a73c07f5755",
  "commit_sha": "81cdb259fb6d8c1c4ecfeea389ff5a73c07f5755",
  "commit_msg": "KVM: x86: fix out-of-bounds accesses of rtc_eoi map\n\nKVM was using arrays of size KVM_MAX_VCPUS with vcpu_id, but ID can be\nbigger that the maximal number of VCPUs, resulting in out-of-bounds\naccess.\n\nFound by syzkaller:\n\n  BUG: KASAN: slab-out-of-bounds in __apic_accept_irq+0xb33/0xb50 at addr [...]\n  Write of size 1 by task a.out/27101\n  CPU: 1 PID: 27101 Comm: a.out Not tainted 4.9.0-rc5+ #49\n  Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS Bochs 01/01/2011\n   [...]\n  Call Trace:\n   [...] __apic_accept_irq+0xb33/0xb50 arch/x86/kvm/lapic.c:905\n   [...] kvm_apic_set_irq+0x10e/0x180 arch/x86/kvm/lapic.c:495\n   [...] kvm_irq_delivery_to_apic+0x732/0xc10 arch/x86/kvm/irq_comm.c:86\n   [...] ioapic_service+0x41d/0x760 arch/x86/kvm/ioapic.c:360\n   [...] ioapic_set_irq+0x275/0x6c0 arch/x86/kvm/ioapic.c:222\n   [...] kvm_ioapic_inject_all arch/x86/kvm/ioapic.c:235\n   [...] kvm_set_ioapic+0x223/0x310 arch/x86/kvm/ioapic.c:670\n   [...] kvm_vm_ioctl_set_irqchip arch/x86/kvm/x86.c:3668\n   [...] kvm_arch_vm_ioctl+0x1a08/0x23c0 arch/x86/kvm/x86.c:3999\n   [...] kvm_vm_ioctl+0x1fa/0x1a70 arch/x86/kvm/../../../virt/kvm/kvm_main.c:3099\n\nReported-by: Dmitry Vyukov <dvyukov@google.com>\nCc: stable@vger.kernel.org\nFixes: af1bae5497b9 (\"KVM: x86: bump KVM_MAX_VCPU_ID to 1023\")\nReviewed-by: Paolo Bonzini <pbonzini@redhat.com>\nReviewed-by: David Hildenbrand <david@redhat.com>\nSigned-off-by: Radim Krčmář <rkrcmar@redhat.com>",
  "pr_url": null,
  "pr_info": null,
  "file_name": "arch/x86/kvm/ioapic.c",
  "func_name": "",
  "raw_func_from_json": " static void rtc_irq_eoi_tracking_reset(struct kvm_ioapic *ioapic)\n {\n \tioapic->rtc_status.pending_eoi = 0;\n\tbitmap_zero(ioapic->rtc_status.dest_map.map, KVM_MAX_VCPUS);\n }\n",
  "diff_func": "@@ -94,7 +94,7 @@ static unsigned long ioapic_read_indirect(struct kvm_ioapic *ioapic,\n static void rtc_irq_eoi_tracking_reset(struct kvm_ioapic *ioapic)\n {\n \tioapic->rtc_status.pending_eoi = 0;\n-\tbitmap_zero(ioapic->rtc_status.dest_map.map, KVM_MAX_VCPUS);\n+\tbitmap_zero(ioapic->rtc_status.dest_map.map, KVM_MAX_VCPU_ID);\n }\n \n static void kvm_rtc_eoi_tracking_restore_all(struct kvm_ioapic *ioapic);",
  "project": "linux",
  "commit_id": "81cdb259fb6d8c1c4ecfeea389ff5a73c07f5755",
  "target": 1,
  "func": " static void rtc_irq_eoi_tracking_reset(struct kvm_ioapic *ioapic)\n {\n \tioapic->rtc_status.pending_eoi = 0;\n\tbitmap_zero(ioapic->rtc_status.dest_map.map, KVM_MAX_VCPUS);\n }\n",
  "big_vul_idx": 180019,
  "idx": 1664,
  "hash": 131623410041848011402606013176532777833
}