{
  "id": 668,
  "language": "c",
  "cwe": "",
  "commit_url": "https://github.com/libconfuse/libconfuse/commit/d73777c2c3566fb2647727bb56d9a2295b81669b",
  "commit_sha": "d73777c2c3566fb2647727bb56d9a2295b81669b",
  "commit_msg": "Fix #163: unterminated username used with getpwnam()\n\nSigned-off-by: Joachim Wiberg <troglobit@gmail.com>",
  "pr_url": null,
  "pr_info": null,
  "file_name": "src/confuse.c",
  "func_name": "",
  "raw_func_from_json": "DLLIMPORT char *cfg_tilde_expand(const char *filename)\n{\n\tchar *expanded = NULL;\n\n#ifndef _WIN32\n\t/* Do tilde expansion */\n\tif (filename[0] == '~') {\n\t\tstruct passwd *passwd = NULL;\n\t\tconst char *file = NULL;\n\n\t\tif (filename[1] == '/' || filename[1] == 0) {\n\t\t\t/* ~ or ~/path */\n\t\t\tpasswd = getpwuid(geteuid());\n\t\t\tfile = filename + 1;\n\t\t} else {\n\t\t\t/* ~user or ~user/path */\n\t\t\tchar *user;\n\n\t\t\tfile = strchr(filename, '/');\n\t\t\tif (file == NULL)\n\t\t\t\tfile = filename + strlen(filename);\n\n\t\t\tuser = malloc(file - filename);\n\t\t\tif (!user)\n\t\t\t\treturn NULL;\n\n\t\t\tstrncpy(user, filename + 1, file - filename - 1);\n\t\t\tpasswd = getpwnam(user);\n\t\t\tfree(user);\n\t\t}\n\n\t\tif (passwd) {\n\t\t\texpanded = malloc(strlen(passwd->pw_dir) + strlen(file) + 1);\n\t\t\tif (!expanded)\n\t\t\t\treturn NULL;\n\n\t\t\tstrcpy(expanded, passwd->pw_dir);\n\t\t\tstrcat(expanded, file);\n\t\t}\n\t}\n#endif\n\tif (!expanded)\n\t\texpanded = strdup(filename);\n\n\treturn expanded;\n}",
  "diff_func": "@@ -1894,18 +1894,20 @@ DLLIMPORT char *cfg_tilde_expand(const char *filename)\n \t\t\tpasswd = getpwuid(geteuid());\n \t\t\tfile = filename + 1;\n \t\t} else {\n-\t\t\t/* ~user or ~user/path */\n-\t\t\tchar *user;\n+\t\t\tchar *user; /* ~user or ~user/path */\n+\t\t\tsize_t len;\n \n \t\t\tfile = strchr(filename, '/');\n \t\t\tif (file == NULL)\n \t\t\t\tfile = filename + strlen(filename);\n \n-\t\t\tuser = malloc(file - filename);\n+\t\t\tlen = file - filename - 1;\n+\t\t\tuser = malloc(len + 1);\n \t\t\tif (!user)\n \t\t\t\treturn NULL;\n \n-\t\t\tstrncpy(user, filename + 1, file - filename - 1);\n+\t\t\tstrncpy(user, &filename[1], len);\n+\t\t\tuser[len] = 0;\n \t\t\tpasswd = getpwnam(user);\n \t\t\tfree(user);\n \t\t}",
  "func": "DLLIMPORT char *cfg_tilde_expand(const char *filename)\n{\n\tchar *expanded = NULL;\n\n#ifndef _WIN32\n\t/* Do tilde expansion */\n\tif (filename[0] == '~') {\n\t\tstruct passwd *passwd = NULL;\n\t\tconst char *file = NULL;\n\n\t\tif (filename[1] == '/' || filename[1] == 0) {\n\t\t\t/* ~ or ~/path */\n\t\t\tpasswd = getpwuid(geteuid());\n\t\t\tfile = filename + 1;\n\t\t} else {\n\t\t\t/* ~user or ~user/path */\n\t\t\tchar *user;\n\n\t\t\tfile = strchr(filename, '/');\n\t\t\tif (file == NULL)\n\t\t\t\tfile = filename + strlen(filename);\n\n\t\t\tuser = malloc(file - filename);\n\t\t\tif (!user)\n\t\t\t\treturn NULL;\n\n\t\t\tstrncpy(user, filename + 1, file - filename - 1);\n\t\t\tpasswd = getpwnam(user);\n\t\t\tfree(user);\n\t\t}\n\n\t\tif (passwd) {\n\t\t\texpanded = malloc(strlen(passwd->pw_dir) + strlen(file) + 1);\n\t\t\tif (!expanded)\n\t\t\t\treturn NULL;\n\n\t\t\tstrcpy(expanded, passwd->pw_dir);\n\t\t\tstrcat(expanded, file);\n\t\t}\n\t}\n#endif\n\tif (!expanded)\n\t\texpanded = strdup(filename);\n\n\treturn expanded;\n}",
  "project": "libconfuse",
  "hash": 274166286719183774870337789066832153738,
  "size": 46,
  "commit_id": "d73777c2c3566fb2647727bb56d9a2295b81669b",
  "message": "Fix #163: unterminated username used with getpwnam()\n\nSigned-off-by: Joachim Wiberg <troglobit@gmail.com>",
  "target": 1,
  "dataset": "other",
  "idx": 196920
}