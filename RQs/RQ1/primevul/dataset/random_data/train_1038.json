{
  "id": 1038,
  "language": "c",
  "cwe": "CWE-404",
  "commit_url": "https://github.com/sjp38/linux.personal/commit/c70422f760c120480fee4de6c38804c72aa26bc1",
  "commit_sha": "c70422f760c120480fee4de6c38804c72aa26bc1",
  "commit_msg": "Merge tag 'nfsd-4.12' of git://linux-nfs.org/~bfields/linux\n\nPull nfsd updates from Bruce Fields:\n \"Another RDMA update from Chuck Lever, and a bunch of miscellaneous\n  bugfixes\"\n\n* tag 'nfsd-4.12' of git://linux-nfs.org/~bfields/linux: (26 commits)\n  nfsd: Fix up the \"supattr_exclcreat\" attributes\n  nfsd: encoders mustn't use unitialized values in error cases\n  nfsd: fix undefined behavior in nfsd4_layout_verify\n  lockd: fix lockd shutdown race\n  NFSv4: Fix callback server shutdown\n  SUNRPC: Refactor svc_set_num_threads()\n  NFSv4.x/callback: Create the callback service through svc_create_pooled\n  lockd: remove redundant check on block\n  svcrdma: Clean out old XDR encoders\n  svcrdma: Remove the req_map cache\n  svcrdma: Remove unused RDMA Write completion handler\n  svcrdma: Reduce size of sge array in struct svc_rdma_op_ctxt\n  svcrdma: Clean up RPC-over-RDMA backchannel reply processing\n  svcrdma: Report Write/Reply chunk overruns\n  svcrdma: Clean up RDMA_ERROR path\n  svcrdma: Use rdma_rw API in RPC reply path\n  svcrdma: Introduce local rdma_rw API helpers\n  svcrdma: Clean up svc_rdma_get_inv_rkey()\n  svcrdma: Add helper to save pages under I/O\n  svcrdma: Eliminate RPCRDMA_SQ_DEPTH_MULT\n  ...",
  "pr_url": null,
  "pr_info": null,
  "file_name": "fs/lockd/svc.c",
  "func_name": "",
  "raw_func_from_json": "nfsd4_layout_verify(struct svc_export *exp, unsigned int layout_type)\n{\n\tif (!exp->ex_layout_types) {\n\t\tdprintk(\"%s: export does not support pNFS\\n\", __func__);\n \t\treturn NULL;\n \t}\n \n\tif (!(exp->ex_layout_types & (1 << layout_type))) {\n \t\tdprintk(\"%s: layout type %d not supported\\n\",\n \t\t\t__func__, layout_type);\n \t\treturn NULL;\n\t}\n\n\treturn nfsd4_layout_ops[layout_type];\n}\n",
  "diff_func": "@@ -132,6 +132,8 @@ lockd(void *vrqstp)\n {\n \tint\t\terr = 0;\n \tstruct svc_rqst *rqstp = vrqstp;\n+\tstruct net *net = &init_net;\n+\tstruct lockd_net *ln = net_generic(net, lockd_net_id);\n \n \t/* try_to_freeze() is called from svc_recv() */\n \tset_freezable();\n@@ -176,6 +178,8 @@ lockd(void *vrqstp)\n \tif (nlmsvc_ops)\n \t\tnlmsvc_invalidate_all();\n \tnlm_shutdown_hosts();\n+\tcancel_delayed_work_sync(&ln->grace_period_end);\n+\tlocks_end_grace(&ln->lockd_manager);\n \treturn 0;\n }\n \n@@ -270,8 +274,6 @@ static void lockd_down_net(struct svc_serv *serv, struct net *net)\n \tif (ln->nlmsvc_users) {\n \t\tif (--ln->nlmsvc_users == 0) {\n \t\t\tnlm_shutdown_hosts_net(net);\n-\t\t\tcancel_delayed_work_sync(&ln->grace_period_end);\n-\t\t\tlocks_end_grace(&ln->lockd_manager);\n \t\t\tsvc_shutdown_net(serv, net);\n \t\t\tdprintk(\"lockd_down_net: per-net data destroyed; net=%p\\n\", net);\n \t\t}",
  "project": "linux",
  "commit_id": "c70422f760c120480fee4de6c38804c72aa26bc1",
  "target": 1,
  "func": "nfsd4_layout_verify(struct svc_export *exp, unsigned int layout_type)\n{\n\tif (!exp->ex_layout_types) {\n\t\tdprintk(\"%s: export does not support pNFS\\n\", __func__);\n \t\treturn NULL;\n \t}\n \n\tif (!(exp->ex_layout_types & (1 << layout_type))) {\n \t\tdprintk(\"%s: layout type %d not supported\\n\",\n \t\t\t__func__, layout_type);\n \t\treturn NULL;\n\t}\n\n\treturn nfsd4_layout_ops[layout_type];\n}\n",
  "big_vul_idx": 181316,
  "idx": 2802,
  "hash": 218091687735945608407980470153263044879
}