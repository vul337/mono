{
  "id": 497,
  "language": "c",
  "cwe": "CWE-189",
  "commit_url": "https://github.com/sailfishos-mirror/file/commit/36fadd29849b8087af9f4586f89dbf74ea45be67",
  "commit_sha": "36fadd29849b8087af9f4586f89dbf74ea45be67",
  "commit_msg": "Use the proper sector size when checking stream offsets (Francisco Alonso and\nJan Kaluza at RedHat)",
  "pr_url": null,
  "pr_info": null,
  "file_name": "src/cdf.c",
  "func_name": "",
  "raw_func_from_json": "cdf_check_stream_offset(const cdf_stream_t *sst, const cdf_header_t *h,\n    const void *p, size_t tail, int line)\n {\n \tconst char *b = (const char *)sst->sst_tab;\n \tconst char *e = ((const char *)p) + tail;\n \t(void)&line;\n\tif (e >= b && (size_t)(e - b) <= CDF_SEC_SIZE(h) * sst->sst_len)\n \t\treturn 0;\n \tDPRINTF((\"%d: offset begin %p < end %p || %\" SIZE_T_FORMAT \"u\"\n \t    \" > %\" SIZE_T_FORMAT \"u [%\" SIZE_T_FORMAT \"u %\"\n \t    SIZE_T_FORMAT \"u]\\n\", line, b, e, (size_t)(e - b),\n\t    CDF_SEC_SIZE(h) * sst->sst_len, CDF_SEC_SIZE(h), sst->sst_len));\n \terrno = EFTYPE;\n \treturn -1;\n }\n",
  "diff_func": "@@ -35,7 +35,7 @@\n #include \"file.h\"\n \n #ifndef lint\n-FILE_RCSID(\"@(#)$File: cdf.c,v 1.60 2014/05/21 13:04:38 christos Exp $\")\n+FILE_RCSID(\"@(#)$File: cdf.c,v 1.61 2014/06/04 17:23:19 christos Exp $\")\n #endif\n \n #include <assert.h>\n@@ -267,13 +267,15 @@ cdf_check_stream_offset(const cdf_stream_t *sst, const cdf_header_t *h,\n {\n \tconst char *b = (const char *)sst->sst_tab;\n \tconst char *e = ((const char *)p) + tail;\n+\tsize_t ss = sst->sst_dirlen < h->h_min_size_standard_stream ?\n+\t    CDF_SHORT_SEC_SIZE(h) : CDF_SEC_SIZE(h);\n \t(void)&line;\n-\tif (e >= b && (size_t)(e - b) <= CDF_SEC_SIZE(h) * sst->sst_len)\n+\tif (e >= b && (size_t)(e - b) <= ss * sst->sst_len)\n \t\treturn 0;\n \tDPRINTF((\"%d: offset begin %p < end %p || %\" SIZE_T_FORMAT \"u\"\n \t    \" > %\" SIZE_T_FORMAT \"u [%\" SIZE_T_FORMAT \"u %\"\n \t    SIZE_T_FORMAT \"u]\\n\", line, b, e, (size_t)(e - b),\n-\t    CDF_SEC_SIZE(h) * sst->sst_len, CDF_SEC_SIZE(h), sst->sst_len));\n+\t    ss * sst->sst_len, ss, sst->sst_len));\n \terrno = EFTYPE;\n \treturn -1;\n }",
  "project": "file",
  "commit_id": "36fadd29849b8087af9f4586f89dbf74ea45be67",
  "target": 1,
  "func": "cdf_check_stream_offset(const cdf_stream_t *sst, const cdf_header_t *h,\n    const void *p, size_t tail, int line)\n {\n \tconst char *b = (const char *)sst->sst_tab;\n \tconst char *e = ((const char *)p) + tail;\n \t(void)&line;\n\tif (e >= b && (size_t)(e - b) <= CDF_SEC_SIZE(h) * sst->sst_len)\n \t\treturn 0;\n \tDPRINTF((\"%d: offset begin %p < end %p || %\" SIZE_T_FORMAT \"u\"\n \t    \" > %\" SIZE_T_FORMAT \"u [%\" SIZE_T_FORMAT \"u %\"\n \t    SIZE_T_FORMAT \"u]\\n\", line, b, e, (size_t)(e - b),\n\t    CDF_SEC_SIZE(h) * sst->sst_len, CDF_SEC_SIZE(h), sst->sst_len));\n \terrno = EFTYPE;\n \treturn -1;\n }\n",
  "big_vul_idx": 179538,
  "idx": 1287,
  "hash": 126331237157471830789816841088958865442
}