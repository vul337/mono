{
    "cve_id": "CVE-2021-41193",
    "cwe_ids": [
        "CWE-134"
    ],
    "cvss_vector": "AV:N/AC:L/Au:N/C:P/I:P/A:P",
    "cvss_is_v3": false,
    "repo_name": "wireapp/wire-avs",
    "commit_msg": "Import latest release-7.1 files from old repo",
    "commit_hash": "40d373ede795443ae6f2f756e9fb1f4f4ae90bbe",
    "git_url": "https://github.com/wireapp/wire-avs/commit/40d373ede795443ae6f2f756e9fb1f4f4ae90bbe",
    "file_path": "tools/zcall/conv.c",
    "func_name": "prekey_handler",
    "func_before": "static void prekey_handler(const char *userid,\n\t\t\t   const uint8_t *key, size_t key_len,\n\t\t\t   uint16_t id, const char *clientid,\n\t\t\t   bool last, void *arg)\n{\n\tstruct session *sess;\n\tchar lclientid[64];\n\tint err;\n\n\toutput(\"prekey_handler: %zu bytes, user:%s[%u] -> %s\\n\",\n\t       key_len, userid, id, clientid);\n\n\n\terr = client_id_load(lclientid, sizeof(lclientid));\n\tif (err) {\n\t\tdebug(\"my clientid not set -- cannot store prekeys\\n\");\n\t\treturn;\n\t}\n\n\tsess = cryptobox_session_find(g_cryptobox, userid, clientid, lclientid);\n\tif (sess) {\n\t\toutput(\"prekey: session found\\n\");\n\t}\n\telse {\n\t\tinfo(\"conv: adding key to cryptobox for clientid=%s\\n\",\n\t\t     clientid);\n\n\t\terr = cryptobox_session_add_send(g_cryptobox, userid, clientid, lclientid,\n\t\t\t\t\t\t key, key_len);\n\t\tif (err) {\n\t\t\twarning(\"cryptobox_session_add_send failed (%m)\\n\",\n\t\t\t\terr);\n\t\t}\n\t}\n}",
    "abstract_func_before": "static void prekey_handler(const char *VAR_0,\n\t\t\t   const uint8_t *VAR_1, size_t VAR_2,\n\t\t\t   uint16_t VAR_3, const char *VAR_4,\n\t\t\t   bool VAR_5, void *VAR_6)\n{\n\tstruct session *VAR_7;\n\tchar VAR_8[64];\n\tint VAR_9;\n\n\toutput(\"prekey_handler: %zu bytes, user:%s[%u] -> %s\\n\",\n\t       VAR_2, VAR_0, VAR_3, VAR_4);\n\n\n\tVAR_9 = client_id_load(VAR_8, sizeof(VAR_8));\n\tif (VAR_9) {\n\t\tdebug(\"my clientid not set -- cannot store prekeys\\n\");\n\t\treturn;\n\t}\n\n\tVAR_7 = cryptobox_session_find(VAR_10, VAR_0, VAR_4, VAR_8);\n\tif (VAR_7) {\n\t\toutput(\"prekey: session found\\n\");\n\t}\n\telse {\n\t\tinfo(\"conv: adding key to cryptobox for clientid=%s\\n\",\n\t\t     VAR_4);\n\n\t\tVAR_9 = cryptobox_session_add_send(VAR_10, VAR_0, VAR_4, VAR_8,\n\t\t\t\t\t\t VAR_1, VAR_2);\n\t\tif (VAR_9) {\n\t\t\twarning(\"cryptobox_session_add_send failed (%m)\\n\",\n\t\t\t\tVAR_9);\n\t\t}\n\t}\n}",
    "func_graph_path_before": "wireapp/wire-avs/40d373ede795443ae6f2f756e9fb1f4f4ae90bbe/conv.c/vul/before/0.json",
    "func": "static void prekey_handler(const char *userid,\n\t\t\t   const uint8_t *key, size_t key_len,\n\t\t\t   uint16_t id, const char *clientid,\n\t\t\t   bool last, void *arg)\n{\n\tstruct session *sess;\n\tchar lclientid[64];\n\tint err;\n\n\toutput(\"prekey_handler: %zu bytes, user:%s[%u] -> %s\\n\",\n\t       key_len, userid, id, clientid);\n\n\terr = client_id_load(lclientid, sizeof(lclientid));\n\tif (err) {\n\t\tdebug(\"my clientid not set -- cannot store prekeys\\n\");\n\t\treturn;\n\t}\n\n\tsess = cryptobox_session_find(g_cryptobox, userid, clientid, lclientid);\n\tif (sess) {\n\t\toutput(\"prekey: session found\\n\");\n\t}\n\telse {\n\t\tinfo(\"conv: adding key to cryptobox for clientid=%s\\n\",\n\t\t     clientid);\n\n\t\terr = cryptobox_session_add_send(g_cryptobox, userid, clientid, lclientid,\n\t\t\t\t\t\t key, key_len);\n\t\tif (err) {\n\t\t\twarning(\"cryptobox_session_add_send failed (%m)\\n\",\n\t\t\t\terr);\n\t\t}\n\t}\n\n\tif (last) {\n\t\toutput(\"prekey_handler: all prekeys fetched\\n\");\n\t}\n}",
    "abstract_func": "static void prekey_handler(const char *VAR_0,\n\t\t\t   const uint8_t *VAR_1, size_t VAR_2,\n\t\t\t   uint16_t VAR_3, const char *VAR_4,\n\t\t\t   bool VAR_5, void *VAR_6)\n{\n\tstruct session *VAR_7;\n\tchar VAR_8[64];\n\tint VAR_9;\n\n\toutput(\"prekey_handler: %zu bytes, user:%s[%u] -> %s\\n\",\n\t       VAR_2, VAR_0, VAR_3, VAR_4);\n\n\tVAR_9 = client_id_load(VAR_8, sizeof(VAR_8));\n\tif (VAR_9) {\n\t\tdebug(\"my clientid not set -- cannot store prekeys\\n\");\n\t\treturn;\n\t}\n\n\tVAR_7 = cryptobox_session_find(VAR_10, VAR_0, VAR_4, VAR_8);\n\tif (VAR_7) {\n\t\toutput(\"prekey: session found\\n\");\n\t}\n\telse {\n\t\tinfo(\"conv: adding key to cryptobox for clientid=%s\\n\",\n\t\t     VAR_4);\n\n\t\tVAR_9 = cryptobox_session_add_send(VAR_10, VAR_0, VAR_4, VAR_8,\n\t\t\t\t\t\t VAR_1, VAR_2);\n\t\tif (VAR_9) {\n\t\t\twarning(\"cryptobox_session_add_send failed (%m)\\n\",\n\t\t\t\tVAR_9);\n\t\t}\n\t}\n\n\tif (VAR_5) {\n\t\toutput(\"prekey_handler: all prekeys fetched\\n\");\n\t}\n}",
    "func_graph_path": "wireapp/wire-avs/40d373ede795443ae6f2f756e9fb1f4f4ae90bbe/conv.c/vul/after/0.json",
    "diff_func": "--- func_before\n+++ func_after\n@@ -9,7 +9,6 @@\n \n \toutput(\"prekey_handler: %zu bytes, user:%s[%u] -> %s\\n\",\n \t       key_len, userid, id, clientid);\n-\n \n \terr = client_id_load(lclientid, sizeof(lclientid));\n \tif (err) {\n@@ -32,4 +31,8 @@\n \t\t\t\terr);\n \t\t}\n \t}\n+\n+\tif (last) {\n+\t\toutput(\"prekey_handler: all prekeys fetched\\n\");\n+\t}\n }",
    "diff_line_info": {
        "deleted_lines": [
            ""
        ],
        "added_lines": [
            "",
            "\tif (last) {",
            "\t\toutput(\"prekey_handler: all prekeys fetched\\n\");",
            "\t}"
        ]
    },
    "is_vul": true,
    "pr_url": null,
    "description": "no more info"
}