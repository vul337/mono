{
    "cve_id": "CVE-2023-30216",
    "cwe_ids": [
        "CWE-639"
    ],
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:N",
    "cvss_is_v3": true,
    "repo_name": "newbee-ltd/newbee-mall",
    "commit_msg": ":bug: Fixing a bug ##https://github.com/newbee-ltd/newbee-mall/issues/75 ##https://github.com/newbee-ltd/newbee-mall/issues/76",
    "commit_hash": "4f8948579ddd6843a2e313fdd55aafc809246f63",
    "git_url": "https://github.com/newbee-ltd/newbee-mall/commit/4f8948579ddd6843a2e313fdd55aafc809246f63",
    "file_path": "src/main/java/ltd/newbee/mall/service/impl/NewBeeMallUserServiceImpl.java",
    "func_name": "updateUserInfo",
    "func_before": "@Override\n    public NewBeeMallUserVO updateUserInfo(MallUser mallUser, HttpSession httpSession) {\n        NewBeeMallUserVO userTemp = (NewBeeMallUserVO) httpSession.getAttribute(Constants.MALL_USER_SESSION_KEY);\n        MallUser userFromDB = mallUserMapper.selectByPrimaryKey(userTemp.getUserId());\n        if (userFromDB != null) {\n            if (!StringUtils.isEmpty(mallUser.getNickName())) {\n                userFromDB.setNickName(NewBeeMallUtils.cleanString(mallUser.getNickName()));\n            }\n            if (!StringUtils.isEmpty(mallUser.getAddress())) {\n                userFromDB.setAddress(NewBeeMallUtils.cleanString(mallUser.getAddress()));\n            }\n            if (!StringUtils.isEmpty(mallUser.getIntroduceSign())) {\n                userFromDB.setIntroduceSign(NewBeeMallUtils.cleanString(mallUser.getIntroduceSign()));\n            }\n            if (mallUserMapper.updateByPrimaryKeySelective(userFromDB) > 0) {\n                NewBeeMallUserVO newBeeMallUserVO = new NewBeeMallUserVO();\n                userFromDB = mallUserMapper.selectByPrimaryKey(mallUser.getUserId());\n                BeanUtil.copyProperties(userFromDB, newBeeMallUserVO);\n                httpSession.setAttribute(Constants.MALL_USER_SESSION_KEY, newBeeMallUserVO);\n                return newBeeMallUserVO;\n            }\n        }\n        return null;\n    }",
    "abstract_func_before": "@Override\n    public NewBeeMallUserVO updateUserInfo(MallUser VAR_0, HttpSession VAR_1) {\n        NewBeeMallUserVO VAR_2 = (NewBeeMallUserVO) VAR_1.getAttribute(VAR_3.MALL_USER_SESSION_KEY);\n        MallUser VAR_4 = VAR_5.selectByPrimaryKey(VAR_2.getUserId());\n        if (VAR_4 != null) {\n            if (!VAR_6.isEmpty(VAR_0.getNickName())) {\n                VAR_4.setNickName(VAR_7.cleanString(VAR_0.getNickName()));\n            }\n            if (!VAR_6.isEmpty(VAR_0.getAddress())) {\n                VAR_4.setAddress(VAR_7.cleanString(VAR_0.getAddress()));\n            }\n            if (!VAR_6.isEmpty(VAR_0.getIntroduceSign())) {\n                VAR_4.setIntroduceSign(VAR_7.cleanString(VAR_0.getIntroduceSign()));\n            }\n            if (VAR_5.updateByPrimaryKeySelective(VAR_4) > 0) {\n                NewBeeMallUserVO VAR_8 = new NewBeeMallUserVO();\n                VAR_4 = VAR_5.selectByPrimaryKey(VAR_0.getUserId());\n                VAR_9.copyProperties(VAR_4, VAR_8);\n                VAR_1.setAttribute(VAR_3.MALL_USER_SESSION_KEY, VAR_8);\n                return VAR_8;\n            }\n        }\n        return null;\n    }",
    "func_graph_path_before": "newbee-ltd/newbee-mall/4f8948579ddd6843a2e313fdd55aafc809246f63/NewBeeMallUserServiceImpl.java/vul/before/0.json",
    "func": "@Override\n    public NewBeeMallUserVO updateUserInfo(MallUser mallUser, HttpSession httpSession) {\n        NewBeeMallUserVO userTemp = (NewBeeMallUserVO) httpSession.getAttribute(Constants.MALL_USER_SESSION_KEY);\n        MallUser userFromDB = mallUserMapper.selectByPrimaryKey(userTemp.getUserId());\n        if (userFromDB != null) {\n            if (!StringUtils.isEmpty(mallUser.getNickName())) {\n                userFromDB.setNickName(NewBeeMallUtils.cleanString(mallUser.getNickName()));\n            }\n            if (!StringUtils.isEmpty(mallUser.getAddress())) {\n                userFromDB.setAddress(NewBeeMallUtils.cleanString(mallUser.getAddress()));\n            }\n            if (!StringUtils.isEmpty(mallUser.getIntroduceSign())) {\n                userFromDB.setIntroduceSign(NewBeeMallUtils.cleanString(mallUser.getIntroduceSign()));\n            }\n            if (mallUserMapper.updateByPrimaryKeySelective(userFromDB) > 0) {\n                NewBeeMallUserVO newBeeMallUserVO = new NewBeeMallUserVO();\n                BeanUtil.copyProperties(userFromDB, newBeeMallUserVO);\n                httpSession.setAttribute(Constants.MALL_USER_SESSION_KEY, newBeeMallUserVO);\n                return newBeeMallUserVO;\n            }\n        }\n        return null;\n    }",
    "abstract_func": "@Override\n    public NewBeeMallUserVO updateUserInfo(MallUser VAR_0, HttpSession VAR_1) {\n        NewBeeMallUserVO VAR_2 = (NewBeeMallUserVO) VAR_1.getAttribute(VAR_3.MALL_USER_SESSION_KEY);\n        MallUser VAR_4 = VAR_5.selectByPrimaryKey(VAR_2.getUserId());\n        if (VAR_4 != null) {\n            if (!VAR_6.isEmpty(VAR_0.getNickName())) {\n                VAR_4.setNickName(VAR_7.cleanString(VAR_0.getNickName()));\n            }\n            if (!VAR_6.isEmpty(VAR_0.getAddress())) {\n                VAR_4.setAddress(VAR_7.cleanString(VAR_0.getAddress()));\n            }\n            if (!VAR_6.isEmpty(VAR_0.getIntroduceSign())) {\n                VAR_4.setIntroduceSign(VAR_7.cleanString(VAR_0.getIntroduceSign()));\n            }\n            if (VAR_5.updateByPrimaryKeySelective(VAR_4) > 0) {\n                NewBeeMallUserVO VAR_8 = new NewBeeMallUserVO();\n                VAR_9.copyProperties(VAR_4, VAR_8);\n                VAR_1.setAttribute(VAR_3.MALL_USER_SESSION_KEY, VAR_8);\n                return VAR_8;\n            }\n        }\n        return null;\n    }",
    "func_graph_path": "newbee-ltd/newbee-mall/4f8948579ddd6843a2e313fdd55aafc809246f63/NewBeeMallUserServiceImpl.java/vul/after/0.json",
    "diff_func": "--- func_before\n+++ func_after\n@@ -14,7 +14,6 @@\n             }\n             if (mallUserMapper.updateByPrimaryKeySelective(userFromDB) > 0) {\n                 NewBeeMallUserVO newBeeMallUserVO = new NewBeeMallUserVO();\n-                userFromDB = mallUserMapper.selectByPrimaryKey(mallUser.getUserId());\n                 BeanUtil.copyProperties(userFromDB, newBeeMallUserVO);\n                 httpSession.setAttribute(Constants.MALL_USER_SESSION_KEY, newBeeMallUserVO);\n                 return newBeeMallUserVO;",
    "diff_line_info": {
        "deleted_lines": [
            "                userFromDB = mallUserMapper.selectByPrimaryKey(mallUser.getUserId());"
        ],
        "added_lines": []
    },
    "is_vul": true,
    "pr_url": null,
    "description": "no more info"
}