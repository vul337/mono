{
    "cve_id": "CVE-2023-6563",
    "cwe_ids": [
        "CWE-770"
    ],
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:N/I:N/A:H",
    "cvss_is_v3": true,
    "repo_name": "keycloak",
    "commit_msg": "Fix performance issues with many offline sessions\n\nFixes: #13340",
    "commit_hash": "11eb952e1df7cbb95b1e2c101dfd4839a2375695",
    "git_url": "https://github.com/keycloak/keycloak/commit/11eb952e1df7cbb95b1e2c101dfd4839a2375695",
    "file_path": "model/jpa/src/main/java/org/keycloak/models/jpa/session/JpaUserSessionPersisterProvider.java",
    "func_name": "loadUserSessionsStream",
    "func_before": "public Stream<UserSessionModel> loadUserSessionsStream(Integer firstResult, Integer maxResults, boolean offline,\n                                                           String lastUserSessionId) {\n        String offlineStr = offlineToString(offline);\n\n        TypedQuery<PersistentUserSessionEntity> query = paginateQuery(em.createNamedQuery(\"findUserSessionsOrderedById\", PersistentUserSessionEntity.class)\n            .setParameter(\"offline\", offlineStr)\n            .setParameter(\"lastSessionId\", lastUserSessionId), firstResult, maxResults);\n\n        return loadUserSessionsWithClientSessions(query, offlineStr);\n    }",
    "abstract_func_before": "public Stream<UserSessionModel> loadUserSessionsStream(Integer VAR_0, Integer VAR_1, boolean VAR_2,\n                                                           String VAR_3) {\n        String VAR_4 = offlineToString(VAR_2);\n\n        TypedQuery<PersistentUserSessionEntity> VAR_5 = paginateQuery(VAR_6.createNamedQuery(\"findUserSessionsOrderedById\", PersistentUserSessionEntity.class)\n            .setParameter(\"offline\", VAR_4)\n            .setParameter(\"lastSessionId\", VAR_3), VAR_0, VAR_1);\n\n        return loadUserSessionsWithClientSessions(VAR_5, VAR_4);\n    }",
    "func_graph_path_before": "keycloak/11eb952e1df7cbb95b1e2c101dfd4839a2375695/JpaUserSessionPersisterProvider.java/vul/before/0.json",
    "func": "public Stream<UserSessionModel> loadUserSessionsStream(Integer firstResult, Integer maxResults, boolean offline,\n                                                           String lastUserSessionId) {\n        String offlineStr = offlineToString(offline);\n\n        TypedQuery<PersistentUserSessionEntity> query = paginateQuery(em.createNamedQuery(\"findUserSessionsOrderedById\", PersistentUserSessionEntity.class)\n            .setParameter(\"offline\", offlineStr)\n            .setParameter(\"lastSessionId\", lastUserSessionId), firstResult, maxResults);\n\n        return loadUserSessionsWithClientSessions(query, offlineStr, false);\n    }",
    "abstract_func": "public Stream<UserSessionModel> loadUserSessionsStream(Integer VAR_0, Integer VAR_1, boolean VAR_2,\n                                                           String VAR_3) {\n        String VAR_4 = offlineToString(VAR_2);\n\n        TypedQuery<PersistentUserSessionEntity> VAR_5 = paginateQuery(VAR_6.createNamedQuery(\"findUserSessionsOrderedById\", PersistentUserSessionEntity.class)\n            .setParameter(\"offline\", VAR_4)\n            .setParameter(\"lastSessionId\", VAR_3), VAR_0, VAR_1);\n\n        return loadUserSessionsWithClientSessions(VAR_5, VAR_4, false);\n    }",
    "func_graph_path": "keycloak/11eb952e1df7cbb95b1e2c101dfd4839a2375695/JpaUserSessionPersisterProvider.java/vul/after/0.json",
    "diff_func": "--- func_before\n+++ func_after\n@@ -6,5 +6,5 @@\n             .setParameter(\"offline\", offlineStr)\n             .setParameter(\"lastSessionId\", lastUserSessionId), firstResult, maxResults);\n \n-        return loadUserSessionsWithClientSessions(query, offlineStr);\n+        return loadUserSessionsWithClientSessions(query, offlineStr, false);\n     }",
    "diff_line_info": {
        "deleted_lines": [
            "        return loadUserSessionsWithClientSessions(query, offlineStr);"
        ],
        "added_lines": [
            "        return loadUserSessionsWithClientSessions(query, offlineStr, false);"
        ]
    },
    "is_vul": true,
    "pr_url": "https://github.com/keycloak/keycloak/pull/15463",
    "description": "Fixes: #13340\r\n\r\nPipeline run: https://master-jenkins.redhat.com/job/universal-test-pipeline-server/2385/\r\n<!---\r\nPlease read https://github.com/keycloak/keycloak/blob/main/CONTRIBUTING.md and follow these guidelines when contributing to Keycloak\r\n-->\r\n"
}