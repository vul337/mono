{
    "cve_id": "CVE-2022-42003",
    "cwe_ids": [
        "CWE-502"
    ],
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H",
    "cvss_is_v3": true,
    "repo_name": "FasterXML/jackson-databind",
    "commit_msg": "Fix #3590",
    "commit_hash": "d78d00ee7b5245b93103fef3187f70543d67ca33",
    "git_url": "https://github.com/FasterXML/jackson-databind/commit/d78d00ee7b5245b93103fef3187f70543d67ca33",
    "file_path": "src/main/java/com/fasterxml/jackson/databind/deser/std/StdDeserializer.java",
    "func_name": "_parseLongPrimitive",
    "func_before": "protected final long _parseLongPrimitive(JsonParser p, DeserializationContext ctxt)\n            throws IOException\n    {\n        String text;\n        switch (p.currentTokenId()) {\n        case JsonTokenId.ID_STRING:\n            text = p.getText();\n            break;\n        case JsonTokenId.ID_NUMBER_FLOAT:\n            final CoercionAction act = _checkFloatToIntCoercion(p, ctxt, Long.TYPE);\n            if (act == CoercionAction.AsNull) {\n                return 0L;\n            }\n            if (act == CoercionAction.AsEmpty) {\n                return 0L;\n            }\n            return p.getValueAsLong();\n        case JsonTokenId.ID_NUMBER_INT:\n            return p.getLongValue();\n        case JsonTokenId.ID_NULL:\n            _verifyNullForPrimitive(ctxt);\n            return 0L;\n        // 29-Jun-2020, tatu: New! \"Scalar from Object\" (mostly for XML)\n        case JsonTokenId.ID_START_OBJECT:\n            text = ctxt.extractScalarFromObject(p, this, Long.TYPE);\n            break;\n        case JsonTokenId.ID_START_ARRAY:\n            if (ctxt.isEnabled(DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS)) {\n                p.nextToken();\n                final long parsed = _parseLongPrimitive(p, ctxt);\n                _verifyEndArrayForSingle(p, ctxt);\n                return parsed;\n            }\n            // fall through\n        default:\n            return ((Number) ctxt.handleUnexpectedToken(Long.TYPE, p)).longValue();\n        }\n\n        final CoercionAction act = _checkFromStringCoercion(ctxt, text,\n                LogicalType.Integer, Long.TYPE);\n        if (act == CoercionAction.AsNull) {\n            // 03-May-2021, tatu: Might not be allowed (should we do \"empty\" check?)\n            _verifyNullForPrimitive(ctxt);\n            return 0L; \n        }\n        if (act == CoercionAction.AsEmpty) {\n            return 0L;\n        }\n        text = text.trim();\n        if (_hasTextualNull(text)) {\n            _verifyNullForPrimitiveCoercion(ctxt, text);\n            return 0L;\n        }\n        return _parseLongPrimitive(ctxt, text);\n    }",
    "abstract_func_before": "protected final long _parseLongPrimitive(JsonParser VAR_0, DeserializationContext VAR_1)\n            throws IOException\n    {\n        String VAR_2;\n        switch (VAR_0.currentTokenId()) {\n        case VAR_3.ID_STRING:\n            VAR_2 = VAR_0.getText();\n            break;\n        case VAR_3.ID_NUMBER_FLOAT:\n            final CoercionAction VAR_4 = _checkFloatToIntCoercion(VAR_0, VAR_1, VAR_5.TYPE);\n            if (VAR_4 == VAR_6.AsNull) {\n                return 0L;\n            }\n            if (VAR_4 == VAR_6.AsEmpty) {\n                return 0L;\n            }\n            return VAR_0.getValueAsLong();\n        case VAR_3.ID_NUMBER_INT:\n            return VAR_0.getLongValue();\n        case VAR_3.ID_NULL:\n            _verifyNullForPrimitive(VAR_1);\n            return 0L;\n        /* COMMENT_0 */\n        case VAR_3.ID_START_OBJECT:\n            VAR_2 = VAR_1.extractScalarFromObject(VAR_0, this, VAR_5.TYPE);\n            break;\n        case VAR_3.ID_START_ARRAY:\n            if (VAR_1.isEnabled(VAR_7.UNWRAP_SINGLE_VALUE_ARRAYS)) {\n                VAR_0.nextToken();\n                final long VAR_8 = _parseLongPrimitive(VAR_0, VAR_1);\n                _verifyEndArrayForSingle(VAR_0, VAR_1);\n                return VAR_8;\n            }\n            /* COMMENT_1 */\n        default:\n            return ((Number) VAR_1.handleUnexpectedToken(VAR_5.TYPE, VAR_0)).longValue();\n        }\n\n        final CoercionAction VAR_4 = _checkFromStringCoercion(VAR_1, VAR_2,\n                VAR_9.Integer, VAR_5.TYPE);\n        if (VAR_4 == VAR_6.AsNull) {\n            /* COMMENT_2 */\n            _verifyNullForPrimitive(VAR_1);\n            return 0L; \n        }\n        if (VAR_4 == VAR_6.AsEmpty) {\n            return 0L;\n        }\n        VAR_2 = VAR_2.trim();\n        if (_hasTextualNull(VAR_2)) {\n            _verifyNullForPrimitiveCoercion(VAR_1, VAR_2);\n            return 0L;\n        }\n        return _parseLongPrimitive(VAR_1, VAR_2);\n    }",
    "func_graph_path_before": "FasterXML/jackson-databind/d78d00ee7b5245b93103fef3187f70543d67ca33/StdDeserializer.java/vul/before/4.json",
    "func": "protected final long _parseLongPrimitive(JsonParser p, DeserializationContext ctxt)\n            throws IOException\n    {\n        String text;\n        switch (p.currentTokenId()) {\n        case JsonTokenId.ID_STRING:\n            text = p.getText();\n            break;\n        case JsonTokenId.ID_NUMBER_FLOAT:\n            final CoercionAction act = _checkFloatToIntCoercion(p, ctxt, Long.TYPE);\n            if (act == CoercionAction.AsNull) {\n                return 0L;\n            }\n            if (act == CoercionAction.AsEmpty) {\n                return 0L;\n            }\n            return p.getValueAsLong();\n        case JsonTokenId.ID_NUMBER_INT:\n            return p.getLongValue();\n        case JsonTokenId.ID_NULL:\n            _verifyNullForPrimitive(ctxt);\n            return 0L;\n        // 29-Jun-2020, tatu: New! \"Scalar from Object\" (mostly for XML)\n        case JsonTokenId.ID_START_OBJECT:\n            text = ctxt.extractScalarFromObject(p, this, Long.TYPE);\n            break;\n        case JsonTokenId.ID_START_ARRAY:\n            if (ctxt.isEnabled(DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS)) {\n                if (p.nextToken() == JsonToken.START_ARRAY) {\n                    return (long) handleNestedArrayForSingle(p, ctxt);\n                }\n                final long parsed = _parseLongPrimitive(p, ctxt);\n                _verifyEndArrayForSingle(p, ctxt);\n                return parsed;\n            }\n            // fall through\n        default:\n            return ((Number) ctxt.handleUnexpectedToken(Long.TYPE, p)).longValue();\n        }\n\n        final CoercionAction act = _checkFromStringCoercion(ctxt, text,\n                LogicalType.Integer, Long.TYPE);\n        if (act == CoercionAction.AsNull) {\n            // 03-May-2021, tatu: Might not be allowed (should we do \"empty\" check?)\n            _verifyNullForPrimitive(ctxt);\n            return 0L; \n        }\n        if (act == CoercionAction.AsEmpty) {\n            return 0L;\n        }\n        text = text.trim();\n        if (_hasTextualNull(text)) {\n            _verifyNullForPrimitiveCoercion(ctxt, text);\n            return 0L;\n        }\n        return _parseLongPrimitive(ctxt, text);\n    }",
    "abstract_func": "protected final long _parseLongPrimitive(JsonParser VAR_0, DeserializationContext VAR_1)\n            throws IOException\n    {\n        String VAR_2;\n        switch (VAR_0.currentTokenId()) {\n        case VAR_3.ID_STRING:\n            VAR_2 = VAR_0.getText();\n            break;\n        case VAR_3.ID_NUMBER_FLOAT:\n            final CoercionAction VAR_4 = _checkFloatToIntCoercion(VAR_0, VAR_1, VAR_5.TYPE);\n            if (VAR_4 == VAR_6.AsNull) {\n                return 0L;\n            }\n            if (VAR_4 == VAR_6.AsEmpty) {\n                return 0L;\n            }\n            return VAR_0.getValueAsLong();\n        case VAR_3.ID_NUMBER_INT:\n            return VAR_0.getLongValue();\n        case VAR_3.ID_NULL:\n            _verifyNullForPrimitive(VAR_1);\n            return 0L;\n        /* COMMENT_0 */\n        case VAR_3.ID_START_OBJECT:\n            VAR_2 = VAR_1.extractScalarFromObject(VAR_0, this, VAR_5.TYPE);\n            break;\n        case VAR_3.ID_START_ARRAY:\n            if (VAR_1.isEnabled(VAR_7.UNWRAP_SINGLE_VALUE_ARRAYS)) {\n                if (VAR_0.nextToken() == VAR_8.START_ARRAY) {\n                    return (long) handleNestedArrayForSingle(VAR_0, VAR_1);\n                }\n                final long VAR_9 = _parseLongPrimitive(VAR_0, VAR_1);\n                _verifyEndArrayForSingle(VAR_0, VAR_1);\n                return VAR_9;\n            }\n            /* COMMENT_1 */\n        default:\n            return ((Number) VAR_1.handleUnexpectedToken(VAR_5.TYPE, VAR_0)).longValue();\n        }\n\n        final CoercionAction VAR_4 = _checkFromStringCoercion(VAR_1, VAR_2,\n                VAR_10.Integer, VAR_5.TYPE);\n        if (VAR_4 == VAR_6.AsNull) {\n            /* COMMENT_2 */\n            _verifyNullForPrimitive(VAR_1);\n            return 0L; \n        }\n        if (VAR_4 == VAR_6.AsEmpty) {\n            return 0L;\n        }\n        VAR_2 = VAR_2.trim();\n        if (_hasTextualNull(VAR_2)) {\n            _verifyNullForPrimitiveCoercion(VAR_1, VAR_2);\n            return 0L;\n        }\n        return _parseLongPrimitive(VAR_1, VAR_2);\n    }",
    "func_graph_path": "FasterXML/jackson-databind/d78d00ee7b5245b93103fef3187f70543d67ca33/StdDeserializer.java/vul/after/4.json",
    "diff_func": "--- func_before\n+++ func_after\n@@ -26,7 +26,9 @@\n             break;\n         case JsonTokenId.ID_START_ARRAY:\n             if (ctxt.isEnabled(DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS)) {\n-                p.nextToken();\n+                if (p.nextToken() == JsonToken.START_ARRAY) {\n+                    return (long) handleNestedArrayForSingle(p, ctxt);\n+                }\n                 final long parsed = _parseLongPrimitive(p, ctxt);\n                 _verifyEndArrayForSingle(p, ctxt);\n                 return parsed;",
    "diff_line_info": {
        "deleted_lines": [
            "                p.nextToken();"
        ],
        "added_lines": [
            "                if (p.nextToken() == JsonToken.START_ARRAY) {",
            "                    return (long) handleNestedArrayForSingle(p, ctxt);",
            "                }"
        ]
    },
    "is_vul": true,
    "pr_url": null,
    "description": "no more info"
}