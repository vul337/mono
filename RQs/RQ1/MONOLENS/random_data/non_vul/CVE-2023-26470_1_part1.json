{
    "cve_id": "CVE-2023-26470",
    "cwe_ids": [
        "CWE-787"
    ],
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H",
    "cvss_is_v3": true,
    "repo_name": "xwiki/xwiki-platform",
    "commit_msg": "XWIKI-19223: Improve xobject memory storage in XWikidocument",
    "commit_hash": "db3d1c62fc5fb59fefcda3b86065d2d362f55164",
    "git_url": "https://github.com/xwiki/xwiki-platform/commit/db3d1c62fc5fb59fefcda3b86065d2d362f55164",
    "file_path": "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/doc/XWikiDocument.java",
    "func_name": "setXObjects",
    "func_before": "public void setXObjects(Map<DocumentReference, List<BaseObject>> objects)\n    {\n        if (objects == null) {\n            // Make sure we don`t set a null objects map since we assume everywhere that it is not null when using it.\n            objects = new HashMap<>();\n        }\n\n        boolean isDirty = false;\n\n        for (List<BaseObject> objList : objects.values()) {\n            for (BaseObject obj : objList) {\n                obj.setOwnerDocument(this);\n                isDirty = true;\n            }\n        }\n\n        // This operation resulted in marking the current document dirty.\n        if (isDirty) {\n            setMetaDataDirty(true);\n        }\n\n        // Replace the current objects with the provided ones.\n        this.xObjects = objects;\n    }",
    "abstract_func_before": "public void setXObjects(Map<DocumentReference, List<BaseObject>> VAR_0)\n    {\n        if (VAR_0 == null) {\n            /* COMMENT_0 */\n            VAR_0 = new HashMap<>();\n        }\n\n        boolean VAR_1 = false;\n\n        for (List<BaseObject> VAR_2 : VAR_0.values()) {\n            for (BaseObject VAR_3 : VAR_2) {\n                VAR_3.setOwnerDocument(this);\n                VAR_1 = true;\n            }\n        }\n\n        /* COMMENT_1 */\n        if (VAR_1) {\n            setMetaDataDirty(true);\n        }\n\n        /* COMMENT_2 */\n        this.xObjects = VAR_0;\n    }",
    "func_graph_path_before": "xwiki/xwiki-platform/db3d1c62fc5fb59fefcda3b86065d2d362f55164/XWikiDocument.java/vul/before/2.json",
    "func": "public void setXObjects(Map<DocumentReference, List<BaseObject>> objects)\n    {\n        if (objects == null) {\n            // Make sure we don`t set a null objects map since we assume everywhere that it is not null when using it.\n            objects = new HashMap<>();\n        }\n\n        boolean isDirty = false;\n\n        for (List<BaseObject> objList : objects.values()) {\n            for (BaseObject obj : objList) {\n                obj.setOwnerDocument(this);\n                isDirty = true;\n            }\n        }\n\n        // This operation resulted in marking the current document dirty.\n        if (isDirty) {\n            setMetaDataDirty(true);\n        }\n\n        // Replace the current objects with the provided ones.\n        Map<DocumentReference, BaseObjects> objectsCopy = new ConcurrentSkipListMap<>();\n        objects.forEach((k, v) -> objectsCopy.put(k, new BaseObjects(v)));\n        this.xObjects = objectsCopy;\n    }",
    "abstract_func": "public void setXObjects(Map<DocumentReference, List<BaseObject>> VAR_0)\n    {\n        if (VAR_0 == null) {\n            /* COMMENT_0 */\n            VAR_0 = new HashMap<>();\n        }\n\n        boolean VAR_1 = false;\n\n        for (List<BaseObject> VAR_2 : VAR_0.values()) {\n            for (BaseObject VAR_3 : VAR_2) {\n                VAR_3.setOwnerDocument(this);\n                VAR_1 = true;\n            }\n        }\n\n        /* COMMENT_1 */\n        if (VAR_1) {\n            setMetaDataDirty(true);\n        }\n\n        /* COMMENT_2 */\n        Map<DocumentReference, BaseObjects> VAR_4 = new ConcurrentSkipListMap<>();\n        VAR_0.forEach((VAR_5, VAR_6) -> VAR_4.put(VAR_5, new BaseObjects(VAR_6)));\n        this.xObjects = VAR_4;\n    }",
    "func_graph_path": "xwiki/xwiki-platform/db3d1c62fc5fb59fefcda3b86065d2d362f55164/XWikiDocument.java/vul/after/2.json",
    "diff_func": "--- func_before\n+++ func_after\n@@ -20,5 +20,7 @@\n         }\n \n         // Replace the current objects with the provided ones.\n-        this.xObjects = objects;\n+        Map<DocumentReference, BaseObjects> objectsCopy = new ConcurrentSkipListMap<>();\n+        objects.forEach((k, v) -> objectsCopy.put(k, new BaseObjects(v)));\n+        this.xObjects = objectsCopy;\n     }",
    "diff_line_info": {
        "deleted_lines": [
            "        this.xObjects = objects;"
        ],
        "added_lines": [
            "        Map<DocumentReference, BaseObjects> objectsCopy = new ConcurrentSkipListMap<>();",
            "        objects.forEach((k, v) -> objectsCopy.put(k, new BaseObjects(v)));",
            "        this.xObjects = objectsCopy;"
        ]
    },
    "is_vul": true,
    "pr_url": null,
    "description": "no more info"
}