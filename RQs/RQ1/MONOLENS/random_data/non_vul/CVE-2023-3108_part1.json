{
    "cve_id": "CVE-2023-3108",
    "cwe_ids": [
        "CWE-362"
    ],
    "cvss_vector": "CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:N/A:H",
    "cvss_is_v3": true,
    "repo_name": "torvalds/linux",
    "commit_msg": "crypto: fix af_alg_make_sg() conversion to iov_iter\n\nCommit 1d10eb2f156f (\"crypto: switch af_alg_make_sg() to iov_iter\")\nbroke af_alg_make_sg() and skcipher_recvmsg() in the process of moving\nthem to the iov_iter interfaces.  The 'npages' calculation in the formar\ncalculated the number of *bytes* in the pages, and in the latter case\nthe conversion didn't re-read the value of 'ctx->used' after waiting for\nit to become non-zero.\n\nThis reverts to the original code for both these cases.\n\nCc: Al Viro <viro@zeniv.linux.org.uk>\nCc: David Miller <davem@davemloft.net>\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>",
    "commit_hash": "9399f0c51489ae8c16d6559b82a452fdc1895e91",
    "git_url": "https://github.com/torvalds/linux/commit/9399f0c51489ae8c16d6559b82a452fdc1895e91",
    "file_path": "crypto/af_alg.c",
    "func_name": "af_alg_make_sg",
    "func_before": "int af_alg_make_sg(struct af_alg_sgl *sgl, struct iov_iter *iter, int len)\n{\n\tsize_t off;\n\tssize_t n;\n\tint npages, i;\n\n\tn = iov_iter_get_pages(iter, sgl->pages, len, ALG_MAX_PAGES, &off);\n\tif (n < 0)\n\t\treturn n;\n\n\tnpages = PAGE_ALIGN(off + n);\n\tif (WARN_ON(npages == 0))\n\t\treturn -EINVAL;\n\n\tsg_init_table(sgl->sg, npages);\n\n\tfor (i = 0, len = n; i < npages; i++) {\n\t\tint plen = min_t(int, len, PAGE_SIZE - off);\n\n\t\tsg_set_page(sgl->sg + i, sgl->pages[i], plen, off);\n\n\t\toff = 0;\n\t\tlen -= plen;\n\t}\n\treturn n;\n}",
    "abstract_func_before": "int af_alg_make_sg(struct af_alg_sgl *VAR_0, struct iov_iter *VAR_1, int VAR_2)\n{\n\tsize_t VAR_3;\n\tssize_t VAR_4;\n\tint VAR_5, VAR_6;\n\n\tVAR_4 = iov_iter_get_pages(VAR_1, VAR_0->pages, VAR_2, VAR_7, &VAR_3);\n\tif (VAR_4 < 0)\n\t\treturn VAR_4;\n\n\tVAR_5 = PAGE_ALIGN(VAR_3 + VAR_4);\n\tif (WARN_ON(VAR_5 == 0))\n\t\treturn -VAR_8;\n\n\tsg_init_table(VAR_0->sg, VAR_5);\n\n\tfor (VAR_6 = 0, VAR_2 = VAR_4; VAR_6 < VAR_5; VAR_6++) {\n\t\tint VAR_9 = min_t(int, VAR_2, VAR_10 - VAR_3);\n\n\t\tsg_set_page(VAR_0->sg + VAR_6, VAR_0->pages[VAR_6], VAR_9, VAR_3);\n\n\t\tVAR_3 = 0;\n\t\tVAR_2 -= VAR_9;\n\t}\n\treturn VAR_4;\n}",
    "func_graph_path_before": "torvalds/linux/9399f0c51489ae8c16d6559b82a452fdc1895e91/af_alg.c/vul/before/0.json",
    "func": "int af_alg_make_sg(struct af_alg_sgl *sgl, struct iov_iter *iter, int len)\n{\n\tsize_t off;\n\tssize_t n;\n\tint npages, i;\n\n\tn = iov_iter_get_pages(iter, sgl->pages, len, ALG_MAX_PAGES, &off);\n\tif (n < 0)\n\t\treturn n;\n\n\tnpages = (off + n + PAGE_SIZE - 1) >> PAGE_SHIFT;\n\tif (WARN_ON(npages == 0))\n\t\treturn -EINVAL;\n\n\tsg_init_table(sgl->sg, npages);\n\n\tfor (i = 0, len = n; i < npages; i++) {\n\t\tint plen = min_t(int, len, PAGE_SIZE - off);\n\n\t\tsg_set_page(sgl->sg + i, sgl->pages[i], plen, off);\n\n\t\toff = 0;\n\t\tlen -= plen;\n\t}\n\treturn n;\n}",
    "abstract_func": "int af_alg_make_sg(struct af_alg_sgl *VAR_0, struct iov_iter *VAR_1, int VAR_2)\n{\n\tsize_t VAR_3;\n\tssize_t VAR_4;\n\tint VAR_5, VAR_6;\n\n\tVAR_4 = iov_iter_get_pages(VAR_1, VAR_0->pages, VAR_2, VAR_7, &VAR_3);\n\tif (VAR_4 < 0)\n\t\treturn VAR_4;\n\n\tVAR_5 = (VAR_3 + VAR_4 + VAR_8 - 1) >> VAR_9;\n\tif (WARN_ON(VAR_5 == 0))\n\t\treturn -VAR_10;\n\n\tsg_init_table(VAR_0->sg, VAR_5);\n\n\tfor (VAR_6 = 0, VAR_2 = VAR_4; VAR_6 < VAR_5; VAR_6++) {\n\t\tint VAR_11 = min_t(int, VAR_2, VAR_8 - VAR_3);\n\n\t\tsg_set_page(VAR_0->sg + VAR_6, VAR_0->pages[VAR_6], VAR_11, VAR_3);\n\n\t\tVAR_3 = 0;\n\t\tVAR_2 -= VAR_11;\n\t}\n\treturn VAR_4;\n}",
    "func_graph_path": "torvalds/linux/9399f0c51489ae8c16d6559b82a452fdc1895e91/af_alg.c/vul/after/0.json",
    "diff_func": "--- func_before\n+++ func_after\n@@ -8,7 +8,7 @@\n \tif (n < 0)\n \t\treturn n;\n \n-\tnpages = PAGE_ALIGN(off + n);\n+\tnpages = (off + n + PAGE_SIZE - 1) >> PAGE_SHIFT;\n \tif (WARN_ON(npages == 0))\n \t\treturn -EINVAL;\n ",
    "diff_line_info": {
        "deleted_lines": [
            "\tnpages = PAGE_ALIGN(off + n);"
        ],
        "added_lines": [
            "\tnpages = (off + n + PAGE_SIZE - 1) >> PAGE_SHIFT;"
        ]
    },
    "is_vul": true,
    "pr_url": null,
    "description": "no more info"
}