{
    "cve_id": "CVE-2018-18897",
    "cwe_ids": [
        "CWE-772"
    ],
    "cvss_vector": "AV:N/AC:M/Au:N/C:N/I:N/A:P",
    "cvss_is_v3": false,
    "repo_name": "poppler",
    "commit_msg": "",
    "commit_hash": "e07c8b4784234383cb5ddcf1133ea91a772506e2",
    "git_url": "https://cgit.freedesktop.org/poppler/poppler/commit/?id=e07c8b4784234383cb5ddcf1133ea91a772506e2",
    "file_path": "poppler/GfxState.cc",
    "func_name": "GfxColorSpace::setDisplayProfile",
    "func_before": "void GfxColorSpace::setDisplayProfile(void *displayProfileA) {\n  displayProfile = displayProfileA;\n  if (displayProfile != nullptr) {\n    cmsHTRANSFORM transform;\n    unsigned int nChannels;\n\n    displayPixelType = getCMSColorSpaceType(cmsGetColorSpace(displayProfile));\n    nChannels = getCMSNChannels(cmsGetColorSpace(displayProfile));\n    // create transform from XYZ\n    cmsHPROFILE XYZProfile = cmsCreateXYZProfile();\n    if ((transform = cmsCreateTransform(XYZProfile, TYPE_XYZ_DBL,\n\t   displayProfile,\n\t   COLORSPACE_SH(displayPixelType) |\n\t     CHANNELS_SH(nChannels) | BYTES_SH(1),\n\t  INTENT_RELATIVE_COLORIMETRIC,LCMS_FLAGS)) == nullptr) {\n      error(errSyntaxWarning, -1, \"Can't create Lab transform\");\n    } else {\n      XYZ2DisplayTransform = new GfxColorTransform(transform, INTENT_RELATIVE_COLORIMETRIC, PT_XYZ, displayPixelType);\n    }\n    cmsCloseProfile(XYZProfile);\n  }\n}",
    "abstract_func_before": "void GfxColorSpace::setDisplayProfile(void *VAR_0) {\n  VAR_1 = VAR_0;\n  if (VAR_1 != nullptr) {\n    cmsHTRANSFORM VAR_2;\n    unsigned int VAR_3;\n\n    VAR_4 = getCMSColorSpaceType(cmsGetColorSpace(VAR_1));\n    VAR_3 = getCMSNChannels(cmsGetColorSpace(VAR_1));\n    /* COMMENT_0 */\n    cmsHPROFILE VAR_5 = cmsCreateXYZProfile();\n    if ((VAR_2 = cmsCreateTransform(VAR_5, VAR_6,\n\t   VAR_1,\n\t   COLORSPACE_SH(VAR_4) |\n\t     CHANNELS_SH(VAR_3) | BYTES_SH(1),\n\t  VAR_7,VAR_8)) == nullptr) {\n      error(VAR_9, -1, \"Can't create Lab transform\");\n    } else {\n      VAR_10 = new GfxColorTransform(VAR_2, VAR_7, VAR_11, VAR_4);\n    }\n    cmsCloseProfile(VAR_5);\n  }\n}",
    "func_graph_path_before": "poppler/e07c8b4784234383cb5ddcf1133ea91a772506e2/GfxState.cc/vul/before/0.json",
    "func": "void GfxColorSpace::setDisplayProfile(void *displayProfileA) {\n  if (displayProfile != nullptr) {\n    error(errInternal, -1, \"The display color profile can only be set once before any rendering is done.\");\n    return;\n  }\n  displayProfile = displayProfileA;\n  if (displayProfile != nullptr) {\n    cmsHTRANSFORM transform;\n    unsigned int nChannels;\n\n    displayPixelType = getCMSColorSpaceType(cmsGetColorSpace(displayProfile));\n    nChannels = getCMSNChannels(cmsGetColorSpace(displayProfile));\n    // create transform from XYZ\n    cmsHPROFILE XYZProfile = cmsCreateXYZProfile();\n    if ((transform = cmsCreateTransform(XYZProfile, TYPE_XYZ_DBL,\n\t   displayProfile,\n\t   COLORSPACE_SH(displayPixelType) |\n\t     CHANNELS_SH(nChannels) | BYTES_SH(1),\n\t  INTENT_RELATIVE_COLORIMETRIC,LCMS_FLAGS)) == nullptr) {\n      error(errSyntaxWarning, -1, \"Can't create Lab transform\");\n    } else {\n      XYZ2DisplayTransform = new GfxColorTransform(transform, INTENT_RELATIVE_COLORIMETRIC, PT_XYZ, displayPixelType);\n    }\n    cmsCloseProfile(XYZProfile);\n  }\n}",
    "abstract_func": "void GfxColorSpace::setDisplayProfile(void *VAR_0) {\n  if (VAR_1 != nullptr) {\n    error(VAR_2, -1, \"The display color profile can only be set once before any rendering is done.\");\n    return;\n  }\n  VAR_1 = VAR_0;\n  if (VAR_1 != nullptr) {\n    cmsHTRANSFORM VAR_3;\n    unsigned int VAR_4;\n\n    VAR_5 = getCMSColorSpaceType(cmsGetColorSpace(VAR_1));\n    VAR_4 = getCMSNChannels(cmsGetColorSpace(VAR_1));\n    /* COMMENT_0 */\n    cmsHPROFILE VAR_6 = cmsCreateXYZProfile();\n    if ((VAR_3 = cmsCreateTransform(VAR_6, VAR_7,\n\t   VAR_1,\n\t   COLORSPACE_SH(VAR_5) |\n\t     CHANNELS_SH(VAR_4) | BYTES_SH(1),\n\t  VAR_8,VAR_9)) == nullptr) {\n      error(VAR_10, -1, \"Can't create Lab transform\");\n    } else {\n      VAR_11 = new GfxColorTransform(VAR_3, VAR_8, VAR_12, VAR_5);\n    }\n    cmsCloseProfile(VAR_6);\n  }\n}",
    "func_graph_path": "poppler/e07c8b4784234383cb5ddcf1133ea91a772506e2/GfxState.cc/vul/after/0.json",
    "diff_func": "--- func_before\n+++ func_after\n@@ -1,4 +1,8 @@\n void GfxColorSpace::setDisplayProfile(void *displayProfileA) {\n+  if (displayProfile != nullptr) {\n+    error(errInternal, -1, \"The display color profile can only be set once before any rendering is done.\");\n+    return;\n+  }\n   displayProfile = displayProfileA;\n   if (displayProfile != nullptr) {\n     cmsHTRANSFORM transform;",
    "diff_line_info": {
        "deleted_lines": [],
        "added_lines": [
            "  if (displayProfile != nullptr) {",
            "    error(errInternal, -1, \"The display color profile can only be set once before any rendering is done.\");",
            "    return;",
            "  }"
        ]
    },
    "is_vul": true,
    "pr_url": null,
    "description": "no more info"
}