{
    "cve_id": "CVE-2016-4071",
    "cwe_ids": [
        "CWE-20"
    ],
    "cvss_vector": "AV:N/AC:L/Au:N/C:P/I:P/A:P",
    "cvss_is_v3": false,
    "repo_name": "php/php-src",
    "commit_msg": "Fixed bug #71704 php_snmp_error() Format String Vulnerability",
    "commit_hash": "6e25966544fb1d2f3d7596e060ce9c9269bbdcf8",
    "git_url": "https://github.com/php/php-src/commit/6e25966544fb1d2f3d7596e060ce9c9269bbdcf8",
    "file_path": "ext/snmp/snmp.c",
    "func_name": "php_snmp_error",
    "func_before": "static void php_snmp_error(zval *object, const char *docref, int type, const char *format, ...)\n{\n\tva_list args;\n\tphp_snmp_object *snmp_object = NULL;\n\n\tif (object) {\n\t\tsnmp_object = Z_SNMP_P(object);\n\t\tif (type == PHP_SNMP_ERRNO_NOERROR) {\n\t\t\tmemset(snmp_object->snmp_errstr, 0, sizeof(snmp_object->snmp_errstr));\n\t\t} else {\n\t\t\tva_start(args, format);\n\t\t\tvsnprintf(snmp_object->snmp_errstr, sizeof(snmp_object->snmp_errstr) - 1, format, args);\n\t\t\tva_end(args);\n\t\t}\n\t\tsnmp_object->snmp_errno = type;\n\t}\n\n\tif (type == PHP_SNMP_ERRNO_NOERROR) {\n\t\treturn;\n\t}\n\n\tif (object && (snmp_object->exceptions_enabled & type)) {\n\t\tzend_throw_exception_ex(php_snmp_exception_ce, type, snmp_object->snmp_errstr);\n\t} else {\n\t\tva_start(args, format);\n\t\tphp_verror(docref, \"\", E_WARNING, format, args);\n\t\tva_end(args);\n\t}\n}",
    "abstract_func_before": "static void php_snmp_error(zval *VAR_0, const char *VAR_1, int VAR_2, const char *VAR_3, ...)\n{\n\tva_list VAR_4;\n\tphp_snmp_object *VAR_5 = NULL;\n\n\tif (VAR_0) {\n\t\tVAR_5 = Z_SNMP_P(VAR_0);\n\t\tif (VAR_2 == VAR_6) {\n\t\t\tmemset(VAR_5->snmp_errstr, 0, sizeof(VAR_5->snmp_errstr));\n\t\t} else {\n\t\t\tva_start(VAR_4, VAR_3);\n\t\t\tvsnprintf(VAR_5->snmp_errstr, sizeof(VAR_5->snmp_errstr) - 1, VAR_3, VAR_4);\n\t\t\tva_end(VAR_4);\n\t\t}\n\t\tVAR_5->snmp_errno = VAR_2;\n\t}\n\n\tif (VAR_2 == VAR_6) {\n\t\treturn;\n\t}\n\n\tif (VAR_0 && (VAR_5->exceptions_enabled & VAR_2)) {\n\t\tzend_throw_exception_ex(VAR_7, VAR_2, VAR_5->snmp_errstr);\n\t} else {\n\t\tva_start(VAR_4, VAR_3);\n\t\tphp_verror(VAR_1, \"\", VAR_8, VAR_3, VAR_4);\n\t\tva_end(VAR_4);\n\t}\n}",
    "func_graph_path_before": "php/php-src/6e25966544fb1d2f3d7596e060ce9c9269bbdcf8/snmp.c/vul/before/0.json",
    "func": "static void php_snmp_error(zval *object, const char *docref, int type, const char *format, ...)\n{\n\tva_list args;\n\tphp_snmp_object *snmp_object = NULL;\n\n\tif (object) {\n\t\tsnmp_object = Z_SNMP_P(object);\n\t\tif (type == PHP_SNMP_ERRNO_NOERROR) {\n\t\t\tmemset(snmp_object->snmp_errstr, 0, sizeof(snmp_object->snmp_errstr));\n\t\t} else {\n\t\t\tva_start(args, format);\n\t\t\tvsnprintf(snmp_object->snmp_errstr, sizeof(snmp_object->snmp_errstr) - 1, format, args);\n\t\t\tva_end(args);\n\t\t}\n\t\tsnmp_object->snmp_errno = type;\n\t}\n\n\tif (type == PHP_SNMP_ERRNO_NOERROR) {\n\t\treturn;\n\t}\n\n\tif (object && (snmp_object->exceptions_enabled & type)) {\n\t\tzend_throw_exception_ex(php_snmp_exception_ce, type, \"%s\", snmp_object->snmp_errstr);\n\t} else {\n\t\tva_start(args, format);\n\t\tphp_verror(docref, \"\", E_WARNING, format, args);\n\t\tva_end(args);\n\t}\n}",
    "abstract_func": "static void php_snmp_error(zval *VAR_0, const char *VAR_1, int VAR_2, const char *VAR_3, ...)\n{\n\tva_list VAR_4;\n\tphp_snmp_object *VAR_5 = NULL;\n\n\tif (VAR_0) {\n\t\tVAR_5 = Z_SNMP_P(VAR_0);\n\t\tif (VAR_2 == VAR_6) {\n\t\t\tmemset(VAR_5->snmp_errstr, 0, sizeof(VAR_5->snmp_errstr));\n\t\t} else {\n\t\t\tva_start(VAR_4, VAR_3);\n\t\t\tvsnprintf(VAR_5->snmp_errstr, sizeof(VAR_5->snmp_errstr) - 1, VAR_3, VAR_4);\n\t\t\tva_end(VAR_4);\n\t\t}\n\t\tVAR_5->snmp_errno = VAR_2;\n\t}\n\n\tif (VAR_2 == VAR_6) {\n\t\treturn;\n\t}\n\n\tif (VAR_0 && (VAR_5->exceptions_enabled & VAR_2)) {\n\t\tzend_throw_exception_ex(VAR_7, VAR_2, \"%s\", VAR_5->snmp_errstr);\n\t} else {\n\t\tva_start(VAR_4, VAR_3);\n\t\tphp_verror(VAR_1, \"\", VAR_8, VAR_3, VAR_4);\n\t\tva_end(VAR_4);\n\t}\n}",
    "func_graph_path": "php/php-src/6e25966544fb1d2f3d7596e060ce9c9269bbdcf8/snmp.c/vul/after/0.json",
    "diff_func": "--- func_before\n+++ func_after\n@@ -20,7 +20,7 @@\n \t}\n \n \tif (object && (snmp_object->exceptions_enabled & type)) {\n-\t\tzend_throw_exception_ex(php_snmp_exception_ce, type, snmp_object->snmp_errstr);\n+\t\tzend_throw_exception_ex(php_snmp_exception_ce, type, \"%s\", snmp_object->snmp_errstr);\n \t} else {\n \t\tva_start(args, format);\n \t\tphp_verror(docref, \"\", E_WARNING, format, args);",
    "diff_line_info": {
        "deleted_lines": [
            "\t\tzend_throw_exception_ex(php_snmp_exception_ce, type, snmp_object->snmp_errstr);"
        ],
        "added_lines": [
            "\t\tzend_throw_exception_ex(php_snmp_exception_ce, type, \"%s\", snmp_object->snmp_errstr);"
        ]
    },
    "is_vul": true,
    "pr_url": null,
    "description": "no more info"
}