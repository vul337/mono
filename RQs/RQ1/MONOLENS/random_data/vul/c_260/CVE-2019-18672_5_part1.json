{
    "cve_id": "CVE-2019-18672",
    "cwe_ids": [
        "CWE-354"
    ],
    "cvss_vector": "AV:N/AC:L/Au:N/C:N/I:P/A:N",
    "cvss_is_v3": false,
    "repo_name": "keepkey/keepkey-firmware",
    "commit_msg": "firmware: stronger recovery state machine checks",
    "commit_hash": "769714fcb569e7a4faff9530a2d9ac1f9d6e5680",
    "git_url": "https://github.com/keepkey/keepkey-firmware/commit/769714fcb569e7a4faff9530a2d9ac1f9d6e5680",
    "file_path": "lib/firmware/recovery_cipher.c",
    "func_name": "recovery_delete_character",
    "func_before": "void recovery_delete_character(void)\n{\n    if(strlen(mnemonic) > 0)\n    {\n        mnemonic[strlen(mnemonic) - 1] = '\\0';\n    }\n\n    next_character();\n}",
    "abstract_func_before": "void recovery_delete_character(void)\n{\n    if(strlen(VAR_0) > 0)\n    {\n        VAR_0[strlen(VAR_0) - 1] = '\\0';\n    }\n\n    next_character();\n}",
    "func_graph_path_before": "keepkey/keepkey-firmware/769714fcb569e7a4faff9530a2d9ac1f9d6e5680/recovery_cipher.c/vul/before/6.json",
    "func": "void recovery_delete_character(void)\n{\n    if (!recovery_started) {\n        recovery_abort();\n        fsm_sendFailure(FailureType_Failure_UnexpectedMessage, \"Not in Recovery mode\");\n        layoutHome();\n        return;\n    }\n\n    if(strlen(mnemonic) > 0)\n    {\n        mnemonic[strlen(mnemonic) - 1] = '\\0';\n    }\n\n    next_character();\n}",
    "abstract_func": "void recovery_delete_character(void)\n{\n    if (!VAR_0) {\n        recovery_abort();\n        fsm_sendFailure(VAR_1, \"Not in Recovery mode\");\n        layoutHome();\n        return;\n    }\n\n    if(strlen(VAR_2) > 0)\n    {\n        VAR_2[strlen(VAR_2) - 1] = '\\0';\n    }\n\n    next_character();\n}",
    "func_graph_path": "keepkey/keepkey-firmware/769714fcb569e7a4faff9530a2d9ac1f9d6e5680/recovery_cipher.c/vul/after/6.json",
    "diff_func": "--- func_before\n+++ func_after\n@@ -1,5 +1,12 @@\n void recovery_delete_character(void)\n {\n+    if (!recovery_started) {\n+        recovery_abort();\n+        fsm_sendFailure(FailureType_Failure_UnexpectedMessage, \"Not in Recovery mode\");\n+        layoutHome();\n+        return;\n+    }\n+\n     if(strlen(mnemonic) > 0)\n     {\n         mnemonic[strlen(mnemonic) - 1] = '\\0';",
    "diff_line_info": {
        "deleted_lines": [],
        "added_lines": [
            "    if (!recovery_started) {",
            "        recovery_abort();",
            "        fsm_sendFailure(FailureType_Failure_UnexpectedMessage, \"Not in Recovery mode\");",
            "        layoutHome();",
            "        return;",
            "    }",
            ""
        ]
    },
    "is_vul": true,
    "pr_url": null,
    "description": "no more info"
}