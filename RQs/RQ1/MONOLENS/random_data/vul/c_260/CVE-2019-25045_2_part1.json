{
    "cve_id": "CVE-2019-25045",
    "cwe_ids": [
        "CWE-416"
    ],
    "cvss_vector": "AV:L/AC:L/Au:N/C:P/I:P/A:P",
    "cvss_is_v3": false,
    "repo_name": "torvalds/linux",
    "commit_msg": "In commit 6a53b7593233 (\"xfrm: check id proto in validate_tmpl()\")\nI introduced a check for xfrm protocol, but according to Herbert\nIPSEC_PROTO_ANY should only be used as a wildcard for lookup, so\nit should be removed from validate_tmpl().\n\nAnd, IPSEC_PROTO_ANY is expected to only match 3 IPSec-specific\nprotocols, this is why xfrm_state_flush() could still miss\nIPPROTO_ROUTING, which leads that those entries are left in\nnet->xfrm.state_all before exit net. Fix this by replacing\nIPSEC_PROTO_ANY with zero.\n\nThis patch also extracts the check from validate_tmpl() to\nxfrm_id_proto_valid() and uses it in parse_ipsecrequest().\nWith this, no other protocols should be added into xfrm.\n\nFixes: 6a53b7593233 (\"xfrm: check id proto in validate_tmpl()\")\nReported-by: syzbot+0bf0519d6e0de15914fe@syzkaller.appspotmail.com\nCc: Steffen Klassert <steffen.klassert@secunet.com>\nCc: Herbert Xu <herbert@gondor.apana.org.au>\nSigned-off-by: Cong Wang <xiyou.wangcong@gmail.com>\nAcked-by: Herbert Xu <herbert@gondor.apana.org.au>\nSigned-off-by: Steffen Klassert <steffen.klassert@secunet.com>\n",
    "commit_hash": "dbb2483b2a46fbaf833cfb5deb5ed9cace9c7399",
    "git_url": "https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?h=dbb2483b2a46fbaf833cfb5deb5ed9cace9c7399",
    "file_path": "net/ipv6/xfrm6_tunnel.c",
    "func_name": "xfrm6_tunnel_net_exit",
    "func_before": "static void __net_exit xfrm6_tunnel_net_exit(struct net *net)\n{\n\tstruct xfrm6_tunnel_net *xfrm6_tn = xfrm6_tunnel_pernet(net);\n\tunsigned int i;\n\n\txfrm_flush_gc();\n\txfrm_state_flush(net, IPSEC_PROTO_ANY, false, true);\n\n\tfor (i = 0; i < XFRM6_TUNNEL_SPI_BYADDR_HSIZE; i++)\n\t\tWARN_ON_ONCE(!hlist_empty(&xfrm6_tn->spi_byaddr[i]));\n\n\tfor (i = 0; i < XFRM6_TUNNEL_SPI_BYSPI_HSIZE; i++)\n\t\tWARN_ON_ONCE(!hlist_empty(&xfrm6_tn->spi_byspi[i]));\n}",
    "abstract_func_before": "static void VAR_0 xfrm6_tunnel_net_exit(struct net *net)\n{\n\tstruct xfrm6_tunnel_net *VAR_1 = xfrm6_tunnel_pernet(net);\n\tunsigned int VAR_2;\n\n\txfrm_flush_gc();\n\txfrm_state_flush(net, VAR_3, false, true);\n\n\tfor (VAR_2 = 0; VAR_2 < VAR_4; VAR_2++)\n\t\tWARN_ON_ONCE(!hlist_empty(&VAR_1->spi_byaddr[VAR_2]));\n\n\tfor (VAR_2 = 0; VAR_2 < VAR_5; VAR_2++)\n\t\tWARN_ON_ONCE(!hlist_empty(&VAR_1->spi_byspi[VAR_2]));\n}",
    "func_graph_path_before": null,
    "func": "static void __net_exit xfrm6_tunnel_net_exit(struct net *net)\n{\n\tstruct xfrm6_tunnel_net *xfrm6_tn = xfrm6_tunnel_pernet(net);\n\tunsigned int i;\n\n\txfrm_flush_gc();\n\txfrm_state_flush(net, 0, false, true);\n\n\tfor (i = 0; i < XFRM6_TUNNEL_SPI_BYADDR_HSIZE; i++)\n\t\tWARN_ON_ONCE(!hlist_empty(&xfrm6_tn->spi_byaddr[i]));\n\n\tfor (i = 0; i < XFRM6_TUNNEL_SPI_BYSPI_HSIZE; i++)\n\t\tWARN_ON_ONCE(!hlist_empty(&xfrm6_tn->spi_byspi[i]));\n}",
    "abstract_func": "static void VAR_0 xfrm6_tunnel_net_exit(struct net *net)\n{\n\tstruct xfrm6_tunnel_net *VAR_1 = xfrm6_tunnel_pernet(net);\n\tunsigned int VAR_2;\n\n\txfrm_flush_gc();\n\txfrm_state_flush(net, 0, false, true);\n\n\tfor (VAR_2 = 0; VAR_2 < VAR_3; VAR_2++)\n\t\tWARN_ON_ONCE(!hlist_empty(&VAR_1->spi_byaddr[VAR_2]));\n\n\tfor (VAR_2 = 0; VAR_2 < VAR_4; VAR_2++)\n\t\tWARN_ON_ONCE(!hlist_empty(&VAR_1->spi_byspi[VAR_2]));\n}",
    "func_graph_path": null,
    "diff_func": "--- func_before\n+++ func_after\n@@ -4,7 +4,7 @@\n \tunsigned int i;\n \n \txfrm_flush_gc();\n-\txfrm_state_flush(net, IPSEC_PROTO_ANY, false, true);\n+\txfrm_state_flush(net, 0, false, true);\n \n \tfor (i = 0; i < XFRM6_TUNNEL_SPI_BYADDR_HSIZE; i++)\n \t\tWARN_ON_ONCE(!hlist_empty(&xfrm6_tn->spi_byaddr[i]));",
    "diff_line_info": {
        "deleted_lines": [
            "\txfrm_state_flush(net, IPSEC_PROTO_ANY, false, true);"
        ],
        "added_lines": [
            "\txfrm_state_flush(net, 0, false, true);"
        ]
    },
    "is_vul": true,
    "pr_url": null,
    "description": "no more info"
}