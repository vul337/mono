{
    "cve_id": "CVE-2013-1643",
    "cwe_ids": [
        "CWE-200"
    ],
    "cvss_vector": "AV:N/AC:L/Au:N/C:P/I:N/A:N",
    "cvss_is_v3": false,
    "repo_name": "php/php-src",
    "commit_msg": "Fixed external entity loading",
    "commit_hash": "8e76d0404b7f664ee6719fd98f0483f0ac4669d6",
    "git_url": "https://github.com/php/php-src/commit/8e76d0404b7f664ee6719fd98f0483f0ac4669d6",
    "file_path": "ext/soap/php_xml.c",
    "func_name": "soap_xmlParseFile",
    "func_before": "xmlDocPtr soap_xmlParseFile(const char *filename TSRMLS_DC)\n{\n\txmlParserCtxtPtr ctxt = NULL;\n\txmlDocPtr ret;\n\tzend_bool old_allow_url_fopen;\n\n/*\n\txmlInitParser();\n*/\n\n\told_allow_url_fopen = PG(allow_url_fopen);\n\tPG(allow_url_fopen) = 1;\n\tctxt = xmlCreateFileParserCtxt(filename);\n\tPG(allow_url_fopen) = old_allow_url_fopen;\n\tif (ctxt) {\n\t\tctxt->keepBlanks = 0;\n\t\tctxt->options &= ~XML_PARSE_DTDLOAD;\n\t\tctxt->sax->ignorableWhitespace = soap_ignorableWhitespace;\n\t\tctxt->sax->comment = soap_Comment;\n\t\tctxt->sax->warning = NULL;\n\t\tctxt->sax->error = NULL;\n\t\t/*ctxt->sax->fatalError = NULL;*/\n\t\txmlParseDocument(ctxt);\n\t\tif (ctxt->wellFormed) {\n\t\t\tret = ctxt->myDoc;\n\t\t\tif (ret->URL == NULL && ctxt->directory != NULL) {\n\t\t\t\tret->URL = xmlCharStrdup(ctxt->directory);\n\t\t\t}\n\t\t} else {\n\t\t\tret = NULL;\n\t\t\txmlFreeDoc(ctxt->myDoc);\n\t\t\tctxt->myDoc = NULL;\n\t\t}\n\t\txmlFreeParserCtxt(ctxt);\n\t} else {\n\t\tret = NULL;\n\t}\n\n/*\n\txmlCleanupParser();\n*/\n\n\tif (ret) {\n\t\tcleanup_xml_node((xmlNodePtr)ret);\n\t}\n\treturn ret;\n}",
    "abstract_func_before": "xmlDocPtr soap_xmlParseFile(const char *VAR_0 TSRMLS_DC)\n{\n\txmlParserCtxtPtr VAR_1 = NULL;\n\txmlDocPtr VAR_2;\n\tzend_bool VAR_3;\n\n/* COMMENT_0 */\n                 \n  \n\n\tVAR_3 = PG(VAR_4);\n\tPG(VAR_4) = 1;\n\tVAR_1 = xmlCreateFileParserCtxt(VAR_0);\n\tPG(VAR_4) = VAR_3;\n\tif (VAR_1) {\n\t\tVAR_1->keepBlanks = 0;\n\t\tVAR_1->options &= ~VAR_5;\n\t\tVAR_1->sax->ignorableWhitespace = VAR_6;\n\t\tVAR_1->sax->comment = VAR_7;\n\t\tVAR_1->sax->warning = NULL;\n\t\tVAR_1->sax->error = NULL;\n\t\t/* COMMENT_3 */\n\t\txmlParseDocument(VAR_1);\n\t\tif (VAR_1->wellFormed) {\n\t\t\tVAR_2 = VAR_1->myDoc;\n\t\t\tif (VAR_2->URL == NULL && VAR_1->directory != NULL) {\n\t\t\t\tVAR_2->URL = xmlCharStrdup(VAR_1->directory);\n\t\t\t}\n\t\t} else {\n\t\t\tVAR_2 = NULL;\n\t\t\txmlFreeDoc(VAR_1->myDoc);\n\t\t\tVAR_1->myDoc = NULL;\n\t\t}\n\t\txmlFreeParserCtxt(VAR_1);\n\t} else {\n\t\tVAR_2 = NULL;\n\t}\n\n/* COMMENT_4 */\n                    \n  \n\n\tif (VAR_2) {\n\t\tcleanup_xml_node((xmlNodePtr)VAR_2);\n\t}\n\treturn VAR_2;\n}",
    "func_graph_path_before": null,
    "func": "xmlDocPtr soap_xmlParseFile(const char *filename TSRMLS_DC)\n{\n\txmlParserCtxtPtr ctxt = NULL;\n\txmlDocPtr ret;\n\tzend_bool old_allow_url_fopen;\n\n/*\n\txmlInitParser();\n*/\n\n\told_allow_url_fopen = PG(allow_url_fopen);\n\tPG(allow_url_fopen) = 1;\n\tctxt = xmlCreateFileParserCtxt(filename);\n\tPG(allow_url_fopen) = old_allow_url_fopen;\n\tif (ctxt) {\n\t\tzend_bool old;\n\n\t\tctxt->keepBlanks = 0;\n\t\tctxt->sax->ignorableWhitespace = soap_ignorableWhitespace;\n\t\tctxt->sax->comment = soap_Comment;\n\t\tctxt->sax->warning = NULL;\n\t\tctxt->sax->error = NULL;\n\t\t/*ctxt->sax->fatalError = NULL;*/\n\t\told = php_libxml_disable_entity_loader(1);\n\t\txmlParseDocument(ctxt);\n\t\tphp_libxml_disable_entity_loader(old);\n\t\tif (ctxt->wellFormed) {\n\t\t\tret = ctxt->myDoc;\n\t\t\tif (ret->URL == NULL && ctxt->directory != NULL) {\n\t\t\t\tret->URL = xmlCharStrdup(ctxt->directory);\n\t\t\t}\n\t\t} else {\n\t\t\tret = NULL;\n\t\t\txmlFreeDoc(ctxt->myDoc);\n\t\t\tctxt->myDoc = NULL;\n\t\t}\n\t\txmlFreeParserCtxt(ctxt);\n\t} else {\n\t\tret = NULL;\n\t}\n\n/*\n\txmlCleanupParser();\n*/\n\n\tif (ret) {\n\t\tcleanup_xml_node((xmlNodePtr)ret);\n\t}\n\treturn ret;\n}",
    "abstract_func": "xmlDocPtr soap_xmlParseFile(const char *VAR_0 TSRMLS_DC)\n{\n\txmlParserCtxtPtr VAR_1 = NULL;\n\txmlDocPtr VAR_2;\n\tzend_bool VAR_3;\n\n/* COMMENT_0 */\n                 \n  \n\n\tVAR_3 = PG(VAR_4);\n\tPG(VAR_4) = 1;\n\tVAR_1 = xmlCreateFileParserCtxt(VAR_0);\n\tPG(VAR_4) = VAR_3;\n\tif (VAR_1) {\n\t\tzend_bool VAR_5;\n\n\t\tVAR_1->keepBlanks = 0;\n\t\tVAR_1->sax->ignorableWhitespace = VAR_6;\n\t\tVAR_1->sax->comment = VAR_7;\n\t\tVAR_1->sax->warning = NULL;\n\t\tVAR_1->sax->error = NULL;\n\t\t/* COMMENT_3 */\n\t\tVAR_5 = php_libxml_disable_entity_loader(1);\n\t\txmlParseDocument(VAR_1);\n\t\tphp_libxml_disable_entity_loader(VAR_5);\n\t\tif (VAR_1->wellFormed) {\n\t\t\tVAR_2 = VAR_1->myDoc;\n\t\t\tif (VAR_2->URL == NULL && VAR_1->directory != NULL) {\n\t\t\t\tVAR_2->URL = xmlCharStrdup(VAR_1->directory);\n\t\t\t}\n\t\t} else {\n\t\t\tVAR_2 = NULL;\n\t\t\txmlFreeDoc(VAR_1->myDoc);\n\t\t\tVAR_1->myDoc = NULL;\n\t\t}\n\t\txmlFreeParserCtxt(VAR_1);\n\t} else {\n\t\tVAR_2 = NULL;\n\t}\n\n/* COMMENT_4 */\n                    \n  \n\n\tif (VAR_2) {\n\t\tcleanup_xml_node((xmlNodePtr)VAR_2);\n\t}\n\treturn VAR_2;\n}",
    "func_graph_path": null,
    "diff_func": "--- func_before\n+++ func_after\n@@ -13,14 +13,17 @@\n \tctxt = xmlCreateFileParserCtxt(filename);\n \tPG(allow_url_fopen) = old_allow_url_fopen;\n \tif (ctxt) {\n+\t\tzend_bool old;\n+\n \t\tctxt->keepBlanks = 0;\n-\t\tctxt->options &= ~XML_PARSE_DTDLOAD;\n \t\tctxt->sax->ignorableWhitespace = soap_ignorableWhitespace;\n \t\tctxt->sax->comment = soap_Comment;\n \t\tctxt->sax->warning = NULL;\n \t\tctxt->sax->error = NULL;\n \t\t/*ctxt->sax->fatalError = NULL;*/\n+\t\told = php_libxml_disable_entity_loader(1);\n \t\txmlParseDocument(ctxt);\n+\t\tphp_libxml_disable_entity_loader(old);\n \t\tif (ctxt->wellFormed) {\n \t\t\tret = ctxt->myDoc;\n \t\t\tif (ret->URL == NULL && ctxt->directory != NULL) {",
    "diff_line_info": {
        "deleted_lines": [
            "\t\tctxt->options &= ~XML_PARSE_DTDLOAD;"
        ],
        "added_lines": [
            "\t\tzend_bool old;",
            "",
            "\t\told = php_libxml_disable_entity_loader(1);",
            "\t\tphp_libxml_disable_entity_loader(old);"
        ]
    },
    "is_vul": true,
    "pr_url": null,
    "description": "no more info"
}