{
    "cve_id": "CVE-2019-20054",
    "cwe_ids": [
        "CWE-476"
    ],
    "cvss_vector": "AV:L/AC:L/Au:N/C:N/I:N/A:C",
    "cvss_is_v3": false,
    "repo_name": "torvalds/linux",
    "commit_msg": "Syzkaller report this:\n\n  sysctl could not get directory: /net//bridge -12\n  kasan: CONFIG_KASAN_INLINE enabled\n  kasan: GPF could be caused by NULL-ptr deref or user memory access\n  general protection fault: 0000 [#1] SMP KASAN PTI\n  CPU: 1 PID: 7027 Comm: syz-executor.0 Tainted: G         C        5.1.0-rc3+ #8\n  Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.10.2-1ubuntu1 04/01/2014\n  RIP: 0010:__write_once_size include/linux/compiler.h:220 [inline]\n  RIP: 0010:__rb_change_child include/linux/rbtree_augmented.h:144 [inline]\n  RIP: 0010:__rb_erase_augmented include/linux/rbtree_augmented.h:186 [inline]\n  RIP: 0010:rb_erase+0x5f4/0x19f0 lib/rbtree.c:459\n  Code: 00 0f 85 60 13 00 00 48 89 1a 48 83 c4 18 5b 5d 41 5c 41 5d 41 5e 41 5f c3 48 89 f2 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 75 0c 00 00 4d 85 ed 4c 89 2e 74 ce 4c 89 ea 48\n  RSP: 0018:ffff8881bb507778 EFLAGS: 00010206\n  RAX: dffffc0000000000 RBX: ffff8881f224b5b8 RCX: ffffffff818f3f6a\n  RDX: 000000000000000a RSI: 0000000000000050 RDI: ffff8881f224b568\n  RBP: 0000000000000000 R08: ffffed10376a0ef4 R09: ffffed10376a0ef4\n  R10: 0000000000000001 R11: ffffed10376a0ef4 R12: ffff8881f224b558\n  R13: 0000000000000000 R14: 0000000000000000 R15: 0000000000000000\n  FS:  00007f3e7ce13700(0000) GS:ffff8881f7300000(0000) knlGS:0000000000000000\n  CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\n  CR2: 00007fd60fbe9398 CR3: 00000001cb55c001 CR4: 00000000007606e0\n  DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000\n  DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400\n  PKRU: 55555554\n  Call Trace:\n   erase_entry fs/proc/proc_sysctl.c:178 [inline]\n   erase_header+0xe3/0x160 fs/proc/proc_sysctl.c:207\n   start_unregistering fs/proc/proc_sysctl.c:331 [inline]\n   drop_sysctl_table+0x558/0x880 fs/proc/proc_sysctl.c:1631\n   get_subdir fs/proc/proc_sysctl.c:1022 [inline]\n   __register_sysctl_table+0xd65/0x1090 fs/proc/proc_sysctl.c:1335\n   br_netfilter_init+0x68/0x1000 [br_netfilter]\n   do_one_initcall+0xbc/0x47d init/main.c:901\n   do_init_module+0x1b5/0x547 kernel/module.c:3456\n   load_module+0x6405/0x8c10 kernel/module.c:3804\n   __do_sys_finit_module+0x162/0x190 kernel/module.c:3898\n   do_syscall_64+0x9f/0x450 arch/x86/entry/common.c:290\n   entry_SYSCALL_64_after_hwframe+0x49/0xbe\n  Modules linked in: br_netfilter(+) backlight comedi(C) hid_sensor_hub max3100 ti_ads8688 udc_core fddi snd_mona leds_gpio rc_streamzap mtd pata_netcell nf_log_common rc_winfast udp_tunnel snd_usbmidi_lib snd_usb_toneport snd_usb_line6 snd_rawmidi snd_seq_device snd_hwdep videobuf2_v4l2 videobuf2_common videodev media videobuf2_vmalloc videobuf2_memops rc_gadmei_rm008z 8250_of smm665 hid_tmff hid_saitek hwmon_vid rc_ati_tv_wonder_hd_600 rc_core pata_pdc202xx_old dn_rtmsg as3722 ad714x_i2c ad714x snd_soc_cs4265 hid_kensington panel_ilitek_ili9322 drm drm_panel_orientation_quirks ipack cdc_phonet usbcore phonet hid_jabra hid extcon_arizona can_dev industrialio_triggered_buffer kfifo_buf industrialio adm1031 i2c_mux_ltc4306 i2c_mux ipmi_msghandler mlxsw_core snd_soc_cs35l34 snd_soc_core snd_pcm_dmaengine snd_pcm snd_timer ac97_bus snd_compress snd soundcore gpio_da9055 uio ecdh_generic mdio_thunder of_mdio fixed_phy libphy mdio_cavium iptable_security iptable_raw iptable_mangle\n   iptable_nat nf_nat nf_conntrack nf_defrag_ipv6 nf_defrag_ipv4 iptable_filter bpfilter ip6_vti ip_vti ip_gre ipip sit tunnel4 ip_tunnel hsr veth netdevsim vxcan batman_adv cfg80211 rfkill chnl_net caif nlmon dummy team bonding vcan bridge stp llc ip6_gre gre ip6_tunnel tunnel6 tun joydev mousedev ppdev tpm kvm_intel kvm irqbypass crct10dif_pclmul crc32_pclmul crc32c_intel ghash_clmulni_intel aesni_intel ide_pci_generic piix aes_x86_64 crypto_simd cryptd ide_core glue_helper input_leds psmouse intel_agp intel_gtt serio_raw ata_generic i2c_piix4 agpgart pata_acpi parport_pc parport floppy rtc_cmos sch_fq_codel ip_tables x_tables sha1_ssse3 sha1_generic ipv6 [last unloaded: br_netfilter]\n  Dumping ftrace buffer:\n     (ftrace buffer empty)\n  ---[ end trace 68741688d5fbfe85 ]---\n\ncommit 23da9588037e (\"fs/proc/proc_sysctl.c: fix NULL pointer\ndereference in put_links\") forgot to handle start_unregistering() case,\nwhile header->parent is NULL, it calls erase_header() and as seen in the\nabove syzkaller call trace, accessing &header->parent->root will trigger\na NULL pointer dereference.\n\nAs that commit explained, there is also no need to call\nstart_unregistering() if header->parent is NULL.\n\nLink: http://lkml.kernel.org/r/20190409153622.28112-1-yuehaibing@huawei.com\nFixes: 23da9588037e (\"fs/proc/proc_sysctl.c: fix NULL pointer dereference in put_links\")\nFixes: 0e47c99d7fe25 (\"sysctl: Replace root_list with links between sysctl_table_sets\")\nSigned-off-by: YueHaibing <yuehaibing@huawei.com>\nReported-by: Hulk Robot <hulkci@huawei.com>\nReviewed-by: Kees Cook <keescook@chromium.org>\nCc: Luis Chamberlain <mcgrof@kernel.org>\nCc: Alexey Dobriyan <adobriyan@gmail.com>\nCc: Al Viro <viro@zeniv.linux.org.uk>\nCc: \"Eric W. Biederman\" <ebiederm@xmission.com>\nSigned-off-by: Andrew Morton <akpm@linux-foundation.org>\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>\n",
    "commit_hash": "89189557b47b35683a27c80ee78aef18248eefb4",
    "git_url": "https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?h=89189557b47b35683a27c80ee78aef18248eefb4",
    "file_path": "fs/proc/proc_sysctl.c",
    "func_name": "drop_sysctl_table",
    "func_before": "static void drop_sysctl_table(struct ctl_table_header *header)\n{\n\tstruct ctl_dir *parent = header->parent;\n\n\tif (--header->nreg)\n\t\treturn;\n\n\tif (parent)\n\t\tput_links(header);\n\tstart_unregistering(header);\n\tif (!--header->count)\n\t\tkfree_rcu(header, rcu);\n\n\tif (parent)\n\t\tdrop_sysctl_table(&parent->header);\n}",
    "abstract_func_before": "static void drop_sysctl_table(struct ctl_table_header *VAR_0)\n{\n\tstruct ctl_dir *VAR_1 = VAR_0->parent;\n\n\tif (--VAR_0->nreg)\n\t\treturn;\n\n\tif (VAR_1)\n\t\tput_links(VAR_0);\n\tstart_unregistering(VAR_0);\n\tif (!--VAR_0->count)\n\t\tkfree_rcu(VAR_0, VAR_2);\n\n\tif (VAR_1)\n\t\tdrop_sysctl_table(&VAR_1->header);\n}",
    "func_graph_path_before": "torvalds/linux/89189557b47b35683a27c80ee78aef18248eefb4/proc_sysctl.c/vul/before/0.json",
    "func": "static void drop_sysctl_table(struct ctl_table_header *header)\n{\n\tstruct ctl_dir *parent = header->parent;\n\n\tif (--header->nreg)\n\t\treturn;\n\n\tif (parent) {\n\t\tput_links(header);\n\t\tstart_unregistering(header);\n\t}\n\n\tif (!--header->count)\n\t\tkfree_rcu(header, rcu);\n\n\tif (parent)\n\t\tdrop_sysctl_table(&parent->header);\n}",
    "abstract_func": "static void drop_sysctl_table(struct ctl_table_header *VAR_0)\n{\n\tstruct ctl_dir *VAR_1 = VAR_0->parent;\n\n\tif (--VAR_0->nreg)\n\t\treturn;\n\n\tif (VAR_1) {\n\t\tput_links(VAR_0);\n\t\tstart_unregistering(VAR_0);\n\t}\n\n\tif (!--VAR_0->count)\n\t\tkfree_rcu(VAR_0, VAR_2);\n\n\tif (VAR_1)\n\t\tdrop_sysctl_table(&VAR_1->header);\n}",
    "func_graph_path": "torvalds/linux/89189557b47b35683a27c80ee78aef18248eefb4/proc_sysctl.c/vul/after/0.json",
    "diff_func": "--- func_before\n+++ func_after\n@@ -5,9 +5,11 @@\n \tif (--header->nreg)\n \t\treturn;\n \n-\tif (parent)\n+\tif (parent) {\n \t\tput_links(header);\n-\tstart_unregistering(header);\n+\t\tstart_unregistering(header);\n+\t}\n+\n \tif (!--header->count)\n \t\tkfree_rcu(header, rcu);\n ",
    "diff_line_info": {
        "deleted_lines": [
            "\tif (parent)",
            "\tstart_unregistering(header);"
        ],
        "added_lines": [
            "\tif (parent) {",
            "\t\tstart_unregistering(header);",
            "\t}",
            ""
        ]
    },
    "is_vul": true,
    "pr_url": null,
    "description": "no more info"
}