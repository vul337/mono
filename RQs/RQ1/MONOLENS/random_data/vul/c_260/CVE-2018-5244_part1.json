{
    "cve_id": "CVE-2018-5244",
    "cwe_ids": [
        "CWE-119"
    ],
    "cvss_vector": "AV:L/AC:L/Au:N/C:N/I:N/A:C",
    "cvss_is_v3": false,
    "repo_name": "xen-project/xen",
    "commit_msg": "x86/msr: Free msr_vcpu_policy during vcpu destruction\n\nc/s 4187f79dc7 \"x86/msr: introduce struct msr_vcpu_policy\" introduced a\nper-vcpu memory allocation, but failed to free it in the clean vcpu\ndestruction case.\n\nThis is XSA-253.\n\nSigned-off-by: Andrew Cooper <andrew.cooper3@citrix.com>\nReviewed-by: Jan Beulich <jbeulich@suse.com>",
    "commit_hash": "e204e60f77702bf5c884dd37c3f1b01f14e396ae",
    "git_url": "https://github.com/xen-project/xen/commit/e204e60f77702bf5c884dd37c3f1b01f14e396ae",
    "file_path": "xen/arch/x86/domain.c",
    "func_name": "vcpu_destroy",
    "func_before": "void vcpu_destroy(struct vcpu *v)\n{\n    xfree(v->arch.vm_event);\n    v->arch.vm_event = NULL;\n\n    vcpu_destroy_fpu(v);\n\n    if ( !is_idle_domain(v->domain) )\n        vpmu_destroy(v);\n\n    if ( is_hvm_vcpu(v) )\n        hvm_vcpu_destroy(v);\n    else\n        pv_vcpu_destroy(v);\n}",
    "abstract_func_before": "void vcpu_destroy(struct vcpu *VAR_0)\n{\n    xfree(VAR_0->arch.vm_event);\n    VAR_0->arch.vm_event = NULL;\n\n    vcpu_destroy_fpu(VAR_0);\n\n    if ( !is_idle_domain(VAR_0->domain) )\n        vpmu_destroy(VAR_0);\n\n    if ( is_hvm_vcpu(VAR_0) )\n        hvm_vcpu_destroy(VAR_0);\n    else\n        pv_vcpu_destroy(VAR_0);\n}",
    "func_graph_path_before": "xen-project/xen/e204e60f77702bf5c884dd37c3f1b01f14e396ae/domain.c/vul/before/0.json",
    "func": "void vcpu_destroy(struct vcpu *v)\n{\n    xfree(v->arch.vm_event);\n    v->arch.vm_event = NULL;\n\n    vcpu_destroy_fpu(v);\n\n    xfree(v->arch.msr);\n    v->arch.msr = NULL;\n\n    if ( !is_idle_domain(v->domain) )\n        vpmu_destroy(v);\n\n    if ( is_hvm_vcpu(v) )\n        hvm_vcpu_destroy(v);\n    else\n        pv_vcpu_destroy(v);\n}",
    "abstract_func": "void vcpu_destroy(struct vcpu *VAR_0)\n{\n    xfree(VAR_0->arch.vm_event);\n    VAR_0->arch.vm_event = NULL;\n\n    vcpu_destroy_fpu(VAR_0);\n\n    xfree(VAR_0->arch.msr);\n    VAR_0->arch.msr = NULL;\n\n    if ( !is_idle_domain(VAR_0->domain) )\n        vpmu_destroy(VAR_0);\n\n    if ( is_hvm_vcpu(VAR_0) )\n        hvm_vcpu_destroy(VAR_0);\n    else\n        pv_vcpu_destroy(VAR_0);\n}",
    "func_graph_path": "xen-project/xen/e204e60f77702bf5c884dd37c3f1b01f14e396ae/domain.c/vul/after/0.json",
    "diff_func": "--- func_before\n+++ func_after\n@@ -4,6 +4,9 @@\n     v->arch.vm_event = NULL;\n \n     vcpu_destroy_fpu(v);\n+\n+    xfree(v->arch.msr);\n+    v->arch.msr = NULL;\n \n     if ( !is_idle_domain(v->domain) )\n         vpmu_destroy(v);",
    "diff_line_info": {
        "deleted_lines": [],
        "added_lines": [
            "",
            "    xfree(v->arch.msr);",
            "    v->arch.msr = NULL;"
        ]
    },
    "is_vul": true,
    "pr_url": null,
    "description": "no more info"
}