{
    "cve_id": "CVE-2020-20740",
    "cwe_ids": [
        "CWE-787"
    ],
    "cvss_vector": "AV:N/AC:M/Au:N/C:P/I:P/A:P",
    "cvss_is_v3": false,
    "repo_name": "enferex/pdfresurrect",
    "commit_msg": "Update header validation checks.\n\nThanks to yifengchen-cc for identifying this.",
    "commit_hash": "1b422459f07353adce2878806d5247d9e91fb397",
    "git_url": "https://github.com/enferex/pdfresurrect/commit/1b422459f07353adce2878806d5247d9e91fb397",
    "file_path": "pdf.c",
    "func_name": "pdf_is_pdf",
    "func_before": "int pdf_is_pdf(FILE *fp)\n{\n    int   is_pdf;\n    char *header;\n\n    header = get_header(fp);\n\n    if (header && strstr(header, \"%PDF-\"))\n      is_pdf = 1;\n    else \n      is_pdf = 0;\n\n    free(header);\n    return is_pdf;\n}",
    "abstract_func_before": "int pdf_is_pdf(FILE *VAR_0)\n{\n    int   VAR_1;\n    char *VAR_2;\n\n    VAR_2 = get_header(VAR_0);\n\n    if (VAR_2 && strstr(VAR_2, \"%PDF-\"))\n      VAR_1 = 1;\n    else \n      VAR_1 = 0;\n\n    free(VAR_2);\n    return VAR_1;\n}",
    "func_graph_path_before": "enferex/pdfresurrect/1b422459f07353adce2878806d5247d9e91fb397/pdf.c/vul/before/1.json",
    "func": "int pdf_is_pdf(FILE *fp)\n{\n    char *header;\n    if (!(header = get_header(fp)))\n      return 0;\n\n    /* First 1024 bytes of doc must be header (1.7 spec pg 1102) */\n    const char *c = strstr(header, \"%PDF-\");\n    const int is_pdf = c && ((c - header+strlen(\"%PDF-M.m\")) < 1024);\n    free(header);\n    return is_pdf;\n}",
    "abstract_func": "int pdf_is_pdf(FILE *VAR_0)\n{\n    char *VAR_1;\n    if (!(VAR_1 = get_header(VAR_0)))\n      return 0;\n\n    /* COMMENT_0 */\n    const char *VAR_2 = strstr(VAR_1, \"%PDF-\");\n    const int VAR_3 = VAR_2 && ((VAR_2 - VAR_1+strlen(\"%PDF-M.m\")) < 1024);\n    free(VAR_1);\n    return VAR_3;\n}",
    "func_graph_path": "enferex/pdfresurrect/1b422459f07353adce2878806d5247d9e91fb397/pdf.c/vul/after/1.json",
    "diff_func": "--- func_before\n+++ func_after\n@@ -1,15 +1,12 @@\n int pdf_is_pdf(FILE *fp)\n {\n-    int   is_pdf;\n     char *header;\n+    if (!(header = get_header(fp)))\n+      return 0;\n \n-    header = get_header(fp);\n-\n-    if (header && strstr(header, \"%PDF-\"))\n-      is_pdf = 1;\n-    else \n-      is_pdf = 0;\n-\n+    /* First 1024 bytes of doc must be header (1.7 spec pg 1102) */\n+    const char *c = strstr(header, \"%PDF-\");\n+    const int is_pdf = c && ((c - header+strlen(\"%PDF-M.m\")) < 1024);\n     free(header);\n     return is_pdf;\n }",
    "diff_line_info": {
        "deleted_lines": [
            "    int   is_pdf;",
            "    header = get_header(fp);",
            "",
            "    if (header && strstr(header, \"%PDF-\"))",
            "      is_pdf = 1;",
            "    else ",
            "      is_pdf = 0;",
            ""
        ],
        "added_lines": [
            "    if (!(header = get_header(fp)))",
            "      return 0;",
            "    /* First 1024 bytes of doc must be header (1.7 spec pg 1102) */",
            "    const char *c = strstr(header, \"%PDF-\");",
            "    const int is_pdf = c && ((c - header+strlen(\"%PDF-M.m\")) < 1024);"
        ]
    },
    "is_vul": true,
    "pr_url": null,
    "description": "no more info"
}