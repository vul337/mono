{
    "cve_id": "CVE-2016-10270",
    "cwe_ids": [
        "CWE-125"
    ],
    "cvss_vector": "AV:N/AC:M/Au:N/C:P/I:P/A:P",
    "cvss_is_v3": false,
    "repo_name": "vadz/libtiff",
    "commit_msg": "* libtiff/tif_dirread.c: modify ChopUpSingleUncompressedStrip() to\ninstanciate compute ntrips as TIFFhowmany_32(td->td_imagelength, rowsperstrip),\ninstead of a logic based on the total size of data. Which is faulty is\nthe total size of data is not sufficient to fill the whole image, and thus\nresults in reading outside of the StripByCounts/StripOffsets arrays when\nusing TIFFReadScanline().\nReported by Agostino Sarubbo.\nFixes http://bugzilla.maptools.org/show_bug.cgi?id=2608.\n\n* libtiff/tif_strip.c: revert the change in TIFFNumberOfStrips() done\nfor http://bugzilla.maptools.org/show_bug.cgi?id=2587 / CVE-2016-9273 since\nthe above change is a better fix that makes it unnecessary.",
    "commit_hash": "9a72a69e035ee70ff5c41541c8c61cd97990d018",
    "git_url": "https://github.com/vadz/libtiff/commit/9a72a69e035ee70ff5c41541c8c61cd97990d018",
    "file_path": "libtiff/tif_strip.c",
    "func_name": "TIFFNumberOfStrips",
    "func_before": "uint32\nTIFFNumberOfStrips(TIFF* tif)\n{\n\tTIFFDirectory *td = &tif->tif_dir;\n\tuint32 nstrips;\n\n    /* If the value was already computed and store in td_nstrips, then return it,\n       since ChopUpSingleUncompressedStrip might have altered and resized the\n       since the td_stripbytecount and td_stripoffset arrays to the new value\n       after the initial affectation of td_nstrips = TIFFNumberOfStrips() in\n       tif_dirread.c ~line 3612.\n       See http://bugzilla.maptools.org/show_bug.cgi?id=2587 */\n    if( td->td_nstrips )\n        return td->td_nstrips;\n\n\tnstrips = (td->td_rowsperstrip == (uint32) -1 ? 1 :\n\t     TIFFhowmany_32(td->td_imagelength, td->td_rowsperstrip));\n\tif (td->td_planarconfig == PLANARCONFIG_SEPARATE)\n\t\tnstrips = _TIFFMultiply32(tif, nstrips, (uint32)td->td_samplesperpixel,\n\t\t    \"TIFFNumberOfStrips\");\n\treturn (nstrips);\n}",
    "abstract_func_before": "uint32\nTIFFNumberOfStrips(TIFF* VAR_0)\n{\n\tTIFFDirectory *VAR_1 = &VAR_0->tif_dir;\n\tuint32 VAR_2;\n\n    /* COMMENT_0 */\n                                                                             \n                                                                             \n                                                                            \n                                \n                                                               \n    if( VAR_1->td_nstrips )\n        return VAR_1->td_nstrips;\n\n\tVAR_2 = (VAR_1->td_rowsperstrip == (uint32) -1 ? 1 :\n\t     TIFFhowmany_32(VAR_1->td_imagelength, VAR_1->td_rowsperstrip));\n\tif (VAR_1->td_planarconfig == VAR_3)\n\t\tVAR_2 = _TIFFMultiply32(VAR_0, VAR_2, (uint32)VAR_1->td_samplesperpixel,\n\t\t    \"TIFFNumberOfStrips\");\n\treturn (VAR_2);\n}",
    "func_graph_path_before": "vadz/libtiff/9a72a69e035ee70ff5c41541c8c61cd97990d018/tif_strip.c/vul/before/0.json",
    "func": "uint32\nTIFFNumberOfStrips(TIFF* tif)\n{\n\tTIFFDirectory *td = &tif->tif_dir;\n\tuint32 nstrips;\n\n\tnstrips = (td->td_rowsperstrip == (uint32) -1 ? 1 :\n\t     TIFFhowmany_32(td->td_imagelength, td->td_rowsperstrip));\n\tif (td->td_planarconfig == PLANARCONFIG_SEPARATE)\n\t\tnstrips = _TIFFMultiply32(tif, nstrips, (uint32)td->td_samplesperpixel,\n\t\t    \"TIFFNumberOfStrips\");\n\treturn (nstrips);\n}",
    "abstract_func": "uint32\nTIFFNumberOfStrips(TIFF* VAR_0)\n{\n\tTIFFDirectory *VAR_1 = &VAR_0->tif_dir;\n\tuint32 VAR_2;\n\n\tVAR_2 = (VAR_1->td_rowsperstrip == (uint32) -1 ? 1 :\n\t     TIFFhowmany_32(VAR_1->td_imagelength, VAR_1->td_rowsperstrip));\n\tif (VAR_1->td_planarconfig == VAR_3)\n\t\tVAR_2 = _TIFFMultiply32(VAR_0, VAR_2, (uint32)VAR_1->td_samplesperpixel,\n\t\t    \"TIFFNumberOfStrips\");\n\treturn (VAR_2);\n}",
    "func_graph_path": "vadz/libtiff/9a72a69e035ee70ff5c41541c8c61cd97990d018/tif_strip.c/vul/after/0.json",
    "diff_func": "--- func_before\n+++ func_after\n@@ -3,15 +3,6 @@\n {\n \tTIFFDirectory *td = &tif->tif_dir;\n \tuint32 nstrips;\n-\n-    /* If the value was already computed and store in td_nstrips, then return it,\n-       since ChopUpSingleUncompressedStrip might have altered and resized the\n-       since the td_stripbytecount and td_stripoffset arrays to the new value\n-       after the initial affectation of td_nstrips = TIFFNumberOfStrips() in\n-       tif_dirread.c ~line 3612.\n-       See http://bugzilla.maptools.org/show_bug.cgi?id=2587 */\n-    if( td->td_nstrips )\n-        return td->td_nstrips;\n \n \tnstrips = (td->td_rowsperstrip == (uint32) -1 ? 1 :\n \t     TIFFhowmany_32(td->td_imagelength, td->td_rowsperstrip));",
    "diff_line_info": {
        "deleted_lines": [
            "",
            "    /* If the value was already computed and store in td_nstrips, then return it,",
            "       since ChopUpSingleUncompressedStrip might have altered and resized the",
            "       since the td_stripbytecount and td_stripoffset arrays to the new value",
            "       after the initial affectation of td_nstrips = TIFFNumberOfStrips() in",
            "       tif_dirread.c ~line 3612.",
            "       See http://bugzilla.maptools.org/show_bug.cgi?id=2587 */",
            "    if( td->td_nstrips )",
            "        return td->td_nstrips;"
        ],
        "added_lines": []
    },
    "is_vul": true,
    "pr_url": null,
    "description": "no more info"
}