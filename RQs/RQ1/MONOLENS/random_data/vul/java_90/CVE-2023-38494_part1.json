{
    "cve_id": "CVE-2023-38494",
    "cwe_ids": [
        "CWE-862"
    ],
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N",
    "cvss_is_v3": true,
    "repo_name": "metersphere",
    "commit_msg": "fix: \u589e\u52a0\u7528\u6237\u7ec4\u63a5\u53e3\u7684\u6743\u9650\u6821\u9a8c",
    "commit_hash": "a23f75d93b666901fd148d834df9384f6f24cf28",
    "git_url": "https://github.com/metersphere/metersphere/commit/a23f75d93b666901fd148d834df9384f6f24cf28",
    "file_path": "framework/sdk-parent/sdk/src/main/java/io/metersphere/controller/BaseUserController.java",
    "func_name": "getCurrentWorkspaceMember",
    "func_before": "@GetMapping(\"/ws/current/member/list\")\n    public List<User> getCurrentWorkspaceMember() {\n        QueryMemberRequest request = new QueryMemberRequest();\n        request.setWorkspaceId(SessionUtils.getCurrentWorkspaceId());\n        return baseUserService.getMemberList(request);\n    }",
    "abstract_func_before": "@GetMapping(\"/ws/current/member/list\")\n    public List<User> getCurrentWorkspaceMember() {\n        QueryMemberRequest VAR_0 = new QueryMemberRequest();\n        VAR_0.setWorkspaceId(VAR_1.getCurrentWorkspaceId());\n        return VAR_2.getMemberList(VAR_0);\n    }",
    "func_graph_path_before": "metersphere/a23f75d93b666901fd148d834df9384f6f24cf28/BaseUserController.java/vul/before/0.json",
    "func": "@GetMapping(\"/ws/current/member/list\")\n    public List<User> getCurrentWorkspaceMember() {\n        SessionUser user = SessionUtils.getUser();\n        Optional<UserGroup> any = user.getUserGroups().stream()\n                .filter(ug -> (ug.getSourceId().equals(SessionUtils.getCurrentWorkspaceId()) || ug.getGroupId().equals(UserGroupConstants.SUPER_GROUP)))\n                .findAny();\n        if (any.isEmpty()) {\n            return new ArrayList<>();\n        }\n        QueryMemberRequest request = new QueryMemberRequest();\n        request.setWorkspaceId(SessionUtils.getCurrentWorkspaceId());\n        return baseUserService.getMemberList(request);\n    }",
    "abstract_func": "@GetMapping(\"/ws/current/member/list\")\n    public List<User> getCurrentWorkspaceMember() {\n        SessionUser VAR_0 = VAR_1.getUser();\n        Optional<UserGroup> VAR_2 = VAR_0.getUserGroups().stream()\n                .filter(VAR_3 -> (VAR_3.getSourceId().equals(VAR_1.getCurrentWorkspaceId()) || VAR_3.getGroupId().equals(VAR_4.SUPER_GROUP)))\n                .findAny();\n        if (VAR_2.isEmpty()) {\n            return new ArrayList<>();\n        }\n        QueryMemberRequest VAR_5 = new QueryMemberRequest();\n        VAR_5.setWorkspaceId(VAR_1.getCurrentWorkspaceId());\n        return VAR_6.getMemberList(VAR_5);\n    }",
    "func_graph_path": "metersphere/a23f75d93b666901fd148d834df9384f6f24cf28/BaseUserController.java/vul/after/0.json",
    "diff_func": "--- func_before\n+++ func_after\n@@ -1,5 +1,12 @@\n @GetMapping(\"/ws/current/member/list\")\n     public List<User> getCurrentWorkspaceMember() {\n+        SessionUser user = SessionUtils.getUser();\n+        Optional<UserGroup> any = user.getUserGroups().stream()\n+                .filter(ug -> (ug.getSourceId().equals(SessionUtils.getCurrentWorkspaceId()) || ug.getGroupId().equals(UserGroupConstants.SUPER_GROUP)))\n+                .findAny();\n+        if (any.isEmpty()) {\n+            return new ArrayList<>();\n+        }\n         QueryMemberRequest request = new QueryMemberRequest();\n         request.setWorkspaceId(SessionUtils.getCurrentWorkspaceId());\n         return baseUserService.getMemberList(request);",
    "diff_line_info": {
        "deleted_lines": [],
        "added_lines": [
            "        SessionUser user = SessionUtils.getUser();",
            "        Optional<UserGroup> any = user.getUserGroups().stream()",
            "                .filter(ug -> (ug.getSourceId().equals(SessionUtils.getCurrentWorkspaceId()) || ug.getGroupId().equals(UserGroupConstants.SUPER_GROUP)))",
            "                .findAny();",
            "        if (any.isEmpty()) {",
            "            return new ArrayList<>();",
            "        }"
        ]
    },
    "is_vul": true,
    "pr_url": "https://github.com/metersphere/metersphere/pull/25725",
    "description": "fix: \u589e\u52a0\u7528\u6237\u7ec4\u63a5\u53e3\u7684\u6743\u9650\u6821\u9a8c "
}