{
    "cve_id": "CVE-2023-40315",
    "cwe_ids": [
        "CWE-Other"
    ],
    "cvss_vector": "CVSS:3.1/AV:A/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H",
    "cvss_is_v3": true,
    "repo_name": "OpenNMS/opennms",
    "commit_msg": "NMS-15702: Only members of ROLE_ADMIN can view/edit users.xml",
    "commit_hash": "201301e067329ababa3c0671ded5c4c43347d4a8",
    "git_url": "https://github.com/OpenNMS/opennms/commit/201301e067329ababa3c0671ded5c4c43347d4a8",
    "file_path": "opennms-webapp-rest/src/main/java/org/opennms/web/rest/v1/FilesystemRestService.java",
    "func_name": "getFileContents",
    "func_before": "@GET\n    @Path(\"/contents\")\n    public Response getFileContents(@QueryParam(\"f\") String fileName, @Context SecurityContext securityContext) {\n        if (!securityContext.isUserInRole(Authentication.ROLE_FILESYSTEM_EDITOR)) {\n            throw new ForbiddenException(\"FILESYSTEM EDITOR role is required for reading files.\");\n        }\n        return fileContents(ensureFileIsAllowed(fileName));\n    }",
    "abstract_func_before": "@GET\n    @Path(\"/contents\")\n    public Response getFileContents(@QueryParam(\"f\") String VAR_0, @Context SecurityContext VAR_1) {\n        if (!VAR_1.isUserInRole(VAR_2.ROLE_FILESYSTEM_EDITOR)) {\n            throw new ForbiddenException(\"FILESYSTEM EDITOR role is required for reading files.\");\n        }\n        return fileContents(ensureFileIsAllowed(VAR_0));\n    }",
    "func_graph_path_before": "OpenNMS/opennms/201301e067329ababa3c0671ded5c4c43347d4a8/FilesystemRestService.java/vul/before/1.json",
    "func": "@GET\n    @Path(\"/contents\")\n    public Response getFileContents(@QueryParam(\"f\") String fileName, @Context SecurityContext securityContext) {\n        if (!securityContext.isUserInRole(Authentication.ROLE_FILESYSTEM_EDITOR)) {\n            throw new ForbiddenException(\"FILESYSTEM EDITOR role is required for reading files.\");\n        }\n        return fileContents(ensureFileIsAllowed(fileName, securityContext));\n    }",
    "abstract_func": "@GET\n    @Path(\"/contents\")\n    public Response getFileContents(@QueryParam(\"f\") String VAR_0, @Context SecurityContext VAR_1) {\n        if (!VAR_1.isUserInRole(VAR_2.ROLE_FILESYSTEM_EDITOR)) {\n            throw new ForbiddenException(\"FILESYSTEM EDITOR role is required for reading files.\");\n        }\n        return fileContents(ensureFileIsAllowed(VAR_0, VAR_1));\n    }",
    "func_graph_path": "OpenNMS/opennms/201301e067329ababa3c0671ded5c4c43347d4a8/FilesystemRestService.java/vul/after/1.json",
    "diff_func": "--- func_before\n+++ func_after\n@@ -4,5 +4,5 @@\n         if (!securityContext.isUserInRole(Authentication.ROLE_FILESYSTEM_EDITOR)) {\n             throw new ForbiddenException(\"FILESYSTEM EDITOR role is required for reading files.\");\n         }\n-        return fileContents(ensureFileIsAllowed(fileName));\n+        return fileContents(ensureFileIsAllowed(fileName, securityContext));\n     }",
    "diff_line_info": {
        "deleted_lines": [
            "        return fileContents(ensureFileIsAllowed(fileName));"
        ],
        "added_lines": [
            "        return fileContents(ensureFileIsAllowed(fileName, securityContext));"
        ]
    },
    "is_vul": true,
    "pr_url": "https://github.com/OpenNMS/opennms/pull/6250",
    "description": "* JIRA: https://opennms.atlassian.net/browse/NMS-15702"
}