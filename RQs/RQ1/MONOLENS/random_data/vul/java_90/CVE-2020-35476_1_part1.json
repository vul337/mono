{
    "cve_id": "CVE-2020-35476",
    "cwe_ids": [
        "CWE-78"
    ],
    "cvss_vector": "AV:N/AC:L/Au:N/C:P/I:P/A:P",
    "cvss_is_v3": false,
    "repo_name": "OpenTSDB/opentsdb",
    "commit_msg": "Fix remote code execution #2051 by adding regex validators for the\nGnuplot params and introducting the tsd.gnuplot.options.allowlist\nsetting that is a strict matching allow list of o= values from the\nquery string that will be allowed through. By default tihs is empty\nso if folks are using this query param, they'll different graphs\nuntil they add the options they need.",
    "commit_hash": "b762338664c3ee6e3f773bc04da2a8af24a5c486",
    "git_url": "https://github.com/OpenTSDB/opentsdb/commit/b762338664c3ee6e3f773bc04da2a8af24a5c486",
    "file_path": "src/tsd/GraphHandler.java",
    "func_name": "popParam",
    "func_before": "private static String popParam(final Map<String, List<String>> querystring,\n                                     final String param) {\n    final List<String> params = querystring.remove(param);\n    if (params == null) {\n      return null;\n    }\n    final String given = params.get(params.size() - 1);\n    // TODO - far from perfect, should help a little.\n    if (given.contains(\"`\") || given.contains(\"%60\") || \n        given.contains(\"&#96;\")) {\n      throw new BadRequestException(\"Parameter \" + param + \" contained a \"\n          + \"back-tick. That's a no-no.\");\n    }\n    return given;\n  }",
    "abstract_func_before": "private static String popParam(final Map<String, List<String>> VAR_0,\n                                     final String VAR_1) {\n    final List<String> VAR_2 = VAR_0.remove(VAR_1);\n    if (VAR_2 == null) {\n      return null;\n    }\n    final String VAR_3 = VAR_2.get(VAR_2.size() - 1);\n    /* COMMENT_0 */\n    if (VAR_3.contains(\"`\") || VAR_3.contains(\"%60\") || \n        VAR_3.contains(\"&#96;\")) {\n      throw new BadRequestException(\"Parameter \" + VAR_1 + \" contained a \"\n          + \"back-tick. That's a no-no.\");\n    }\n    return VAR_3;\n  }",
    "func_graph_path_before": "OpenTSDB/opentsdb/b762338664c3ee6e3f773bc04da2a8af24a5c486/GraphHandler.java/vul/before/1.json",
    "func": "public static String popParam(final Map<String, List<String>> querystring,\n                                final String param) {\n    final List<String> params = querystring.remove(param);\n    if (params == null) {\n      return null;\n    }\n    String given = params.get(params.size() - 1);\n    if (given != null) {\n      given = URLDecoder.decode(given.trim());\n    }\n    // TODO - far from perfect, should help a little.\n    if (given.contains(\"`\") || given.contains(\"%60\") || \n        given.contains(\"&#96;\")) {\n      throw new BadRequestException(\"Parameter \" + param + \" contained a \"\n          + \"back-tick. That's a no-no.\");\n    }\n    return given;\n  }",
    "abstract_func": "public static String popParam(final Map<String, List<String>> VAR_0,\n                                final String VAR_1) {\n    final List<String> VAR_2 = VAR_0.remove(VAR_1);\n    if (VAR_2 == null) {\n      return null;\n    }\n    String VAR_3 = VAR_2.get(VAR_2.size() - 1);\n    if (VAR_3 != null) {\n      VAR_3 = VAR_4.decode(VAR_3.trim());\n    }\n    /* COMMENT_0 */\n    if (VAR_3.contains(\"`\") || VAR_3.contains(\"%60\") || \n        VAR_3.contains(\"&#96;\")) {\n      throw new BadRequestException(\"Parameter \" + VAR_1 + \" contained a \"\n          + \"back-tick. That's a no-no.\");\n    }\n    return VAR_3;\n  }",
    "func_graph_path": "OpenTSDB/opentsdb/b762338664c3ee6e3f773bc04da2a8af24a5c486/GraphHandler.java/vul/after/1.json",
    "diff_func": "--- func_before\n+++ func_after\n@@ -1,10 +1,13 @@\n-private static String popParam(final Map<String, List<String>> querystring,\n-                                     final String param) {\n+public static String popParam(final Map<String, List<String>> querystring,\n+                                final String param) {\n     final List<String> params = querystring.remove(param);\n     if (params == null) {\n       return null;\n     }\n-    final String given = params.get(params.size() - 1);\n+    String given = params.get(params.size() - 1);\n+    if (given != null) {\n+      given = URLDecoder.decode(given.trim());\n+    }\n     // TODO - far from perfect, should help a little.\n     if (given.contains(\"`\") || given.contains(\"%60\") || \n         given.contains(\"&#96;\")) {",
    "diff_line_info": {
        "deleted_lines": [
            "private static String popParam(final Map<String, List<String>> querystring,",
            "                                     final String param) {",
            "    final String given = params.get(params.size() - 1);"
        ],
        "added_lines": [
            "public static String popParam(final Map<String, List<String>> querystring,",
            "                                final String param) {",
            "    String given = params.get(params.size() - 1);",
            "    if (given != null) {",
            "      given = URLDecoder.decode(given.trim());",
            "    }"
        ]
    },
    "is_vul": true,
    "pr_url": null,
    "description": "no more info"
}