{
  "id": 2639,
  "language": "Java",
  "commit_url": "https://github.com/GrapheneOS/platform_frameworks_base/commit/a04b3666b8619e09e08646c6d5c529d016cbfb47",
  "commit_sha": "a04b3666b8619e09e08646c6d5c529d016cbfb47",
  "commit_msg": "Add hide-non-system-overlay flag for HarmfulAppWarningActivity\n\nA malicious application could overlay the activity. The overlay is\nable to be tapped through, which can trick the user into starting a\nharmful activity.\n\nThe CL added the flag SYSTEM_FLAG_HIDE_NON_SYSTEM_OVERLAY_WINDOWS for\nthe activity to prevent the tapjacking/overlay attack.\n\nBug: 205595291\nTest: atest CtsHarmfulAppWarningHostTestCases\nChange-Id: Ia1a1ae0dc451e04bf5c31e3cb8cf30a0d8e32991",
  "pr_url": null,
  "pr_info": "no more info",
  "file_name": "core/java/com/android/internal/app/HarmfulAppWarningActivity.java",
  "func_name": "onCreate",
  "func_before": "@Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n\n        final Intent intent = getIntent();\n        mPackageName = intent.getStringExtra(Intent.EXTRA_PACKAGE_NAME);\n        mTarget = intent.getParcelableExtra(Intent.EXTRA_INTENT);\n        mHarmfulAppWarning = intent.getStringExtra(EXTRA_HARMFUL_APP_WARNING);\n\n        if (mPackageName == null || mTarget == null || mHarmfulAppWarning == null) {\n            Log.wtf(TAG, \"Invalid intent: \" + intent.toString());\n            finish();\n        }\n\n        final ApplicationInfo applicationInfo;\n        try {\n            applicationInfo = getPackageManager().getApplicationInfo(mPackageName, 0 /*flags*/);\n        } catch (PackageManager.NameNotFoundException e) {\n            Log.e(TAG, \"Could not show warning because package does not exist \", e);\n            finish();\n            return;\n        }\n\n        final AlertController.AlertParams p = mAlertParams;\n        p.mTitle = getString(R.string.harmful_app_warning_title);\n        p.mView = createView(applicationInfo);\n\n        p.mPositiveButtonText = getString(R.string.harmful_app_warning_uninstall);\n        p.mPositiveButtonListener = this;\n        p.mNegativeButtonText = getString(R.string.harmful_app_warning_open_anyway);\n        p.mNegativeButtonListener = this;\n\n        mAlert.installContent(mAlertParams);\n    }",
  "func_after": "@Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n\n        getWindow().addSystemFlags(SYSTEM_FLAG_HIDE_NON_SYSTEM_OVERLAY_WINDOWS);\n        final Intent intent = getIntent();\n        mPackageName = intent.getStringExtra(Intent.EXTRA_PACKAGE_NAME);\n        mTarget = intent.getParcelableExtra(Intent.EXTRA_INTENT);\n        mHarmfulAppWarning = intent.getStringExtra(EXTRA_HARMFUL_APP_WARNING);\n\n        if (mPackageName == null || mTarget == null || mHarmfulAppWarning == null) {\n            Log.wtf(TAG, \"Invalid intent: \" + intent.toString());\n            finish();\n        }\n\n        final ApplicationInfo applicationInfo;\n        try {\n            applicationInfo = getPackageManager().getApplicationInfo(mPackageName, 0 /*flags*/);\n        } catch (PackageManager.NameNotFoundException e) {\n            Log.e(TAG, \"Could not show warning because package does not exist \", e);\n            finish();\n            return;\n        }\n\n        final AlertController.AlertParams p = mAlertParams;\n        p.mTitle = getString(R.string.harmful_app_warning_title);\n        p.mView = createView(applicationInfo);\n\n        p.mPositiveButtonText = getString(R.string.harmful_app_warning_uninstall);\n        p.mPositiveButtonListener = this;\n        p.mNegativeButtonText = getString(R.string.harmful_app_warning_open_anyway);\n        p.mNegativeButtonListener = this;\n\n        mAlert.installContent(mAlertParams);\n    }",
  "diff_func": "--- func_before\n+++ func_after\n @Override\n     protected void onCreate(Bundle savedInstanceState) {\n         super.onCreate(savedInstanceState);\n \n+        getWindow().addSystemFlags(SYSTEM_FLAG_HIDE_NON_SYSTEM_OVERLAY_WINDOWS);\n         final Intent intent = getIntent();\n         mPackageName = intent.getStringExtra(Intent.EXTRA_PACKAGE_NAME);\n         mTarget = intent.getParcelableExtra(Intent.EXTRA_INTENT);\n         mHarmfulAppWarning = intent.getStringExtra(EXTRA_HARMFUL_APP_WARNING);\n \n         if (mPackageName == null || mTarget == null || mHarmfulAppWarning == null) {\n             Log.wtf(TAG, \"Invalid intent: \" + intent.toString());\n             finish();\n         }\n \n         final ApplicationInfo applicationInfo;\n         try {\n             applicationInfo = getPackageManager().getApplicationInfo(mPackageName, 0 /*flags*/);\n         } catch (PackageManager.NameNotFoundException e) {\n             Log.e(TAG, \"Could not show warning because package does not exist \", e);\n             finish();\n             return;\n         }\n \n         final AlertController.AlertParams p = mAlertParams;\n         p.mTitle = getString(R.string.harmful_app_warning_title);\n         p.mView = createView(applicationInfo);\n \n         p.mPositiveButtonText = getString(R.string.harmful_app_warning_uninstall);\n         p.mPositiveButtonListener = this;\n         p.mNegativeButtonText = getString(R.string.harmful_app_warning_open_anyway);\n         p.mNegativeButtonListener = this;\n \n         mAlert.installContent(mAlertParams);\n     }",
  "diff_source": "custom",
  "Bug Filter": "Security Vulnerability Fix\nConfidence Score: 1.0",
  "Bug Filter Confidence": 1.0,
  "Bug Filter Response": "\n\n**Final Output:**\nAnalysis: The commit adds a system flag to prevent malicious overlays, directly addressing a security exploit. The code change modifies window flags to stop unauthorized access via overlays, fitting the criteria for a security fix.\nFinal Classification: Security Vulnerability Fix\nConfidence Score: 1.0"
}