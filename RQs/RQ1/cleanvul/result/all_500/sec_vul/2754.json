{
  "id": 2754,
  "language": "Java",
  "commit_url": "https://github.com/nuxeo/nuxeo/commit/e37d77c508c573293c35b52181c3a9822ff80dd5",
  "commit_sha": "e37d77c508c573293c35b52181c3a9822ff80dd5",
  "commit_msg": "NXP-30260: avoid infinite loop in DirectoryEntryResolver#getReference",
  "pr_url": "https://github.com/Blaquez-home/nuxeo/pull/2",
  "pr_info": "no more info",
  "file_name": "modules/platform/nuxeo-platform-directory/nuxeo-platform-directory-core/src/main/java/org/nuxeo/ecm/directory/DirectoryEntryResolver.java",
  "func_name": "IllegalStateException",
  "func_before": "@Override\n    public Serializable getReference(Object entity) throws IllegalStateException {\n        checkConfig();\n        DocumentModel entry = null;\n        if (entity != null) {\n            if (entity instanceof DirectoryEntry) {\n                entry = ((DirectoryEntry) entity).getDocumentModel();\n            } else if (entity instanceof DocumentModel) {\n                entry = (DocumentModel) entity;\n            }\n            if (entry != null) {\n                if (!entry.hasSchema(schema)) {\n                    return null;\n                }\n                String result = (String) entry.getProperty(schema, idField);\n                if (hierarchical) {\n                    String parent = (String) entry.getProperty(schema, parentField);\n                    try (Session session = getDirectory().getSession()) {\n                        while (parent != null) {\n                            String finalParent = parent; // Effectively final\n                            entry = Framework.doPrivileged(() -> session.getEntry(finalParent));\n                            if (entry == null) {\n                                break;\n                            }\n                            result = parent + separator + result;\n                            parent = (String) entry.getProperty(schema, parentField);\n                        }\n                    }\n                }\n                return result;\n            }\n        }\n        return null;\n    }",
  "func_after": "@Override\n    public Serializable getReference(Object entity) throws IllegalStateException {\n        checkConfig();\n        DocumentModel entry = null;\n        if (entity != null) {\n            if (entity instanceof DirectoryEntry) {\n                entry = ((DirectoryEntry) entity).getDocumentModel();\n            } else if (entity instanceof DocumentModel) {\n                entry = (DocumentModel) entity;\n            }\n            if (entry != null) {\n                if (!entry.hasSchema(schema)) {\n                    return null;\n                }\n\n                return hierarchical ? getHierarchicalReference(entry) : (String) entry.getProperty(schema, idField);\n            }\n        }\n        return null;\n    }",
  "diff_func": "--- func_before\n+++ func_after\n @Override\n     public Serializable getReference(Object entity) throws IllegalStateException {\n         checkConfig();\n         DocumentModel entry = null;\n         if (entity != null) {\n             if (entity instanceof DirectoryEntry) {\n                 entry = ((DirectoryEntry) entity).getDocumentModel();\n             } else if (entity instanceof DocumentModel) {\n                 entry = (DocumentModel) entity;\n             }\n             if (entry != null) {\n                 if (!entry.hasSchema(schema)) {\n                     return null;\n                 }\n+\n+                return hierarchical ? getHierarchicalReference(entry) : (String) entry.getProperty(schema, idField);\n-                String result = (String) entry.getProperty(schema, idField);\n-                if (hierarchical) {\n-                    String parent = (String) entry.getProperty(schema, parentField);\n-                    try (Session session = getDirectory().getSession()) {\n-                        while (parent != null) {\n-                            String finalParent = parent; // Effectively final\n-                            entry = Framework.doPrivileged(() -> session.getEntry(finalParent));\n-                            if (entry == null) {\n-                                break;\n-                            }\n-                            result = parent + separator + result;\n-                            parent = (String) entry.getProperty(schema, parentField);\n-                        }\n-                    }\n-                }\n-                return result;\n             }\n         }\n         return null;\n     }",
  "diff_source": "custom",
  "Bug Filter": "** Security Vulnerability Fix  \n**Confidence Score:** 0.95",
  "Bug Filter Confidence": 0.95,
  "Bug Filter Response": "\n\nThe patch addresses an infinite loop in a method that could lead to a denial of service if triggered by an attacker. This qualifies as a security vulnerability fix.\n\n**Final Classification:** Security Vulnerability Fix  \n**Confidence Score:** 0.95"
}