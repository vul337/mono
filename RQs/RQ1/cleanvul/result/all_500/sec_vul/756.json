{
  "id": 756,
  "language": "Java",
  "commit_url": "https://github.com/PixelExperience/frameworks_base/commit/6aba151873bfae198ef9eceb10f943e18b52d58c",
  "commit_sha": "6aba151873bfae198ef9eceb10f943e18b52d58c",
  "commit_msg": "[RESTRICT AUTOMERGE] Fix bypass BG-FGS and BAL via package manager APIs\n\nOpt-in for BAL of PendingIntent for following APIs:\n\n* PackageInstaller.uninstall()\n* PackageInstaller.installExistingPackage()\n* PackageInstaller.uninstallExistingPackage()\n* PackageInstaller.Session.commit()\n* PackageInstaller.Session.commitTransferred()\n* PackageManager.freeStorage()\n\nBug: 230492955\nBug: 243377226\nTest: atest android.security.cts.PackageInstallerTest\nTest: atest CtsStagedInstallHostTestCases\nChange-Id: I9b6f801d69ea6d2244a38dbe689e81afa4e798bf\n(cherry picked from commit 03b77aee350696781b4d7a61768a172bedc3ac73)\nMerged-In: I9b6f801d69ea6d2244a38dbe689e81afa4e798bf",
  "pr_url": null,
  "pr_info": "no more info",
  "file_name": "services/core/java/com/android/server/pm/PackageInstallerSession.java",
  "func_name": "sendOnUserActionRequired",
  "func_before": "private static void sendOnUserActionRequired(Context context, IntentSender target,\n            int sessionId, Intent intent) {\n        final Intent fillIn = new Intent();\n        fillIn.putExtra(PackageInstaller.EXTRA_SESSION_ID, sessionId);\n        fillIn.putExtra(PackageInstaller.EXTRA_STATUS, PackageInstaller.STATUS_PENDING_USER_ACTION);\n        fillIn.putExtra(Intent.EXTRA_INTENT, intent);\n        try {\n            target.sendIntent(context, 0, fillIn, null, null);\n        } catch (IntentSender.SendIntentException ignored) {\n        }\n    }",
  "func_after": "private static void sendOnUserActionRequired(Context context, IntentSender target,\n            int sessionId, Intent intent) {\n        final Intent fillIn = new Intent();\n        fillIn.putExtra(PackageInstaller.EXTRA_SESSION_ID, sessionId);\n        fillIn.putExtra(PackageInstaller.EXTRA_STATUS, PackageInstaller.STATUS_PENDING_USER_ACTION);\n        fillIn.putExtra(Intent.EXTRA_INTENT, intent);\n        try {\n            final BroadcastOptions options = BroadcastOptions.makeBasic();\n            options.setPendingIntentBackgroundActivityLaunchAllowed(false);\n            target.sendIntent(context, 0, fillIn, null /* onFinished */,\n                    null /* handler */, null /* requiredPermission */, options.toBundle());\n        } catch (IntentSender.SendIntentException ignored) {\n        }\n    }",
  "diff_func": "--- func_before\n+++ func_after\n private static void sendOnUserActionRequired(Context context, IntentSender target,\n             int sessionId, Intent intent) {\n         final Intent fillIn = new Intent();\n         fillIn.putExtra(PackageInstaller.EXTRA_SESSION_ID, sessionId);\n         fillIn.putExtra(PackageInstaller.EXTRA_STATUS, PackageInstaller.STATUS_PENDING_USER_ACTION);\n         fillIn.putExtra(Intent.EXTRA_INTENT, intent);\n         try {\n+            final BroadcastOptions options = BroadcastOptions.makeBasic();\n+            options.setPendingIntentBackgroundActivityLaunchAllowed(false);\n-            target.sendIntent(context, 0, fillIn, null, null);\n+            target.sendIntent(context, 0, fillIn, null /* onFinished */,\n+                    null /* handler */, null /* requiredPermission */, options.toBundle());\n         } catch (IntentSender.SendIntentException ignored) {\n         }\n     }",
  "diff_source": "custom",
  "Bug Filter": "Security Vulnerability Fix  \nConfidence Score: 0.95",
  "Bug Filter Confidence": 0.95,
  "Bug Filter Response": "\n\n**Final Output:**\nAnalysis: The patch modifies the sendOnUserActionRequired function to prevent background activity launches via package manager APIs, addressing a security issue where apps could bypass security checks.\n\nFinal Classification: Security Vulnerability Fix  \nConfidence Score: 0.95"
}