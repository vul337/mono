{
  "id": 5325,
  "language": "Python",
  "commit_url": "https://github.com/twangboy/salt/commit/c0689e32154c41f59840ae10ffc5fbfa30618710",
  "commit_sha": "c0689e32154c41f59840ae10ffc5fbfa30618710",
  "commit_msg": "Replaced password with redacted when displayed",
  "pr_url": null,
  "pr_info": "no more info",
  "file_name": "salt/states/user.py",
  "func_name": "present",
  "func_before": "def present(name,\n            uid=None,\n            gid=None,\n            gid_from_name=False,\n            groups=None,\n            optional_groups=None,\n            remove_groups=True,\n            home=None,\n            createhome=True,\n            password=None,\n            enforce_password=True,\n            empty_password=False,\n            shell=None,\n            unique=True,\n            system=False,\n            fullname=None,\n            roomnumber=None,\n            workphone=None,\n            homephone=None,\n            date=None,\n            mindays=None,\n            maxdays=None,\n            inactdays=None,\n            warndays=None,\n            expire=None):\n    '''\n    Ensure that the named user is present with the specified properties\n\n    name\n        The name of the user to manage\n\n    uid\n        The user id to assign, if left empty then the next available user id\n        will be assigned\n\n    gid\n        The default group id\n\n    gid_from_name\n        If True, the default group id will be set to the id of the group with\n        the same name as the user.\n\n    groups\n        A list of groups to assign the user to, pass a list object. If a group\n        specified here does not exist on the minion, the state will fail.\n        If set to the empty list, the user will be removed from all groups\n        except the default group.\n\n    optional_groups\n        A list of groups to assign the user to, pass a list object. If a group\n        specified here does not exist on the minion, the state will silently\n        ignore it.\n\n    NOTE: If the same group is specified in both \"groups\" and\n    \"optional_groups\", then it will be assumed to be required and not optional.\n\n    remove_groups\n        Remove groups that the user is a member of that weren't specified in\n        the state, True by default\n\n    home\n        The custom login directory of user. Uses default value of underlying\n        system if not set. Notice that this directory does not have to exists.\n        This also the location of the home directory to create if createhome is\n        set to True.\n\n    createhome\n        If True, the home directory will be created if it doesn't exist.\n        Please note that directories leading up to the home directory\n        will NOT be created.\n\n    password\n        A password hash to set for the user. This field is only supported on\n        Linux, FreeBSD, NetBSD, OpenBSD, and Solaris.\n\n    .. versionchanged:: 0.16.0\n       BSD support added.\n\n    enforce_password\n        Set to False to keep the password from being changed if it has already\n        been set and the password hash differs from what is specified in the\n        \"password\" field. This option will be ignored if \"password\" is not\n        specified.\n\n    empty_password\n        Set to True to enable no password-less login for user\n\n    shell\n        The login shell, defaults to the system default shell\n\n    unique\n        Require a unique UID, True by default\n\n    system\n        Choose UID in the range of FIRST_SYSTEM_UID and LAST_SYSTEM_UID.\n\n\n    User comment field (GECOS) support (currently Linux, FreeBSD, and MacOS\n    only):\n\n    The below values should be specified as strings to avoid ambiguities when\n    the values are loaded. (Especially the phone and room number fields which\n    are likely to contain numeric data)\n\n    fullname\n        The user's full name\n\n    roomnumber\n        The user's room number (not supported in MacOS)\n\n    workphone\n        The user's work phone number (not supported in MacOS)\n\n    homephone\n        The user's home phone number (not supported in MacOS)\n\n\n    .. versionchanged:: 2014.7.0\n       Shadow attribute support added.\n\n    Shadow attributes support (currently Linux only):\n\n    The below values should be specified as integers.\n\n    date\n        Date of last change of password, represented in days since epoch\n        (January 1, 1970).\n\n    mindays\n        The minimum number of days between password changes.\n\n    maxdays\n        The maximum number of days between password changes.\n\n    inactdays\n        The number of days after a password expires before an account is\n        locked.\n\n    warndays\n        Number of days prior to maxdays to warn users.\n\n    expire\n        Date that account expires, represented in days since epoch (January 1,\n        1970).\n    '''\n    fullname = salt.utils.sdecode(fullname) if fullname is not None else fullname\n    roomnumber = salt.utils.sdecode(roomnumber) if roomnumber is not None else roomnumber\n    workphone = salt.utils.sdecode(workphone) if workphone is not None else workphone\n    homephone = salt.utils.sdecode(homephone) if homephone is not None else homephone\n\n    ret = {'name': name,\n           'changes': {},\n           'result': True,\n           'comment': 'User {0} is present and up to date'.format(name)}\n\n    if groups:\n        missing_groups = [x for x in groups if not __salt__['group.info'](x)]\n        if missing_groups:\n            ret['comment'] = 'The following group(s) are not present: ' \\\n                             '{0}'.format(','.join(missing_groups))\n            ret['result'] = False\n            return ret\n\n    if optional_groups:\n        present_optgroups = [x for x in optional_groups\n                             if __salt__['group.info'](x)]\n        for missing_optgroup in [x for x in optional_groups\n                                 if x not in present_optgroups]:\n            log.debug('Optional group \"{0}\" for user \"{1}\" is not '\n                      'present'.format(missing_optgroup, name))\n    else:\n        present_optgroups = None\n\n    # Log a warning for all groups specified in both \"groups\" and\n    # \"optional_groups\" lists.\n    if groups and optional_groups:\n        for isected in set(groups).intersection(optional_groups):\n            log.warning('Group \"{0}\" specified in both groups and '\n                        'optional_groups for user {1}'.format(isected, name))\n\n    if gid_from_name:\n        gid = __salt__['file.group_to_gid'](name)\n\n    if empty_password:\n        __salt__['shadow.del_password'](name)\n\n    changes = _changes(name,\n                       uid,\n                       gid,\n                       groups,\n                       present_optgroups,\n                       remove_groups,\n                       home,\n                       createhome,\n                       password,\n                       enforce_password,\n                       empty_password,\n                       shell,\n                       fullname,\n                       roomnumber,\n                       workphone,\n                       homephone,\n                       date,\n                       mindays,\n                       maxdays,\n                       inactdays,\n                       warndays,\n                       expire)\n\n    if changes:\n        if __opts__['test']:\n            ret['result'] = None\n            ret['comment'] = ('The following user attributes are set to be '\n                              'changed:\\n')\n            for key, val in changes.items():\n                ret['comment'] += '{0}: {1}\\n'.format(key, val)\n            return ret\n        # The user is present\n        if 'shadow.info' in __salt__:\n            lshad = __salt__['shadow.info'](name)\n        pre = __salt__['user.info'](name)\n        for key, val in changes.items():\n            if key == 'passwd' and not empty_password:\n                __salt__['shadow.set_password'](name, password)\n                continue\n            if key == 'date':\n                __salt__['shadow.set_date'](name, date)\n                continue\n            # run chhome once to avoid any possible bad side-effect\n            if key == 'home' and 'homeDoesNotExist' not in changes:\n                __salt__['user.chhome'](name, val, False)\n                continue\n            if key == 'homeDoesNotExist':\n                __salt__['user.chhome'](name, val, True)\n                if not os.path.isdir(val):\n                    __salt__['file.mkdir'](val, pre['uid'], pre['gid'], 0755)\n                continue\n            if key == 'mindays':\n                __salt__['shadow.set_mindays'](name, mindays)\n                continue\n            if key == 'maxdays':\n                __salt__['shadow.set_maxdays'](name, maxdays)\n                continue\n            if key == 'inactdays':\n                __salt__['shadow.set_inactdays'](name, inactdays)\n                continue\n            if key == 'warndays':\n                __salt__['shadow.set_warndays'](name, warndays)\n                continue\n            if key == 'expire':\n                __salt__['shadow.set_expire'](name, expire)\n                continue\n            if key == 'groups':\n                __salt__['user.ch{0}'.format(key)](\n                    name, val, not remove_groups\n                )\n            else:\n                __salt__['user.ch{0}'.format(key)](name, val)\n\n        post = __salt__['user.info'](name)\n        spost = {}\n        if 'shadow.info' in __salt__:\n            if lshad['passwd'] != password:\n                spost = __salt__['shadow.info'](name)\n        # See if anything changed\n        for key in post:\n            if post[key] != pre[key]:\n                ret['changes'][key] = post[key]\n        if 'shadow.info' in __salt__:\n            for key in spost:\n                if lshad[key] != spost[key]:\n                    ret['changes'][key] = spost[key]\n        if ret['changes']:\n            ret['comment'] = 'Updated user {0}'.format(name)\n        changes = _changes(name,\n                           uid,\n                           gid,\n                           groups,\n                           present_optgroups,\n                           remove_groups,\n                           home,\n                           createhome,\n                           password,\n                           enforce_password,\n                           empty_password,\n                           shell,\n                           fullname,\n                           roomnumber,\n                           workphone,\n                           homephone,\n                           date,\n                           mindays,\n                           maxdays,\n                           inactdays,\n                           warndays,\n                           expire)\n\n        if changes:\n            ret['comment'] = 'These values could not be changed: {0}'.format(\n                changes\n            )\n            ret['result'] = False\n        return ret\n\n    if changes is False:\n        # The user is not present, make it!\n        if __opts__['test']:\n            ret['result'] = None\n            ret['comment'] = 'User {0} set to be added'.format(name)\n            return ret\n        if groups and present_optgroups:\n            groups.extend(present_optgroups)\n        elif present_optgroups:\n            groups = present_optgroups[:]\n        if __salt__['user.add'](name,\n                                uid=uid,\n                                gid=gid,\n                                groups=groups,\n                                home=home,\n                                shell=shell,\n                                unique=unique,\n                                system=system,\n                                fullname=fullname,\n                                roomnumber=roomnumber,\n                                workphone=workphone,\n                                homephone=homephone,\n                                createhome=createhome):\n            ret['comment'] = 'New user {0} created'.format(name)\n            ret['changes'] = __salt__['user.info'](name)\n            if 'shadow.info' in __salt__ and not salt.utils.is_windows():\n                if password and not empty_password:\n                    __salt__['shadow.set_password'](name, password)\n                    spost = __salt__['shadow.info'](name)\n                    if spost['passwd'] != password:\n                        ret['comment'] = 'User {0} created but failed to set' \\\n                                         ' password to' \\\n                                         ' {1}'.format(name, password)\n                        ret['result'] = False\n                    ret['changes']['password'] = password\n                if date:\n                    __salt__['shadow.set_date'](name, date)\n                    spost = __salt__['shadow.info'](name)\n                    if spost['lstchg'] != date:\n                        ret['comment'] = 'User {0} created but failed to set' \\\n                                         ' last change date to' \\\n                                         ' {1}'.format(name, date)\n                        ret['result'] = False\n                    ret['changes']['date'] = date\n                if mindays:\n                    __salt__['shadow.set_mindays'](name, mindays)\n                    spost = __salt__['shadow.info'](name)\n                    if spost['min'] != mindays:\n                        ret['comment'] = 'User {0} created but failed to set' \\\n                                         ' minimum days to' \\\n                                         ' {1}'.format(name, mindays)\n                        ret['result'] = False\n                    ret['changes']['mindays'] = mindays\n                if maxdays:\n                    __salt__['shadow.set_maxdays'](name, maxdays)\n                    spost = __salt__['shadow.info'](name)\n                    if spost['max'] != maxdays:\n                        ret['comment'] = 'User {0} created but failed to set' \\\n                                         ' maximum days to' \\\n                                         ' {1}'.format(name, maxdays)\n                        ret['result'] = False\n                    ret['changes']['maxdays'] = maxdays\n                if inactdays:\n                    __salt__['shadow.set_inactdays'](name, inactdays)\n                    spost = __salt__['shadow.info'](name)\n                    if spost['inact'] != inactdays:\n                        ret['comment'] = 'User {0} created but failed to set' \\\n                                         ' inactive days to' \\\n                                         ' {1}'.format(name, inactdays)\n                        ret['result'] = False\n                    ret['changes']['inactdays'] = inactdays\n                if warndays:\n                    __salt__['shadow.set_warndays'](name, warndays)\n                    spost = __salt__['shadow.info'](name)\n                    if spost['warn'] != warndays:\n                        ret['comment'] = 'User {0} created but failed to set' \\\n                                         ' warn days to' \\\n                                         ' {1}'.format(name, warndays)\n                        ret['result'] = False\n                    ret['changes']['warndays'] = warndays\n                if expire:\n                    __salt__['shadow.set_expire'](name, expire)\n                    spost = __salt__['shadow.info'](name)\n                    if spost['expire'] != expire:\n                        ret['comment'] = 'User {0} created but failed to set' \\\n                                         ' expire days to' \\\n                                         ' {1}'.format(name, expire)\n                        ret['result'] = False\n                    ret['changes']['expire'] = expire\n            elif salt.utils.is_windows():\n                if password and not empty_password:\n                    if not __salt__['user.setpassword'](name, password):\n                        ret['comment'] = 'User {0} created but failed to set' \\\n                                         ' password to' \\\n                                         ' {1}'.format(name, password)\n                        ret['result'] = False\n                    ret['changes']['passwd'] = password\n        else:\n            ret['comment'] = 'Failed to create new user {0}'.format(name)\n            ret['result'] = False\n\n    return ret",
  "func_after": "def present(name,\n            uid=None,\n            gid=None,\n            gid_from_name=False,\n            groups=None,\n            optional_groups=None,\n            remove_groups=True,\n            home=None,\n            createhome=True,\n            password=None,\n            enforce_password=True,\n            empty_password=False,\n            shell=None,\n            unique=True,\n            system=False,\n            fullname=None,\n            roomnumber=None,\n            workphone=None,\n            homephone=None,\n            date=None,\n            mindays=None,\n            maxdays=None,\n            inactdays=None,\n            warndays=None,\n            expire=None):\n    '''\n    Ensure that the named user is present with the specified properties\n\n    name\n        The name of the user to manage\n\n    uid\n        The user id to assign, if left empty then the next available user id\n        will be assigned\n\n    gid\n        The default group id\n\n    gid_from_name\n        If True, the default group id will be set to the id of the group with\n        the same name as the user.\n\n    groups\n        A list of groups to assign the user to, pass a list object. If a group\n        specified here does not exist on the minion, the state will fail.\n        If set to the empty list, the user will be removed from all groups\n        except the default group.\n\n    optional_groups\n        A list of groups to assign the user to, pass a list object. If a group\n        specified here does not exist on the minion, the state will silently\n        ignore it.\n\n    NOTE: If the same group is specified in both \"groups\" and\n    \"optional_groups\", then it will be assumed to be required and not optional.\n\n    remove_groups\n        Remove groups that the user is a member of that weren't specified in\n        the state, True by default\n\n    home\n        The custom login directory of user. Uses default value of underlying\n        system if not set. Notice that this directory does not have to exists.\n        This also the location of the home directory to create if createhome is\n        set to True.\n\n    createhome\n        If True, the home directory will be created if it doesn't exist.\n        Please note that directories leading up to the home directory\n        will NOT be created.\n\n    password\n        A password hash to set for the user. This field is only supported on\n        Linux, FreeBSD, NetBSD, OpenBSD, and Solaris.\n\n    .. versionchanged:: 0.16.0\n       BSD support added.\n\n    enforce_password\n        Set to False to keep the password from being changed if it has already\n        been set and the password hash differs from what is specified in the\n        \"password\" field. This option will be ignored if \"password\" is not\n        specified.\n\n    empty_password\n        Set to True to enable no password-less login for user\n\n    shell\n        The login shell, defaults to the system default shell\n\n    unique\n        Require a unique UID, True by default\n\n    system\n        Choose UID in the range of FIRST_SYSTEM_UID and LAST_SYSTEM_UID.\n\n\n    User comment field (GECOS) support (currently Linux, FreeBSD, and MacOS\n    only):\n\n    The below values should be specified as strings to avoid ambiguities when\n    the values are loaded. (Especially the phone and room number fields which\n    are likely to contain numeric data)\n\n    fullname\n        The user's full name\n\n    roomnumber\n        The user's room number (not supported in MacOS)\n\n    workphone\n        The user's work phone number (not supported in MacOS)\n\n    homephone\n        The user's home phone number (not supported in MacOS)\n\n\n    .. versionchanged:: 2014.7.0\n       Shadow attribute support added.\n\n    Shadow attributes support (currently Linux only):\n\n    The below values should be specified as integers.\n\n    date\n        Date of last change of password, represented in days since epoch\n        (January 1, 1970).\n\n    mindays\n        The minimum number of days between password changes.\n\n    maxdays\n        The maximum number of days between password changes.\n\n    inactdays\n        The number of days after a password expires before an account is\n        locked.\n\n    warndays\n        Number of days prior to maxdays to warn users.\n\n    expire\n        Date that account expires, represented in days since epoch (January 1,\n        1970).\n    '''\n    fullname = salt.utils.sdecode(fullname) if fullname is not None else fullname\n    roomnumber = salt.utils.sdecode(roomnumber) if roomnumber is not None else roomnumber\n    workphone = salt.utils.sdecode(workphone) if workphone is not None else workphone\n    homephone = salt.utils.sdecode(homephone) if homephone is not None else homephone\n\n    ret = {'name': name,\n           'changes': {},\n           'result': True,\n           'comment': 'User {0} is present and up to date'.format(name)}\n\n    if groups:\n        missing_groups = [x for x in groups if not __salt__['group.info'](x)]\n        if missing_groups:\n            ret['comment'] = 'The following group(s) are not present: ' \\\n                             '{0}'.format(','.join(missing_groups))\n            ret['result'] = False\n            return ret\n\n    if optional_groups:\n        present_optgroups = [x for x in optional_groups\n                             if __salt__['group.info'](x)]\n        for missing_optgroup in [x for x in optional_groups\n                                 if x not in present_optgroups]:\n            log.debug('Optional group \"{0}\" for user \"{1}\" is not '\n                      'present'.format(missing_optgroup, name))\n    else:\n        present_optgroups = None\n\n    # Log a warning for all groups specified in both \"groups\" and\n    # \"optional_groups\" lists.\n    if groups and optional_groups:\n        for isected in set(groups).intersection(optional_groups):\n            log.warning('Group \"{0}\" specified in both groups and '\n                        'optional_groups for user {1}'.format(isected, name))\n\n    if gid_from_name:\n        gid = __salt__['file.group_to_gid'](name)\n\n    if empty_password:\n        __salt__['shadow.del_password'](name)\n\n    changes = _changes(name,\n                       uid,\n                       gid,\n                       groups,\n                       present_optgroups,\n                       remove_groups,\n                       home,\n                       createhome,\n                       password,\n                       enforce_password,\n                       empty_password,\n                       shell,\n                       fullname,\n                       roomnumber,\n                       workphone,\n                       homephone,\n                       date,\n                       mindays,\n                       maxdays,\n                       inactdays,\n                       warndays,\n                       expire)\n\n    if changes:\n        if __opts__['test']:\n            ret['result'] = None\n            ret['comment'] = ('The following user attributes are set to be '\n                              'changed:\\n')\n            for key, val in changes.items():\n                if key == 'password':\n                    val = 'XXX-REDACTED-XXX'\n                ret['comment'] += '{0}: {1}\\n'.format(key, val)\n            return ret\n        # The user is present\n        if 'shadow.info' in __salt__:\n            lshad = __salt__['shadow.info'](name)\n        pre = __salt__['user.info'](name)\n        for key, val in changes.items():\n            if key == 'passwd' and not empty_password:\n                __salt__['shadow.set_password'](name, password)\n                continue\n            if key == 'date':\n                __salt__['shadow.set_date'](name, date)\n                continue\n            # run chhome once to avoid any possible bad side-effect\n            if key == 'home' and 'homeDoesNotExist' not in changes:\n                __salt__['user.chhome'](name, val, False)\n                continue\n            if key == 'homeDoesNotExist':\n                __salt__['user.chhome'](name, val, True)\n                if not os.path.isdir(val):\n                    __salt__['file.mkdir'](val, pre['uid'], pre['gid'], 0755)\n                continue\n            if key == 'mindays':\n                __salt__['shadow.set_mindays'](name, mindays)\n                continue\n            if key == 'maxdays':\n                __salt__['shadow.set_maxdays'](name, maxdays)\n                continue\n            if key == 'inactdays':\n                __salt__['shadow.set_inactdays'](name, inactdays)\n                continue\n            if key == 'warndays':\n                __salt__['shadow.set_warndays'](name, warndays)\n                continue\n            if key == 'expire':\n                __salt__['shadow.set_expire'](name, expire)\n                continue\n            if key == 'groups':\n                __salt__['user.ch{0}'.format(key)](\n                    name, val, not remove_groups\n                )\n            else:\n                __salt__['user.ch{0}'.format(key)](name, val)\n\n        post = __salt__['user.info'](name)\n        spost = {}\n        if 'shadow.info' in __salt__:\n            if lshad['passwd'] != password:\n                spost = __salt__['shadow.info'](name)\n        # See if anything changed\n        for key in post:\n            if post[key] != pre[key]:\n                ret['changes'][key] = post[key]\n        if 'shadow.info' in __salt__:\n            for key in spost:\n                if lshad[key] != spost[key]:\n                    ret['changes'][key] = spost[key]\n        if ret['changes']:\n            ret['comment'] = 'Updated user {0}'.format(name)\n        changes = _changes(name,\n                           uid,\n                           gid,\n                           groups,\n                           present_optgroups,\n                           remove_groups,\n                           home,\n                           createhome,\n                           password,\n                           enforce_password,\n                           empty_password,\n                           shell,\n                           fullname,\n                           roomnumber,\n                           workphone,\n                           homephone,\n                           date,\n                           mindays,\n                           maxdays,\n                           inactdays,\n                           warndays,\n                           expire)\n\n        if changes:\n            ret['comment'] = 'These values could not be changed: {0}'.format(\n                changes\n            )\n            ret['result'] = False\n        return ret\n\n    if changes is False:\n        # The user is not present, make it!\n        if __opts__['test']:\n            ret['result'] = None\n            ret['comment'] = 'User {0} set to be added'.format(name)\n            return ret\n        if groups and present_optgroups:\n            groups.extend(present_optgroups)\n        elif present_optgroups:\n            groups = present_optgroups[:]\n        if __salt__['user.add'](name,\n                                uid=uid,\n                                gid=gid,\n                                groups=groups,\n                                home=home,\n                                shell=shell,\n                                unique=unique,\n                                system=system,\n                                fullname=fullname,\n                                roomnumber=roomnumber,\n                                workphone=workphone,\n                                homephone=homephone,\n                                createhome=createhome):\n            ret['comment'] = 'New user {0} created'.format(name)\n            ret['changes'] = __salt__['user.info'](name)\n            if 'shadow.info' in __salt__ and not salt.utils.is_windows():\n                if password and not empty_password:\n                    __salt__['shadow.set_password'](name, password)\n                    spost = __salt__['shadow.info'](name)\n                    if spost['passwd'] != password:\n                        ret['comment'] = 'User {0} created but failed to set' \\\n                                         ' password to' \\\n                                         ' {1}'.format(name, 'XXX-REDACTED-XXX')\n                        ret['result'] = False\n                    ret['changes']['password'] = 'XXX-REDACTED-XXX'\n                if date:\n                    __salt__['shadow.set_date'](name, date)\n                    spost = __salt__['shadow.info'](name)\n                    if spost['lstchg'] != date:\n                        ret['comment'] = 'User {0} created but failed to set' \\\n                                         ' last change date to' \\\n                                         ' {1}'.format(name, date)\n                        ret['result'] = False\n                    ret['changes']['date'] = date\n                if mindays:\n                    __salt__['shadow.set_mindays'](name, mindays)\n                    spost = __salt__['shadow.info'](name)\n                    if spost['min'] != mindays:\n                        ret['comment'] = 'User {0} created but failed to set' \\\n                                         ' minimum days to' \\\n                                         ' {1}'.format(name, mindays)\n                        ret['result'] = False\n                    ret['changes']['mindays'] = mindays\n                if maxdays:\n                    __salt__['shadow.set_maxdays'](name, maxdays)\n                    spost = __salt__['shadow.info'](name)\n                    if spost['max'] != maxdays:\n                        ret['comment'] = 'User {0} created but failed to set' \\\n                                         ' maximum days to' \\\n                                         ' {1}'.format(name, maxdays)\n                        ret['result'] = False\n                    ret['changes']['maxdays'] = maxdays\n                if inactdays:\n                    __salt__['shadow.set_inactdays'](name, inactdays)\n                    spost = __salt__['shadow.info'](name)\n                    if spost['inact'] != inactdays:\n                        ret['comment'] = 'User {0} created but failed to set' \\\n                                         ' inactive days to' \\\n                                         ' {1}'.format(name, inactdays)\n                        ret['result'] = False\n                    ret['changes']['inactdays'] = inactdays\n                if warndays:\n                    __salt__['shadow.set_warndays'](name, warndays)\n                    spost = __salt__['shadow.info'](name)\n                    if spost['warn'] != warndays:\n                        ret['comment'] = 'User {0} created but failed to set' \\\n                                         ' warn days to' \\\n                                         ' {1}'.format(name, warndays)\n                        ret['result'] = False\n                    ret['changes']['warndays'] = warndays\n                if expire:\n                    __salt__['shadow.set_expire'](name, expire)\n                    spost = __salt__['shadow.info'](name)\n                    if spost['expire'] != expire:\n                        ret['comment'] = 'User {0} created but failed to set' \\\n                                         ' expire days to' \\\n                                         ' {1}'.format(name, expire)\n                        ret['result'] = False\n                    ret['changes']['expire'] = expire\n            elif salt.utils.is_windows():\n                if password and not empty_password:\n                    if not __salt__['user.setpassword'](name, password):\n                        ret['comment'] = 'User {0} created but failed to set' \\\n                                         ' password to' \\\n                                         ' {1}'.format(name, 'XXX-REDACTED-XXX')\n                        ret['result'] = False\n                    ret['changes']['passwd'] = 'XXX-REDACTED-XXX'\n        else:\n            ret['comment'] = 'Failed to create new user {0}'.format(name)\n            ret['result'] = False\n\n    return ret",
  "diff_func": "--- func_before\n+++ func_after\n def present(name,\n             uid=None,\n             gid=None,\n             gid_from_name=False,\n             groups=None,\n             optional_groups=None,\n             remove_groups=True,\n             home=None,\n             createhome=True,\n             password=None,\n             enforce_password=True,\n             empty_password=False,\n             shell=None,\n             unique=True,\n             system=False,\n             fullname=None,\n             roomnumber=None,\n             workphone=None,\n             homephone=None,\n             date=None,\n             mindays=None,\n             maxdays=None,\n             inactdays=None,\n             warndays=None,\n             expire=None):\n     '''\n     Ensure that the named user is present with the specified properties\n \n     name\n         The name of the user to manage\n \n     uid\n         The user id to assign, if left empty then the next available user id\n         will be assigned\n \n     gid\n         The default group id\n \n     gid_from_name\n         If True, the default group id will be set to the id of the group with\n         the same name as the user.\n \n     groups\n         A list of groups to assign the user to, pass a list object. If a group\n         specified here does not exist on the minion, the state will fail.\n         If set to the empty list, the user will be removed from all groups\n         except the default group.\n \n     optional_groups\n         A list of groups to assign the user to, pass a list object. If a group\n         specified here does not exist on the minion, the state will silently\n         ignore it.\n \n     NOTE: If the same group is specified in both \"groups\" and\n     \"optional_groups\", then it will be assumed to be required and not optional.\n \n     remove_groups\n         Remove groups that the user is a member of that weren't specified in\n         the state, True by default\n \n     home\n         The custom login directory of user. Uses default value of ",
  "diff_source": "custom"
}