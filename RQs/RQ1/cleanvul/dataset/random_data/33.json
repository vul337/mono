{
  "id": 33,
  "language": "Java",
  "commit_url": "https://github.com/hazelcast/hazelcast/commit/d23d59f42bab865a342d32fa9be52a6497499058",
  "commit_sha": "d23d59f42bab865a342d32fa9be52a6497499058",
  "commit_msg": "Add helper method to XmlUtil to enable XXE protection in the SAXParserFactory and XMLInputFactory (5.0) (#20941)",
  "pr_url": "https://github.com/hazelcast/hazelcast/pull/20941",
  "pr_info": "Backport (`git cherry-pick [...]`) of the changes in #20407 into the Hazelcast 5.0.z version branch.\r\n\r\nFixes #20928 (for 5.0.z branch)\r\n\r\nBackport of: #20407\r\n\r\nChecklist:\r\n- [ ] Labels (`Team:`, `Type:`, `Source:`, `Module:`) and Milestone set\r\n- [ ] Label `Add to Release Notes` or `Not Release Notes content` set\r\n- [ ] Request reviewers if possible\r\n- [ ] Send backports/forwardports if fix needs to be applied to past/future releases\r\n- [ ] New public APIs have `@Nonnull/@Nullable` annotations\r\n- [ ] New public APIs have `@since` tags in Javadoc",
  "file_name": "hazelcast/src/main/java/com/hazelcast/internal/util/XmlUtil.java",
  "func_name": "SAXException",
  "func_before": "static void setProperty(SchemaFactory schemaFactory, String propertyName) throws SAXException {\n        try {\n            schemaFactory.setProperty(propertyName, \"\");\n        } catch (SAXException e) {\n            if (Boolean.getBoolean(SYSTEM_PROPERTY_IGNORE_XXE_PROTECTION_FAILURES)) {\n                LOGGER.warning(\"Enabling XXE protection failed. The property \" + propertyName\n                        + \" is not supported by the SchemaFactory. The \" + SYSTEM_PROPERTY_IGNORE_XXE_PROTECTION_FAILURES\n                        + \" system property is used so the XML processing continues in the UNSECURE mode\"\n                        + \" with XXE protection disabled!!!\");\n            } else {\n                LOGGER.severe(\"Enabling XXE protection failed. The property \" + propertyName\n                        + \" is not supported by the SchemaFactory. This usually mean an outdated XML processor\"\n                        + \" is present on the classpath (e.g. Xerces, Xalan). If you are not able to resolve the issue by\"\n                        + \" fixing the classpath, the \" + SYSTEM_PROPERTY_IGNORE_XXE_PROTECTION_FAILURES\n                        + \" system property can be used to disable XML External Entity protections.\"\n                        + \" We don't recommend disabling the XXE as such the XML processor configuration is unsecure!!!\", e);\n                throw e;\n            }\n        }\n    }",
  "func_after": "static void setProperty(SchemaFactory schemaFactory, String propertyName) throws SAXException {\n        try {\n            schemaFactory.setProperty(propertyName, \"\");\n        } catch (SAXException e) {\n            printWarningAndRethrowEventually(e, SchemaFactory.class, \"property \" + propertyName);\n        }\n    }",
  "diff_func": "--- func_before\n+++ func_after\n static void setProperty(SchemaFactory schemaFactory, String propertyName) throws SAXException {\n         try {\n             schemaFactory.setProperty(propertyName, \"\");\n         } catch (SAXException e) {\n+            printWarningAndRethrowEventually(e, SchemaFactory.class, \"property \" + propertyName);\n-            if (Boolean.getBoolean(SYSTEM_PROPERTY_IGNORE_XXE_PROTECTION_FAILURES)) {\n-                LOGGER.warning(\"Enabling XXE protection failed. The property \" + propertyName\n-                        + \" is not supported by the SchemaFactory. The \" + SYSTEM_PROPERTY_IGNORE_XXE_PROTECTION_FAILURES\n-                        + \" system property is used so the XML processing continues in the UNSECURE mode\"\n-                        + \" with XXE protection disabled!!!\");\n-            } else {\n-                LOGGER.severe(\"Enabling XXE protection failed. The property \" + propertyName\n-                        + \" is not supported by the SchemaFactory. This usually mean an outdated XML processor\"\n-                        + \" is present on the classpath (e.g. Xerces, Xalan). If you are not able to resolve the issue by\"\n-                        + \" fixing the classpath, the \" + SYSTEM_PROPERTY_IGNORE_XXE_PROTECTION_FAILURES\n-                        + \" system property can be used to disable XML External Entity protections.\"\n-                        + \" We don't recommend disabling the XXE as such the XML processor configuration is unsecure!!!\", e);\n-                throw e;\n-            }\n         }\n     }",
  "diff_source": "custom"
}