{
  "id": 1549,
  "language": "Java",
  "commit_url": "https://github.com/dogtagpki/pki/commit/669292d31344c76f1731a416afbf741ed6f3afb7",
  "commit_sha": "669292d31344c76f1731a416afbf741ed6f3afb7",
  "commit_msg": "Disable access to external entities when parsing XML\n\nThis reduces the vulnerability of XML parsers to XXE (XML external\nentity) injection.\n\nThe best way to prevent XXE is to stop using XML altogether, which we do\nplan to do. Until that happens I consider it worthwhile to tighten the\nsecurity here though.",
  "pr_url": null,
  "pr_info": "no more info",
  "file_name": "base/server/src/com/netscape/cms/servlet/csadmin/SecurityDomainProcessor.java",
  "func_name": "Exception",
  "func_before": "public static void main(String args[]) throws Exception {\n\n        DomainInfo before = new DomainInfo();\n        before.setName(\"EXAMPLE\");\n\n        SecurityDomainHost host = new SecurityDomainHost();\n        host.setId(\"CA localhost 8443\");\n        host.setHostname(\"localhost\");\n        host.setPort(\"8080\");\n        host.setSecurePort(\"8443\");\n        host.setDomainManager(\"TRUE\");\n\n        before.addHost(\"CA\", host);\n\n        System.out.println(\"Before:\");\n        System.out.println(before);\n\n        XMLObject xmlObject = convertDomainInfoToXMLObject(before);\n        Document document = xmlObject.getDocument();\n\n        Transformer transformer = TransformerFactory.newInstance().newTransformer();\n        transformer.setOutputProperty(OutputKeys.INDENT, \"yes\");\n        transformer.setOutputProperty(\"{http://xml.apache.org/xslt}indent-amount\", \"4\");\n\n        StringWriter sw = new StringWriter();\n        transformer.transform(new DOMSource(document), new StreamResult(sw));\n\n        System.out.println(\"Domain XML:\");\n        System.out.println(sw);\n\n        DomainInfo after = convertXMLObjectToDomainInfo(xmlObject);\n\n        System.out.println(\"After:\");\n        System.out.println(after);\n    }",
  "func_after": "public static void main(String args[]) throws Exception {\n\n        DomainInfo before = new DomainInfo();\n        before.setName(\"EXAMPLE\");\n\n        SecurityDomainHost host = new SecurityDomainHost();\n        host.setId(\"CA localhost 8443\");\n        host.setHostname(\"localhost\");\n        host.setPort(\"8080\");\n        host.setSecurePort(\"8443\");\n        host.setDomainManager(\"TRUE\");\n\n        before.addHost(\"CA\", host);\n\n        System.out.println(\"Before:\");\n        System.out.println(before);\n\n        XMLObject xmlObject = convertDomainInfoToXMLObject(before);\n        Document document = xmlObject.getDocument();\n\n        TransformerFactory transformerFactory = TransformerFactory.newInstance();\n        transformerFactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, \"\");\n        transformerFactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, \"\");\n        Transformer transformer = transformerFactory.newTransformer();\n        transformer.setOutputProperty(OutputKeys.INDENT, \"yes\");\n        transformer.setOutputProperty(\"{http://xml.apache.org/xslt}indent-amount\", \"4\");\n\n        StringWriter sw = new StringWriter();\n        transformer.transform(new DOMSource(document), new StreamResult(sw));\n\n        System.out.println(\"Domain XML:\");\n        System.out.println(sw);\n\n        DomainInfo after = convertXMLObjectToDomainInfo(xmlObject);\n\n        System.out.println(\"After:\");\n        System.out.println(after);\n    }",
  "diff_func": "--- func_before\n+++ func_after\n public static void main(String args[]) throws Exception {\n \n         DomainInfo before = new DomainInfo();\n         before.setName(\"EXAMPLE\");\n \n         SecurityDomainHost host = new SecurityDomainHost();\n         host.setId(\"CA localhost 8443\");\n         host.setHostname(\"localhost\");\n         host.setPort(\"8080\");\n         host.setSecurePort(\"8443\");\n         host.setDomainManager(\"TRUE\");\n \n         before.addHost(\"CA\", host);\n \n         System.out.println(\"Before:\");\n         System.out.println(before);\n \n         XMLObject xmlObject = convertDomainInfoToXMLObject(before);\n         Document document = xmlObject.getDocument();\n \n+        TransformerFactory transformerFactory = TransformerFactory.newInstance();\n+        transformerFactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, \"\");\n+        transformerFactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, \"\");\n-        Transformer transformer = TransformerFactory.newInstance().newTransformer();\n+        Transformer transformer = transformerFactory.newTransformer();\n         transformer.setOutputProperty(OutputKeys.INDENT, \"yes\");\n         transformer.setOutputProperty(\"{http://xml.apache.org/xslt}indent-amount\", \"4\");\n \n         StringWriter sw = new StringWriter();\n         transformer.transform(new DOMSource(document), new StreamResult(sw));\n \n         System.out.println(\"Domain XML:\");\n         System.out.println(sw);\n \n         DomainInfo after = convertXMLObjectToDomainInfo(xmlObject);\n \n         System.out.println(\"After:\");\n         System.out.println(after);\n     }",
  "diff_source": "custom"
}