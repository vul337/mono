{
  "id": 1690,
  "language": "Java",
  "commit_url": "https://github.com/shiftrot/droidvim/commit/15604fc70e185a023ff5408b207b009187cdd9ca",
  "commit_sha": "15604fc70e185a023ff5408b207b009187cdd9ca",
  "commit_msg": "Fix Intent Redirection Vulnerability",
  "pr_url": null,
  "pr_info": "no more info",
  "file_name": "term/src/main/java/jackpal/androidterm/RemoteInterface.java",
  "func_name": "appendToWindow",
  "func_before": "protected String appendToWindow(String handle, String iInitialCommand) {\n        TermService service = getTermService();\n\n        // Find the target window\n        SessionList sessions = service.getSessions();\n        GenericTermSession target = null;\n        int index;\n        for (index = 0; index < sessions.size(); ++index) {\n            GenericTermSession session = (GenericTermSession) sessions.get(index);\n            String h = session.getHandle();\n            if (h != null && h.equals(handle)) {\n                target = session;\n                break;\n            }\n        }\n\n        if (target == null) {\n            // Target window not found, open a new one\n            return openNewWindow(iInitialCommand);\n        }\n\n        if (iInitialCommand != null) {\n            target.write(iInitialCommand);\n            target.write('\\r');\n        }\n\n        Intent intent = new Intent(PRIVACT_SWITCH_WINDOW);\n        intent.addCategory(Intent.CATEGORY_DEFAULT);\n        intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\n        intent.putExtra(PRIVEXTRA_TARGET_WINDOW, index);\n        startActivity(intent);\n\n        return handle;\n    }",
  "func_after": "protected String appendToWindow(String handle, String iInitialCommand) {\n        TermService service = getTermService();\n\n        // Find the target window\n        SessionList sessions = service.getSessions();\n        GenericTermSession target = null;\n        int index;\n        for (index = 0; index < sessions.size(); ++index) {\n            GenericTermSession session = (GenericTermSession) sessions.get(index);\n            String h = session.getHandle();\n            if (h != null && h.equals(handle)) {\n                target = session;\n                break;\n            }\n        }\n\n        if (target == null) {\n            // Target window not found, open a new one\n            return openNewWindow(iInitialCommand);\n        }\n\n        if (iInitialCommand != null) {\n            target.write(iInitialCommand);\n            target.write('\\r');\n        }\n\n        Intent intent = new Intent(PRIVACT_SWITCH_WINDOW);\n        intent.addCategory(Intent.CATEGORY_DEFAULT);\n        intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\n        intent.putExtra(PRIVEXTRA_TARGET_WINDOW, index);\n        intent.setClassName(BuildConfig.APPLICATION_ID, PRIVACT_ACTIVITY_ALIAS);\n        startActivity(intent);\n\n        return handle;\n    }",
  "diff_func": "--- func_before\n+++ func_after\n protected String appendToWindow(String handle, String iInitialCommand) {\n         TermService service = getTermService();\n \n         // Find the target window\n         SessionList sessions = service.getSessions();\n         GenericTermSession target = null;\n         int index;\n         for (index = 0; index < sessions.size(); ++index) {\n             GenericTermSession session = (GenericTermSession) sessions.get(index);\n             String h = session.getHandle();\n             if (h != null && h.equals(handle)) {\n                 target = session;\n                 break;\n             }\n         }\n \n         if (target == null) {\n             // Target window not found, open a new one\n             return openNewWindow(iInitialCommand);\n         }\n \n         if (iInitialCommand != null) {\n             target.write(iInitialCommand);\n             target.write('\\r');\n         }\n \n         Intent intent = new Intent(PRIVACT_SWITCH_WINDOW);\n         intent.addCategory(Intent.CATEGORY_DEFAULT);\n         intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\n         intent.putExtra(PRIVEXTRA_TARGET_WINDOW, index);\n+        intent.setClassName(BuildConfig.APPLICATION_ID, PRIVACT_ACTIVITY_ALIAS);\n         startActivity(intent);\n \n         return handle;\n     }",
  "diff_source": "custom"
}