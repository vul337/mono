{
  "id": 7807,
  "language": "JavaScript",
  "commit_url": "https://github.com/mrodrig/doc-path/commit/3e2bb168cf303bffcd7fae5f8d05e5300c1541c7",
  "commit_sha": "3e2bb168cf303bffcd7fae5f8d05e5300c1541c7",
  "commit_msg": "Fix issue presented in #14",
  "pr_url": "https://github.com/mrodrig/doc-path/pull/15",
  "pr_info": "no more info",
  "file_name": "src/path.js",
  "func_name": "setPath",
  "func_before": "function setPath(document, keyPath, value) {\n    if (!document) {\n        throw new Error('No document was provided.');\n    }\n\n    let {indexOfDot, currentKey, remainingKeyPath} = computeStateInformation(keyPath);\n\n    // if (currentKey === '__proto__' || currentKey === 'prototype' && Object.prototype.hasOwnProperty.call(document, currentKey)) {\n    if (currentKey === '__proto__') {\n        // Refuse to modify anything on __proto__, return the document\n        return document;\n    } else if (indexOfDot >= 0) {\n        // If there is a '.' in the keyPath, recur on the subdoc and ...\n        if (!document[currentKey] && Array.isArray(document)) {\n            // If this is an array and there are multiple levels of keys to iterate over, recur.\n            return document.forEach((doc) => setPath(doc, keyPath, value));\n        } else if (!document[currentKey]) {\n            // If the currentKey doesn't exist yet, populate it\n            document[currentKey] = {};\n        }\n        setPath(document[currentKey], remainingKeyPath, value);\n    } else if (Array.isArray(document)) {\n        // If this \"document\" is actually an array, then we can loop over each of the values and set the path\n        return document.forEach((doc) => setPath(doc, remainingKeyPath, value));\n    } else {\n        // Otherwise, we can set the path directly\n        document[keyPath] = value;\n    }\n\n    return document;\n}",
  "func_after": "function setPath(document, keyPath, value) {\n    if (!document) {\n        throw new Error('No document was provided.');\n    } else if (!keyPath) {\n        throw new Error('No keyPath was provided.');\n    }\n\n    // If this is clearly a prototype pollution attempt, then refuse to modify the path\n    if (keyPath.startsWith('__proto__') || keyPath.startsWith('constructor')) {\n        return document;\n    }\n\n    return _setPath(document, keyPath, value);\n}",
  "diff_func": "--- func_before\n+++ func_after\n function setPath(document, keyPath, value) {\n     if (!document) {\n         throw new Error('No document was provided.');\n+    } else if (!keyPath) {\n+        throw new Error('No keyPath was provided.');\n     }\n \n+    // If this is clearly a prototype pollution attempt, then refuse to modify the path\n+    if (keyPath.startsWith('__proto__') || keyPath.startsWith('constructor')) {\n-    let {indexOfDot, currentKey, remainingKeyPath} = computeStateInformation(keyPath);\n-\n-    // if (currentKey === '__proto__' || currentKey === 'prototype' && Object.prototype.hasOwnProperty.call(document, currentKey)) {\n-    if (currentKey === '__proto__') {\n-        // Refuse to modify anything on __proto__, return the document\n         return document;\n-    } else if (indexOfDot >= 0) {\n-        // If there is a '.' in the keyPath, recur on the subdoc and ...\n-        if (!document[currentKey] && Array.isArray(document)) {\n-            // If this is an array and there are multiple levels of keys to iterate over, recur.\n-            return document.forEach((doc) => setPath(doc, keyPath, value));\n-        } else if (!document[currentKey]) {\n-            // If the currentKey doesn't exist yet, populate it\n-            document[currentKey] = {};\n-        }\n-        setPath(document[currentKey], remainingKeyPath, value);\n-    } else if (Array.isArray(document)) {\n-        // If this \"document\" is actually an array, then we can loop over each of the values and set the path\n-        return document.forEach((doc) => setPath(doc, remainingKeyPath, value));\n-    } else {\n-        // Otherwise, we can set the path directly\n-        document[keyPath] = value;\n     }\n \n-    return document;\n+    return _setPath(document, keyPath, value);\n }",
  "diff_source": "custom"
}