{
  "cve_id": "CVE-2019-18212",
  "cwe_ids": [
    "CWE-22"
  ],
  "cvss_vector": "AV:N/AC:L/Au:S/C:N/I:P/A:N",
  "cvss_is_v3": false,
  "repo_name": "eclipse/lemminx",
  "commit_msg": "Reject download of resource which are not in the cache folder (url which\nuses several ../../).\n\nSigned-off-by: azerr <azerr@redhat.com>",
  "commit_hash": "e37c399aa266be1b7a43061d4afc43dc230410d2",
  "git_url": "https://github.com/eclipse/lemminx/commit/e37c399aa266be1b7a43061d4afc43dc230410d2",
  "file_path": "org.eclipse.lsp4xml/src/main/java/org/eclipse/lsp4xml/uriresolver/CacheResourcesManager.java",
  "func_name": "getResource",
  "func_before": "public Path getResource(final String resourceURI) throws IOException {\n\t\tPath resourceCachePath = getResourceCachePath(resourceURI);\n\t\tif (Files.exists(resourceCachePath)) {\n\t\t\treturn resourceCachePath;\n\t\t}\n\n\t\tif(unavailableURICache.getIfPresent(resourceURI) != null) {\n\t\t\tLOGGER.info(\"Ignored unavailable schema URI: \" + resourceURI + \"\\n\");\n\t\t\treturn null;\n\t\t}\n\n\t\tCompletableFuture<Path> f = null;\n\t\tsynchronized (resourcesLoading) {\n\t\t\tif (resourcesLoading.containsKey(resourceURI)) {\n\t\t\t\tCompletableFuture<Path> future = resourcesLoading.get(resourceURI);\n\t\t\t\tthrow new CacheResourceDownloadingException(resourceURI, future);\n\t\t\t}\n\t\t\tf = downloadResource(resourceURI, resourceCachePath);\n\t\t\tresourcesLoading.put(resourceURI, f);\n\t\t}\n\n\t\tif (f.getNow(null) == null) {\n\t\t\tthrow new CacheResourceDownloadingException(resourceURI, f);\n\t\t}\n\n\t\treturn resourceCachePath;\n\t}",
  "abstract_func_before": "public Path getResource(final String VAR_0) throws IOException {\n\t\tPath VAR_1 = getResourceCachePath(VAR_0);\n\t\tif (VAR_2.exists(VAR_1)) {\n\t\t\treturn VAR_1;\n\t\t}\n\n\t\tif(VAR_3.getIfPresent(VAR_0) != null) {\n\t\t\tVAR_4.info(\"Ignored unavailable schema URI: \" + VAR_0 + \"\\n\");\n\t\t\treturn null;\n\t\t}\n\n\t\tCompletableFuture<Path> VAR_5 = null;\n\t\tsynchronized (VAR_6) {\n\t\t\tif (VAR_6.containsKey(VAR_0)) {\n\t\t\t\tCompletableFuture<Path> VAR_7 = VAR_6.get(VAR_0);\n\t\t\t\tthrow new CacheResourceDownloadingException(VAR_0, VAR_7);\n\t\t\t}\n\t\t\tVAR_5 = downloadResource(VAR_0, VAR_1);\n\t\t\tVAR_6.put(VAR_0, VAR_5);\n\t\t}\n\n\t\tif (VAR_5.getNow(null) == null) {\n\t\t\tthrow new CacheResourceDownloadingException(VAR_0, VAR_5);\n\t\t}\n\n\t\treturn VAR_1;\n\t}",
  "func_graph_path_before": "eclipse/lemminx/e37c399aa266be1b7a43061d4afc43dc230410d2/CacheResourcesManager.java/vul/before/1.json",
  "func": "public Path getResource(final String resourceURI) throws IOException {\n\t\tPath resourceCachePath = getResourceCachePath(resourceURI);\n\t\tif (Files.exists(resourceCachePath)) {\n\t\t\treturn resourceCachePath;\n\t\t}\n\t\tif (!FilesUtils.isIncludedInDeployedPath(resourceCachePath)) {\n\t\t\tthrow new CacheResourceDownloadingException(resourceURI);\n\t\t}\n\t\tif (unavailableURICache.getIfPresent(resourceURI) != null) {\n\t\t\tLOGGER.info(\"Ignored unavailable schema URI: \" + resourceURI + \"\\n\");\n\t\t\treturn null;\n\t\t}\n\n\t\tCompletableFuture<Path> f = null;\n\t\tsynchronized (resourcesLoading) {\n\t\t\tif (resourcesLoading.containsKey(resourceURI)) {\n\t\t\t\tCompletableFuture<Path> future = resourcesLoading.get(resourceURI);\n\t\t\t\tthrow new CacheResourceDownloadingException(resourceURI, future);\n\t\t\t}\n\t\t\tf = downloadResource(resourceURI, resourceCachePath);\n\t\t\tresourcesLoading.put(resourceURI, f);\n\t\t}\n\n\t\tif (f.getNow(null) == null) {\n\t\t\tthrow new CacheResourceDownloadingException(resourceURI, f);\n\t\t}\n\n\t\treturn resourceCachePath;\n\t}",
  "abstract_func": "public Path getResource(final String VAR_0) throws IOException {\n\t\tPath VAR_1 = getResourceCachePath(VAR_0);\n\t\tif (VAR_2.exists(VAR_1)) {\n\t\t\treturn VAR_1;\n\t\t}\n\t\tif (!VAR_3.isIncludedInDeployedPath(VAR_1)) {\n\t\t\tthrow new CacheResourceDownloadingException(VAR_0);\n\t\t}\n\t\tif (VAR_4.getIfPresent(VAR_0) != null) {\n\t\t\tVAR_5.info(\"Ignored unavailable schema URI: \" + VAR_0 + \"\\n\");\n\t\t\treturn null;\n\t\t}\n\n\t\tCompletableFuture<Path> VAR_6 = null;\n\t\tsynchronized (VAR_7) {\n\t\t\tif (VAR_7.containsKey(VAR_0)) {\n\t\t\t\tCompletableFuture<Path> VAR_8 = VAR_7.get(VAR_0);\n\t\t\t\tthrow new CacheResourceDownloadingException(VAR_0, VAR_8);\n\t\t\t}\n\t\t\tVAR_6 = downloadResource(VAR_0, VAR_1);\n\t\t\tVAR_7.put(VAR_0, VAR_6);\n\t\t}\n\n\t\tif (VAR_6.getNow(null) == null) {\n\t\t\tthrow new CacheResourceDownloadingException(VAR_0, VAR_6);\n\t\t}\n\n\t\treturn VAR_1;\n\t}",
  "func_graph_path": "eclipse/lemminx/e37c399aa266be1b7a43061d4afc43dc230410d2/CacheResourcesManager.java/vul/after/1.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -3,8 +3,10 @@\n \t\tif (Files.exists(resourceCachePath)) {\n \t\t\treturn resourceCachePath;\n \t\t}\n-\n-\t\tif(unavailableURICache.getIfPresent(resourceURI) != null) {\n+\t\tif (!FilesUtils.isIncludedInDeployedPath(resourceCachePath)) {\n+\t\t\tthrow new CacheResourceDownloadingException(resourceURI);\n+\t\t}\n+\t\tif (unavailableURICache.getIfPresent(resourceURI) != null) {\n \t\t\tLOGGER.info(\"Ignored unavailable schema URI: \" + resourceURI + \"\\n\");\n \t\t\treturn null;\n \t\t}",
  "diff_line_info": {
    "deleted_lines": [
      "",
      "\t\tif(unavailableURICache.getIfPresent(resourceURI) != null) {"
    ],
    "added_lines": [
      "\t\tif (!FilesUtils.isIncludedInDeployedPath(resourceCachePath)) {",
      "\t\t\tthrow new CacheResourceDownloadingException(resourceURI);",
      "\t\t}",
      "\t\tif (unavailableURICache.getIfPresent(resourceURI) != null) {"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/eclipse-lemminx/lemminx/pull/567",
  "description": {
    "pr_info": {
      "title": "Reject download of resource which are not in the cache folder",
      "number": 567
    },
    "comment": [
      "Reject download of resource which are not in the cache folder (url which uses several ../../).\r\n\r\nSigned-off-by: azerr <azerr@redhat.com>",
      "[CVE-2019-18212](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-18212) was opened  about this issue."
    ]
  },
  "Bug Filter": "Security Vulnerability Fix",
  "Bug Filter Confidence": 0.9,
  "Bug Filter Response": "**Final Classification:** Security Vulnerability Fix;  \n**Confidence:** 0.9."
}