{
  "cve_id": "CVE-2021-40656",
  "cwe_ids": [
    "CWE-787"
  ],
  "cvss_vector": "AV:N/AC:M/Au:N/C:P/I:P/A:P",
  "cvss_is_v3": false,
  "repo_name": "libsixel",
  "commit_msg": "[error_diffuse] don't diffuse into the void",
  "commit_hash": "dc96cdc27fb53e8595af67aaf68001033c808e42",
  "git_url": "https://github.com/libsixel/libsixel/commit/dc96cdc27fb53e8595af67aaf68001033c808e42",
  "file_path": "src/quant.c",
  "func_name": "diffuse_jajuni",
  "func_before": "static void\ndiffuse_jajuni(unsigned char *data, int width, int height,\n               int x, int y, int depth, int error)\n{\n    int pos;\n\n    pos = y * width + x;\n\n    /* Jarvis, Judice & Ninke Method\n     *                  curr    7/48    5/48\n     *  3/48    5/48    7/48    5/48    3/48\n     *  1/48    3/48    5/48    3/48    1/48\n     */\n    if (pos < (height - 2) * width - 2) {\n        error_diffuse(data, pos + width * 0 + 1, depth, error, 7, 48);\n        error_diffuse(data, pos + width * 0 + 2, depth, error, 5, 48);\n        error_diffuse(data, pos + width * 1 - 2, depth, error, 3, 48);\n        error_diffuse(data, pos + width * 1 - 1, depth, error, 5, 48);\n        error_diffuse(data, pos + width * 1 + 0, depth, error, 7, 48);\n        error_diffuse(data, pos + width * 1 + 1, depth, error, 5, 48);\n        error_diffuse(data, pos + width * 1 + 2, depth, error, 3, 48);\n        error_diffuse(data, pos + width * 2 - 2, depth, error, 1, 48);\n        error_diffuse(data, pos + width * 2 - 1, depth, error, 3, 48);\n        error_diffuse(data, pos + width * 2 + 0, depth, error, 5, 48);\n        error_diffuse(data, pos + width * 2 + 1, depth, error, 3, 48);\n        error_diffuse(data, pos + width * 2 + 2, depth, error, 1, 48);\n    }\n}",
  "abstract_func_before": "static void\ndiffuse_jajuni(unsigned char *VAR_0, int VAR_1, int VAR_2,\n               int VAR_3, int VAR_4, int VAR_5, int VAR_6)\n{\n    int VAR_7;\n\n    VAR_7 = VAR_4 * VAR_1 + VAR_3;\n\n    /* COMMENT_0 */\n                                            \n                                            \n                                            \n       \n    if (VAR_7 < (VAR_2 - 2) * VAR_1 - 2) {\n        error_diffuse(VAR_0, VAR_7 + VAR_1 * 0 + 1, VAR_5, VAR_6, 7, 48);\n        error_diffuse(VAR_0, VAR_7 + VAR_1 * 0 + 2, VAR_5, VAR_6, 5, 48);\n        error_diffuse(VAR_0, VAR_7 + VAR_1 * 1 - 2, VAR_5, VAR_6, 3, 48);\n        error_diffuse(VAR_0, VAR_7 + VAR_1 * 1 - 1, VAR_5, VAR_6, 5, 48);\n        error_diffuse(VAR_0, VAR_7 + VAR_1 * 1 + 0, VAR_5, VAR_6, 7, 48);\n        error_diffuse(VAR_0, VAR_7 + VAR_1 * 1 + 1, VAR_5, VAR_6, 5, 48);\n        error_diffuse(VAR_0, VAR_7 + VAR_1 * 1 + 2, VAR_5, VAR_6, 3, 48);\n        error_diffuse(VAR_0, VAR_7 + VAR_1 * 2 - 2, VAR_5, VAR_6, 1, 48);\n        error_diffuse(VAR_0, VAR_7 + VAR_1 * 2 - 1, VAR_5, VAR_6, 3, 48);\n        error_diffuse(VAR_0, VAR_7 + VAR_1 * 2 + 0, VAR_5, VAR_6, 5, 48);\n        error_diffuse(VAR_0, VAR_7 + VAR_1 * 2 + 1, VAR_5, VAR_6, 3, 48);\n        error_diffuse(VAR_0, VAR_7 + VAR_1 * 2 + 2, VAR_5, VAR_6, 1, 48);\n    }\n}",
  "func_graph_path_before": "libsixel/dc96cdc27fb53e8595af67aaf68001033c808e42/quant.c/vul/before/2.json",
  "func": "static void\ndiffuse_jajuni(unsigned char *data, int width, int height,\n               int x, int y, int depth, int error)\n{\n    int pos;\n\n    pos = y * width + x;\n\n    /* Jarvis, Judice & Ninke Method\n     *                  curr    7/48    5/48\n     *  3/48    5/48    7/48    5/48    3/48\n     *  1/48    3/48    5/48    3/48    1/48\n     */\n    if (pos < (height - 2) * width - 2) {\n        error_diffuse(data, pos + width * 0 + 1, depth, error, 7, 48, width * height);\n        error_diffuse(data, pos + width * 0 + 2, depth, error, 5, 48, width * height);\n        error_diffuse(data, pos + width * 1 - 2, depth, error, 3, 48, width * height);\n        error_diffuse(data, pos + width * 1 - 1, depth, error, 5, 48, width * height);\n        error_diffuse(data, pos + width * 1 + 0, depth, error, 7, 48, width * height);\n        error_diffuse(data, pos + width * 1 + 1, depth, error, 5, 48, width * height);\n        error_diffuse(data, pos + width * 1 + 2, depth, error, 3, 48, width * height);\n        error_diffuse(data, pos + width * 2 - 2, depth, error, 1, 48, width * height);\n        error_diffuse(data, pos + width * 2 - 1, depth, error, 3, 48, width * height);\n        error_diffuse(data, pos + width * 2 + 0, depth, error, 5, 48, width * height);\n        error_diffuse(data, pos + width * 2 + 1, depth, error, 3, 48, width * height);\n        error_diffuse(data, pos + width * 2 + 2, depth, error, 1, 48, width * height);\n    }\n}",
  "abstract_func": "static void\ndiffuse_jajuni(unsigned char *VAR_0, int VAR_1, int VAR_2,\n               int VAR_3, int VAR_4, int VAR_5, int VAR_6)\n{\n    int VAR_7;\n\n    VAR_7 = VAR_4 * VAR_1 + VAR_3;\n\n    /* COMMENT_0 */\n                                            \n                                            \n                                            \n       \n    if (VAR_7 < (VAR_2 - 2) * VAR_1 - 2) {\n        error_diffuse(VAR_0, VAR_7 + VAR_1 * 0 + 1, VAR_5, VAR_6, 7, 48, VAR_1 * VAR_2);\n        error_diffuse(VAR_0, VAR_7 + VAR_1 * 0 + 2, VAR_5, VAR_6, 5, 48, VAR_1 * VAR_2);\n        error_diffuse(VAR_0, VAR_7 + VAR_1 * 1 - 2, VAR_5, VAR_6, 3, 48, VAR_1 * VAR_2);\n        error_diffuse(VAR_0, VAR_7 + VAR_1 * 1 - 1, VAR_5, VAR_6, 5, 48, VAR_1 * VAR_2);\n        error_diffuse(VAR_0, VAR_7 + VAR_1 * 1 + 0, VAR_5, VAR_6, 7, 48, VAR_1 * VAR_2);\n        error_diffuse(VAR_0, VAR_7 + VAR_1 * 1 + 1, VAR_5, VAR_6, 5, 48, VAR_1 * VAR_2);\n        error_diffuse(VAR_0, VAR_7 + VAR_1 * 1 + 2, VAR_5, VAR_6, 3, 48, VAR_1 * VAR_2);\n        error_diffuse(VAR_0, VAR_7 + VAR_1 * 2 - 2, VAR_5, VAR_6, 1, 48, VAR_1 * VAR_2);\n        error_diffuse(VAR_0, VAR_7 + VAR_1 * 2 - 1, VAR_5, VAR_6, 3, 48, VAR_1 * VAR_2);\n        error_diffuse(VAR_0, VAR_7 + VAR_1 * 2 + 0, VAR_5, VAR_6, 5, 48, VAR_1 * VAR_2);\n        error_diffuse(VAR_0, VAR_7 + VAR_1 * 2 + 1, VAR_5, VAR_6, 3, 48, VAR_1 * VAR_2);\n        error_diffuse(VAR_0, VAR_7 + VAR_1 * 2 + 2, VAR_5, VAR_6, 1, 48, VAR_1 * VAR_2);\n    }\n}",
  "func_graph_path": "libsixel/dc96cdc27fb53e8595af67aaf68001033c808e42/quant.c/vul/after/2.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -12,17 +12,17 @@\n      *  1/48    3/48    5/48    3/48    1/48\n      */\n     if (pos < (height - 2) * width - 2) {\n-        error_diffuse(data, pos + width * 0 + 1, depth, error, 7, 48);\n-        error_diffuse(data, pos + width * 0 + 2, depth, error, 5, 48);\n-        error_diffuse(data, pos + width * 1 - 2, depth, error, 3, 48);\n-        error_diffuse(data, pos + width * 1 - 1, depth, error, 5, 48);\n-        error_diffuse(data, pos + width * 1 + 0, depth, error, 7, 48);\n-        error_diffuse(data, pos + width * 1 + 1, depth, error, 5, 48);\n-        error_diffuse(data, pos + width * 1 + 2, depth, error, 3, 48);\n-        error_diffuse(data, pos + width * 2 - 2, depth, error, 1, 48);\n-        error_diffuse(data, pos + width * 2 - 1, depth, error, 3, 48);\n-        error_diffuse(data, pos + width * 2 + 0, depth, error, 5, 48);\n-        error_diffuse(data, pos + width * 2 + 1, depth, error, 3, 48);\n-        error_diffuse(data, pos + width * 2 + 2, depth, error, 1, 48);\n+        error_diffuse(data, pos + width * 0 + 1, depth, error, 7, 48, width * height);\n+        error_diffuse(data, pos + width * 0 + 2, depth, error, 5, 48, width * height);\n+        error_diffuse(data, pos + width * 1 - 2, depth, error, 3, 48, width * height);\n+        error_diffuse(data, pos + width * 1 - 1, depth, error, 5, 48, width * height);\n+        error_diffuse(data, pos + width * 1 + 0, depth, error, 7, 48, width * height);\n+        error_diffuse(data, pos + width * 1 + 1, depth, error, 5, 48, width * height);\n+        error_diffuse(data, pos + width * 1 + 2, depth, error, 3, 48, width * height);\n+        error_diffuse(data, pos + width * 2 - 2, depth, error, 1, 48, width * height);\n+        error_diffuse(data, pos + width * 2 - 1, depth, error, 3, 48, width * height);\n+        error_diffuse(data, pos + width * 2 + 0, depth, error, 5, 48, width * height);\n+        error_diffuse(data, pos + width * 2 + 1, depth, error, 3, 48, width * height);\n+        error_diffuse(data, pos + width * 2 + 2, depth, error, 1, 48, width * height);\n     }\n }",
  "diff_line_info": {
    "deleted_lines": [
      "        error_diffuse(data, pos + width * 0 + 1, depth, error, 7, 48);",
      "        error_diffuse(data, pos + width * 0 + 2, depth, error, 5, 48);",
      "        error_diffuse(data, pos + width * 1 - 2, depth, error, 3, 48);",
      "        error_diffuse(data, pos + width * 1 - 1, depth, error, 5, 48);",
      "        error_diffuse(data, pos + width * 1 + 0, depth, error, 7, 48);",
      "        error_diffuse(data, pos + width * 1 + 1, depth, error, 5, 48);",
      "        error_diffuse(data, pos + width * 1 + 2, depth, error, 3, 48);",
      "        error_diffuse(data, pos + width * 2 - 2, depth, error, 1, 48);",
      "        error_diffuse(data, pos + width * 2 - 1, depth, error, 3, 48);",
      "        error_diffuse(data, pos + width * 2 + 0, depth, error, 5, 48);",
      "        error_diffuse(data, pos + width * 2 + 1, depth, error, 3, 48);",
      "        error_diffuse(data, pos + width * 2 + 2, depth, error, 1, 48);"
    ],
    "added_lines": [
      "        error_diffuse(data, pos + width * 0 + 1, depth, error, 7, 48, width * height);",
      "        error_diffuse(data, pos + width * 0 + 2, depth, error, 5, 48, width * height);",
      "        error_diffuse(data, pos + width * 1 - 2, depth, error, 3, 48, width * height);",
      "        error_diffuse(data, pos + width * 1 - 1, depth, error, 5, 48, width * height);",
      "        error_diffuse(data, pos + width * 1 + 0, depth, error, 7, 48, width * height);",
      "        error_diffuse(data, pos + width * 1 + 1, depth, error, 5, 48, width * height);",
      "        error_diffuse(data, pos + width * 1 + 2, depth, error, 3, 48, width * height);",
      "        error_diffuse(data, pos + width * 2 - 2, depth, error, 1, 48, width * height);",
      "        error_diffuse(data, pos + width * 2 - 1, depth, error, 3, 48, width * height);",
      "        error_diffuse(data, pos + width * 2 + 0, depth, error, 5, 48, width * height);",
      "        error_diffuse(data, pos + width * 2 + 1, depth, error, 3, 48, width * height);",
      "        error_diffuse(data, pos + width * 2 + 2, depth, error, 1, 48, width * height);"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/libsixel/libsixel/pull/26",
  "description": {
    "pr_info": {
      "title": "[error_diffuse] don't diffuse into the void",
      "number": 26
    },
    "comment": [
      "Fixes the invalid accesses noted by @a4865g in #25. Simple and inelegant, but robust fix. Closes #25."
    ]
  },
  "Bug Filter": "Security Vulnerability Fix",
  "Bug Filter Confidence": 0.8,
  "Bug Filter Response": "**Final Classification:** Security Vulnerability Fix  \n**Confidence:** 0.8"
}