{
  "cve_id": "CVE-2020-10576",
  "cwe_ids": [
    "CWE-362"
  ],
  "cvss_vector": "AV:N/AC:M/Au:N/C:N/I:N/A:P",
  "cvss_is_v3": false,
  "repo_name": "meetecho/janus-gateway",
  "commit_msg": "Fixes to leaks and race conditions in VoiceMail plugin",
  "commit_hash": "eb99ac8674c554bab6775f4378b24e991b4a2fa1",
  "git_url": "https://github.com/meetecho/janus-gateway/commit/eb99ac8674c554bab6775f4378b24e991b4a2fa1",
  "file_path": "plugins/janus_voicemail.c",
  "func_name": "janus_voicemail_destroy_session",
  "func_before": "void janus_voicemail_destroy_session(janus_plugin_session *handle, int *error) {\n\tif(g_atomic_int_get(&stopping) || !g_atomic_int_get(&initialized)) {\n\t\t*error = -1;\n\t\treturn;\n\t}\n\tjanus_mutex_lock(&sessions_mutex);\n\tjanus_voicemail_session *session = janus_voicemail_lookup_session(handle);\n\tif(!session) {\n\t\tjanus_mutex_unlock(&sessions_mutex);\n\t\tJANUS_LOG(LOG_ERR, \"No VoiceMail session associated with this handle...\\n\");\n\t\t*error = -2;\n\t\treturn;\n\t}\n\tJANUS_LOG(LOG_VERB, \"Removing VoiceMail session...\\n\");\n\tjanus_voicemail_hangup_media_internal(handle);\n\thandle->plugin_handle = NULL;\n\tg_hash_table_remove(sessions, handle);\n\tjanus_mutex_unlock(&sessions_mutex);\n\n\treturn;\n}",
  "abstract_func_before": "void janus_voicemail_destroy_session(janus_plugin_session *VAR_0, int *VAR_1) {\n\tif(g_atomic_int_get(&VAR_2) || !g_atomic_int_get(&VAR_3)) {\n\t\t*VAR_1 = -1;\n\t\treturn;\n\t}\n\tjanus_mutex_lock(&VAR_4);\n\tjanus_voicemail_session *VAR_5 = janus_voicemail_lookup_session(VAR_0);\n\tif(!VAR_5) {\n\t\tjanus_mutex_unlock(&VAR_4);\n\t\tJANUS_LOG(VAR_6, \"No VoiceMail session associated with this handle...\\n\");\n\t\t*VAR_1 = -2;\n\t\treturn;\n\t}\n\tJANUS_LOG(VAR_7, \"Removing VoiceMail session...\\n\");\n\tjanus_voicemail_hangup_media_internal(VAR_0);\n\tVAR_0->plugin_handle = NULL;\n\tg_hash_table_remove(VAR_8, VAR_0);\n\tjanus_mutex_unlock(&VAR_4);\n\n\treturn;\n}",
  "func_graph_path_before": "meetecho/janus-gateway/eb99ac8674c554bab6775f4378b24e991b4a2fa1/janus_voicemail.c/vul/before/0.json",
  "func": "void janus_voicemail_destroy_session(janus_plugin_session *handle, int *error) {\n\tif(g_atomic_int_get(&stopping) || !g_atomic_int_get(&initialized)) {\n\t\t*error = -1;\n\t\treturn;\n\t}\n\tjanus_mutex_lock(&sessions_mutex);\n\tjanus_voicemail_session *session = janus_voicemail_lookup_session(handle);\n\tif(!session) {\n\t\tjanus_mutex_unlock(&sessions_mutex);\n\t\tJANUS_LOG(LOG_ERR, \"No VoiceMail session associated with this handle...\\n\");\n\t\t*error = -2;\n\t\treturn;\n\t}\n\tJANUS_LOG(LOG_VERB, \"Removing VoiceMail session...\\n\");\n\tjanus_voicemail_hangup_media_internal(handle);\n\tg_hash_table_remove(sessions, handle);\n\tjanus_mutex_unlock(&sessions_mutex);\n\n\treturn;\n}",
  "abstract_func": "void janus_voicemail_destroy_session(janus_plugin_session *VAR_0, int *VAR_1) {\n\tif(g_atomic_int_get(&VAR_2) || !g_atomic_int_get(&VAR_3)) {\n\t\t*VAR_1 = -1;\n\t\treturn;\n\t}\n\tjanus_mutex_lock(&VAR_4);\n\tjanus_voicemail_session *VAR_5 = janus_voicemail_lookup_session(VAR_0);\n\tif(!VAR_5) {\n\t\tjanus_mutex_unlock(&VAR_4);\n\t\tJANUS_LOG(VAR_6, \"No VoiceMail session associated with this handle...\\n\");\n\t\t*VAR_1 = -2;\n\t\treturn;\n\t}\n\tJANUS_LOG(VAR_7, \"Removing VoiceMail session...\\n\");\n\tjanus_voicemail_hangup_media_internal(VAR_0);\n\tg_hash_table_remove(VAR_8, VAR_0);\n\tjanus_mutex_unlock(&VAR_4);\n\n\treturn;\n}",
  "func_graph_path": "meetecho/janus-gateway/eb99ac8674c554bab6775f4378b24e991b4a2fa1/janus_voicemail.c/vul/after/0.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -13,7 +13,6 @@\n \t}\n \tJANUS_LOG(LOG_VERB, \"Removing VoiceMail session...\\n\");\n \tjanus_voicemail_hangup_media_internal(handle);\n-\thandle->plugin_handle = NULL;\n \tg_hash_table_remove(sessions, handle);\n \tjanus_mutex_unlock(&sessions_mutex);\n ",
  "diff_line_info": {
    "deleted_lines": [
      "\thandle->plugin_handle = NULL;"
    ],
    "added_lines": []
  },
  "is_vul": true,
  "pr_url": "https://github.com/meetecho/janus-gateway/pull/1993",
  "description": "Failed to get PR details: HTTP Request Error for PR https://github.com/meetecho/janus-gateway/pull/1993: 403 Client Error: Forbidden for url: https://api.github.com/repos/meetecho/janus-gateway/pulls/1993",
  "Bug Filter": "Security Vulnerability Fix",
  "Bug Filter Confidence": 1.0,
  "Bug Filter Response": "The patch addresses a security issue (CVE-2020-10576) by fixing race conditions and memory leaks in the VoiceMail plugin. The commit message and code changes are consistent, confirming it as a security fix.\n\n**Final Classification:** Security Vulnerability Fix  \n**Confidence:** 1.0"
}