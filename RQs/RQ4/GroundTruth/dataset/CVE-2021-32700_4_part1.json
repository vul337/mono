{
  "cve_id": "CVE-2021-32700",
  "cwe_ids": [
    "CWE-306"
  ],
  "cvss_vector": "AV:N/AC:M/Au:N/C:P/I:P/A:N",
  "cvss_is_v3": false,
  "repo_name": "ballerina-platform/ballerina-lang",
  "commit_msg": "Fix central connection",
  "commit_hash": "4609ffee1744ecd16aac09303b1783bf0a525816",
  "git_url": "https://github.com/ballerina-platform/ballerina-lang/commit/4609ffee1744ecd16aac09303b1783bf0a525816",
  "file_path": "cli/ballerina-cli-module/src/main/java/org/ballerinalang/cli/module/Push.java",
  "func_name": "execute",
  "func_before": "public static void execute(String url, String proxyHost, int proxyPort, String proxyUsername, String proxyPassword,\n            String accessToken, String orgName, String moduleName, String version, Path baloPath) {\n        initializeSsl();\n        HttpURLConnection conn = createHttpUrlConnection(convertToUrl(url), proxyHost, proxyPort, proxyUsername,\n                proxyPassword);\n        conn.setInstanceFollowRedirects(false);\n        setRequestMethod(conn, Utils.RequestMethod.POST);\n\n        // Set headers\n        conn.setRequestProperty(HttpHeaders.AUTHORIZATION, \"Bearer \" + accessToken);\n        conn.setRequestProperty(PUSH_ORGANIZATION, orgName);\n        conn.setRequestProperty(HttpHeaders.CONTENT_TYPE, MediaType.APPLICATION_OCTET_STREAM);\n\n        conn.setDoOutput(true);\n        conn.setChunkedStreamingMode(BUFFER_SIZE);\n\n        try (DataOutputStream outputStream = new DataOutputStream(conn.getOutputStream())) {\n            // Send balo content by 1 kb chunks\n            byte[] buffer = new byte[BUFFER_SIZE];\n            int count;\n            try (ProgressBar progressBar = new ProgressBar(\n                    orgName + \"/\" + moduleName + \":\" + version + \" [project repo -> central]\",\n                    getTotalFileSizeInKB(baloPath), 1000, outStream, ProgressBarStyle.ASCII, \" KB\", 1);\n                    FileInputStream fis = new FileInputStream(baloPath.toFile())) {\n                while ((count = fis.read(buffer)) > 0) {\n                    outputStream.write(buffer, 0, count);\n                    outputStream.flush();\n                    progressBar.stepBy((long) NO_OF_BYTES);\n                }\n            }\n        } catch (IOException e) {\n            throw ErrorUtil.createCommandException(\"error occurred while uploading balo to central: \" + e.getMessage());\n        }\n\n        handleResponse(conn, orgName, moduleName, version);\n        Authenticator.setDefault(null);\n    }",
  "abstract_func_before": "public static void execute(String VAR_0, String VAR_1, int VAR_2, String VAR_3, String VAR_4,\n            String VAR_5, String VAR_6, String VAR_7, String VAR_8, Path VAR_9) {\n        initializeSsl();\n        HttpURLConnection VAR_10 = createHttpUrlConnection(convertToUrl(VAR_0), VAR_1, VAR_2, VAR_3,\n                VAR_4);\n        VAR_10.setInstanceFollowRedirects(false);\n        setRequestMethod(VAR_10, VAR_11.RequestMethod.POST);\n\n        /* COMMENT_0 */\n        VAR_10.setRequestProperty(VAR_12.AUTHORIZATION, \"Bearer \" + VAR_5);\n        VAR_10.setRequestProperty(VAR_13, VAR_6);\n        VAR_10.setRequestProperty(VAR_12.CONTENT_TYPE, VAR_14.APPLICATION_OCTET_STREAM);\n\n        VAR_10.setDoOutput(true);\n        VAR_10.setChunkedStreamingMode(VAR_15);\n\n        try (DataOutputStream VAR_16 = new DataOutputStream(VAR_10.getOutputStream())) {\n            /* COMMENT_1 */\n            byte[] VAR_17 = new byte[VAR_15];\n            int VAR_18;\n            try (ProgressBar VAR_19 = new ProgressBar(\n                    VAR_6 + \"/\" + VAR_7 + \":\" + VAR_8 + \" [project repo -> central]\",\n                    getTotalFileSizeInKB(VAR_9), 1000, VAR_20, VAR_21.ASCII, \" KB\", 1);\n                    FileInputStream VAR_22 = new FileInputStream(VAR_9.toFile())) {\n                while ((VAR_18 = VAR_22.read(VAR_17)) > 0) {\n                    VAR_16.write(VAR_17, 0, VAR_18);\n                    VAR_16.flush();\n                    VAR_19.stepBy((long) VAR_23);\n                }\n            }\n        } catch (IOException VAR_24) {\n            throw VAR_25.createCommandException(\"error occurred while uploading balo to central: \" + VAR_24.getMessage());\n        }\n\n        handleResponse(VAR_10, VAR_6, VAR_7, VAR_8);\n        VAR_26.setDefault(null);\n    }",
  "func_graph_path_before": "ballerina-platform/ballerina-lang/4609ffee1744ecd16aac09303b1783bf0a525816/Push.java/vul/before/1.json",
  "func": "public static void execute(String url, String proxyHost, int proxyPort, String proxyUsername, String proxyPassword,\n            String accessToken, String orgName, String moduleName, String version, Path baloPath) {\n        HttpsURLConnection conn = createHttpsUrlConnection(convertToUrl(url), proxyHost, proxyPort, proxyUsername,\n                                                           proxyPassword);\n        conn.setInstanceFollowRedirects(false);\n        setRequestMethod(conn, Utils.RequestMethod.POST);\n\n        // Set headers\n        conn.setRequestProperty(HttpHeaders.AUTHORIZATION, \"Bearer \" + accessToken);\n        conn.setRequestProperty(PUSH_ORGANIZATION, orgName);\n        conn.setRequestProperty(HttpHeaders.CONTENT_TYPE, MediaType.APPLICATION_OCTET_STREAM);\n\n        conn.setDoOutput(true);\n        conn.setChunkedStreamingMode(BUFFER_SIZE);\n\n        try (DataOutputStream outputStream = new DataOutputStream(conn.getOutputStream())) {\n            // Send balo content by 1 kb chunks\n            byte[] buffer = new byte[BUFFER_SIZE];\n            int count;\n            try (ProgressBar progressBar = new ProgressBar(\n                    orgName + \"/\" + moduleName + \":\" + version + \" [project repo -> central]\",\n                    getTotalFileSizeInKB(baloPath), 1000, outStream, ProgressBarStyle.ASCII, \" KB\", 1);\n                    FileInputStream fis = new FileInputStream(baloPath.toFile())) {\n                while ((count = fis.read(buffer)) > 0) {\n                    outputStream.write(buffer, 0, count);\n                    outputStream.flush();\n                    progressBar.stepBy((long) NO_OF_BYTES);\n                }\n            }\n        } catch (IOException e) {\n            throw ErrorUtil.createCommandException(\"error occurred while uploading balo to central: \" + e.getMessage());\n        }\n\n        handleResponse(conn, orgName, moduleName, version);\n        Authenticator.setDefault(null);\n    }",
  "abstract_func": "public static void execute(String VAR_0, String VAR_1, int VAR_2, String VAR_3, String VAR_4,\n            String VAR_5, String VAR_6, String VAR_7, String VAR_8, Path VAR_9) {\n        HttpsURLConnection VAR_10 = createHttpsUrlConnection(convertToUrl(VAR_0), VAR_1, VAR_2, VAR_3,\n                                                           VAR_4);\n        VAR_10.setInstanceFollowRedirects(false);\n        setRequestMethod(VAR_10, VAR_11.RequestMethod.POST);\n\n        /* COMMENT_0 */\n        VAR_10.setRequestProperty(VAR_12.AUTHORIZATION, \"Bearer \" + VAR_5);\n        VAR_10.setRequestProperty(VAR_13, VAR_6);\n        VAR_10.setRequestProperty(VAR_12.CONTENT_TYPE, VAR_14.APPLICATION_OCTET_STREAM);\n\n        VAR_10.setDoOutput(true);\n        VAR_10.setChunkedStreamingMode(VAR_15);\n\n        try (DataOutputStream VAR_16 = new DataOutputStream(VAR_10.getOutputStream())) {\n            /* COMMENT_1 */\n            byte[] VAR_17 = new byte[VAR_15];\n            int VAR_18;\n            try (ProgressBar VAR_19 = new ProgressBar(\n                    VAR_6 + \"/\" + VAR_7 + \":\" + VAR_8 + \" [project repo -> central]\",\n                    getTotalFileSizeInKB(VAR_9), 1000, VAR_20, VAR_21.ASCII, \" KB\", 1);\n                    FileInputStream VAR_22 = new FileInputStream(VAR_9.toFile())) {\n                while ((VAR_18 = VAR_22.read(VAR_17)) > 0) {\n                    VAR_16.write(VAR_17, 0, VAR_18);\n                    VAR_16.flush();\n                    VAR_19.stepBy((long) VAR_23);\n                }\n            }\n        } catch (IOException VAR_24) {\n            throw VAR_25.createCommandException(\"error occurred while uploading balo to central: \" + VAR_24.getMessage());\n        }\n\n        handleResponse(VAR_10, VAR_6, VAR_7, VAR_8);\n        VAR_26.setDefault(null);\n    }",
  "func_graph_path": "ballerina-platform/ballerina-lang/4609ffee1744ecd16aac09303b1783bf0a525816/Push.java/vul/after/1.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -1,8 +1,7 @@\n public static void execute(String url, String proxyHost, int proxyPort, String proxyUsername, String proxyPassword,\n             String accessToken, String orgName, String moduleName, String version, Path baloPath) {\n-        initializeSsl();\n-        HttpURLConnection conn = createHttpUrlConnection(convertToUrl(url), proxyHost, proxyPort, proxyUsername,\n-                proxyPassword);\n+        HttpsURLConnection conn = createHttpsUrlConnection(convertToUrl(url), proxyHost, proxyPort, proxyUsername,\n+                                                           proxyPassword);\n         conn.setInstanceFollowRedirects(false);\n         setRequestMethod(conn, Utils.RequestMethod.POST);\n ",
  "diff_line_info": {
    "deleted_lines": [
      "        initializeSsl();",
      "        HttpURLConnection conn = createHttpUrlConnection(convertToUrl(url), proxyHost, proxyPort, proxyUsername,",
      "                proxyPassword);"
    ],
    "added_lines": [
      "        HttpsURLConnection conn = createHttpsUrlConnection(convertToUrl(url), proxyHost, proxyPort, proxyUsername,",
      "                                                           proxyPassword);"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/29246",
  "description": {
    "pr_info": {
      "title": "Fix central connection",
      "number": 29246
    },
    "comment": [
      "## Purpose\r\n> $Title\r\n\r\nFixes #<Issue Number>\r\n\r\n## Approach\r\n> Describe how you are implementing the solutions along with the design details.\r\n\r\n## Samples\r\n> Provide high-level details about the samples related to this feature.\r\n\r\n## Remarks\r\n> List any other known issues, related PRs, TODO items, or any other notes related to the PR.\r\n\r\n## Check List \r\n- [ ] Read the [Contributing Guide](https://github.com/ballerina-platform/ballerina-lang/blob/master/CONTRIBUTING.md)\r\n- [ ] Updated Change Log\r\n- [ ] Checked Tooling Support (#<Issue Number>)\r\n- [ ] Added necessary tests\r\n  - [ ] Unit Tests\r\n  - [ ] Spec Conformance Tests\r\n  - [ ] Integration Tests\r\n  - [ ] Ballerina By Example Tests\r\n- [ ] Increased Test Coverage   \r\n- [ ] Added necessary documentation  \r\n  - [ ] API documentation \r\n  - [ ] Module documentation in Module.md files\r\n  - [ ] Ballerina By Examples\r\n",
      "# [Codecov](https://codecov.io/gh/ballerina-platform/ballerina-lang/pull/29246?src=pr&el=h1) Report\n> Merging [#29246](https://codecov.io/gh/ballerina-platform/ballerina-lang/pull/29246?src=pr&el=desc) (4609ffe) into [ballerina-1.2.x](https://codecov.io/gh/ballerina-platform/ballerina-lang/commit/9e6464b9f28a0f707fb1e8ded125be46c1849e41?el=desc) (9e6464b) will **not change** coverage.\n> The diff coverage is `n/a`.\n\n[![Impacted file tree graph](https://codecov.io/gh/ballerina-platform/ballerina-lang/pull/29246/graphs/tree.svg?width=650&height=150&src=pr&token=IgZRPljg71)](https://codecov.io/gh/ballerina-platform/ballerina-lang/pull/29246?src=pr&el=tree)\n\n```diff\n@@               Coverage Diff                @@\n##           ballerina-1.2.x   #29246   +/-   ##\n================================================\n  Coverage            14.59%   14.59%           \n================================================\n  Files                   51       51           \n  Lines                 1411     1411           \n  Branches               219      219           \n================================================\n  Hits                   206      206           \n  Misses                1189     1189           \n  Partials                16       16           \n```\n\n\n\n------\n\n[Continue to review full report at Codecov](https://codecov.io/gh/ballerina-platform/ballerina-lang/pull/29246?src=pr&el=continue).\n> **Legend** - [Click here to learn more](https://docs.codecov.io/docs/codecov-delta)\n> `Δ = absolute <relative> (impact)`, `ø = not affected`, `? = missing data`\n> Powered by [Codecov](https://codecov.io/gh/ballerina-platform/ballerina-lang/pull/29246?src=pr&el=footer). Last update [a3bac05...4609ffe](https://codecov.io/gh/ballerina-platform/ballerina-lang/pull/29246?src=pr&el=lastupdated). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments).\n"
    ]
  },
  "Bug Filter": "Defect Remediation & Feature Upgrades",
  "Bug Filter Confidence": 0.7,
  "Bug Filter Response": "**Final Classification:** Defect Remediation & Feature Upgrades  \n**Confidence:** 0.7"
}