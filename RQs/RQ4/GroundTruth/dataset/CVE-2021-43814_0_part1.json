{
  "cve_id": "CVE-2021-43814",
  "cwe_ids": [
    "CWE-787"
  ],
  "cvss_vector": "AV:N/AC:M/Au:N/C:P/I:P/A:P",
  "cvss_is_v3": false,
  "repo_name": "rizinorg/rizin",
  "commit_msg": "Fix oob write for dwarf with abbrev with count 0 (Fix #2083) (#2086)",
  "commit_hash": "aa6917772d2f32e5a7daab25a46c72df0b5ea406",
  "git_url": "https://github.com/rizinorg/rizin/commit/aa6917772d2f32e5a7daab25a46c72df0b5ea406",
  "file_path": "librz/bin/dwarf.c",
  "func_name": "init_die",
  "func_before": "static int init_die(RzBinDwarfDie *die, ut64 abbr_code, ut64 attr_count) {\n\tif (!die) {\n\t\treturn -1;\n\t}\n\tdie->attr_values = calloc(sizeof(RzBinDwarfAttrValue), attr_count);\n\tif (!die->attr_values) {\n\t\treturn -1;\n\t}\n\tdie->abbrev_code = abbr_code;\n\tdie->capacity = attr_count;\n\tdie->count = 0;\n\treturn 0;\n}",
  "abstract_func_before": "static int init_die(RzBinDwarfDie *VAR_0, ut64 VAR_1, ut64 VAR_2) {\n\tif (!VAR_0) {\n\t\treturn -1;\n\t}\n\tVAR_0->attr_values = calloc(sizeof(VAR_3), VAR_2);\n\tif (!VAR_0->attr_values) {\n\t\treturn -1;\n\t}\n\tVAR_0->abbrev_code = VAR_1;\n\tVAR_0->capacity = VAR_2;\n\tVAR_0->count = 0;\n\treturn 0;\n}",
  "func_graph_path_before": "rizinorg/rizin/aa6917772d2f32e5a7daab25a46c72df0b5ea406/dwarf.c/vul/before/1.json",
  "func": "static int init_die(RzBinDwarfDie *die, ut64 abbr_code, ut64 attr_count) {\n\tif (!die) {\n\t\treturn -1;\n\t}\n\tif (attr_count) {\n\t\tdie->attr_values = calloc(sizeof(RzBinDwarfAttrValue), attr_count);\n\t\tif (!die->attr_values) {\n\t\t\treturn -1;\n\t\t}\n\t} else {\n\t\tdie->attr_values = NULL;\n\t}\n\tdie->abbrev_code = abbr_code;\n\tdie->capacity = attr_count;\n\tdie->count = 0;\n\treturn 0;\n}",
  "abstract_func": "static int init_die(RzBinDwarfDie *VAR_0, ut64 VAR_1, ut64 VAR_2) {\n\tif (!VAR_0) {\n\t\treturn -1;\n\t}\n\tif (VAR_2) {\n\t\tVAR_0->attr_values = calloc(sizeof(VAR_3), VAR_2);\n\t\tif (!VAR_0->attr_values) {\n\t\t\treturn -1;\n\t\t}\n\t} else {\n\t\tVAR_0->attr_values = NULL;\n\t}\n\tVAR_0->abbrev_code = VAR_1;\n\tVAR_0->capacity = VAR_2;\n\tVAR_0->count = 0;\n\treturn 0;\n}",
  "func_graph_path": "rizinorg/rizin/aa6917772d2f32e5a7daab25a46c72df0b5ea406/dwarf.c/vul/after/1.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -2,9 +2,13 @@\n \tif (!die) {\n \t\treturn -1;\n \t}\n-\tdie->attr_values = calloc(sizeof(RzBinDwarfAttrValue), attr_count);\n-\tif (!die->attr_values) {\n-\t\treturn -1;\n+\tif (attr_count) {\n+\t\tdie->attr_values = calloc(sizeof(RzBinDwarfAttrValue), attr_count);\n+\t\tif (!die->attr_values) {\n+\t\t\treturn -1;\n+\t\t}\n+\t} else {\n+\t\tdie->attr_values = NULL;\n \t}\n \tdie->abbrev_code = abbr_code;\n \tdie->capacity = attr_count;",
  "diff_line_info": {
    "deleted_lines": [
      "\tdie->attr_values = calloc(sizeof(RzBinDwarfAttrValue), attr_count);",
      "\tif (!die->attr_values) {",
      "\t\treturn -1;"
    ],
    "added_lines": [
      "\tif (attr_count) {",
      "\t\tdie->attr_values = calloc(sizeof(RzBinDwarfAttrValue), attr_count);",
      "\t\tif (!die->attr_values) {",
      "\t\t\treturn -1;",
      "\t\t}",
      "\t} else {",
      "\t\tdie->attr_values = NULL;"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/rizinorg/rizin/pull/2086",
  "description": {
    "pr_info": {
      "title": "Fix oob write for dwarf with abbrev with count 0 (Fix #2083)",
      "number": 2086
    },
    "comment": [
      " <!-- Filling this template is mandatory -->\r\n\r\n**Your checklist for this pull request**\r\n- [x] I've read the [guidelines for contributing](https://github.com/rizinorg/rizin/blob/master/DEVELOPERS.md) to this repository\r\n- [x] I made sure to follow the project's [coding style](https://github.com/rizinorg/rizin/blob/master/DEVELOPERS.md#code-style)\r\n- [ ] I've documented or updated the documentation of every function and struct this PR changes. If not so I've explained why.\r\n- [x] I've added tests that prove my fix is effective or that my feature works (if possible)\r\n- [ ] I've updated the [rizin book](https://github.com/rizinorg/book) with the relevant information (if needed)\r\n\r\nFix #2083\r\n\r\n**Detailed description**\r\n\r\nThis is described in #2083."
    ]
  },
  "Bug Filter": "Security Vulnerability Fix",
  "Bug Filter Confidence": 0.9,
  "Bug Filter Response": "**Final Classification:** Security Vulnerability Fix  \n**Confidence:** 0.9"
}