{
  "cve_id": "CVE-2018-16391",
  "cwe_ids": [
    "CWE-415",
    "CWE-119"
  ],
  "cvss_vector": "AV:L/AC:L/Au:N/C:P/I:P/A:P",
  "cvss_is_v3": false,
  "repo_name": "OpenSC",
  "commit_msg": "fixed out of bounds writes\n\nThanks to Eric Sesterhenn from X41 D-SEC GmbH\nfor reporting the problems.",
  "commit_hash": "360e95d45ac4123255a4c796db96337f332160ad",
  "git_url": "https://github.com/OpenSC/OpenSC/commit/360e95d45ac4123255a4c796db96337f332160ad",
  "file_path": "src/tools/egk-tool.c",
  "func_name": "read_file",
  "func_before": "int read_file(struct sc_card *card, char *str_path, unsigned char **data, size_t *data_len)\n{\n\tstruct sc_path path;\n\tstruct sc_file *file;\n\tunsigned char *p;\n\tint ok = 0;\n\tint r;\n\tsize_t len;\n\n\tsc_format_path(str_path, &path);\n\tif (SC_SUCCESS != sc_select_file(card, &path, &file)) {\n\t\tgoto err;\n\t}\n\n\tlen = file ? file->size : 4096;\n\tp = realloc(*data, len);\n\tif (!p) {\n\t\tgoto err;\n\t}\n\t*data = p;\n\t*data_len = len;\n\n\tr = sc_read_binary(card, 0, p, len, 0);\n\tif (r < 0)\n\t\tgoto err;\n\n\t*data_len = r;\n\tok = 1;\n\nerr:\n\tsc_file_free(file);\n\n\treturn ok;\n}",
  "abstract_func_before": "int read_file(struct sc_card *VAR_0, char *VAR_1, unsigned char **VAR_2, size_t *VAR_3)\n{\n\tstruct sc_path VAR_4;\n\tstruct sc_file *VAR_5;\n\tunsigned char *VAR_6;\n\tint VAR_7 = 0;\n\tint VAR_8;\n\tsize_t VAR_9;\n\n\tsc_format_path(VAR_1, &VAR_4);\n\tif (VAR_10 != sc_select_file(VAR_0, &VAR_4, &VAR_5)) {\n\t\tgoto err;\n\t}\n\n\tVAR_9 = VAR_5 ? VAR_5->size : 4096;\n\tVAR_6 = realloc(*VAR_2, VAR_9);\n\tif (!VAR_6) {\n\t\tgoto err;\n\t}\n\t*VAR_2 = VAR_6;\n\t*VAR_3 = VAR_9;\n\n\tVAR_8 = sc_read_binary(VAR_0, 0, VAR_6, VAR_9, 0);\n\tif (VAR_8 < 0)\n\t\tgoto err;\n\n\t*VAR_3 = VAR_8;\n\tVAR_7 = 1;\n\nerr:\n\tsc_file_free(VAR_5);\n\n\treturn VAR_7;\n}",
  "func_graph_path_before": "OpenSC/360e95d45ac4123255a4c796db96337f332160ad/egk-tool.c/vul/before/0.json",
  "func": "int read_file(struct sc_card *card, char *str_path, unsigned char **data, size_t *data_len)\n{\n\tstruct sc_path path;\n\tstruct sc_file *file;\n\tunsigned char *p;\n\tint ok = 0;\n\tint r;\n\tsize_t len;\n\n\tsc_format_path(str_path, &path);\n\tif (SC_SUCCESS != sc_select_file(card, &path, &file)) {\n\t\tgoto err;\n\t}\n\n\tlen = file && file->size > 0 ? file->size : 4096;\n\tp = realloc(*data, len);\n\tif (!p) {\n\t\tgoto err;\n\t}\n\t*data = p;\n\t*data_len = len;\n\n\tr = sc_read_binary(card, 0, p, len, 0);\n\tif (r < 0)\n\t\tgoto err;\n\n\t*data_len = r;\n\tok = 1;\n\nerr:\n\tsc_file_free(file);\n\n\treturn ok;\n}",
  "abstract_func": "int read_file(struct sc_card *VAR_0, char *VAR_1, unsigned char **VAR_2, size_t *VAR_3)\n{\n\tstruct sc_path VAR_4;\n\tstruct sc_file *VAR_5;\n\tunsigned char *VAR_6;\n\tint VAR_7 = 0;\n\tint VAR_8;\n\tsize_t VAR_9;\n\n\tsc_format_path(VAR_1, &VAR_4);\n\tif (VAR_10 != sc_select_file(VAR_0, &VAR_4, &VAR_5)) {\n\t\tgoto err;\n\t}\n\n\tVAR_9 = VAR_5 && VAR_5->size > 0 ? VAR_5->size : 4096;\n\tVAR_6 = realloc(*VAR_2, VAR_9);\n\tif (!VAR_6) {\n\t\tgoto err;\n\t}\n\t*VAR_2 = VAR_6;\n\t*VAR_3 = VAR_9;\n\n\tVAR_8 = sc_read_binary(VAR_0, 0, VAR_6, VAR_9, 0);\n\tif (VAR_8 < 0)\n\t\tgoto err;\n\n\t*VAR_3 = VAR_8;\n\tVAR_7 = 1;\n\nerr:\n\tsc_file_free(VAR_5);\n\n\treturn VAR_7;\n}",
  "func_graph_path": "OpenSC/360e95d45ac4123255a4c796db96337f332160ad/egk-tool.c/vul/after/0.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -12,7 +12,7 @@\n \t\tgoto err;\n \t}\n \n-\tlen = file ? file->size : 4096;\n+\tlen = file && file->size > 0 ? file->size : 4096;\n \tp = realloc(*data, len);\n \tif (!p) {\n \t\tgoto err;",
  "diff_line_info": {
    "deleted_lines": [
      "\tlen = file ? file->size : 4096;"
    ],
    "added_lines": [
      "\tlen = file && file->size > 0 ? file->size : 4096;"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/OpenSC/OpenSC/pull/1447",
  "description": "Failed to get PR details: HTTP Request Error for PR https://github.com/OpenSC/OpenSC/pull/1447: 403 Client Error: Forbidden for url: https://api.github.com/repos/OpenSC/OpenSC/pulls/1447",
  "Bug Filter": "Security Vulnerability Fix",
  "Bug Filter Confidence": 0.95,
  "Bug Filter Response": "**Final Classification:** Security Vulnerability Fix;  \n**Confidence:** 0.95"
}