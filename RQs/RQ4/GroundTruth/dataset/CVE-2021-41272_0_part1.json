{
  "cve_id": "CVE-2021-41272",
  "cwe_ids": [
    "CWE-681"
  ],
  "cvss_vector": "AV:N/AC:L/Au:N/C:N/I:N/A:P",
  "cvss_is_v3": false,
  "repo_name": "hyperledger/besu",
  "commit_msg": "Shift Optimization (#3039)\n\nReduce shift calculations to shifts that may have an actual result.\r\n\r\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>",
  "commit_hash": "4170524ac3b45185704fcfbdeeb71b0b05dfa0a1",
  "git_url": "https://github.com/hyperledger/besu/commit/4170524ac3b45185704fcfbdeeb71b0b05dfa0a1",
  "file_path": "evm/src/main/java/org/hyperledger/besu/evm/operation/ShrOperation.java",
  "func_name": "executeFixedCostOperation",
  "func_before": "@Override\n  public Operation.OperationResult executeFixedCostOperation(\n      final MessageFrame frame, final EVM evm) {\n    Bytes shiftAmount = frame.popStackItem();\n    if (shiftAmount.size() > 4 && (shiftAmount = shiftAmount.trimLeadingZeros()).size() > 4) {\n      frame.popStackItem();\n      frame.pushStackItem(UInt256.ZERO);\n    } else {\n      final int shiftAmountInt = shiftAmount.toInt();\n      final Bytes value = leftPad(frame.popStackItem());\n\n      if (shiftAmountInt >= 256) {\n        frame.pushStackItem(UInt256.ZERO);\n      } else {\n        frame.pushStackItem(value.shiftRight(shiftAmountInt));\n      }\n    }\n    return successResponse;\n  }",
  "abstract_func_before": "@Override\n  public Operation.OperationResult executeFixedCostOperation(\n      final MessageFrame VAR_0, final EVM VAR_1) {\n    Bytes VAR_2 = VAR_0.popStackItem();\n    if (VAR_2.size() > 4 && (VAR_2 = VAR_2.trimLeadingZeros()).size() > 4) {\n      VAR_0.popStackItem();\n      VAR_0.pushStackItem(VAR_3.ZERO);\n    } else {\n      final int VAR_4 = VAR_2.toInt();\n      final Bytes VAR_5 = leftPad(VAR_0.popStackItem());\n\n      if (VAR_4 >= 256) {\n        VAR_0.pushStackItem(VAR_3.ZERO);\n      } else {\n        VAR_0.pushStackItem(VAR_5.shiftRight(VAR_4));\n      }\n    }\n    return VAR_6;\n  }",
  "func_graph_path_before": "hyperledger/besu/4170524ac3b45185704fcfbdeeb71b0b05dfa0a1/ShrOperation.java/vul/before/0.json",
  "func": "@Override\n  public Operation.OperationResult executeFixedCostOperation(\n      final MessageFrame frame, final EVM evm) {\n    Bytes shiftAmount = frame.popStackItem();\n    if (shiftAmount.size() > 4 && (shiftAmount = shiftAmount.trimLeadingZeros()).size() > 4) {\n      frame.popStackItem();\n      frame.pushStackItem(UInt256.ZERO);\n    } else {\n      final int shiftAmountInt = shiftAmount.toInt();\n      final Bytes value = leftPad(frame.popStackItem());\n\n      if (shiftAmountInt >= 256 || shiftAmountInt < 0) {\n        frame.pushStackItem(UInt256.ZERO);\n      } else {\n        frame.pushStackItem(value.shiftRight(shiftAmountInt));\n      }\n    }\n    return successResponse;\n  }",
  "abstract_func": "@Override\n  public Operation.OperationResult executeFixedCostOperation(\n      final MessageFrame VAR_0, final EVM VAR_1) {\n    Bytes VAR_2 = VAR_0.popStackItem();\n    if (VAR_2.size() > 4 && (VAR_2 = VAR_2.trimLeadingZeros()).size() > 4) {\n      VAR_0.popStackItem();\n      VAR_0.pushStackItem(VAR_3.ZERO);\n    } else {\n      final int VAR_4 = VAR_2.toInt();\n      final Bytes VAR_5 = leftPad(VAR_0.popStackItem());\n\n      if (VAR_4 >= 256 || VAR_4 < 0) {\n        VAR_0.pushStackItem(VAR_3.ZERO);\n      } else {\n        VAR_0.pushStackItem(VAR_5.shiftRight(VAR_4));\n      }\n    }\n    return VAR_6;\n  }",
  "func_graph_path": "hyperledger/besu/4170524ac3b45185704fcfbdeeb71b0b05dfa0a1/ShrOperation.java/vul/after/0.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -9,7 +9,7 @@\n       final int shiftAmountInt = shiftAmount.toInt();\n       final Bytes value = leftPad(frame.popStackItem());\n \n-      if (shiftAmountInt >= 256) {\n+      if (shiftAmountInt >= 256 || shiftAmountInt < 0) {\n         frame.pushStackItem(UInt256.ZERO);\n       } else {\n         frame.pushStackItem(value.shiftRight(shiftAmountInt));",
  "diff_line_info": {
    "deleted_lines": [
      "      if (shiftAmountInt >= 256) {"
    ],
    "added_lines": [
      "      if (shiftAmountInt >= 256 || shiftAmountInt < 0) {"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/hyperledger/besu/pull/3039",
  "description": "Failed to get PR details: HTTP Request Error for PR https://github.com/hyperledger/besu/pull/3039: 403 Client Error: Forbidden for url: https://api.github.com/repos/hyperledger/besu/pulls/3039",
  "Bug Filter": "Defect Remediation & Feature Upgrades",
  "Bug Filter Confidence": 0.9,
  "Bug Filter Response": "**Final Classification:** Defect Remediation & Feature Upgrades  \n**Confidence:** 0.9"
}