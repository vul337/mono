{
  "cve_id": "CVE-2023-1495",
  "cwe_ids": [
    "CWE-89"
  ],
  "cvss_vector": "AV:N/AC:L/Au:S/C:P/I:P/A:P",
  "cvss_is_v3": false,
  "repo_name": "getrebuild/rebuild",
  "commit_msg": "H5 sync2 (#595)\n\n* style: 目录样式gh\r\n\r\n* style: J_new\r\n\r\n* feat: advListFilterTabs\r\n\r\n* feat: nav-copyto\r\n\r\n* enh: 助记码全拼\r\n\r\n* enh: 地图搜索选点\r\n\r\n* enh: topnav\r\n\r\n* list pn\r\n\r\n* .form-line.v33\r\n\r\n* open TAG\r\n\r\n* KVS addShutdownHook\r\n\r\n* fix: #594\r\n\r\n---------\r\n\r\nCo-authored-by: devezhao <zhaofang123@gmail.com>",
  "commit_hash": "c9474f84e5f376dd2ade2078e3039961a9425da7",
  "git_url": "https://github.com/getrebuild/rebuild/commit/c9474f84e5f376dd2ade2078e3039961a9425da7",
  "file_path": "src/main/java/com/rebuild/core/configuration/NavBuilder.java",
  "func_name": "renderTopNav2",
  "func_before": "static String renderTopNav2(HttpServletRequest request) {\n        String topNav = KVStorage.getCustomValue(\"TopNav32\");\n        if (!JSONUtils.wellFormat(topNav)) return StringUtils.EMPTY;\n\n        JSONArray sets = JSON.parseArray(topNav);\n        if (sets.isEmpty()) return StringUtils.EMPTY;\n\n        final ID user = AppUtils.getRequestUser(request);\n        final boolean isAdmin = UserHelper.isAdmin(user);\n        final Object[][] alls = instance.getAllConfig(null, TYPE_NAV);\n\n        StringBuilder topNavHtml = new StringBuilder();\n\n        for (Object nd : sets) {\n            JSONArray ndAnd = (JSONArray) nd;\n            String nav = ndAnd.getString(0);\n            String dash = ndAnd.getString(1);\n\n            ID useNav = ID.isId(nav) ? ID.valueOf(nav) : null;\n            if (useNav == null) continue;\n\n            for (Object[] d : alls) {\n                if (!useNav.equals(d[0])) continue;\n                // 管理员、有共享的\n                if ((isAdmin && RoleService.ADMIN_ROLE.equals(d[5])) || instance.isShareTo((String) d[1], user)) {\n                    String url = AppUtils.getContextPath(\"/app/home?n=\" + useNav);\n                    if (ID.isId(dash)) url += \"&d=\" + dash;\n                    String name = StringUtils.defaultIfBlank((String) d[4], Language.L(\"未命名\"));\n\n                    topNavHtml.append(\n                            String.format(\"<li class=\\\"nav-item\\\" data-id=\\\"%s\\\"><a class=\\\"nav-link\\\" href=\\\"%s\\\">%s</a></li>\", useNav, url, name));\n                    break;\n                }\n            }\n        }\n        return topNavHtml.toString();\n    }",
  "abstract_func_before": "static String renderTopNav2(HttpServletRequest VAR_0) {\n        String VAR_1 = VAR_2.getCustomValue(\"TopNav32\");\n        if (!VAR_3.wellFormat(VAR_1)) return VAR_4.EMPTY;\n\n        JSONArray VAR_5 = VAR_6.parseArray(VAR_1);\n        if (VAR_5.isEmpty()) return VAR_4.EMPTY;\n\n        final ID VAR_7 = VAR_8.getRequestUser(VAR_0);\n        final boolean VAR_9 = VAR_10.isAdmin(VAR_7);\n        final Object[][] VAR_11 = VAR_12.getAllConfig(null, VAR_13);\n\n        StringBuilder VAR_14 = new StringBuilder();\n\n        for (Object VAR_15 : VAR_5) {\n            JSONArray VAR_16 = (JSONArray) VAR_15;\n            String VAR_17 = VAR_16.getString(0);\n            String VAR_18 = VAR_16.getString(1);\n\n            ID VAR_19 = VAR_20.isId(VAR_17) ? VAR_20.valueOf(VAR_17) : null;\n            if (VAR_19 == null) continue;\n\n            for (Object[] VAR_21 : VAR_11) {\n                if (!VAR_19.equals(VAR_21[0])) continue;\n                /* COMMENT_0 */\n                if ((VAR_9 && VAR_22.ADMIN_ROLE.equals(VAR_21[5])) || VAR_12.isShareTo((String) VAR_21[1], VAR_7)) {\n                    String VAR_23 = VAR_8.getContextPath(\"/app/home?n=\" + VAR_19);\n                    if (VAR_20.isId(VAR_18)) VAR_23 += \"&d=\" + VAR_18;\n                    String VAR_24 = VAR_4.defaultIfBlank((String) VAR_21[4], VAR_25.L(\"未命名\"));\n\n                    VAR_14.append(\n                            VAR_26.format(\"<li class=\\\"nav-item\\\" data-id=\\\"%s\\\"><a class=\\\"nav-link\\\" href=\\\"%s\\\">%s</a></li>\", VAR_19, VAR_23, VAR_24));\n                    break;\n                }\n            }\n        }\n        return VAR_14.toString();\n    }",
  "func_graph_path_before": "getrebuild/rebuild/c9474f84e5f376dd2ade2078e3039961a9425da7/NavBuilder.java/vul/before/0.json",
  "func": "static String renderTopNav2(HttpServletRequest request) {\n        String topNav = KVStorage.getCustomValue(\"TopNav32\");\n        if (!JSONUtils.wellFormat(topNav)) return StringUtils.EMPTY;\n\n        JSONArray sets = JSON.parseArray(topNav);\n        if (sets.isEmpty()) return StringUtils.EMPTY;\n\n        final ID user = AppUtils.getRequestUser(request);\n        final boolean isAdmin = UserHelper.isAdmin(user);\n        final Object[][] alls = instance.getAllConfig(null, TYPE_NAV);\n\n        StringBuilder topNavHtml = new StringBuilder();\n\n        for (Object nd : sets) {\n            JSONArray ndAnd = (JSONArray) nd;\n            String nav = ndAnd.getString(0);\n            String dash = ndAnd.getString(1);\n\n            ID useNav = ID.isId(nav) ? ID.valueOf(nav) : null;\n            if (useNav == null) continue;\n\n            for (Object[] d : alls) {\n                if (!useNav.equals(d[0])) continue;\n                // 管理员、有共享的\n                if ((isAdmin && RoleService.ADMIN_ROLE.equals(d[5])) || instance.isShareTo((String) d[1], user)) {\n                    String url = AppUtils.getContextPath(\"/app/home?n=\" + useNav);\n                    if (ID.isId(dash)) url += \"&d=\" + dash;\n                    String name = StringUtils.defaultIfBlank((String) d[4], Language.L(\"未命名\"));\n\n                    topNavHtml.append(\n                            String.format(\"<li class=\\\"nav-item\\\" data-id=\\\"%s\\\"><a class=\\\"nav-link text-ellipsis\\\" href=\\\"%s\\\">%s</a></li>\", useNav, url, name));\n                    break;\n                }\n            }\n        }\n        return topNavHtml.toString();\n    }",
  "abstract_func": "static String renderTopNav2(HttpServletRequest VAR_0) {\n        String VAR_1 = VAR_2.getCustomValue(\"TopNav32\");\n        if (!VAR_3.wellFormat(VAR_1)) return VAR_4.EMPTY;\n\n        JSONArray VAR_5 = VAR_6.parseArray(VAR_1);\n        if (VAR_5.isEmpty()) return VAR_4.EMPTY;\n\n        final ID VAR_7 = VAR_8.getRequestUser(VAR_0);\n        final boolean VAR_9 = VAR_10.isAdmin(VAR_7);\n        final Object[][] VAR_11 = VAR_12.getAllConfig(null, VAR_13);\n\n        StringBuilder VAR_14 = new StringBuilder();\n\n        for (Object VAR_15 : VAR_5) {\n            JSONArray VAR_16 = (JSONArray) VAR_15;\n            String VAR_17 = VAR_16.getString(0);\n            String VAR_18 = VAR_16.getString(1);\n\n            ID VAR_19 = VAR_20.isId(VAR_17) ? VAR_20.valueOf(VAR_17) : null;\n            if (VAR_19 == null) continue;\n\n            for (Object[] VAR_21 : VAR_11) {\n                if (!VAR_19.equals(VAR_21[0])) continue;\n                /* COMMENT_0 */\n                if ((VAR_9 && VAR_22.ADMIN_ROLE.equals(VAR_21[5])) || VAR_12.isShareTo((String) VAR_21[1], VAR_7)) {\n                    String VAR_23 = VAR_8.getContextPath(\"/app/home?n=\" + VAR_19);\n                    if (VAR_20.isId(VAR_18)) VAR_23 += \"&d=\" + VAR_18;\n                    String VAR_24 = VAR_4.defaultIfBlank((String) VAR_21[4], VAR_25.L(\"未命名\"));\n\n                    VAR_14.append(\n                            VAR_26.format(\"<li class=\\\"nav-item\\\" data-id=\\\"%s\\\"><a class=\\\"nav-link text-ellipsis\\\" href=\\\"%s\\\">%s</a></li>\", VAR_19, VAR_23, VAR_24));\n                    break;\n                }\n            }\n        }\n        return VAR_14.toString();\n    }",
  "func_graph_path": "getrebuild/rebuild/c9474f84e5f376dd2ade2078e3039961a9425da7/NavBuilder.java/vul/after/0.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -28,7 +28,7 @@\n                     String name = StringUtils.defaultIfBlank((String) d[4], Language.L(\"未命名\"));\n \n                     topNavHtml.append(\n-                            String.format(\"<li class=\\\"nav-item\\\" data-id=\\\"%s\\\"><a class=\\\"nav-link\\\" href=\\\"%s\\\">%s</a></li>\", useNav, url, name));\n+                            String.format(\"<li class=\\\"nav-item\\\" data-id=\\\"%s\\\"><a class=\\\"nav-link text-ellipsis\\\" href=\\\"%s\\\">%s</a></li>\", useNav, url, name));\n                     break;\n                 }\n             }",
  "diff_line_info": {
    "deleted_lines": [
      "                            String.format(\"<li class=\\\"nav-item\\\" data-id=\\\"%s\\\"><a class=\\\"nav-link\\\" href=\\\"%s\\\">%s</a></li>\", useNav, url, name));"
    ],
    "added_lines": [
      "                            String.format(\"<li class=\\\"nav-item\\\" data-id=\\\"%s\\\"><a class=\\\"nav-link text-ellipsis\\\" href=\\\"%s\\\">%s</a></li>\", useNav, url, name));"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/getrebuild/rebuild/pull/595",
  "description": "Failed to get PR details: HTTP Request Error for PR https://github.com/getrebuild/rebuild/pull/595: 403 Client Error: Forbidden for url: https://api.github.com/repos/getrebuild/rebuild/pulls/595",
  "Bug Filter": "Supporting & Non-Core Improvements",
  "Bug Filter Confidence": 0.9,
  "Bug Filter Response": "**Step-by-Step Explanation:**\n\n1. **Commit Analysis:** The commit involves UI style changes, feature additions, and several enhacements. The fix tag in the commit mentions issue #594 but doesn't specify a security context.\n\n2. **Code Diff Review:** The change adds a CSS class for text ellipsis, impacting how navigation links display. This is a UI enhancement, not related to security.\n\n3. **Vulnerability Description:** While it mentions a \"CVE fix,\" the features listed are UI-related, suggesting ambiguity.\n\n4. **Security Check:** No security-related code changes found. The modifications don't address input validation, permissions, or other security concerns.\n\n5. **Classification:** The patch is not a security fix. It falls under Supporting & Non-Core Improvements due to UI and feature enhancements.\n\n**Final Classification:** Supporting & Non-Core Improvements; **Confidence:** 0.9  \nThe changes are clearly UI-focused, though the CVE mention is unclear, indicating the patch isn't a security fix."
}