{
  "cve_id": "CVE-2022-21675",
  "cwe_ids": [
    "CWE-22"
  ],
  "cvss_vector": "AV:N/AC:M/Au:N/C:P/I:P/A:P",
  "cvss_is_v3": false,
  "repo_name": "Konloch/bytecode-viewer",
  "commit_msg": "Mitigate Zip Slip exlpoit",
  "commit_hash": "c968e94b2c93da434a4ecfac6d08eda162d615d0",
  "git_url": "https://github.com/Konloch/bytecode-viewer/commit/c968e94b2c93da434a4ecfac6d08eda162d615d0",
  "file_path": "src/main/java/the/bytecode/club/bytecodeviewer/util/ZipUtils.java",
  "func_name": "unzipFilesToPath",
  "func_before": "public static void unzipFilesToPath(String jarPath, String destinationDir) throws IOException {\n        File file = new File(jarPath);\n        try (JarFile jar = new JarFile(file)) {\n\n            // fist get all directories,\n            // then make those directory on the destination Path\n            /*for (Enumeration<JarEntry> enums = jar.entries(); enums.hasMoreElements(); ) {\n                JarEntry entry = (JarEntry) enums.nextElement();\n\n                String fileName = destinationDir + File.separator + entry.getName();\n                File f = new File(fileName);\n\n                if (fileName.endsWith(\"/\")) {\n                    f.mkdirs();\n                }\n\n            }*/\n\n            //now create all files\n            for (Enumeration<JarEntry> enums = jar.entries(); enums.hasMoreElements(); ) {\n                JarEntry entry = enums.nextElement();\n\n                String fileName = destinationDir + File.separator + entry.getName();\n                File f = new File(fileName);\n\n                File parent = f.getParentFile();\n                if (!parent.exists()) {\n                    parent.mkdirs();\n                }\n\n                if (!fileName.endsWith(\"/\")) {\n                    try (InputStream is = jar.getInputStream(entry);\n                         FileOutputStream fos = new FileOutputStream(f)) {\n                        // write contents of 'is' to 'fos'\n                        while (is.available() > 0) {\n                            fos.write(is.read());\n                        }\n                    }\n                }\n            }\n        }\n    }",
  "abstract_func_before": "public static void unzipFilesToPath(String VAR_0, String VAR_1) throws IOException {\n        File VAR_2 = new File(VAR_0);\n        try (JarFile VAR_3 = new JarFile(VAR_2)) {\n\n            /* COMMENT_0 */\n            /* COMMENT_1 */\n            /* COMMENT_2 */\n                                                                \n\n                                                                                    \n                                            \n\n                                             \n                               \n                 \n\n               \n\n            /* COMMENT_11 */\n            for (Enumeration<JarEntry> VAR_4 = VAR_3.entries(); VAR_4.hasMoreElements(); ) {\n                JarEntry VAR_5 = VAR_4.nextElement();\n\n                String VAR_6 = VAR_1 + VAR_7.separator + VAR_5.getName();\n                File VAR_8 = new File(VAR_6);\n\n                File VAR_9 = VAR_8.getParentFile();\n                if (!VAR_9.exists()) {\n                    VAR_9.mkdirs();\n                }\n\n                if (!VAR_6.endsWith(\"/\")) {\n                    try (InputStream VAR_10 = VAR_3.getInputStream(VAR_5);\n                         FileOutputStream VAR_11 = new FileOutputStream(VAR_8)) {\n                        /* COMMENT_12 */\n                        while (VAR_10.available() > 0) {\n                            VAR_11.write(VAR_10.read());\n                        }\n                    }\n                }\n            }\n        }\n    }",
  "func_graph_path_before": "Konloch/bytecode-viewer/c968e94b2c93da434a4ecfac6d08eda162d615d0/ZipUtils.java/vul/before/2.json",
  "func": "public static void unzipFilesToPath(String jarPath, String destinationDir) throws IOException {\n        File file = new File(jarPath);\n        try (JarFile jar = new JarFile(file)) {\n\n            // fist get all directories,\n            // then make those directory on the destination Path\n            /*for (Enumeration<JarEntry> enums = jar.entries(); enums.hasMoreElements(); ) {\n                JarEntry entry = (JarEntry) enums.nextElement();\n\n                String fileName = destinationDir + File.separator + entry.getName();\n                File f = new File(fileName);\n\n                if (fileName.endsWith(\"/\")) {\n                    f.mkdirs();\n                }\n\n            }*/\n\n            //now create all files\n            for (Enumeration<JarEntry> enums = jar.entries(); enums.hasMoreElements(); ) {\n                JarEntry entry = enums.nextElement();\n\n                String fileName = destinationDir + File.separator + entry.getName();\n                File f = new File(fileName);\n\n                if (!f.getCanonicalPath().startsWith(destinationDir)) {\n                    System.out.println(\"Zip Slip exploit detected. Skipping entry \" + entry.getName());\n                    continue;\n                }\n\n                File parent = f.getParentFile();\n                if (!parent.exists()) {\n                    parent.mkdirs();\n                }\n\n                if (!fileName.endsWith(\"/\")) {\n                    try (InputStream is = jar.getInputStream(entry);\n                         FileOutputStream fos = new FileOutputStream(f)) {\n                        // write contents of 'is' to 'fos'\n                        while (is.available() > 0) {\n                            fos.write(is.read());\n                        }\n                    }\n                }\n            }\n        }\n    }",
  "abstract_func": "public static void unzipFilesToPath(String VAR_0, String VAR_1) throws IOException {\n        File VAR_2 = new File(VAR_0);\n        try (JarFile VAR_3 = new JarFile(VAR_2)) {\n\n            /* COMMENT_0 */\n            /* COMMENT_1 */\n            /* COMMENT_2 */\n                                                                \n\n                                                                                    \n                                            \n\n                                             \n                               \n                 \n\n               \n\n            /* COMMENT_11 */\n            for (Enumeration<JarEntry> VAR_4 = VAR_3.entries(); VAR_4.hasMoreElements(); ) {\n                JarEntry VAR_5 = VAR_4.nextElement();\n\n                String VAR_6 = VAR_1 + VAR_7.separator + VAR_5.getName();\n                File VAR_8 = new File(VAR_6);\n\n                if (!VAR_8.getCanonicalPath().startsWith(VAR_1)) {\n                    VAR_9.out.println(\"Zip Slip exploit detected. Skipping entry \" + VAR_5.getName());\n                    continue;\n                }\n\n                File VAR_10 = VAR_8.getParentFile();\n                if (!VAR_10.exists()) {\n                    VAR_10.mkdirs();\n                }\n\n                if (!VAR_6.endsWith(\"/\")) {\n                    try (InputStream VAR_11 = VAR_3.getInputStream(VAR_5);\n                         FileOutputStream VAR_12 = new FileOutputStream(VAR_8)) {\n                        /* COMMENT_12 */\n                        while (VAR_11.available() > 0) {\n                            VAR_12.write(VAR_11.read());\n                        }\n                    }\n                }\n            }\n        }\n    }",
  "func_graph_path": "Konloch/bytecode-viewer/c968e94b2c93da434a4ecfac6d08eda162d615d0/ZipUtils.java/vul/after/2.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -23,6 +23,11 @@\n                 String fileName = destinationDir + File.separator + entry.getName();\n                 File f = new File(fileName);\n \n+                if (!f.getCanonicalPath().startsWith(destinationDir)) {\n+                    System.out.println(\"Zip Slip exploit detected. Skipping entry \" + entry.getName());\n+                    continue;\n+                }\n+\n                 File parent = f.getParentFile();\n                 if (!parent.exists()) {\n                     parent.mkdirs();",
  "diff_line_info": {
    "deleted_lines": [],
    "added_lines": [
      "                if (!f.getCanonicalPath().startsWith(destinationDir)) {",
      "                    System.out.println(\"Zip Slip exploit detected. Skipping entry \" + entry.getName());",
      "                    continue;",
      "                }",
      ""
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/Konloch/bytecode-viewer/pull/379",
  "description": "Failed to get PR details: HTTP Request Error for PR https://github.com/Konloch/bytecode-viewer/pull/379: 403 Client Error: Forbidden for url: https://api.github.com/repos/Konloch/bytecode-viewer/pulls/379",
  "Bug Filter": "Security Vulnerability Fix",
  "Bug Filter Confidence": 0.95,
  "Bug Filter Response": "**Final Classification:** Security Vulnerability Fix; **Confidence:** 0.95  \nThe changes address a specific security exploit (Zip Slip), involve a clear security check, and align with the commit message and description."
}