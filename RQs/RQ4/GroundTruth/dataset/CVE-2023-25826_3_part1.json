{
  "cve_id": "CVE-2023-25826",
  "cwe_ids": [
    "CWE-78"
  ],
  "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H",
  "cvss_is_v3": true,
  "repo_name": "OpenTSDB/opentsdb",
  "commit_msg": "Improved fix for #2261.\nRegular expressions wouldn't catch the newlines or possibly other\ncontrol characters. Now we'll use the TAG validation code to make\nsure the inputs are only plain ASCII printables first.\nFixes CVE-2018-12972, CVE-2020-35476",
  "commit_hash": "26be40a5e5b6ce8b0b1e4686c4b0d7911e5d8a25",
  "git_url": "https://github.com/OpenTSDB/opentsdb/commit/26be40a5e5b6ce8b0b1e4686c4b0d7911e5d8a25",
  "file_path": "test/tsd/TestGraphHandler.java",
  "func_name": "setKeyParams",
  "func_before": "@Test\n  public void setKeyParams() throws Exception {\n    assertPlotParam(\"key\", \"out\");\n    assertPlotParam(\"key\", \"left\");\n    assertPlotParam(\"key\", \"top\");\n    assertPlotParam(\"key\", \"center\");\n    assertPlotParam(\"key\", \"right\");\n    assertPlotParam(\"key\", \"horiz\");\n    assertPlotParam(\"key\", \"box\");\n    assertPlotParam(\"key\", \"bottom\");\n    assertInvalidPlotParam(\"yrange\", \"out%20right%20top%0aset%20yrange%20[33:system(%20\");\n  }",
  "abstract_func_before": "@Test\n  public void setKeyParams() throws Exception {\n    assertPlotParam(\"key\", \"out\");\n    assertPlotParam(\"key\", \"left\");\n    assertPlotParam(\"key\", \"top\");\n    assertPlotParam(\"key\", \"center\");\n    assertPlotParam(\"key\", \"right\");\n    assertPlotParam(\"key\", \"horiz\");\n    assertPlotParam(\"key\", \"box\");\n    assertPlotParam(\"key\", \"bottom\");\n    assertInvalidPlotParam(\"yrange\", \"out%20right%20top%0aset%20yrange%20[33:system(%20\");\n  }",
  "func_graph_path_before": "OpenTSDB/opentsdb/26be40a5e5b6ce8b0b1e4686c4b0d7911e5d8a25/TestGraphHandler.java/vul/before/4.json",
  "func": "@Test\n  public void setKeyParams() throws Exception {\n    assertPlotParam(\"key\", \"out\");\n    assertPlotParam(\"key\", \"left\");\n    assertPlotParam(\"key\", \"top\");\n    assertPlotParam(\"key\", \"center\");\n    assertPlotParam(\"key\", \"right\");\n    assertPlotParam(\"key\", \"horiz\");\n    assertPlotParam(\"key\", \"box\");\n    assertPlotParam(\"key\", \"bottom\");\n    assertInvalidPlotParam(\"key\", \"out%20right%20top%0aset%20yrange%20[33:system(%20\");\n    assertInvalidPlotParam(\"key\", \"%3Bsystem%20%22cat%20/home/ubuntuvm/secret.txt%20%3E/tmp/secret.txt%22%20%22\");\n  }",
  "abstract_func": "@Test\n  public void setKeyParams() throws Exception {\n    assertPlotParam(\"key\", \"out\");\n    assertPlotParam(\"key\", \"left\");\n    assertPlotParam(\"key\", \"top\");\n    assertPlotParam(\"key\", \"center\");\n    assertPlotParam(\"key\", \"right\");\n    assertPlotParam(\"key\", \"horiz\");\n    assertPlotParam(\"key\", \"box\");\n    assertPlotParam(\"key\", \"bottom\");\n    assertInvalidPlotParam(\"key\", \"out%20right%20top%0aset%20yrange%20[33:system(%20\");\n    assertInvalidPlotParam(\"key\", \"%3Bsystem%20%22cat%20/home/ubuntuvm/secret.txt%20%3E/tmp/secret.txt%22%20%22\");\n  }",
  "func_graph_path": "OpenTSDB/opentsdb/26be40a5e5b6ce8b0b1e4686c4b0d7911e5d8a25/TestGraphHandler.java/vul/after/4.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -8,5 +8,6 @@\n     assertPlotParam(\"key\", \"horiz\");\n     assertPlotParam(\"key\", \"box\");\n     assertPlotParam(\"key\", \"bottom\");\n-    assertInvalidPlotParam(\"yrange\", \"out%20right%20top%0aset%20yrange%20[33:system(%20\");\n+    assertInvalidPlotParam(\"key\", \"out%20right%20top%0aset%20yrange%20[33:system(%20\");\n+    assertInvalidPlotParam(\"key\", \"%3Bsystem%20%22cat%20/home/ubuntuvm/secret.txt%20%3E/tmp/secret.txt%22%20%22\");\n   }",
  "diff_line_info": {
    "deleted_lines": [
      "    assertInvalidPlotParam(\"yrange\", \"out%20right%20top%0aset%20yrange%20[33:system(%20\");"
    ],
    "added_lines": [
      "    assertInvalidPlotParam(\"key\", \"out%20right%20top%0aset%20yrange%20[33:system(%20\");",
      "    assertInvalidPlotParam(\"key\", \"%3Bsystem%20%22cat%20/home/ubuntuvm/secret.txt%20%3E/tmp/secret.txt%22%20%22\");"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/OpenTSDB/opentsdb/pull/2275",
  "description": {
    "pr_info": {
      "title": "Improved fix for #2261.",
      "number": 2275
    },
    "comment": [
      "Regular expressions wouldn't catch the newlines or possibly other control characters. Now we'll use the TAG validation code to make sure the inputs are only plain ASCII printables first. Fixes CVE-2018-12972, CVE-2020-35476",
      "@manolama - this seems to fix the [RCE we reported](https://github.com/OpenTSDB/opentsdb/issues/2261) before Synopsis on Dec 12, 2022. Seems like they have also issued a CVE for the vulnerability we found. Could you please open a Github security advisory? Thanks."
    ]
  },
  "Bug Filter": "Security Vulnerability Fix",
  "Bug Filter Confidence": 0.9,
  "Bug Filter Response": "The patch addresses security issues by adding tests that check for invalid inputs, specifically targeting known vulnerabilities (CVE IDs). These changes are directly aimed at enhancing security by preventing control character issues, which are security risks.\n\n**Final Classification:** Security Vulnerability Fix  \n**Confidence:** 0.9"
}