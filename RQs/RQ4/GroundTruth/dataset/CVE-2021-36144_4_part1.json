{
  "cve_id": "CVE-2021-36144",
  "cwe_ids": [
    "CWE-416"
  ],
  "cvss_vector": "AV:N/AC:L/Au:N/C:N/I:N/A:P",
  "cvss_is_v3": false,
  "repo_name": "projectacrn/acrn-hypervisor",
  "commit_msg": "dm: Reset virtio device before release\n\nWith virtio polling mode enabled, a timer is running in the virtio\nbackend service. And the timer will also be triggered if its frondend\ndriver didn't do the device reset in shutdown. A freed virtio device\nwill be accessed in the polling timer handler.\n\nDo the virtio reset() callback specifically to clear the polling timer\nbefore the free.\n\nTracked-On: #6147\nSigned-off-by: Shuo A Liu <shuo.a.liu@intel.com>\nSigned-off-by: Yonghua Huang <yonghua.huang@intel.com>",
  "commit_hash": "dd88504804e186029f845a166dc5c31695e2cca2",
  "git_url": "https://github.com/projectacrn/acrn-hypervisor/commit/dd88504804e186029f845a166dc5c31695e2cca2",
  "file_path": "devicemodel/hw/pci/virtio/virtio_gpio.c",
  "func_name": "virtio_gpio_deinit",
  "func_before": "static void\nvirtio_gpio_deinit(struct vmctx *ctx, struct pci_vdev *dev, char *opts)\n{\n\tstruct virtio_gpio *gpio;\n\tint i;\n\n\tDPRINTF((\"%s\", \"virtio gpio: pci_gpio_deinit\\r\\n\"));\n\tvirtio_gpio_is_active = false;\n\tgpio = (struct virtio_gpio *)dev->arg;\n\tif (gpio) {\n\t\tpthread_mutex_destroy(&gpio->mtx);\n\t\tgpio_irq_deinit(gpio);\n\t\tfor (i = 0; i < gpio->nchip; i++)\n\t\t\tnative_gpio_close_chip(&gpio->chips[i]);\n\t\tfree(gpio);\n\t\tdev->arg = NULL;\n\t}\n}",
  "abstract_func_before": "static void\nvirtio_gpio_deinit(struct vmctx *VAR_0, struct pci_vdev *VAR_1, char *VAR_2)\n{\n\tstruct virtio_gpio *VAR_3;\n\tint VAR_4;\n\n\tDPRINTF((\"%s\", \"virtio gpio: pci_gpio_deinit\\r\\n\"));\n\tVAR_5 = false;\n\tVAR_3 = (struct virtio_gpio *)VAR_1->arg;\n\tif (VAR_3) {\n\t\tpthread_mutex_destroy(&VAR_3->mtx);\n\t\tgpio_irq_deinit(VAR_3);\n\t\tfor (VAR_4 = 0; VAR_4 < VAR_3->nchip; VAR_4++)\n\t\t\tnative_gpio_close_chip(&VAR_3->chips[VAR_4]);\n\t\tfree(VAR_3);\n\t\tVAR_1->arg = NULL;\n\t}\n}",
  "func_graph_path_before": "projectacrn/acrn-hypervisor/dd88504804e186029f845a166dc5c31695e2cca2/virtio_gpio.c/vul/before/0.json",
  "func": "static void\nvirtio_gpio_deinit(struct vmctx *ctx, struct pci_vdev *dev, char *opts)\n{\n\tstruct virtio_gpio *gpio;\n\tint i;\n\n\tDPRINTF((\"%s\", \"virtio gpio: pci_gpio_deinit\\r\\n\"));\n\tvirtio_gpio_is_active = false;\n\tgpio = (struct virtio_gpio *)dev->arg;\n\tif (gpio) {\n\t\tpthread_mutex_destroy(&gpio->mtx);\n\t\tgpio_irq_deinit(gpio);\n\t\tfor (i = 0; i < gpio->nchip; i++)\n\t\t\tnative_gpio_close_chip(&gpio->chips[i]);\n\t\tvirtio_gpio_reset(gpio);\n\t\tfree(gpio);\n\t\tdev->arg = NULL;\n\t}\n}",
  "abstract_func": "static void\nvirtio_gpio_deinit(struct vmctx *VAR_0, struct pci_vdev *VAR_1, char *VAR_2)\n{\n\tstruct virtio_gpio *VAR_3;\n\tint VAR_4;\n\n\tDPRINTF((\"%s\", \"virtio gpio: pci_gpio_deinit\\r\\n\"));\n\tVAR_5 = false;\n\tVAR_3 = (struct virtio_gpio *)VAR_1->arg;\n\tif (VAR_3) {\n\t\tpthread_mutex_destroy(&VAR_3->mtx);\n\t\tgpio_irq_deinit(VAR_3);\n\t\tfor (VAR_4 = 0; VAR_4 < VAR_3->nchip; VAR_4++)\n\t\t\tnative_gpio_close_chip(&VAR_3->chips[VAR_4]);\n\t\tvirtio_gpio_reset(VAR_3);\n\t\tfree(VAR_3);\n\t\tVAR_1->arg = NULL;\n\t}\n}",
  "func_graph_path": "projectacrn/acrn-hypervisor/dd88504804e186029f845a166dc5c31695e2cca2/virtio_gpio.c/vul/after/0.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -12,6 +12,7 @@\n \t\tgpio_irq_deinit(gpio);\n \t\tfor (i = 0; i < gpio->nchip; i++)\n \t\t\tnative_gpio_close_chip(&gpio->chips[i]);\n+\t\tvirtio_gpio_reset(gpio);\n \t\tfree(gpio);\n \t\tdev->arg = NULL;\n \t}",
  "diff_line_info": {
    "deleted_lines": [],
    "added_lines": [
      "\t\tvirtio_gpio_reset(gpio);"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/projectacrn/acrn-hypervisor/pull/6268",
  "description": "Failed to get PR details: HTTP Request Error for PR https://github.com/projectacrn/acrn-hypervisor/pull/6268: 403 Client Error: Forbidden for url: https://api.github.com/repos/projectacrn/acrn-hypervisor/pulls/6268",
  "Bug Filter": "Defect Remediation & Feature Upgrades",
  "Bug Filter Confidence": 0.85,
  "Bug Filter Response": "**Final Classification:** Defect Remediation & Feature Upgrades; **Confidence:** 0.85"
}