{
  "cve_id": "CVE-2020-12649",
  "cwe_ids": [
    "CWE-22"
  ],
  "cvss_vector": "AV:N/AC:L/Au:N/C:P/I:N/A:N",
  "cvss_is_v3": false,
  "repo_name": "sirdude/gurbalib",
  "commit_msg": "update help.c to fix security bug\n\npath traversal in help.c allows administrative paths to be read",
  "commit_hash": "2c0e744927d4aaa5c5f1b5d4b5405104350f5f83",
  "git_url": "https://github.com/sirdude/gurbalib/commit/2c0e744927d4aaa5c5f1b5d4b5405104350f5f83",
  "file_path": "lib/cmds/player/help.c",
  "func_name": "main",
  "func_before": "static void main(string arg) {\n   string file;\n\n   if (!alsos) {\n      setup_alsos();\n   }\n\n   if (empty_str(arg) || (arg == \"help\")) {\n      this_player()->more(usage());\n      return;\n   }\n\n   if (sscanf(arg, \"-%s\", arg)) {\n      this_player()->more(usage());\n      return;\n   }\n\n   file = normalize_path(arg, \"/doc/help/\");\n   if (show_help(file)) {\n      return;\n   }\n\n   if (query_wizard(this_player())) {\n      file = normalize_path(arg, \"/doc/help/wiz/\");\n      if (show_help(file)) {\n         return;\n      }\n   }\n\n   if (show_help_for_command(arg)) {\n      return;\n   }\n\n   write(capitalize(arg) + \": Unknown help topic.\");\n   if (query_wizard(this_player())) {\n      write(\"Try one of the following for more info:\\n\");\n      write(\"\\tman \" + arg + \"\\n\");\n      write(\"\\t\" + arg + \" -h\\n\");\n   } else {\n      write(\"If \" + arg + \" is a command, for more info try: \" + \n         arg + \" -h\\n\");\n   }\n   LOG_D->write_log(\"help\", this_player()->query_Name() +\n      \" on \" + ctime(time()) + \": \" + arg + \"\\n\");\n   return;\n}",
  "abstract_func_before": "static void main(string VAR_0) {\n   string VAR_1;\n\n   if (!VAR_2) {\n      setup_alsos();\n   }\n\n   if (empty_str(VAR_0) || (VAR_0 == \"help\")) {\n      this_player()->more(usage());\n      return;\n   }\n\n   if (sscanf(VAR_0, \"-%s\", VAR_0)) {\n      this_player()->more(usage());\n      return;\n   }\n\n   VAR_1 = normalize_path(VAR_0, \"/doc/help/\");\n   if (show_help(VAR_1)) {\n      return;\n   }\n\n   if (query_wizard(this_player())) {\n      VAR_1 = normalize_path(VAR_0, \"/doc/help/wiz/\");\n      if (show_help(VAR_1)) {\n         return;\n      }\n   }\n\n   if (show_help_for_command(VAR_0)) {\n      return;\n   }\n\n   write(capitalize(VAR_0) + \": Unknown help topic.\");\n   if (query_wizard(this_player())) {\n      write(\"Try one of the following for more info:\\n\");\n      write(\"\\tman \" + VAR_0 + \"\\n\");\n      write(\"\\t\" + VAR_0 + \" -h\\n\");\n   } else {\n      write(\"If \" + VAR_0 + \" is a command, for more info try: \" + \n         VAR_0 + \" -h\\n\");\n   }\n   VAR_3->write_log(\"help\", this_player()->query_Name() +\n      \" on \" + ctime(time()) + \": \" + VAR_0 + \"\\n\");\n   return;\n}",
  "func_graph_path_before": "sirdude/gurbalib/2c0e744927d4aaa5c5f1b5d4b5405104350f5f83/help.c/vul/before/0.json",
  "func": "static void main(string arg) {\n   string file, *exparg;\n   int szof;\n   \n   /* remove capability of path traversal */\n   /* discoverd by David Byrne of X-Force Red */\n   if (szof > 1) {\n      return 1;\n   }\n\n   if (!alsos) {\n      setup_alsos();\n   }\n\n   if (empty_str(arg) || (arg == \"help\")) {\n      this_player()->more(usage());\n      return;\n   }\n\n   if (sscanf(arg, \"-%s\", arg)) {\n      this_player()->more(usage());\n      return;\n   }\n\n   file = normalize_path(arg, \"/doc/help/\");\n   if (show_help(file)) {\n      return;\n   }\n\n   if (query_wizard(this_player())) {\n      file = normalize_path(arg, \"/doc/help/wiz/\");\n      if (show_help(file)) {\n         return;\n      }\n   }\n\n   if (show_help_for_command(arg)) {\n      return;\n   }\n\n   write(capitalize(arg) + \": Unknown help topic.\");\n   if (query_wizard(this_player())) {\n      write(\"Try one of the following for more info:\\n\");\n      write(\"\\tman \" + arg + \"\\n\");\n      write(\"\\t\" + arg + \" -h\\n\");\n   } else {\n      write(\"If \" + arg + \" is a command, for more info try: \" + \n         arg + \" -h\\n\");\n   }\n   LOG_D->write_log(\"help\", this_player()->query_Name() +\n      \" on \" + ctime(time()) + \": \" + arg + \"\\n\");\n   return;\n}",
  "abstract_func": "static void main(string VAR_0) {\n   string VAR_1, *VAR_2;\n   int VAR_3;\n   \n   /* COMMENT_0 */\n   /* COMMENT_1 */\n   if (VAR_3 > 1) {\n      return 1;\n   }\n\n   if (!VAR_4) {\n      setup_alsos();\n   }\n\n   if (empty_str(VAR_0) || (VAR_0 == \"help\")) {\n      this_player()->more(usage());\n      return;\n   }\n\n   if (sscanf(VAR_0, \"-%s\", VAR_0)) {\n      this_player()->more(usage());\n      return;\n   }\n\n   VAR_1 = normalize_path(VAR_0, \"/doc/help/\");\n   if (show_help(VAR_1)) {\n      return;\n   }\n\n   if (query_wizard(this_player())) {\n      VAR_1 = normalize_path(VAR_0, \"/doc/help/wiz/\");\n      if (show_help(VAR_1)) {\n         return;\n      }\n   }\n\n   if (show_help_for_command(VAR_0)) {\n      return;\n   }\n\n   write(capitalize(VAR_0) + \": Unknown help topic.\");\n   if (query_wizard(this_player())) {\n      write(\"Try one of the following for more info:\\n\");\n      write(\"\\tman \" + VAR_0 + \"\\n\");\n      write(\"\\t\" + VAR_0 + \" -h\\n\");\n   } else {\n      write(\"If \" + VAR_0 + \" is a command, for more info try: \" + \n         VAR_0 + \" -h\\n\");\n   }\n   VAR_5->write_log(\"help\", this_player()->query_Name() +\n      \" on \" + ctime(time()) + \": \" + VAR_0 + \"\\n\");\n   return;\n}",
  "func_graph_path": "sirdude/gurbalib/2c0e744927d4aaa5c5f1b5d4b5405104350f5f83/help.c/vul/after/0.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -1,5 +1,12 @@\n static void main(string arg) {\n-   string file;\n+   string file, *exparg;\n+   int szof;\n+   \n+   /* remove capability of path traversal */\n+   /* discoverd by David Byrne of X-Force Red */\n+   if (szof > 1) {\n+      return 1;\n+   }\n \n    if (!alsos) {\n       setup_alsos();",
  "diff_line_info": {
    "deleted_lines": [
      "   string file;"
    ],
    "added_lines": [
      "   string file, *exparg;",
      "   int szof;",
      "   ",
      "   /* remove capability of path traversal */",
      "   /* discoverd by David Byrne of X-Force Red */",
      "   if (szof > 1) {",
      "      return 1;",
      "   }"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/sirdude/gurbalib/pull/39",
  "description": {
    "pr_info": {
      "title": "Patch 2",
      "number": 39
    },
    "comment": [
      "CVE Fix, plus the missing pk code, sorry parts of the code was missing, I did a bad copy and paste from my other source tree",
      "Can you take out the help bits after that I'll commit."
    ]
  },
  "Bug Filter": "Security Vulnerability Fix",
  "Bug Filter Confidence": 1.0,
  "Bug Filter Response": "**Final Classification:** Security Vulnerability Fix\n\n**Confidence:** 1.0"
}