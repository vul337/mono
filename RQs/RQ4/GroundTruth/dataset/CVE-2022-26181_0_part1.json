{
  "cve_id": "CVE-2022-26181",
  "cwe_ids": [
    "CWE-787"
  ],
  "cvss_vector": "AV:N/AC:M/Au:N/C:P/I:P/A:P",
  "cvss_is_v3": false,
  "repo_name": "dropbox/lepton",
  "commit_msg": "Fix wild free.\n\n`huffdata` is initially allocated using `aligned_dealloc` but can be\nreplaced with `data2` which is allocated using `custom_calloc`.\nThis can cause a wild free when `aligned_dealloc(huffdata)` is called.\nFix by replacing allocation sites with aligned_alloc.\n\nNoticed and fixed a similar problem with `hdrdata`.",
  "commit_hash": "4e591ffd0127ac064c4749e523458a923b29cc75",
  "git_url": "https://github.com/dropbox/lepton/commit/4e591ffd0127ac064c4749e523458a923b29cc75",
  "file_path": "src/lepton/bitops.cc",
  "func_name": "aligned_dealloc",
  "func_before": "void aligned_dealloc(unsigned char *data) {\n    if (!data) return;\n    data -= data[-1];\n    custom_free(data);\n}",
  "abstract_func_before": "void aligned_dealloc(unsigned char *VAR_0) {\n    if (!VAR_0) return;\n    VAR_0 -= VAR_0[-1];\n    custom_free(VAR_0);\n}",
  "func_graph_path_before": "dropbox/lepton/4e591ffd0127ac064c4749e523458a923b29cc75/bitops.cc/vul/before/1.json",
  "func": "void aligned_dealloc(unsigned char *data) {\n    if (!data) return;\n    always_assert(((size_t)(data - 0) & 0xf) == 0);\n    always_assert(data[-1] <= 0x10);\n    data -= data[-1];\n    custom_free(data);\n}",
  "abstract_func": "void aligned_dealloc(unsigned char *VAR_0) {\n    if (!VAR_0) return;\n    always_assert(((size_t)(VAR_0 - 0) & 0xf) == 0);\n    always_assert(VAR_0[-1] <= 0x10);\n    VAR_0 -= VAR_0[-1];\n    custom_free(VAR_0);\n}",
  "func_graph_path": "dropbox/lepton/4e591ffd0127ac064c4749e523458a923b29cc75/bitops.cc/vul/after/1.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -1,5 +1,7 @@\n void aligned_dealloc(unsigned char *data) {\n     if (!data) return;\n+    always_assert(((size_t)(data - 0) & 0xf) == 0);\n+    always_assert(data[-1] <= 0x10);\n     data -= data[-1];\n     custom_free(data);\n }",
  "diff_line_info": {
    "deleted_lines": [],
    "added_lines": [
      "    always_assert(((size_t)(data - 0) & 0xf) == 0);",
      "    always_assert(data[-1] <= 0x10);"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/dropbox/lepton/pull/155",
  "description": {
    "pr_info": {
      "title": "Fix wild free.",
      "number": 155
    },
    "comment": [
      "`huffdata` is initially allocated using `aligned_dealloc` but can be\r\nreplaced with `data2` which is allocated using `custom_calloc`.\r\nThis can cause a wild free when `aligned_dealloc(huffdata)` is called.\r\nFix by replacing allocation sites with aligned_alloc.\r\n\r\nNoticed and fixed a similar problem with `hdrdata`.\r\n\r\nFixes #154."
    ]
  },
  "Bug Filter": "Security Vulnerability Fix",
  "Bug Filter Confidence": 1.0,
  "Bug Filter Response": "**Final Classification:** Security Vulnerability Fix  \n**Confidence:** 1.0"
}