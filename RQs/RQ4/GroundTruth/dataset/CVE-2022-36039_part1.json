{
  "cve_id": "CVE-2022-36039",
  "cwe_ids": [
    "CWE-787"
  ],
  "cvss_vector": "CVSS:3.1/AV:L/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H",
  "cvss_is_v3": true,
  "repo_name": "rizinorg/rizin",
  "commit_msg": "fix #2969 - oob write (1 byte) in dex.c",
  "commit_hash": "1524f85211445e41506f98180f8f69f7bf115406",
  "git_url": "https://github.com/rizinorg/rizin/commit/1524f85211445e41506f98180f8f69f7bf115406",
  "file_path": "librz/bin/format/dex/dex.c",
  "func_name": "dex_string_new",
  "func_before": "static DexString *dex_string_new(RzBuffer *buf, ut64 offset, st64 *pread) {\n\tut64 size = 0;\n\tchar *data = NULL;\n\tst64 read;\n\tDexString *string = NULL;\n\n\tread = rz_buf_uleb128(buf, &size);\n\tdata = malloc(size + 1);\n\tif (!data || rz_buf_read(buf, (ut8 *)data, size) != size) {\n\t\tfree(data);\n\t\treturn NULL;\n\t}\n\tdata[size] = 0;\n\n\tstring = RZ_NEW0(DexString);\n\tif (!string) {\n\t\tfree(data);\n\t\treturn NULL;\n\t}\n\n\t*pread = read;\n\tstring->size = size;\n\tstring->offset = offset;\n\tstring->data = data;\n\treturn string;\n}",
  "abstract_func_before": "static DexString *dex_string_new(RzBuffer *VAR_0, ut64 VAR_1, st64 *VAR_2) {\n\tut64 VAR_3 = 0;\n\tchar *VAR_4 = NULL;\n\tst64 VAR_5;\n\tDexString *VAR_6 = NULL;\n\n\tVAR_5 = rz_buf_uleb128(VAR_0, &VAR_3);\n\tVAR_4 = malloc(VAR_3 + 1);\n\tif (!VAR_4 || rz_buf_read(VAR_0, (ut8 *)VAR_4, VAR_3) != VAR_3) {\n\t\tfree(VAR_4);\n\t\treturn NULL;\n\t}\n\tVAR_4[VAR_3] = 0;\n\n\tVAR_6 = RZ_NEW0(DexString);\n\tif (!VAR_6) {\n\t\tfree(VAR_4);\n\t\treturn NULL;\n\t}\n\n\t*VAR_2 = VAR_5;\n\tVAR_6->size = VAR_3;\n\tVAR_6->offset = VAR_1;\n\tVAR_6->data = VAR_4;\n\treturn VAR_6;\n}",
  "func_graph_path_before": "rizinorg/rizin/1524f85211445e41506f98180f8f69f7bf115406/dex.c/vul/before/0.json",
  "func": "static DexString *dex_string_new(RzBuffer *buf, ut64 offset, st64 *pread) {\n\tut64 size = 0;\n\tchar *data = NULL;\n\tst64 read;\n\tDexString *string = NULL;\n\n\tread = rz_buf_uleb128(buf, &size);\n\tif (UT64_ADD_OVFCHK(size, 1)) {\n\t\treturn NULL;\n\t}\n\n\tdata = malloc(size + 1);\n\tif (!data || rz_buf_read(buf, (ut8 *)data, size) != size) {\n\t\tfree(data);\n\t\treturn NULL;\n\t}\n\tdata[size] = 0;\n\n\tstring = RZ_NEW0(DexString);\n\tif (!string) {\n\t\tfree(data);\n\t\treturn NULL;\n\t}\n\n\t*pread = read;\n\tstring->size = size;\n\tstring->offset = offset;\n\tstring->data = data;\n\treturn string;\n}",
  "abstract_func": "static DexString *dex_string_new(RzBuffer *VAR_0, ut64 VAR_1, st64 *VAR_2) {\n\tut64 VAR_3 = 0;\n\tchar *VAR_4 = NULL;\n\tst64 VAR_5;\n\tDexString *VAR_6 = NULL;\n\n\tVAR_5 = rz_buf_uleb128(VAR_0, &VAR_3);\n\tif (UT64_ADD_OVFCHK(VAR_3, 1)) {\n\t\treturn NULL;\n\t}\n\n\tVAR_4 = malloc(VAR_3 + 1);\n\tif (!VAR_4 || rz_buf_read(VAR_0, (ut8 *)VAR_4, VAR_3) != VAR_3) {\n\t\tfree(VAR_4);\n\t\treturn NULL;\n\t}\n\tVAR_4[VAR_3] = 0;\n\n\tVAR_6 = RZ_NEW0(DexString);\n\tif (!VAR_6) {\n\t\tfree(VAR_4);\n\t\treturn NULL;\n\t}\n\n\t*VAR_2 = VAR_5;\n\tVAR_6->size = VAR_3;\n\tVAR_6->offset = VAR_1;\n\tVAR_6->data = VAR_4;\n\treturn VAR_6;\n}",
  "func_graph_path": "rizinorg/rizin/1524f85211445e41506f98180f8f69f7bf115406/dex.c/vul/after/0.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -5,6 +5,10 @@\n \tDexString *string = NULL;\n \n \tread = rz_buf_uleb128(buf, &size);\n+\tif (UT64_ADD_OVFCHK(size, 1)) {\n+\t\treturn NULL;\n+\t}\n+\n \tdata = malloc(size + 1);\n \tif (!data || rz_buf_read(buf, (ut8 *)data, size) != size) {\n \t\tfree(data);",
  "diff_line_info": {
    "deleted_lines": [],
    "added_lines": [
      "\tif (UT64_ADD_OVFCHK(size, 1)) {",
      "\t\treturn NULL;",
      "\t}",
      ""
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/rizinorg/rizin/pull/2977",
  "description": "Failed to get PR details: HTTP Request Error for PR https://github.com/rizinorg/rizin/pull/2977: 403 Client Error: Forbidden for url: https://api.github.com/repos/rizinorg/rizin/pulls/2977",
  "Bug Filter": "Security Vulnerability Fix",
  "Bug Filter Confidence": 0.95,
  "Bug Filter Response": "**Final Classification:** Security Vulnerability Fix; **Confidence:** 0.95\n\nThe commit addresses an out-of-bounds write issue by adding an overflow check, which is a security fix. The code change directly corresponds to the vulnerability mentioned in the commit message."
}