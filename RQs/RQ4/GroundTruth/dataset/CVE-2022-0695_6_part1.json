{
  "cve_id": "CVE-2022-0695",
  "cwe_ids": [
    "CWE-400"
  ],
  "cvss_vector": "AV:N/AC:M/Au:N/C:N/I:N/A:P",
  "cvss_is_v3": false,
  "repo_name": "radareorg/radare2",
  "commit_msg": "Fix DoS in PE/QNX/DYLDCACHE/PSX parsers ##crash\n\n* Reported by lazymio\n* Reproducer: AAA4AAAAAB4=",
  "commit_hash": "634b886e84a5c568d243e744becc6b3223e089cf",
  "git_url": "https://github.com/radareorg/radare2/commit/634b886e84a5c568d243e744becc6b3223e089cf",
  "file_path": "libr/bin/p/bin_psxexe.c",
  "func_name": "sections",
  "func_before": "static RList* sections(RBinFile* bf) {\n\tRList* ret = NULL;\n\tRBinSection* sect = NULL;\n\tpsxexe_header psxheader = {0};\n\tut64 sz = 0;\n\n\tif (!(ret = r_list_new ())) {\n\t\treturn NULL;\n\t}\n\n\tif (!(sect = R_NEW0 (RBinSection))) {\n\t\tr_list_free (ret);\n\t\treturn NULL;\n\t}\n\n\tif (r_buf_fread_at (bf->buf, 0, (ut8*)&psxheader, \"8c17i\", 1) < sizeof (psxexe_header)) {\n\t\teprintf (\"Truncated Header\\n\");\n\t\tfree (sect);\n\t\tr_list_free (ret);\n\t\treturn NULL;\n\t}\n\n\tsz = r_buf_size (bf->buf);\n\n\tsect->name = strdup (\"TEXT\");\n\tsect->paddr = PSXEXE_TEXTSECTION_OFFSET;\n\tsect->size = sz - PSXEXE_TEXTSECTION_OFFSET;\n\tsect->vaddr = psxheader.t_addr;\n\tsect->vsize = psxheader.t_size;\n\tsect->perm = R_PERM_RX;\n\tsect->add = true;\n\tsect->has_strings = true;\n\n\tr_list_append (ret, sect);\n\treturn ret;\n}",
  "abstract_func_before": "static RList* sections(RBinFile* VAR_0) {\n\tRList* VAR_1 = NULL;\n\tRBinSection* VAR_2 = NULL;\n\tpsxexe_header VAR_3 = {0};\n\tut64 VAR_4 = 0;\n\n\tif (!(VAR_1 = r_list_new ())) {\n\t\treturn NULL;\n\t}\n\n\tif (!(VAR_2 = R_NEW0 (RBinSection))) {\n\t\tr_list_free (VAR_1);\n\t\treturn NULL;\n\t}\n\n\tif (r_buf_fread_at (VAR_0->buf, 0, (ut8*)&VAR_3, \"8c17i\", 1) < sizeof (psxexe_header)) {\n\t\teprintf (\"Truncated Header\\n\");\n\t\tfree (VAR_2);\n\t\tr_list_free (VAR_1);\n\t\treturn NULL;\n\t}\n\n\tVAR_4 = r_buf_size (VAR_0->buf);\n\n\tVAR_2->name = strdup (\"TEXT\");\n\tVAR_2->paddr = VAR_5;\n\tVAR_2->size = VAR_4 - VAR_5;\n\tVAR_2->vaddr = VAR_3.t_addr;\n\tVAR_2->vsize = VAR_3.t_size;\n\tVAR_2->perm = VAR_6;\n\tVAR_2->add = true;\n\tVAR_2->has_strings = true;\n\n\tr_list_append (VAR_1, VAR_2);\n\treturn VAR_1;\n}",
  "func_graph_path_before": "radareorg/radare2/634b886e84a5c568d243e744becc6b3223e089cf/bin_psxexe.c/vul/before/0.json",
  "func": "static RList* sections(RBinFile* bf) {\n\tRList* ret = NULL;\n\tRBinSection* sect = NULL;\n\tpsxexe_header psxheader = {0};\n\tut64 sz = 0;\n\n\tif (!(ret = r_list_new ())) {\n\t\treturn NULL;\n\t}\n\n\tif (!(sect = R_NEW0 (RBinSection))) {\n\t\tr_list_free (ret);\n\t\treturn NULL;\n\t}\n\n\tif (r_buf_fread_at (bf->buf, 0, (ut8*)&psxheader, \"8c17i\", 1) != sizeof (psxexe_header)) {\n\t\teprintf (\"Truncated Header\\n\");\n\t\tfree (sect);\n\t\tr_list_free (ret);\n\t\treturn NULL;\n\t}\n\n\tsz = r_buf_size (bf->buf);\n\n\tsect->name = strdup (\"TEXT\");\n\tsect->paddr = PSXEXE_TEXTSECTION_OFFSET;\n\tsect->size = sz - PSXEXE_TEXTSECTION_OFFSET;\n\tsect->vaddr = psxheader.t_addr;\n\tsect->vsize = psxheader.t_size;\n\tsect->perm = R_PERM_RX;\n\tsect->add = true;\n\tsect->has_strings = true;\n\n\tr_list_append (ret, sect);\n\treturn ret;\n}",
  "abstract_func": "static RList* sections(RBinFile* VAR_0) {\n\tRList* VAR_1 = NULL;\n\tRBinSection* VAR_2 = NULL;\n\tpsxexe_header VAR_3 = {0};\n\tut64 VAR_4 = 0;\n\n\tif (!(VAR_1 = r_list_new ())) {\n\t\treturn NULL;\n\t}\n\n\tif (!(VAR_2 = R_NEW0 (RBinSection))) {\n\t\tr_list_free (VAR_1);\n\t\treturn NULL;\n\t}\n\n\tif (r_buf_fread_at (VAR_0->buf, 0, (ut8*)&VAR_3, \"8c17i\", 1) != sizeof (psxexe_header)) {\n\t\teprintf (\"Truncated Header\\n\");\n\t\tfree (VAR_2);\n\t\tr_list_free (VAR_1);\n\t\treturn NULL;\n\t}\n\n\tVAR_4 = r_buf_size (VAR_0->buf);\n\n\tVAR_2->name = strdup (\"TEXT\");\n\tVAR_2->paddr = VAR_5;\n\tVAR_2->size = VAR_4 - VAR_5;\n\tVAR_2->vaddr = VAR_3.t_addr;\n\tVAR_2->vsize = VAR_3.t_size;\n\tVAR_2->perm = VAR_6;\n\tVAR_2->add = true;\n\tVAR_2->has_strings = true;\n\n\tr_list_append (VAR_1, VAR_2);\n\treturn VAR_1;\n}",
  "func_graph_path": "radareorg/radare2/634b886e84a5c568d243e744becc6b3223e089cf/bin_psxexe.c/vul/after/0.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -13,7 +13,7 @@\n \t\treturn NULL;\n \t}\n \n-\tif (r_buf_fread_at (bf->buf, 0, (ut8*)&psxheader, \"8c17i\", 1) < sizeof (psxexe_header)) {\n+\tif (r_buf_fread_at (bf->buf, 0, (ut8*)&psxheader, \"8c17i\", 1) != sizeof (psxexe_header)) {\n \t\teprintf (\"Truncated Header\\n\");\n \t\tfree (sect);\n \t\tr_list_free (ret);",
  "diff_line_info": {
    "deleted_lines": [
      "\tif (r_buf_fread_at (bf->buf, 0, (ut8*)&psxheader, \"8c17i\", 1) < sizeof (psxexe_header)) {"
    ],
    "added_lines": [
      "\tif (r_buf_fread_at (bf->buf, 0, (ut8*)&psxheader, \"8c17i\", 1) != sizeof (psxexe_header)) {"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/radareorg/radare2/pull/19747",
  "description": "Failed to get PR details: HTTP Request Error for PR https://github.com/radareorg/radare2/pull/19747: 403 Client Error: Forbidden for url: https://api.github.com/repos/radareorg/radare2/pulls/19747",
  "Bug Filter": "Security Vulnerability Fix",
  "Bug Filter Confidence": 0.95,
  "Bug Filter Response": "**Final Classification:** Security Vulnerability Fix  \n**Confidence:** 0.95"
}