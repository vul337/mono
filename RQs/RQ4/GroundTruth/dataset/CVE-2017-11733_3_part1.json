{
  "cve_id": "CVE-2017-11733",
  "cwe_ids": [
    "CWE-476"
  ],
  "cvss_vector": "AV:N/AC:M/Au:N/C:N/I:N/A:P",
  "cvss_is_v3": false,
  "repo_name": "libming",
  "commit_msg": "Fix null-pointer dereference issue in stackswap.\n\nAvoid processing stackswap when stack only contains one element. In this\ncase, print a warning if debug mode is enabled, and return cleanly.\n\nThis commit fixes CVE-2017-11733 (fixes #78).",
  "commit_hash": "eda5a20206862a11805303cdd125566c9f9f9103",
  "git_url": "https://github.com/libming/libming/commit/eda5a20206862a11805303cdd125566c9f9f9103",
  "file_path": "util/decompile.c",
  "func_name": "stackswap",
  "func_before": "void\nstackswap()\n{\n#ifdef DEBUG\n\tprintf(\"*stackswap*\\n\");\n#endif\n\tstruct SWF_ACTIONPUSHPARAM *p = peek();\t\t/* peek() includes error handling */\n\tchar type = Stack->type;\n\tStack->type = Stack->next->type;\n\tStack->val  = Stack->next->val;\n\tStack->next->type = type;\n\tStack->next->val  = p;\n}",
  "abstract_func_before": "void\nstackswap()\n{\n#ifdef VAR_0\n\tprintf(\"*stackswap*\\n\");\n#endif\n\tstruct SWF_ACTIONPUSHPARAM *VAR_1 = peek();\t\t/* COMMENT_0 */\n\tchar VAR_2 = VAR_3->type;\n\tVAR_3->type = VAR_3->next->type;\n\tVAR_3->val  = VAR_3->next->val;\n\tVAR_3->next->type = VAR_2;\n\tVAR_3->next->val  = VAR_1;\n}",
  "func_graph_path_before": "libming/eda5a20206862a11805303cdd125566c9f9f9103/decompile.c/vul/before/0.json",
  "func": "void\nstackswap()\n{\n#ifdef DEBUG\n\tprintf(\"*stackswap*\\n\");\n#endif\n\tstruct SWF_ACTIONPUSHPARAM *p = peek();\t\t/* peek() includes error handling */\n\tchar type = Stack->type;\n\n        if (Stack->next == NULL) {\n#if DEBUG\n\t\tSWF_warn(\"stackswap: can't swap (stack contains only one element)\\n\");\n#endif\n                return;\n        }\n\n\tStack->type = Stack->next->type;\n\tStack->val  = Stack->next->val;\n\tStack->next->type = type;\n\tStack->next->val  = p;\n}",
  "abstract_func": "void\nstackswap()\n{\n#ifdef VAR_0\n\tprintf(\"*stackswap*\\n\");\n#endif\n\tstruct SWF_ACTIONPUSHPARAM *VAR_1 = peek();\t\t/* COMMENT_0 */\n\tchar VAR_2 = VAR_3->type;\n\n        if (VAR_3->next == NULL) {\n#if VAR_0\n\t\tSWF_warn(\"stackswap: can't swap (stack contains only one element)\\n\");\n#endif\n                return;\n        }\n\n\tVAR_3->type = VAR_3->next->type;\n\tVAR_3->val  = VAR_3->next->val;\n\tVAR_3->next->type = VAR_2;\n\tVAR_3->next->val  = VAR_1;\n}",
  "func_graph_path": "libming/eda5a20206862a11805303cdd125566c9f9f9103/decompile.c/vul/after/0.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -6,6 +6,14 @@\n #endif\n \tstruct SWF_ACTIONPUSHPARAM *p = peek();\t\t/* peek() includes error handling */\n \tchar type = Stack->type;\n+\n+        if (Stack->next == NULL) {\n+#if DEBUG\n+\t\tSWF_warn(\"stackswap: can't swap (stack contains only one element)\\n\");\n+#endif\n+                return;\n+        }\n+\n \tStack->type = Stack->next->type;\n \tStack->val  = Stack->next->val;\n \tStack->next->type = type;",
  "diff_line_info": {
    "deleted_lines": [],
    "added_lines": [
      "",
      "        if (Stack->next == NULL) {",
      "#if DEBUG",
      "\t\tSWF_warn(\"stackswap: can't swap (stack contains only one element)\\n\");",
      "#endif",
      "                return;",
      "        }",
      ""
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/libming/libming/pull/93",
  "description": {
    "pr_info": {
      "title": "Fix various issues related to CVE-2017-11733.",
      "number": 93
    },
    "comment": [
      "Avoid processing stackswap when stack only contains one element. In this case, print a warning if debug mode is enabled, and return cleanly.\r\n\r\nThis PR fixes CVE-2017-11733 (fixes #78).\r\n\r\nPlease note:\r\n* This fix only addresses the null pointer dereference issue. See #78.\r\n* I'm going to update this PR in order to also address the memory leaks issue. I'd suggest to wait before merge.",
      "This PR now addresses various issues regarding `readSInt16`, `readUInt16` and `readSInt32`.\r\n\r\nThese issues haven't been reported as such, but I suspect them to be part of those still open.",
      "I also suggest to un-define `DEBUGSTACK`. You'll find more detailed explanations in the commit message.\r\n\r\nThese three commit are addressing three (more or less) separate issues. If you want, I can squash them into a single one, but I wouldn't recommend it.\r\n\r\nCVE-2017-11733 seems to be completely fixed now.",
      "Should that \"stackswap: can't swap\" warning really be protected by\nDEBUG ?\n\nAnyway, I merged it as-is, thank you!\n"
    ]
  },
  "Bug Filter": "Security Vulnerability Fix",
  "Bug Filter Confidence": 1.0,
  "Bug Filter Response": "**Final Classification:** Security Vulnerability Fix; **Confidence:** 1.0"
}