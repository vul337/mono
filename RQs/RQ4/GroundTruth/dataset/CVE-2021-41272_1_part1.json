{
  "cve_id": "CVE-2021-41272",
  "cwe_ids": [
    "CWE-681"
  ],
  "cvss_vector": "AV:N/AC:L/Au:N/C:N/I:N/A:P",
  "cvss_is_v3": false,
  "repo_name": "hyperledger/besu",
  "commit_msg": "Shift Optimization (#3039)\n\nReduce shift calculations to shifts that may have an actual result.\r\n\r\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>",
  "commit_hash": "4170524ac3b45185704fcfbdeeb71b0b05dfa0a1",
  "git_url": "https://github.com/hyperledger/besu/commit/4170524ac3b45185704fcfbdeeb71b0b05dfa0a1",
  "file_path": "evm/src/main/java/org/hyperledger/besu/evm/operation/ShlOperation.java",
  "func_name": "executeFixedCostOperation",
  "func_before": "@Override\n  public Operation.OperationResult executeFixedCostOperation(\n      final MessageFrame frame, final EVM evm) {\n    Bytes shiftAmount = frame.popStackItem();\n    if (shiftAmount.size() > 4 && (shiftAmount = shiftAmount.trimLeadingZeros()).size() > 4) {\n      frame.popStackItem();\n      frame.pushStackItem(UInt256.ZERO);\n    } else {\n      final int shiftAmountInt = shiftAmount.toInt();\n      final Bytes value = leftPad(frame.popStackItem());\n\n      if (shiftAmountInt >= 256) {\n        frame.pushStackItem(UInt256.ZERO);\n      } else {\n        frame.pushStackItem(value.shiftLeft(shiftAmountInt));\n      }\n    }\n    return successResponse;\n  }",
  "abstract_func_before": "@Override\n  public Operation.OperationResult executeFixedCostOperation(\n      final MessageFrame VAR_0, final EVM VAR_1) {\n    Bytes VAR_2 = VAR_0.popStackItem();\n    if (VAR_2.size() > 4 && (VAR_2 = VAR_2.trimLeadingZeros()).size() > 4) {\n      VAR_0.popStackItem();\n      VAR_0.pushStackItem(VAR_3.ZERO);\n    } else {\n      final int VAR_4 = VAR_2.toInt();\n      final Bytes VAR_5 = leftPad(VAR_0.popStackItem());\n\n      if (VAR_4 >= 256) {\n        VAR_0.pushStackItem(VAR_3.ZERO);\n      } else {\n        VAR_0.pushStackItem(VAR_5.shiftLeft(VAR_4));\n      }\n    }\n    return VAR_6;\n  }",
  "func_graph_path_before": "hyperledger/besu/4170524ac3b45185704fcfbdeeb71b0b05dfa0a1/ShlOperation.java/vul/before/0.json",
  "func": "@Override\n  public Operation.OperationResult executeFixedCostOperation(\n      final MessageFrame frame, final EVM evm) {\n    Bytes shiftAmount = frame.popStackItem();\n    if (shiftAmount.size() > 4 && (shiftAmount = shiftAmount.trimLeadingZeros()).size() > 4) {\n      frame.popStackItem();\n      frame.pushStackItem(UInt256.ZERO);\n    } else {\n      final int shiftAmountInt = shiftAmount.toInt();\n      final Bytes value = leftPad(frame.popStackItem());\n\n      if (shiftAmountInt >= 256 || shiftAmountInt < 0) {\n        frame.pushStackItem(UInt256.ZERO);\n      } else {\n        frame.pushStackItem(value.shiftLeft(shiftAmountInt));\n      }\n    }\n    return successResponse;\n  }",
  "abstract_func": "@Override\n  public Operation.OperationResult executeFixedCostOperation(\n      final MessageFrame VAR_0, final EVM VAR_1) {\n    Bytes VAR_2 = VAR_0.popStackItem();\n    if (VAR_2.size() > 4 && (VAR_2 = VAR_2.trimLeadingZeros()).size() > 4) {\n      VAR_0.popStackItem();\n      VAR_0.pushStackItem(VAR_3.ZERO);\n    } else {\n      final int VAR_4 = VAR_2.toInt();\n      final Bytes VAR_5 = leftPad(VAR_0.popStackItem());\n\n      if (VAR_4 >= 256 || VAR_4 < 0) {\n        VAR_0.pushStackItem(VAR_3.ZERO);\n      } else {\n        VAR_0.pushStackItem(VAR_5.shiftLeft(VAR_4));\n      }\n    }\n    return VAR_6;\n  }",
  "func_graph_path": "hyperledger/besu/4170524ac3b45185704fcfbdeeb71b0b05dfa0a1/ShlOperation.java/vul/after/0.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -9,7 +9,7 @@\n       final int shiftAmountInt = shiftAmount.toInt();\n       final Bytes value = leftPad(frame.popStackItem());\n \n-      if (shiftAmountInt >= 256) {\n+      if (shiftAmountInt >= 256 || shiftAmountInt < 0) {\n         frame.pushStackItem(UInt256.ZERO);\n       } else {\n         frame.pushStackItem(value.shiftLeft(shiftAmountInt));",
  "diff_line_info": {
    "deleted_lines": [
      "      if (shiftAmountInt >= 256) {"
    ],
    "added_lines": [
      "      if (shiftAmountInt >= 256 || shiftAmountInt < 0) {"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/hyperledger/besu/pull/3039",
  "description": {
    "pr_info": {
      "title": "Shift Optimization",
      "number": 3039
    },
    "comment": [
      "## PR description\r\n\r\nReduce shift calculations to shifts that may have an actual result.\r\n\r\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>\r\n\r\n\r\n## Changelog\r\n\r\n- [X] I thought about the changelog and included a [changelog update if required](https://wiki.hyperledger.org/display/BESU/Changelog).",
      "Kudos, SonarCloud Quality Gate passed!&nbsp; &nbsp; ![Quality Gate passed](https://sonarsource.github.io/sonarcloud-github-static-resources/v2/checks/QualityGateBadge/passed-16px.png 'Quality Gate passed')\n\n[![Bug](https://sonarsource.github.io/sonarcloud-github-static-resources/v2/common/bug-16px.png 'Bug')](https://sonarcloud.io/project/issues?id=hyperledger_besu&pullRequest=3039&resolved=false&types=BUG) [![A](https://sonarsource.github.io/sonarcloud-github-static-resources/v2/checks/RatingBadge/A-16px.png 'A')](https://sonarcloud.io/project/issues?id=hyperledger_besu&pullRequest=3039&resolved=false&types=BUG) [0 Bugs](https://sonarcloud.io/project/issues?id=hyperledger_besu&pullRequest=3039&resolved=false&types=BUG)  \n[![Vulnerability](https://sonarsource.github.io/sonarcloud-github-static-resources/v2/common/vulnerability-16px.png 'Vulnerability')](https://sonarcloud.io/project/issues?id=hyperledger_besu&pullRequest=3039&resolved=false&types=VULNERABILITY) [![A](https://sonarsource.github.io/sonarcloud-github-static-resources/v2/checks/RatingBadge/A-16px.png 'A')](https://sonarcloud.io/project/issues?id=hyperledger_besu&pullRequest=3039&resolved=false&types=VULNERABILITY) [0 Vulnerabilities](https://sonarcloud.io/project/issues?id=hyperledger_besu&pullRequest=3039&resolved=false&types=VULNERABILITY)  \n[![Security Hotspot](https://sonarsource.github.io/sonarcloud-github-static-resources/v2/common/security_hotspot-16px.png 'Security Hotspot')](https://sonarcloud.io/project/security_hotspots?id=hyperledger_besu&pullRequest=3039&resolved=false&types=SECURITY_HOTSPOT) [![A](https://sonarsource.github.io/sonarcloud-github-static-resources/v2/checks/RatingBadge/A-16px.png 'A')](https://sonarcloud.io/project/security_hotspots?id=hyperledger_besu&pullRequest=3039&resolved=false&types=SECURITY_HOTSPOT) [0 Security Hotspots](https://sonarcloud.io/project/security_hotspots?id=hyperledger_besu&pullRequest=3039&resolved=false&types=SECURITY_HOTSPOT)  \n[![Code Smell](https://sonarsource.github.io/sonarcloud-github-static-resources/v2/common/code_smell-16px.png 'Code Smell')](https://sonarcloud.io/project/issues?id=hyperledger_besu&pullRequest=3039&resolved=false&types=CODE_SMELL) [![A](https://sonarsource.github.io/sonarcloud-github-static-resources/v2/checks/RatingBadge/A-16px.png 'A')](https://sonarcloud.io/project/issues?id=hyperledger_besu&pullRequest=3039&resolved=false&types=CODE_SMELL) [0 Code Smells](https://sonarcloud.io/project/issues?id=hyperledger_besu&pullRequest=3039&resolved=false&types=CODE_SMELL)\n\n[![80.0%](https://sonarsource.github.io/sonarcloud-github-static-resources/v2/checks/CoverageChart/60-16px.png '80.0%')](https://sonarcloud.io/component_measures?id=hyperledger_besu&pullRequest=3039&metric=new_coverage&view=list) [80.0% Coverage](https://sonarcloud.io/component_measures?id=hyperledger_besu&pullRequest=3039&metric=new_coverage&view=list)  \n[![66.7%](https://sonarsource.github.io/sonarcloud-github-static-resources/v2/checks/Duplications/20plus-16px.png '66.7%')](https://sonarcloud.io/component_measures?id=hyperledger_besu&pullRequest=3039&metric=new_duplicated_lines_density&view=list) [66.7% Duplication](https://sonarcloud.io/component_measures?id=hyperledger_besu&pullRequest=3039&metric=new_duplicated_lines_density&view=list)\n\n"
    ]
  },
  "Bug Filter": "Defect Remediation & Feature Upgrades",
  "Bug Filter Confidence": 0.9,
  "Bug Filter Response": "**Final Classification:** Defect Remediation & Feature Upgrades; **Confidence:** 0.9"
}