{
  "cve_id": "CVE-2020-14147",
  "cwe_ids": [
    "CWE-190",
    "CWE-787"
  ],
  "cvss_vector": "AV:N/AC:L/Au:S/C:N/I:N/A:P",
  "cvss_is_v3": false,
  "repo_name": "redis",
  "commit_msg": "[FIX] revisit CVE-2015-8080 vulnerability",
  "commit_hash": "ef764dde1cca2f25d00686673d1bc89448819571",
  "git_url": "https://github.com/redis/redis/commit/ef764dde1cca2f25d00686673d1bc89448819571",
  "file_path": "deps/lua/src/lua_struct.c",
  "func_name": "controloptions",
  "func_before": "static void controloptions (lua_State *L, int opt, const char **fmt,\n                            Header *h) {\n  switch (opt) {\n    case  ' ': return;  /* ignore white spaces */\n    case '>': h->endian = BIG; return;\n    case '<': h->endian = LITTLE; return;\n    case '!': {\n      int a = getnum(fmt, MAXALIGN);\n      if (!isp2(a))\n        luaL_error(L, \"alignment %d is not a power of 2\", a);\n      h->align = a;\n      return;\n    }\n    default: {\n      const char *msg = lua_pushfstring(L, \"invalid format option '%c'\", opt);\n      luaL_argerror(L, 1, msg);\n    }\n  }\n}",
  "abstract_func_before": "static void controloptions (lua_State *VAR_0, int VAR_1, const char **VAR_2,\n                            Header *VAR_3) {\n  switch (VAR_1) {\n    case  ' ': return;  /* COMMENT_0 */\n    case '>': VAR_3->endian = VAR_4; return;\n    case '<': VAR_3->endian = VAR_5; return;\n    case '!': {\n      int VAR_6 = getnum(VAR_2, VAR_7);\n      if (!isp2(VAR_6))\n        luaL_error(VAR_0, \"alignment %d is not a power of 2\", VAR_6);\n      VAR_3->align = VAR_6;\n      return;\n    }\n    default: {\n      const char *VAR_8 = lua_pushfstring(VAR_0, \"invalid format option '%c'\", VAR_1);\n      luaL_argerror(VAR_0, 1, VAR_8);\n    }\n  }\n}",
  "func_graph_path_before": "redis/ef764dde1cca2f25d00686673d1bc89448819571/lua_struct.c/vul/before/2.json",
  "func": "static void controloptions (lua_State *L, int opt, const char **fmt,\n                            Header *h) {\n  switch (opt) {\n    case  ' ': return;  /* ignore white spaces */\n    case '>': h->endian = BIG; return;\n    case '<': h->endian = LITTLE; return;\n    case '!': {\n      int a = getnum(L, fmt, MAXALIGN);\n      if (!isp2(a))\n        luaL_error(L, \"alignment %d is not a power of 2\", a);\n      h->align = a;\n      return;\n    }\n    default: {\n      const char *msg = lua_pushfstring(L, \"invalid format option '%c'\", opt);\n      luaL_argerror(L, 1, msg);\n    }\n  }\n}",
  "abstract_func": "static void controloptions (lua_State *VAR_0, int VAR_1, const char **VAR_2,\n                            Header *VAR_3) {\n  switch (VAR_1) {\n    case  ' ': return;  /* COMMENT_0 */\n    case '>': VAR_3->endian = VAR_4; return;\n    case '<': VAR_3->endian = VAR_5; return;\n    case '!': {\n      int VAR_6 = getnum(VAR_0, VAR_2, VAR_7);\n      if (!isp2(VAR_6))\n        luaL_error(VAR_0, \"alignment %d is not a power of 2\", VAR_6);\n      VAR_3->align = VAR_6;\n      return;\n    }\n    default: {\n      const char *VAR_8 = lua_pushfstring(VAR_0, \"invalid format option '%c'\", VAR_1);\n      luaL_argerror(VAR_0, 1, VAR_8);\n    }\n  }\n}",
  "func_graph_path": "redis/ef764dde1cca2f25d00686673d1bc89448819571/lua_struct.c/vul/after/2.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -5,7 +5,7 @@\n     case '>': h->endian = BIG; return;\n     case '<': h->endian = LITTLE; return;\n     case '!': {\n-      int a = getnum(fmt, MAXALIGN);\n+      int a = getnum(L, fmt, MAXALIGN);\n       if (!isp2(a))\n         luaL_error(L, \"alignment %d is not a power of 2\", a);\n       h->align = a;",
  "diff_line_info": {
    "deleted_lines": [
      "      int a = getnum(fmt, MAXALIGN);"
    ],
    "added_lines": [
      "      int a = getnum(L, fmt, MAXALIGN);"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/redis/redis/pull/6875",
  "description": {
    "pr_info": {
      "title": "[FIX] revisit CVE-2015-8080 vulnerability",
      "number": 6875
    },
    "comment": [
      "Hi,\r\n\r\nWe discovered that the CVE-2015-8080 vulnerability revisited in the latest version of Redis (5.0.7).\r\n - Initial issue number: **#2855**\r\n - Initial fix commit: **3a47c8cfb85af1b69cccf30eaaa690e4a23ab20a** (Dec. 2015)\r\n\r\nThe vulnerability is from the Lua source code that you already patched in Dec. 2015. \r\nHowever, as a result of the Lua update in May 2018 (commit: 1eb08bcd4634ae42ec45e8284923ac048beaa4c3), the vulnerability patch was removed during the update process.\r\n\r\nAs a result, we successfully reproduce the vulnerability in the latest stable version of Redis using simple PoC provided in issue #2855.\r\n\r\nPlease reflect it after confirmation.\r\nThank you.",
      "Thanks! I'm backporting the fix in the Redis 5 branch."
    ]
  },
  "Bug Filter": "Security Vulnerability Fix",
  "Bug Filter Confidence": 0.98,
  "Bug Filter Response": "**Final Classification:** Security Vulnerability Fix; **Confidence:** 0.98"
}