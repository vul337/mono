{
  "cve_id": "CVE-2013-4119",
  "cwe_ids": [
    "CWE-476"
  ],
  "cvss_vector": "AV:N/AC:L/Au:N/C:N/I:N/A:P",
  "cvss_is_v3": false,
  "repo_name": "FreeRDP",
  "commit_msg": "nla: invalidate sec handle after creation\n\nIf sec pointer isn't invalidated after creation it is not possible\nto check if the upper and lower pointers are valid.\n\nThis fixes a segfault in the server part if the client disconnects before\nthe authentication was finished.",
  "commit_hash": "0773bb9303d24473fe1185d85a424dfe159aff53",
  "git_url": "https://github.com/FreeRDP/FreeRDP/commit/0773bb9303d24473fe1185d85a424dfe159aff53",
  "file_path": "libfreerdp/core/transport.c",
  "func_name": "transport_connect_nla",
  "func_before": "BOOL transport_connect_nla(rdpTransport* transport)\n{\n\tfreerdp* instance;\n\trdpSettings* settings;\n\n\tif (transport->layer == TRANSPORT_LAYER_TSG)\n\t\treturn TRUE;\n\n\tif (!transport_connect_tls(transport))\n\t\treturn FALSE;\n\n\t/* Network Level Authentication */\n\n\tif (transport->settings->Authentication != TRUE)\n\t\treturn TRUE;\n\n\tsettings = transport->settings;\n\tinstance = (freerdp*) settings->instance;\n\n\tif (transport->credssp == NULL)\n\t\ttransport->credssp = credssp_new(instance, transport, settings);\n\n\tif (credssp_authenticate(transport->credssp) < 0)\n\t{\n\t\tif (!connectErrorCode)\n\t\t\tconnectErrorCode = AUTHENTICATIONERROR;\n\n\t\tfprintf(stderr, \"Authentication failure, check credentials.\\n\"\n\t\t\t\"If credentials are valid, the NTLMSSP implementation may be to blame.\\n\");\n\n\t\tcredssp_free(transport->credssp);\n\t\treturn FALSE;\n\t}\n\n\tcredssp_free(transport->credssp);\n\n\treturn TRUE;\n}",
  "abstract_func_before": "BOOL transport_connect_nla(rdpTransport* VAR_0)\n{\n\tfreerdp* VAR_1;\n\trdpSettings* VAR_2;\n\n\tif (VAR_0->layer == VAR_3)\n\t\treturn TRUE;\n\n\tif (!transport_connect_tls(VAR_0))\n\t\treturn FALSE;\n\n\t/* COMMENT_0 */\n\n\tif (VAR_0->settings->Authentication != TRUE)\n\t\treturn TRUE;\n\n\tVAR_2 = VAR_0->settings;\n\tVAR_1 = (freerdp*) VAR_2->instance;\n\n\tif (VAR_0->credssp == NULL)\n\t\tVAR_0->credssp = credssp_new(VAR_1, VAR_0, VAR_2);\n\n\tif (credssp_authenticate(VAR_0->credssp) < 0)\n\t{\n\t\tif (!VAR_4)\n\t\t\tVAR_4 = VAR_5;\n\n\t\tfprintf(VAR_6, \"Authentication failure, check credentials.\\n\"\n\t\t\t\"If credentials are valid, the NTLMSSP implementation may be to blame.\\n\");\n\n\t\tcredssp_free(VAR_0->credssp);\n\t\treturn FALSE;\n\t}\n\n\tcredssp_free(VAR_0->credssp);\n\n\treturn TRUE;\n}",
  "func_graph_path_before": "FreeRDP/0773bb9303d24473fe1185d85a424dfe159aff53/transport.c/vul/before/0.json",
  "func": "BOOL transport_connect_nla(rdpTransport* transport)\n{\n\tfreerdp* instance;\n\trdpSettings* settings;\n\n\tif (transport->layer == TRANSPORT_LAYER_TSG)\n\t\treturn TRUE;\n\n\tif (!transport_connect_tls(transport))\n\t\treturn FALSE;\n\n\t/* Network Level Authentication */\n\n\tif (transport->settings->Authentication != TRUE)\n\t\treturn TRUE;\n\n\tsettings = transport->settings;\n\tinstance = (freerdp*) settings->instance;\n\n\tif (transport->credssp == NULL)\n\t\ttransport->credssp = credssp_new(instance, transport, settings);\n\n\tif (credssp_authenticate(transport->credssp) < 0)\n\t{\n\t\tif (!connectErrorCode)\n\t\t\tconnectErrorCode = AUTHENTICATIONERROR;\n\n\t\tfprintf(stderr, \"Authentication failure, check credentials.\\n\"\n\t\t\t\"If credentials are valid, the NTLMSSP implementation may be to blame.\\n\");\n\n\t\tcredssp_free(transport->credssp);\n\t\ttransport->credssp = NULL;\n\t\treturn FALSE;\n\t}\n\n\tcredssp_free(transport->credssp);\n\n\treturn TRUE;\n}",
  "abstract_func": "BOOL transport_connect_nla(rdpTransport* VAR_0)\n{\n\tfreerdp* VAR_1;\n\trdpSettings* VAR_2;\n\n\tif (VAR_0->layer == VAR_3)\n\t\treturn TRUE;\n\n\tif (!transport_connect_tls(VAR_0))\n\t\treturn FALSE;\n\n\t/* COMMENT_0 */\n\n\tif (VAR_0->settings->Authentication != TRUE)\n\t\treturn TRUE;\n\n\tVAR_2 = VAR_0->settings;\n\tVAR_1 = (freerdp*) VAR_2->instance;\n\n\tif (VAR_0->credssp == NULL)\n\t\tVAR_0->credssp = credssp_new(VAR_1, VAR_0, VAR_2);\n\n\tif (credssp_authenticate(VAR_0->credssp) < 0)\n\t{\n\t\tif (!VAR_4)\n\t\t\tVAR_4 = VAR_5;\n\n\t\tfprintf(VAR_6, \"Authentication failure, check credentials.\\n\"\n\t\t\t\"If credentials are valid, the NTLMSSP implementation may be to blame.\\n\");\n\n\t\tcredssp_free(VAR_0->credssp);\n\t\tVAR_0->credssp = NULL;\n\t\treturn FALSE;\n\t}\n\n\tcredssp_free(VAR_0->credssp);\n\n\treturn TRUE;\n}",
  "func_graph_path": "FreeRDP/0773bb9303d24473fe1185d85a424dfe159aff53/transport.c/vul/after/0.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -29,6 +29,7 @@\n \t\t\t\"If credentials are valid, the NTLMSSP implementation may be to blame.\\n\");\n \n \t\tcredssp_free(transport->credssp);\n+\t\ttransport->credssp = NULL;\n \t\treturn FALSE;\n \t}\n ",
  "diff_line_info": {
    "deleted_lines": [],
    "added_lines": [
      "\t\ttransport->credssp = NULL;"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/FreeRDP/FreeRDP/pull/1330",
  "description": "Failed to get PR details: HTTP Request Error for PR https://github.com/FreeRDP/FreeRDP/pull/1330: 403 Client Error: Forbidden for url: https://api.github.com/repos/FreeRDP/FreeRDP/pulls/1330",
  "Bug Filter": "Security Vulnerability Fix",
  "Bug Filter Confidence": 0.91,
  "Bug Filter Response": "**Final Classification:** Security Vulnerability Fix  \n**Confidence:** 0.91"
}