{
  "cve_id": "CVE-2022-22892",
  "cwe_ids": [
    "CWE-617"
  ],
  "cvss_vector": "AV:N/AC:M/Au:N/C:N/I:N/A:P",
  "cvss_is_v3": false,
  "repo_name": "jerryscript-project/jerryscript",
  "commit_msg": "Fix arrow function this binding resolving if environment record is present\n\nThis patch fixes #4872 and fixes #4876.\n\nJerryScript-DCO-1.0-Signed-off-by: Robert Fancsik robert.fancsik@h-lab.eu",
  "commit_hash": "c6aab480c1e2d968871028aec53c85ac5566b34a",
  "git_url": "https://github.com/jerryscript-project/jerryscript/commit/c6aab480c1e2d968871028aec53c85ac5566b34a",
  "file_path": "jerry-core/ecma/operations/ecma-lex-env.c",
  "func_name": "ecma_op_get_environment_record",
  "func_before": "ecma_environment_record_t *\necma_op_get_environment_record (ecma_object_t *lex_env_p) /**< lexical environment */\n{\n  JERRY_ASSERT (lex_env_p != NULL);\n\n  ecma_string_t *property_name_p = ecma_get_internal_string (LIT_INTERNAL_MAGIC_STRING_ENVIRONMENT_RECORD);\n  while (true)\n  {\n    if (ecma_get_lex_env_type (lex_env_p) == ECMA_LEXICAL_ENVIRONMENT_DECLARATIVE)\n    {\n      ecma_property_t *property_p = ecma_find_named_property (lex_env_p, property_name_p);\n\n      if (property_p != NULL)\n      {\n        ecma_property_value_t *property_value_p = ECMA_PROPERTY_VALUE_PTR (property_p);\n        return ECMA_GET_INTERNAL_VALUE_POINTER (ecma_environment_record_t, property_value_p->value);\n      }\n    }\n\n    JERRY_ASSERT (lex_env_p->u2.outer_reference_cp != JMEM_CP_NULL);\n    lex_env_p = ECMA_GET_NON_NULL_POINTER (ecma_object_t, lex_env_p->u2.outer_reference_cp);\n  }\n}",
  "abstract_func_before": "ecma_environment_record_t *\necma_op_get_environment_record (ecma_object_t *VAR_0) /* COMMENT_0 */\n{\n  JERRY_ASSERT (VAR_0 != NULL);\n\n  ecma_string_t *VAR_1 = ecma_get_internal_string (VAR_2);\n  while (true)\n  {\n    if (ecma_get_lex_env_type (VAR_0) == VAR_3)\n    {\n      ecma_property_t *VAR_4 = ecma_find_named_property (VAR_0, VAR_1);\n\n      if (VAR_4 != NULL)\n      {\n        ecma_property_value_t *VAR_5 = ECMA_PROPERTY_VALUE_PTR (VAR_4);\n        return ECMA_GET_INTERNAL_VALUE_POINTER (ecma_environment_record_t, VAR_5->value);\n      }\n    }\n\n    JERRY_ASSERT (VAR_0->u2.outer_reference_cp != VAR_6);\n    VAR_0 = ECMA_GET_NON_NULL_POINTER (ecma_object_t, VAR_0->u2.outer_reference_cp);\n  }\n}",
  "func_graph_path_before": "jerryscript-project/jerryscript/c6aab480c1e2d968871028aec53c85ac5566b34a/ecma-lex-env.c/vul/before/0.json",
  "func": "ecma_environment_record_t *\necma_op_get_environment_record (ecma_object_t *lex_env_p) /**< lexical environment */\n{\n  JERRY_ASSERT (lex_env_p != NULL);\n\n  ecma_string_t *property_name_p = ecma_get_internal_string (LIT_INTERNAL_MAGIC_STRING_ENVIRONMENT_RECORD);\n  while (true)\n  {\n    if (ecma_get_lex_env_type (lex_env_p) == ECMA_LEXICAL_ENVIRONMENT_DECLARATIVE)\n    {\n      ecma_property_t *property_p = ecma_find_named_property (lex_env_p, property_name_p);\n\n      if (property_p != NULL)\n      {\n        ecma_property_value_t *property_value_p = ECMA_PROPERTY_VALUE_PTR (property_p);\n        return ECMA_GET_INTERNAL_VALUE_POINTER (ecma_environment_record_t, property_value_p->value);\n      }\n    }\n\n    if (lex_env_p->u2.outer_reference_cp == JMEM_CP_NULL)\n    {\n      break;\n    }\n\n    lex_env_p = ECMA_GET_NON_NULL_POINTER (ecma_object_t, lex_env_p->u2.outer_reference_cp);\n  }\n\n  return NULL;\n}",
  "abstract_func": "ecma_environment_record_t *\necma_op_get_environment_record (ecma_object_t *VAR_0) /* COMMENT_0 */\n{\n  JERRY_ASSERT (VAR_0 != NULL);\n\n  ecma_string_t *VAR_1 = ecma_get_internal_string (VAR_2);\n  while (true)\n  {\n    if (ecma_get_lex_env_type (VAR_0) == VAR_3)\n    {\n      ecma_property_t *VAR_4 = ecma_find_named_property (VAR_0, VAR_1);\n\n      if (VAR_4 != NULL)\n      {\n        ecma_property_value_t *VAR_5 = ECMA_PROPERTY_VALUE_PTR (VAR_4);\n        return ECMA_GET_INTERNAL_VALUE_POINTER (ecma_environment_record_t, VAR_5->value);\n      }\n    }\n\n    if (VAR_0->u2.outer_reference_cp == VAR_6)\n    {\n      break;\n    }\n\n    VAR_0 = ECMA_GET_NON_NULL_POINTER (ecma_object_t, VAR_0->u2.outer_reference_cp);\n  }\n\n  return NULL;\n}",
  "func_graph_path": "jerryscript-project/jerryscript/c6aab480c1e2d968871028aec53c85ac5566b34a/ecma-lex-env.c/vul/after/0.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -17,7 +17,13 @@\n       }\n     }\n \n-    JERRY_ASSERT (lex_env_p->u2.outer_reference_cp != JMEM_CP_NULL);\n+    if (lex_env_p->u2.outer_reference_cp == JMEM_CP_NULL)\n+    {\n+      break;\n+    }\n+\n     lex_env_p = ECMA_GET_NON_NULL_POINTER (ecma_object_t, lex_env_p->u2.outer_reference_cp);\n   }\n+\n+  return NULL;\n }",
  "diff_line_info": {
    "deleted_lines": [
      "    JERRY_ASSERT (lex_env_p->u2.outer_reference_cp != JMEM_CP_NULL);"
    ],
    "added_lines": [
      "    if (lex_env_p->u2.outer_reference_cp == JMEM_CP_NULL)",
      "    {",
      "      break;",
      "    }",
      "",
      "",
      "  return NULL;"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/jerryscript-project/jerryscript/pull/4878",
  "description": "Failed to get PR details: HTTP Request Error for PR https://github.com/jerryscript-project/jerryscript/pull/4878: 403 Client Error: Forbidden for url: https://api.github.com/repos/jerryscript-project/jerryscript/pulls/4878",
  "Bug Filter": "Defect Remediation & Feature Upgrades",
  "Bug Filter Confidence": 0.9,
  "Bug Filter Response": "**Final Classification:** Defect Remediation & Feature Upgrades  \n**Confidence:** 0.9"
}