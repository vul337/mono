{
  "cve_id": "CVE-2021-25939",
  "cwe_ids": [
    "CWE-918"
  ],
  "cvss_vector": "AV:N/AC:L/Au:S/C:N/I:P/A:N",
  "cvss_is_v3": false,
  "repo_name": "arangodb",
  "commit_msg": "[APM-78] Disable installation from remote URL (#15292) (#15343)\n\n* [APM-78] Disable installation from remote URL (#15292)\r\n\r\n* Update CHANGELOG\r\n\r\n* Fix clang-format\r\n\r\nCo-authored-by: Vadim <vadim@arangodb.com>",
  "commit_hash": "d7b35a6884c6b2802d34d79fb2a79fb2c9ec2175",
  "git_url": "https://github.com/arangodb/arangodb/commit/d7b35a6884c6b2802d34d79fb2a79fb2c9ec2175",
  "file_path": "arangod/GeneralServer/ServerSecurityFeature.cpp",
  "func_name": "ServerSecurityFeature::collectOptions",
  "func_before": "void ServerSecurityFeature::collectOptions(\n    std::shared_ptr<ProgramOptions> options) {\n  options\n      ->addOption(\n          \"--server.harden\",\n          \"lock down REST APIs that reveal version information or server \"\n          \"internals for non-admin users\",\n          new BooleanParameter(&_hardenedRestApi))\n      .setIntroducedIn(30500);\n\n  options\n      ->addOption(\"--foxx.api\", \"enables Foxx management REST APIs\",\n                  new BooleanParameter(&_enableFoxxApi),\n                  arangodb::options::makeFlags(\n                      arangodb::options::Flags::DefaultNoComponents,\n                      arangodb::options::Flags::OnCoordinator,\n                      arangodb::options::Flags::OnSingle))\n      .setIntroducedIn(30500);\n  options\n      ->addOption(\"--foxx.store\", \"enables Foxx store in web interface\",\n                  new BooleanParameter(&_enableFoxxStore),\n                  arangodb::options::makeFlags(\n                      arangodb::options::Flags::DefaultNoComponents,\n                      arangodb::options::Flags::OnCoordinator,\n                      arangodb::options::Flags::OnSingle))\n      .setIntroducedIn(30500);\n}",
  "abstract_func_before": "void ServerSecurityFeature::collectOptions(\n    std::shared_ptr<ProgramOptions> VAR_0) {\n  VAR_0\n      ->addOption(\n          \"--server.harden\",\n          \"lock down REST APIs that reveal version information or server \"\n          \"internals for non-admin users\",\n          new BooleanParameter(&VAR_1))\n      .setIntroducedIn(30500);\n\n  VAR_0\n      ->addOption(\"--foxx.api\", \"enables Foxx management REST APIs\",\n                  new BooleanParameter(&VAR_2),\n                  arangodb::options::makeFlags(\n                      arangodb::options::Flags::DefaultNoComponents,\n                      arangodb::options::Flags::OnCoordinator,\n                      arangodb::options::Flags::OnSingle))\n      .setIntroducedIn(30500);\n  VAR_0\n      ->addOption(\"--foxx.store\", \"enables Foxx store in web interface\",\n                  new BooleanParameter(&VAR_3),\n                  arangodb::options::makeFlags(\n                      arangodb::options::Flags::DefaultNoComponents,\n                      arangodb::options::Flags::OnCoordinator,\n                      arangodb::options::Flags::OnSingle))\n      .setIntroducedIn(30500);\n}",
  "func_graph_path_before": "arangodb/d7b35a6884c6b2802d34d79fb2a79fb2c9ec2175/ServerSecurityFeature.cpp/vul/before/0.json",
  "func": "void ServerSecurityFeature::collectOptions(\n    std::shared_ptr<ProgramOptions> options) {\n  options\n      ->addOption(\n          \"--server.harden\",\n          \"lock down REST APIs that reveal version information or server \"\n          \"internals for non-admin users\",\n          new BooleanParameter(&_hardenedRestApi))\n      .setIntroducedIn(30500);\n\n  options\n      ->addOption(\"--foxx.api\", \"enables Foxx management REST APIs\",\n                  new BooleanParameter(&_enableFoxxApi),\n                  arangodb::options::makeFlags(\n                      arangodb::options::Flags::DefaultNoComponents,\n                      arangodb::options::Flags::OnCoordinator,\n                      arangodb::options::Flags::OnSingle))\n      .setIntroducedIn(30500);\n  options\n      ->addOption(\"--foxx.store\", \"enables Foxx store in web interface\",\n                  new BooleanParameter(&_enableFoxxStore),\n                  arangodb::options::makeFlags(\n                      arangodb::options::Flags::DefaultNoComponents,\n                      arangodb::options::Flags::OnCoordinator,\n                      arangodb::options::Flags::OnSingle))\n      .setIntroducedIn(30500);\n  options\n      ->addOption(\n          \"--foxx.allow-install-from-remote\",\n          \"allow installing Foxx apps from remote URLs other than Github\",\n          new BooleanParameter(&_foxxAllowInstallFromRemote),\n          arangodb::options::makeFlags(\n              arangodb::options::Flags::DefaultNoComponents,\n              arangodb::options::Flags::OnCoordinator,\n              arangodb::options::Flags::OnSingle))\n      .setIntroducedIn(30805);\n}",
  "abstract_func": "void ServerSecurityFeature::collectOptions(\n    std::shared_ptr<ProgramOptions> VAR_0) {\n  VAR_0\n      ->addOption(\n          \"--server.harden\",\n          \"lock down REST APIs that reveal version information or server \"\n          \"internals for non-admin users\",\n          new BooleanParameter(&VAR_1))\n      .setIntroducedIn(30500);\n\n  VAR_0\n      ->addOption(\"--foxx.api\", \"enables Foxx management REST APIs\",\n                  new BooleanParameter(&VAR_2),\n                  arangodb::options::makeFlags(\n                      arangodb::options::Flags::DefaultNoComponents,\n                      arangodb::options::Flags::OnCoordinator,\n                      arangodb::options::Flags::OnSingle))\n      .setIntroducedIn(30500);\n  VAR_0\n      ->addOption(\"--foxx.store\", \"enables Foxx store in web interface\",\n                  new BooleanParameter(&VAR_3),\n                  arangodb::options::makeFlags(\n                      arangodb::options::Flags::DefaultNoComponents,\n                      arangodb::options::Flags::OnCoordinator,\n                      arangodb::options::Flags::OnSingle))\n      .setIntroducedIn(30500);\n  VAR_0\n      ->addOption(\n          \"--foxx.allow-install-from-remote\",\n          \"allow installing Foxx apps from remote URLs other than Github\",\n          new BooleanParameter(&VAR_4),\n          arangodb::options::makeFlags(\n              arangodb::options::Flags::DefaultNoComponents,\n              arangodb::options::Flags::OnCoordinator,\n              arangodb::options::Flags::OnSingle))\n      .setIntroducedIn(30805);\n}",
  "func_graph_path": "arangodb/d7b35a6884c6b2802d34d79fb2a79fb2c9ec2175/ServerSecurityFeature.cpp/vul/after/0.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -24,4 +24,14 @@\n                       arangodb::options::Flags::OnCoordinator,\n                       arangodb::options::Flags::OnSingle))\n       .setIntroducedIn(30500);\n+  options\n+      ->addOption(\n+          \"--foxx.allow-install-from-remote\",\n+          \"allow installing Foxx apps from remote URLs other than Github\",\n+          new BooleanParameter(&_foxxAllowInstallFromRemote),\n+          arangodb::options::makeFlags(\n+              arangodb::options::Flags::DefaultNoComponents,\n+              arangodb::options::Flags::OnCoordinator,\n+              arangodb::options::Flags::OnSingle))\n+      .setIntroducedIn(30805);\n }",
  "diff_line_info": {
    "deleted_lines": [],
    "added_lines": [
      "  options",
      "      ->addOption(",
      "          \"--foxx.allow-install-from-remote\",",
      "          \"allow installing Foxx apps from remote URLs other than Github\",",
      "          new BooleanParameter(&_foxxAllowInstallFromRemote),",
      "          arangodb::options::makeFlags(",
      "              arangodb::options::Flags::DefaultNoComponents,",
      "              arangodb::options::Flags::OnCoordinator,",
      "              arangodb::options::Flags::OnSingle))",
      "      .setIntroducedIn(30805);"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/arangodb/arangodb/pull/15343",
  "description": {
    "pr_info": {
      "title": "[APM-78] Disable installation from remote URL (#15292)",
      "number": 15343
    },
    "comment": [
      "### Scope & Purpose\r\n\r\nBackport of https://github.com/arangodb/arangodb/pull/15292\r\n\r\nhttps://arangodb.atlassian.net/browse/APM-78\r\n\r\nDocs PR: https://github.com/arangodb/docs/pull/838\r\nDisable installation of Foxx apps from remote URLs by default.\r\nThis is a potential security issue and is now an opt-in functionality.\r\n\r\nThe new startup option `--foxx.allow-install-from-remote` can be used to toggle whether installing Foxx apps from remote URLs other than Github is allowed. The option is turned off by default. If it is disabled, the web UI will not offer the \"Remote\" tab for installing Foxx services.\r\n\r\n- [x] :hankey: Bugfix (requires CHANGELOG entry)\r\n- [ ] :pizza: New feature (requires CHANGELOG entry, feature documentation and release notes)\r\n- [ ] :fire: Performance improvement\r\n- [ ] :hammer: Refactoring/simplification\r\n- [x] :book: CHANGELOG entry made\r\n\r\n#### Backports:\r\n\r\n- [x] Backport for 3.8: https://github.com/arangodb/arangodb/pull/15344\r\n\r\n#### Related Information\r\n\r\n- [x] Docs PR: https://github.com/arangodb/docs/pull/838\r\n\r\n### Testing & Verification\r\n\r\n- [x] The behavior in this PR was *manually tested*\r\n- [ ] This change is already covered by existing tests, such as *(please describe tests)*.\r\n- [x] This PR adds tests that were used to verify all changes:\r\n  - [x] Added new **integration tests** (server_parameters)\r\n",
      "Tests blue"
    ]
  },
  "Bug Filter": "Security Vulnerability Fix",
  "Bug Filter Confidence": 0.9,
  "Bug Filter Response": "**Final Classification:** Security Vulnerability Fix  \n**Confidence:** 0.9"
}