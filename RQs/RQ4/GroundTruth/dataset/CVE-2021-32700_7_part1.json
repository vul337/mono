{
  "cve_id": "CVE-2021-32700",
  "cwe_ids": [
    "CWE-306"
  ],
  "cvss_vector": "AV:N/AC:M/Au:N/C:P/I:P/A:N",
  "cvss_is_v3": false,
  "repo_name": "ballerina-platform/ballerina-lang",
  "commit_msg": "Fix central connection",
  "commit_hash": "4609ffee1744ecd16aac09303b1783bf0a525816",
  "git_url": "https://github.com/ballerina-platform/ballerina-lang/commit/4609ffee1744ecd16aac09303b1783bf0a525816",
  "file_path": "cli/ballerina-cli-module/src/main/java/org/ballerinalang/cli/module/Pull.java",
  "func_name": "createBaloInHomeRepo",
  "func_before": "private static void createBaloInHomeRepo(HttpURLConnection conn, String modulePathInBaloCache,\n            String moduleNameWithOrg, boolean isNightlyBuild, String newUrl, String contentDisposition) {\n        long responseContentLength = conn.getContentLengthLong();\n        if (responseContentLength <= 0) {\n            createError(\"invalid response from the server, please try again\");\n        }\n        String resolvedURI = conn.getHeaderField(RESOLVED_REQUESTED_URI);\n        if (resolvedURI == null || resolvedURI.equals(\"\")) {\n            resolvedURI = newUrl;\n        }\n        String[] uriParts = resolvedURI.split(\"/\");\n        String moduleVersion = uriParts[uriParts.length - 3];\n\n        validateModuleVersion(moduleVersion);\n        String baloFile = getBaloFileName(contentDisposition, uriParts[uriParts.length - 1]);\n        Path baloCacheWithModulePath = Paths.get(modulePathInBaloCache, moduleVersion);\n        //<user.home>.ballerina/balo_cache/<org-name>/<module-name>/<module-version>\n\n        Path baloPath = Paths.get(baloCacheWithModulePath.toString(), baloFile);\n        if (baloPath.toFile().exists()) {\n            createError(\"module already exists in the home repository: \" + baloPath.toString());\n        }\n\n        createBaloFileDirectory(baloCacheWithModulePath);\n        writeBaloFile(conn, baloPath, moduleNameWithOrg + \":\" + moduleVersion, responseContentLength);\n        handleNightlyBuild(isNightlyBuild, baloCacheWithModulePath);\n    }",
  "abstract_func_before": "private static void createBaloInHomeRepo(HttpURLConnection VAR_0, String VAR_1,\n            String VAR_2, boolean VAR_3, String VAR_4, String VAR_5) {\n        long VAR_6 = VAR_0.getContentLengthLong();\n        if (VAR_6 <= 0) {\n            createError(\"invalid response from the server, please try again\");\n        }\n        String VAR_7 = VAR_0.getHeaderField(VAR_8);\n        if (VAR_7 == null || VAR_7.equals(\"\")) {\n            VAR_7 = VAR_4;\n        }\n        String[] VAR_9 = VAR_7.split(\"/\");\n        String VAR_10 = VAR_9[VAR_9.length - 3];\n\n        validateModuleVersion(VAR_10);\n        String VAR_11 = getBaloFileName(VAR_5, VAR_9[VAR_9.length - 1]);\n        Path VAR_12 = VAR_13.get(VAR_1, VAR_10);\n        /* COMMENT_0 */\n\n        Path VAR_14 = VAR_13.get(VAR_12.toString(), VAR_11);\n        if (VAR_14.toFile().exists()) {\n            createError(\"module already exists in the home repository: \" + VAR_14.toString());\n        }\n\n        createBaloFileDirectory(VAR_12);\n        writeBaloFile(VAR_0, VAR_14, VAR_2 + \":\" + VAR_10, VAR_6);\n        handleNightlyBuild(VAR_3, VAR_12);\n    }",
  "func_graph_path_before": "ballerina-platform/ballerina-lang/4609ffee1744ecd16aac09303b1783bf0a525816/Pull.java/vul/before/2.json",
  "func": "private static void createBaloInHomeRepo(HttpsURLConnection conn, String modulePathInBaloCache,\n            String moduleNameWithOrg, boolean isNightlyBuild, String newUrl, String contentDisposition) {\n        long responseContentLength = conn.getContentLengthLong();\n        if (responseContentLength <= 0) {\n            createError(\"invalid response from the server, please try again\");\n        }\n        String resolvedURI = conn.getHeaderField(RESOLVED_REQUESTED_URI);\n        if (resolvedURI == null || resolvedURI.equals(\"\")) {\n            resolvedURI = newUrl;\n        }\n        String[] uriParts = resolvedURI.split(\"/\");\n        String moduleVersion = uriParts[uriParts.length - 3];\n\n        validateModuleVersion(moduleVersion);\n        String baloFile = getBaloFileName(contentDisposition, uriParts[uriParts.length - 1]);\n        Path baloCacheWithModulePath = Paths.get(modulePathInBaloCache, moduleVersion);\n        //<user.home>.ballerina/balo_cache/<org-name>/<module-name>/<module-version>\n\n        Path baloPath = Paths.get(baloCacheWithModulePath.toString(), baloFile);\n        if (baloPath.toFile().exists()) {\n            createError(\"module already exists in the home repository: \" + baloPath.toString());\n        }\n\n        createBaloFileDirectory(baloCacheWithModulePath);\n        writeBaloFile(conn, baloPath, moduleNameWithOrg + \":\" + moduleVersion, responseContentLength);\n        handleNightlyBuild(isNightlyBuild, baloCacheWithModulePath);\n    }",
  "abstract_func": "private static void createBaloInHomeRepo(HttpsURLConnection VAR_0, String VAR_1,\n            String VAR_2, boolean VAR_3, String VAR_4, String VAR_5) {\n        long VAR_6 = VAR_0.getContentLengthLong();\n        if (VAR_6 <= 0) {\n            createError(\"invalid response from the server, please try again\");\n        }\n        String VAR_7 = VAR_0.getHeaderField(VAR_8);\n        if (VAR_7 == null || VAR_7.equals(\"\")) {\n            VAR_7 = VAR_4;\n        }\n        String[] VAR_9 = VAR_7.split(\"/\");\n        String VAR_10 = VAR_9[VAR_9.length - 3];\n\n        validateModuleVersion(VAR_10);\n        String VAR_11 = getBaloFileName(VAR_5, VAR_9[VAR_9.length - 1]);\n        Path VAR_12 = VAR_13.get(VAR_1, VAR_10);\n        /* COMMENT_0 */\n\n        Path VAR_14 = VAR_13.get(VAR_12.toString(), VAR_11);\n        if (VAR_14.toFile().exists()) {\n            createError(\"module already exists in the home repository: \" + VAR_14.toString());\n        }\n\n        createBaloFileDirectory(VAR_12);\n        writeBaloFile(VAR_0, VAR_14, VAR_2 + \":\" + VAR_10, VAR_6);\n        handleNightlyBuild(VAR_3, VAR_12);\n    }",
  "func_graph_path": "ballerina-platform/ballerina-lang/4609ffee1744ecd16aac09303b1783bf0a525816/Pull.java/vul/after/2.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -1,4 +1,4 @@\n-private static void createBaloInHomeRepo(HttpURLConnection conn, String modulePathInBaloCache,\n+private static void createBaloInHomeRepo(HttpsURLConnection conn, String modulePathInBaloCache,\n             String moduleNameWithOrg, boolean isNightlyBuild, String newUrl, String contentDisposition) {\n         long responseContentLength = conn.getContentLengthLong();\n         if (responseContentLength <= 0) {",
  "diff_line_info": {
    "deleted_lines": [
      "private static void createBaloInHomeRepo(HttpURLConnection conn, String modulePathInBaloCache,"
    ],
    "added_lines": [
      "private static void createBaloInHomeRepo(HttpsURLConnection conn, String modulePathInBaloCache,"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/29246",
  "description": "Failed to get PR details: HTTP Request Error for PR https://github.com/ballerina-platform/ballerina-lang/pull/29246: 403 Client Error: Forbidden for url: https://api.github.com/repos/ballerina-platform/ballerina-lang/pulls/29246",
  "Bug Filter": "Security Vulnerability Fix",
  "Bug Filter Confidence": 0.9,
  "Bug Filter Response": "**Final Classification:** Security Vulnerability Fix  \n**Confidence:** 0.9  \n\nThe patch changes `HttpURLConnection` to `HttpsURLConnection`, addressing a likely insecure communication vulnerability, despite the unclear commit message. This confidence score reflects the aligning change with security practices."
}