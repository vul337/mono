{
  "cve_id": "CVE-2020-24621",
  "cwe_ids": [
    "CWE-22"
  ],
  "cvss_vector": "AV:N/AC:L/Au:S/C:P/I:P/A:P",
  "cvss_is_v3": false,
  "repo_name": "openmrs/openmrs-module-uiframework",
  "commit_msg": "UIFR-215: Do not allow loading arbitrary files",
  "commit_hash": "0422fa52c7eba3d96cce2936cb92897dca4b680a",
  "git_url": "https://github.com/openmrs/openmrs-module-uiframework/commit/0422fa52c7eba3d96cce2936cb92897dca4b680a",
  "file_path": "api/src/main/java/org/openmrs/module/uiframework/UiFrameworkActivator.java",
  "func_name": "contextRefreshed",
  "func_before": "@Override\n\tpublic void contextRefreshed() {\n\t\tcontextLastRefreshedTime = System.currentTimeMillis();\n\n\t\t// START HACK\n\t\t// since we're not using a Listener anymore, these are not set at startup\n\t\ttry {\n\t\t\tClass<?> webConstants1x = Context.loadClass(\"org.openmrs.web.WebConstants\");\n\t\t\tString webappName = (String) webConstants1x.getField(\"WEBAPP_NAME\").get(null);\n\t\t\tWebConstants.CONTEXT_PATH = webappName;\n\t\t\tWebConstants.WEBAPP_NAME = webappName;\n\t\t} catch (Exception ex) {\n\t\t\tlog.error(\"Failed to get CONTEXT_PATH from WebConstants during UI Framework startup\");\n\t\t}\n\t\t// END HACK\n\t\t\n\t\tPageFactory pageFactory = getComponent(PageFactory.class);\n\t\tFragmentFactory fragmentFactory = getComponent(FragmentFactory.class);\n\t\tResourceFactory resourceFactory = getComponent(ResourceFactory.class);\n\n\t\t// Register a standard resource provider that can load file-based resources\n\t\tresourceFactory.addResourceProvider(FileResourceProvider.RESOURCE_KEY, new FileResourceProvider());\n\n\t\tList<UiContextRefreshedCallback> callbacks = Context.getRegisteredComponents(UiContextRefreshedCallback.class);\n\t\tfor (UiContextRefreshedCallback callback : callbacks) {\n\t\t\ttry {\n\t\t\t\tcallback.afterContextRefreshed(pageFactory, fragmentFactory, resourceFactory);\n\t\t\t}\n\t\t\tcatch (Exception ex) {\n\t\t\t\tlog.error(\"Error in UiContextRefreshedCallback: \" + callback, ex);\n\t\t\t}\n\t\t}\n\t}",
  "abstract_func_before": "@Override\n\tpublic void contextRefreshed() {\n\t\tVAR_0 = VAR_1.currentTimeMillis();\n\n\t\t/* COMMENT_0 */\n\t\t/* COMMENT_1 */\n\t\ttry {\n\t\t\tClass<?> VAR_2 = VAR_3.loadClass(\"org.openmrs.web.WebConstants\");\n\t\t\tString VAR_4 = (String) VAR_2.getField(\"WEBAPP_NAME\").get(null);\n\t\t\tVAR_5.CONTEXT_PATH = VAR_4;\n\t\t\tVAR_5.WEBAPP_NAME = VAR_4;\n\t\t} catch (Exception VAR_6) {\n\t\t\tVAR_7.error(\"Failed to get CONTEXT_PATH from WebConstants during UI Framework startup\");\n\t\t}\n\t\t/* COMMENT_2 */\n\t\t\n\t\tPageFactory VAR_8 = getComponent(PageFactory.class);\n\t\tFragmentFactory VAR_9 = getComponent(FragmentFactory.class);\n\t\tResourceFactory VAR_10 = getComponent(ResourceFactory.class);\n\n\t\t/* COMMENT_3 */\n\t\tVAR_10.addResourceProvider(VAR_11.RESOURCE_KEY, new FileResourceProvider());\n\n\t\tList<UiContextRefreshedCallback> VAR_12 = VAR_3.getRegisteredComponents(UiContextRefreshedCallback.class);\n\t\tfor (UiContextRefreshedCallback VAR_13 : VAR_12) {\n\t\t\ttry {\n\t\t\t\tVAR_13.afterContextRefreshed(VAR_8, VAR_9, VAR_10);\n\t\t\t}\n\t\t\tcatch (Exception VAR_6) {\n\t\t\t\tVAR_7.error(\"Error in UiContextRefreshedCallback: \" + VAR_13, VAR_6);\n\t\t\t}\n\t\t}\n\t}",
  "func_graph_path_before": "openmrs/openmrs-module-uiframework/0422fa52c7eba3d96cce2936cb92897dca4b680a/UiFrameworkActivator.java/vul/before/0.json",
  "func": "@Override\n\tpublic void contextRefreshed() {\n\t\tcontextLastRefreshedTime = System.currentTimeMillis();\n\n\t\t// START HACK\n\t\t// since we're not using a Listener anymore, these are not set at startup\n\t\ttry {\n\t\t\tClass<?> webConstants1x = Context.loadClass(\"org.openmrs.web.WebConstants\");\n\t\t\tString webappName = (String) webConstants1x.getField(\"WEBAPP_NAME\").get(null);\n\t\t\tWebConstants.CONTEXT_PATH = webappName;\n\t\t\tWebConstants.WEBAPP_NAME = webappName;\n\t\t} catch (Exception ex) {\n\t\t\tlog.error(\"Failed to get CONTEXT_PATH from WebConstants during UI Framework startup\");\n\t\t}\n\t\t// END HACK\n\t\t\n\t\tPageFactory pageFactory = getComponent(PageFactory.class);\n\t\tFragmentFactory fragmentFactory = getComponent(FragmentFactory.class);\n\t\tResourceFactory resourceFactory = getComponent(ResourceFactory.class);\n\n\t\t// Register a standard resource provider that can load file-based resources\n\t\tresourceFactory.addResourceProvider(ConfigurationResourceProvider.RESOURCE_KEY, new ConfigurationResourceProvider());\n\n\t\tList<UiContextRefreshedCallback> callbacks = Context.getRegisteredComponents(UiContextRefreshedCallback.class);\n\t\tfor (UiContextRefreshedCallback callback : callbacks) {\n\t\t\ttry {\n\t\t\t\tcallback.afterContextRefreshed(pageFactory, fragmentFactory, resourceFactory);\n\t\t\t}\n\t\t\tcatch (Exception ex) {\n\t\t\t\tlog.error(\"Error in UiContextRefreshedCallback: \" + callback, ex);\n\t\t\t}\n\t\t}\n\t}",
  "abstract_func": "@Override\n\tpublic void contextRefreshed() {\n\t\tVAR_0 = VAR_1.currentTimeMillis();\n\n\t\t/* COMMENT_0 */\n\t\t/* COMMENT_1 */\n\t\ttry {\n\t\t\tClass<?> VAR_2 = VAR_3.loadClass(\"org.openmrs.web.WebConstants\");\n\t\t\tString VAR_4 = (String) VAR_2.getField(\"WEBAPP_NAME\").get(null);\n\t\t\tVAR_5.CONTEXT_PATH = VAR_4;\n\t\t\tVAR_5.WEBAPP_NAME = VAR_4;\n\t\t} catch (Exception VAR_6) {\n\t\t\tVAR_7.error(\"Failed to get CONTEXT_PATH from WebConstants during UI Framework startup\");\n\t\t}\n\t\t/* COMMENT_2 */\n\t\t\n\t\tPageFactory VAR_8 = getComponent(PageFactory.class);\n\t\tFragmentFactory VAR_9 = getComponent(FragmentFactory.class);\n\t\tResourceFactory VAR_10 = getComponent(ResourceFactory.class);\n\n\t\t/* COMMENT_3 */\n\t\tVAR_10.addResourceProvider(VAR_11.RESOURCE_KEY, new ConfigurationResourceProvider());\n\n\t\tList<UiContextRefreshedCallback> VAR_12 = VAR_3.getRegisteredComponents(UiContextRefreshedCallback.class);\n\t\tfor (UiContextRefreshedCallback VAR_13 : VAR_12) {\n\t\t\ttry {\n\t\t\t\tVAR_13.afterContextRefreshed(VAR_8, VAR_9, VAR_10);\n\t\t\t}\n\t\t\tcatch (Exception VAR_6) {\n\t\t\t\tVAR_7.error(\"Error in UiContextRefreshedCallback: \" + VAR_13, VAR_6);\n\t\t\t}\n\t\t}\n\t}",
  "func_graph_path": "openmrs/openmrs-module-uiframework/0422fa52c7eba3d96cce2936cb92897dca4b680a/UiFrameworkActivator.java/vul/after/0.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -19,7 +19,7 @@\n \t\tResourceFactory resourceFactory = getComponent(ResourceFactory.class);\n \n \t\t// Register a standard resource provider that can load file-based resources\n-\t\tresourceFactory.addResourceProvider(FileResourceProvider.RESOURCE_KEY, new FileResourceProvider());\n+\t\tresourceFactory.addResourceProvider(ConfigurationResourceProvider.RESOURCE_KEY, new ConfigurationResourceProvider());\n \n \t\tList<UiContextRefreshedCallback> callbacks = Context.getRegisteredComponents(UiContextRefreshedCallback.class);\n \t\tfor (UiContextRefreshedCallback callback : callbacks) {",
  "diff_line_info": {
    "deleted_lines": [
      "\t\tresourceFactory.addResourceProvider(FileResourceProvider.RESOURCE_KEY, new FileResourceProvider());"
    ],
    "added_lines": [
      "\t\tresourceFactory.addResourceProvider(ConfigurationResourceProvider.RESOURCE_KEY, new ConfigurationResourceProvider());"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/openmrs/openmrs-module-uiframework/pull/59",
  "description": {
    "pr_info": {
      "title": "UIFR-215: Do not allow loading arbitrary files",
      "number": 59
    },
    "comment": [
      "This prevents the load of files via absolute paths or path traversal. Ticket is [here](https://issues.openmrs.org/browse/UIFR-215)."
    ]
  },
  "Bug Filter": "Security Vulnerability Fix",
  "Bug Filter Confidence": 1.0,
  "Bug Filter Response": "**Final Classification:** Security Vulnerability Fix; **Confidence:** 1.0\n\nThe patch addresses a security issue by preventing arbitrary file loading through path traversal, aligning with the commit message and vulnerability description, confirming it as a security fix."
}