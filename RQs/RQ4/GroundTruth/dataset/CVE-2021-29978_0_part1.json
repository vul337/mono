{
  "cve_id": "CVE-2021-29978",
  "cwe_ids": [
    "CWE-Other"
  ],
  "cvss_vector": "AV:N/AC:L/Au:N/C:C/I:C/A:C",
  "cvss_is_v3": false,
  "repo_name": "mozilla-mobile/mozilla-vpn-client",
  "commit_msg": "Add rebase",
  "commit_hash": "c8440f464a2f5c4e7d4990152ee5850df8b23f42",
  "git_url": "https://github.com/mozilla-mobile/mozilla-vpn-client/commit/c8440f464a2f5c4e7d4990152ee5850df8b23f42",
  "file_path": "android/src/org/mozilla/firefox/vpn/qt/VPNWebView.java",
  "func_name": "destroy",
  "func_before": "public void destroy()\n    {\n        Log.v(TAG, \"bye!\");\n        m_activity.runOnUiThread(new Runnable() {\n            @Override\n            public void run() {\n                m_webView.destroy();\n            }\n        });\n    }",
  "abstract_func_before": "public void destroy()\n    {\n        VAR_0.v(VAR_1, \"bye!\");\n        VAR_2.runOnUiThread(new Runnable() {\n            @Override\n            public void run() {\n                VAR_3.destroy();\n            }\n        });\n    }",
  "func_graph_path_before": "mozilla-mobile/mozilla-vpn-client/c8440f464a2f5c4e7d4990152ee5850df8b23f42/VPNWebView.java/vul/before/1.json",
  "func": "public void destroy()\n    {\n        Log.v(TAG, \"bye!\");\n        m_activity.runOnUiThread(new Runnable() {\n          @Override\n          public void run() {\n            m_webView.destroy();\n            m_activity.getWindow().clearFlags(WindowManager.LayoutParams.FLAG_SECURE);\n          }\n        });\n    }",
  "abstract_func": "public void destroy()\n    {\n        VAR_0.v(VAR_1, \"bye!\");\n        VAR_2.runOnUiThread(new Runnable() {\n          @Override\n          public void run() {\n            VAR_3.destroy();\n            VAR_2.getWindow().clearFlags(VAR_4.LayoutParams.FLAG_SECURE);\n          }\n        });\n    }",
  "func_graph_path": "mozilla-mobile/mozilla-vpn-client/c8440f464a2f5c4e7d4990152ee5850df8b23f42/VPNWebView.java/vul/after/1.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -2,9 +2,10 @@\n     {\n         Log.v(TAG, \"bye!\");\n         m_activity.runOnUiThread(new Runnable() {\n-            @Override\n-            public void run() {\n-                m_webView.destroy();\n-            }\n+          @Override\n+          public void run() {\n+            m_webView.destroy();\n+            m_activity.getWindow().clearFlags(WindowManager.LayoutParams.FLAG_SECURE);\n+          }\n         });\n     }",
  "diff_line_info": {
    "deleted_lines": [
      "            @Override",
      "            public void run() {",
      "                m_webView.destroy();",
      "            }"
    ],
    "added_lines": [
      "          @Override",
      "          public void run() {",
      "            m_webView.destroy();",
      "            m_activity.getWindow().clearFlags(WindowManager.LayoutParams.FLAG_SECURE);",
      "          }"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/mozilla-mobile/mozilla-vpn-client/pull/817",
  "description": {
    "pr_info": {
      "title": " FVP-02 WP5: Harden android",
      "number": 817
    },
    "comment": [
      "** Dont Merge yet. - As this would include dropping support of android <7.  **\r\n-->This is required for the Encrypted Shared prefs and #805 - to force using the v2 APK signature. \r\n\r\nThis should address all WP5 related issues.\r\n\r\nDisallow Backups of Data (2ca5182)\r\nCloses #803\r\n\r\nEncypt Shared Prefs (830231c)\r\nCloses #808\r\n\r\nMake the Web-View a secured View (10c90ae)\r\nCloses #804\r\n\r\nStop Posting all Log messages to Logcat on Release Builds (e3b3eba)\r\nCloses #809\r\n\r\nCloses #805 - As we require android 7 now. \r\n\r\n"
    ]
  },
  "Bug Filter": "Security Vulnerability Fix",
  "Bug Filter Confidence": 0.9,
  "Bug Filter Response": "The patch addresses multiple security-related issues such as encryption, WebView security, and logging. The code changes modify how the WebView is handled, which ties directly into the security improvements mentioned. \n\n**Final Classification:** Security Vulnerability Fix; **Confidence:** 0.9\n\n**Step-by-Step Explanation:**\n1. **Input Analysis:** The commit message is vague, but the vulnerability description details security issues. Code changes affect WebView destruction, which is security-related.\n2. **Consistency Check:** The code changes align with the security fixes described.\n3. **Purpose Evaluation:** The intent is to enhance security by fixing WebView handling.\n4. **Security Assessment:** The changes prevent screen capture vulnerabilities by properly handling WebView destruction, linking to known security issues.\n5. **Confidence Score:** High confidence (0.9) as the changes clearly address security concerns despite a vague commit message."
}