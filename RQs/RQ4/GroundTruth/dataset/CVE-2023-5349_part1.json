{
  "cve_id": "CVE-2023-5349",
  "cwe_ids": [
    "CWE-401"
  ],
  "cvss_vector": "CVSS:3.1/AV:L/AC:L/PR:N/UI:R/S:U/C:N/I:N/A:L",
  "cvss_is_v3": true,
  "repo_name": "rmagick",
  "commit_msg": "Fix memory leak in `Magick::Draw` for recentry ImageMagick 6 by removing unnecessary `GetDrawInfo()` calling",
  "commit_hash": "da823515a13130010f74678dc48f8b08a70cbd14",
  "git_url": "https://github.com/rmagick/rmagick/commit/da823515a13130010f74678dc48f8b08a70cbd14",
  "file_path": "ext/RMagick/rmdraw.c",
  "func_name": "DrawOptions_initialize",
  "func_before": "VALUE\nDrawOptions_initialize(VALUE self)\n{\n    Draw *draw_options;\n\n    TypedData_Get_Struct(self, Draw, &rm_draw_data_type, draw_options);\n    draw_options->info = AcquireDrawInfo();\n    if (!draw_options->info)\n    {\n        rb_raise(rb_eNoMemError, \"not enough memory to continue\");\n    }\n\n    GetDrawInfo(NULL, draw_options->info);\n\n    if (rb_block_given_p())\n    {\n        rb_yield(self);\n    }\n\n    return self;\n}",
  "abstract_func_before": "VALUE\nDrawOptions_initialize(VALUE VAR_0)\n{\n    Draw *VAR_1;\n\n    TypedData_Get_Struct(VAR_0, Draw, &VAR_2, VAR_1);\n    VAR_1->info = AcquireDrawInfo();\n    if (!VAR_1->info)\n    {\n        rb_raise(VAR_3, \"not enough memory to continue\");\n    }\n\n    GetDrawInfo(NULL, VAR_1->info);\n\n    if (rb_block_given_p())\n    {\n        rb_yield(VAR_0);\n    }\n\n    return VAR_0;\n}",
  "func_graph_path_before": "rmagick/da823515a13130010f74678dc48f8b08a70cbd14/rmdraw.c/vul/before/0.json",
  "func": "VALUE\nDrawOptions_initialize(VALUE self)\n{\n    Draw *draw_options;\n\n    TypedData_Get_Struct(self, Draw, &rm_draw_data_type, draw_options);\n    draw_options->info = AcquireDrawInfo();\n    if (!draw_options->info)\n    {\n        rb_raise(rb_eNoMemError, \"not enough memory to continue\");\n    }\n\n    if (rb_block_given_p())\n    {\n        rb_yield(self);\n    }\n\n    return self;\n}",
  "abstract_func": "VALUE\nDrawOptions_initialize(VALUE VAR_0)\n{\n    Draw *VAR_1;\n\n    TypedData_Get_Struct(VAR_0, Draw, &VAR_2, VAR_1);\n    VAR_1->info = AcquireDrawInfo();\n    if (!VAR_1->info)\n    {\n        rb_raise(VAR_3, \"not enough memory to continue\");\n    }\n\n    if (rb_block_given_p())\n    {\n        rb_yield(VAR_0);\n    }\n\n    return VAR_0;\n}",
  "func_graph_path": "rmagick/da823515a13130010f74678dc48f8b08a70cbd14/rmdraw.c/vul/after/0.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -10,8 +10,6 @@\n         rb_raise(rb_eNoMemError, \"not enough memory to continue\");\n     }\n \n-    GetDrawInfo(NULL, draw_options->info);\n-\n     if (rb_block_given_p())\n     {\n         rb_yield(self);",
  "diff_line_info": {
    "deleted_lines": [
      "    GetDrawInfo(NULL, draw_options->info);",
      ""
    ],
    "added_lines": []
  },
  "is_vul": true,
  "pr_url": "https://github.com/rmagick/rmagick/pull/1406",
  "description": "Failed to get PR details: HTTP Request Error for PR https://github.com/rmagick/rmagick/pull/1406: 403 Client Error: Forbidden for url: https://api.github.com/repos/rmagick/rmagick/pulls/1406",
  "Bug Filter": "Security Vulnerability Fix",
  "Bug Filter Confidence": 0.9,
  "Bug Filter Response": "**Final Classification:** Security Vulnerability Fix  \n**Confidence:** 0.9  \n\nThe patch addresses a memory leak in ImageMagick, which is a security concern. The code removal of `GetDrawInfo()` likely prevents resource exhaustion, thus fixing a security issue."
}