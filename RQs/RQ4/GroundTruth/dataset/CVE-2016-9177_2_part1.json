{
  "cve_id": "CVE-2016-9177",
  "cwe_ids": [
    "CWE-22"
  ],
  "cvss_vector": "AV:N/AC:L/Au:N/C:P/I:N/A:N",
  "cvss_is_v3": false,
  "repo_name": "perwendel/spark",
  "commit_msg": "Fix for #700 - Arbitrary File Read Vulnerability",
  "commit_hash": "26b57d0596ee73c14c558463943ef0857e53b91f",
  "git_url": "https://github.com/perwendel/spark/commit/26b57d0596ee73c14c558463943ef0857e53b91f",
  "file_path": "src/main/java/spark/staticfiles/StaticFilesConfiguration.java",
  "func_name": "configureJarCase",
  "func_before": "private boolean configureJarCase(String folder, ClassPathResource resource) throws IOException {\n        if (resource.getURL().getProtocol().equals(\"jar\")) {\n\n            InputStream stream = StaticFilesConfiguration.class.getResourceAsStream(folder);\n\n            if (stream != null) {\n                if (jarResourceHandlers == null) {\n                    jarResourceHandlers = new ArrayList<>();\n                }\n\n                // Add jar file resource handler\n                jarResourceHandlers.add(new JarResourceHandler(folder, \"index.html\"));\n                staticResourcesSet = true;\n                return true;\n            }\n            \n            LOG.error(\"Static file configuration failed.\");\n        }\n        return false;\n    }",
  "abstract_func_before": "private boolean configureJarCase(String VAR_0, ClassPathResource VAR_1) throws IOException {\n        if (VAR_1.getURL().getProtocol().equals(\"jar\")) {\n\n            InputStream VAR_2 = StaticFilesConfiguration.class.getResourceAsStream(VAR_0);\n\n            if (VAR_2 != null) {\n                if (VAR_3 == null) {\n                    VAR_3 = new ArrayList<>();\n                }\n\n                /* COMMENT_0 */\n                VAR_3.add(new JarResourceHandler(VAR_0, \"index.html\"));\n                VAR_4 = true;\n                return true;\n            }\n            \n            VAR_5.error(\"Static file configuration failed.\");\n        }\n        return false;\n    }",
  "func_graph_path_before": "perwendel/spark/26b57d0596ee73c14c558463943ef0857e53b91f/StaticFilesConfiguration.java/vul/before/2.json",
  "func": "private boolean configureJarCase(String folder, ClassPathResource resource) throws IOException {\n        if (resource.getURL().getProtocol().equals(\"jar\")) {\n\n            InputStream stream = StaticFilesConfiguration.class.getResourceAsStream(folder);\n\n            if (stream != null) {\n                if (jarResourceHandlers == null) {\n                    jarResourceHandlers = new ArrayList<>();\n                }\n\n                // Add jar file resource handler\n                jarResourceHandlers.add(new JarResourceHandler(folder, \"index.html\"));\n                staticResourcesSet = true;\n                return true;\n            }\n\n            LOG.error(\"Static file configuration failed.\");\n        }\n        return false;\n    }",
  "abstract_func": "private boolean configureJarCase(String VAR_0, ClassPathResource VAR_1) throws IOException {\n        if (VAR_1.getURL().getProtocol().equals(\"jar\")) {\n\n            InputStream VAR_2 = StaticFilesConfiguration.class.getResourceAsStream(VAR_0);\n\n            if (VAR_2 != null) {\n                if (VAR_3 == null) {\n                    VAR_3 = new ArrayList<>();\n                }\n\n                /* COMMENT_0 */\n                VAR_3.add(new JarResourceHandler(VAR_0, \"index.html\"));\n                VAR_4 = true;\n                return true;\n            }\n\n            VAR_5.error(\"Static file configuration failed.\");\n        }\n        return false;\n    }",
  "func_graph_path": "perwendel/spark/26b57d0596ee73c14c558463943ef0857e53b91f/StaticFilesConfiguration.java/vul/after/2.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -13,7 +13,7 @@\n                 staticResourcesSet = true;\n                 return true;\n             }\n-            \n+\n             LOG.error(\"Static file configuration failed.\");\n         }\n         return false;",
  "diff_line_info": {
    "deleted_lines": [
      "            "
    ],
    "added_lines": [
      ""
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/perwendel/spark/pull/701",
  "description": {
    "pr_info": {
      "title": "Fix for #700 - Arbitrary File Read Vulnerability",
      "number": 701
    },
    "comment": [
      "Fix for #700 \r\nThis is my take on the directory traversal problem.\r\nPlease review and try out.",
      "I've just verified it for Windows, didn't have time to test for linux etc.\nWhen travis CI built it didn't detect directory traversal for the test case for external resources. There's probably an issue with how path handling differs in unix-like OSs and windows.\n",
      "DISCLAIMER: Didn't really have time to look closely, so I could be talking out of my arse so to speak, but: wouldn't using `File.getCanonicalPath()` be safer than string manipulation? I'd certainly trust JDK library methods more than my own code, especially when it comes to security. Also, there are all kinds of clever ways (encodings, escapes and what not) of defeating checking strings for \"..\", \"/\", \"\\\" etc.\n",
      "@jakaarl Sorry, merged before I saw your comment. The guy making the post emailed and said it was a good solution. But I'll follow your advise and see if I can make it better. New PR will be created if you're right!\n"
    ]
  },
  "Bug Filter": "Security Vulnerability Fix",
  "Bug Filter Confidence": 0.9,
  "Bug Filter Response": "**Final Classification:** Security Vulnerability Fix  \n**Confidence:** 0.9"
}