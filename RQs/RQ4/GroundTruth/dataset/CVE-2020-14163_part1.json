{
  "cve_id": "CVE-2020-14163",
  "cwe_ids": [
    "CWE-125"
  ],
  "cvss_vector": "AV:N/AC:L/Au:N/C:P/I:N/A:N",
  "cvss_is_v3": false,
  "repo_name": "jerryscript-project/jerryscript",
  "commit_msg": "Fix adding entries to the internal buffer of a Map object (#3805)\n\nWhen appending the key/value pair separately, garbage collection could be\r\ntriggered before the value is added, which could cause problems during\r\nmarking. This patch changes insertion to add both values at the same\r\ntime, which prevents partial entries from being present in the internal\r\nbuffer.\r\n\r\nFixes #3804.\r\n\r\nJerryScript-DCO-1.0-Signed-off-by: Dániel Bátyai dbatyai@inf.u-szeged.hu",
  "commit_hash": "c2b662170245a16f46ce02eae68815c325d99821",
  "git_url": "https://github.com/jerryscript-project/jerryscript/commit/c2b662170245a16f46ce02eae68815c325d99821",
  "file_path": "jerry-core/ecma/operations/ecma-container-object.c",
  "func_name": "ecma_op_internal_buffer_append",
  "func_before": "static void\necma_op_internal_buffer_append (ecma_collection_t *container_p, /**< internal container pointer */\n                                ecma_value_t key_arg, /**< key argument */\n                                ecma_value_t value_arg, /**< value argument */\n                                lit_magic_string_id_t lit_id) /**< class id */\n{\n  JERRY_ASSERT (container_p != NULL);\n\n  ecma_collection_push_back (container_p, ecma_copy_value_if_not_object (key_arg));\n\n  if (lit_id == LIT_MAGIC_STRING_WEAKMAP_UL || lit_id == LIT_MAGIC_STRING_MAP_UL)\n  {\n    ecma_collection_push_back (container_p, ecma_copy_value_if_not_object (value_arg));\n  }\n\n  ECMA_CONTAINER_SET_SIZE (container_p, ECMA_CONTAINER_GET_SIZE (container_p) + 1);\n}",
  "abstract_func_before": "static void\necma_op_internal_buffer_append (ecma_collection_t *VAR_0, /* COMMENT_0 */\n                                ecma_value_t VAR_1, /* COMMENT_1 */\n                                ecma_value_t VAR_2, /* COMMENT_2 */\n                                lit_magic_string_id_t VAR_3) /* COMMENT_3 */\n{\n  JERRY_ASSERT (VAR_0 != NULL);\n\n  ecma_collection_push_back (VAR_0, ecma_copy_value_if_not_object (VAR_1));\n\n  if (VAR_3 == VAR_4 || VAR_3 == VAR_5)\n  {\n    ecma_collection_push_back (VAR_0, ecma_copy_value_if_not_object (VAR_2));\n  }\n\n  ECMA_CONTAINER_SET_SIZE (VAR_0, ECMA_CONTAINER_GET_SIZE (VAR_0) + 1);\n}",
  "func_graph_path_before": "jerryscript-project/jerryscript/c2b662170245a16f46ce02eae68815c325d99821/ecma-container-object.c/vul/before/0.json",
  "func": "static void\necma_op_internal_buffer_append (ecma_collection_t *container_p, /**< internal container pointer */\n                                ecma_value_t key_arg, /**< key argument */\n                                ecma_value_t value_arg, /**< value argument */\n                                lit_magic_string_id_t lit_id) /**< class id */\n{\n  JERRY_ASSERT (container_p != NULL);\n\n  if (lit_id == LIT_MAGIC_STRING_WEAKMAP_UL || lit_id == LIT_MAGIC_STRING_MAP_UL)\n  {\n    ecma_value_t values[] = { ecma_copy_value_if_not_object (key_arg), ecma_copy_value_if_not_object (value_arg) };\n    ecma_collection_append (container_p, values, 2);\n  }\n  else\n  {\n    ecma_collection_push_back (container_p, ecma_copy_value_if_not_object (key_arg));\n  }\n\n  ECMA_CONTAINER_SET_SIZE (container_p, ECMA_CONTAINER_GET_SIZE (container_p) + 1);\n}",
  "abstract_func": "static void\necma_op_internal_buffer_append (ecma_collection_t *VAR_0, /* COMMENT_0 */\n                                ecma_value_t VAR_1, /* COMMENT_1 */\n                                ecma_value_t VAR_2, /* COMMENT_2 */\n                                lit_magic_string_id_t VAR_3) /* COMMENT_3 */\n{\n  JERRY_ASSERT (VAR_0 != NULL);\n\n  if (VAR_3 == VAR_4 || VAR_3 == VAR_5)\n  {\n    ecma_value_t VAR_6[] = { ecma_copy_value_if_not_object (VAR_1), ecma_copy_value_if_not_object (VAR_2) };\n    ecma_collection_append (VAR_0, VAR_6, 2);\n  }\n  else\n  {\n    ecma_collection_push_back (VAR_0, ecma_copy_value_if_not_object (VAR_1));\n  }\n\n  ECMA_CONTAINER_SET_SIZE (VAR_0, ECMA_CONTAINER_GET_SIZE (VAR_0) + 1);\n}",
  "func_graph_path": "jerryscript-project/jerryscript/c2b662170245a16f46ce02eae68815c325d99821/ecma-container-object.c/vul/after/0.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -6,11 +6,14 @@\n {\n   JERRY_ASSERT (container_p != NULL);\n \n-  ecma_collection_push_back (container_p, ecma_copy_value_if_not_object (key_arg));\n-\n   if (lit_id == LIT_MAGIC_STRING_WEAKMAP_UL || lit_id == LIT_MAGIC_STRING_MAP_UL)\n   {\n-    ecma_collection_push_back (container_p, ecma_copy_value_if_not_object (value_arg));\n+    ecma_value_t values[] = { ecma_copy_value_if_not_object (key_arg), ecma_copy_value_if_not_object (value_arg) };\n+    ecma_collection_append (container_p, values, 2);\n+  }\n+  else\n+  {\n+    ecma_collection_push_back (container_p, ecma_copy_value_if_not_object (key_arg));\n   }\n \n   ECMA_CONTAINER_SET_SIZE (container_p, ECMA_CONTAINER_GET_SIZE (container_p) + 1);",
  "diff_line_info": {
    "deleted_lines": [
      "  ecma_collection_push_back (container_p, ecma_copy_value_if_not_object (key_arg));",
      "",
      "    ecma_collection_push_back (container_p, ecma_copy_value_if_not_object (value_arg));"
    ],
    "added_lines": [
      "    ecma_value_t values[] = { ecma_copy_value_if_not_object (key_arg), ecma_copy_value_if_not_object (value_arg) };",
      "    ecma_collection_append (container_p, values, 2);",
      "  }",
      "  else",
      "  {",
      "    ecma_collection_push_back (container_p, ecma_copy_value_if_not_object (key_arg));"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/jerryscript-project/jerryscript/pull/3805",
  "description": "Failed to get PR details: HTTP Request Error for PR https://github.com/jerryscript-project/jerryscript/pull/3805: 403 Client Error: Forbidden for url: https://api.github.com/repos/jerryscript-project/jerryscript/pulls/3805",
  "Bug Filter": "Defect Remediation & Feature Upgrades",
  "Bug Filter Confidence": 0.9,
  "Bug Filter Response": "**Final Classification:** Defect Remediation & Feature Upgrades; **Confidence:** 0.9"
}