{
  "cve_id": "CVE-2022-4727",
  "cwe_ids": [
    "CWE-79"
  ],
  "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N",
  "cvss_is_v3": true,
  "repo_name": "openmrs/openmrs-module-appointmentscheduling",
  "commit_msg": "RA1865 - Fixing reflected XSS in the notes section (#39)\n\n* Fixing reflective XSS in the notes section\r\n\r\n* using owasp encoder for HTML encoding\r\n\r\n* Escaping HTML using WebUtil\r\n\r\n* Update api/src/main/java/org/openmrs/module/appointmentscheduling/AppointmentRequest.java\r\n\r\nCo-authored-by: Brandon Istenes <brandonesbox@gmail.com>\r\n\r\n* Update api/src/main/java/org/openmrs/module/appointmentscheduling/AppointmentRequest.java\r\n\r\nCo-authored-by: Brandon Istenes <brandonesbox@gmail.com>\r\n\r\nCo-authored-by: Anupam Devulapalli <anupam.8010@gmail.com>\r\nCo-authored-by: Mark Goodrich <mgoodrich@pih.org>\r\nCo-authored-by: Brandon Istenes <brandonesbox@gmail.com>",
  "commit_hash": "2ccbe39c020809765de41eeb8ee4c70b5ec49cc8",
  "git_url": "https://github.com/openmrs/openmrs-module-appointmentscheduling/commit/2ccbe39c020809765de41eeb8ee4c70b5ec49cc8",
  "file_path": "api/src/main/java/org/openmrs/module/appointmentscheduling/AppointmentRequest.java",
  "func_name": "setNotes",
  "func_before": "public void setNotes(String notes) {\n        this.notes = notes;\n    }",
  "abstract_func_before": "public void setNotes(String VAR_0) {\n        this.notes = VAR_0;\n    }",
  "func_graph_path_before": "openmrs/openmrs-module-appointmentscheduling/2ccbe39c020809765de41eeb8ee4c70b5ec49cc8/AppointmentRequest.java/vul/before/0.json",
  "func": "public void setNotes(String notes) {\n        this.notes = WebUtil.escapeHTML(notes);\n    }",
  "abstract_func": "public void setNotes(String VAR_0) {\n        this.notes = VAR_1.escapeHTML(VAR_0);\n    }",
  "func_graph_path": "openmrs/openmrs-module-appointmentscheduling/2ccbe39c020809765de41eeb8ee4c70b5ec49cc8/AppointmentRequest.java/vul/after/0.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -1,3 +1,3 @@\n public void setNotes(String notes) {\n-        this.notes = notes;\n+        this.notes = WebUtil.escapeHTML(notes);\n     }",
  "diff_line_info": {
    "deleted_lines": [
      "        this.notes = notes;"
    ],
    "added_lines": [
      "        this.notes = WebUtil.escapeHTML(notes);"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/openmrs/openmrs-module-appointmentscheduling/pull/39",
  "description": {
    "pr_info": {
      "title": "RA1865 - Fixing reflected XSS in the notes section",
      "number": 39
    },
    "comment": [
      "<!--- Add a pull request title above in this format -->\r\n<!--- real example: 'TRUNK-5111: Replace use of deprecated isVoided' -->\r\n<!--- 'TRUNK-JiraIssueNumber: JiraIssueTitle' -->\r\n## Description of what I changed\r\n<!--- Describe your changes in detail -->\r\n<!--- It can simply be your commit message, which you must have -->\r\n@isears \r\nAdded input sanitization for Notes section in the Appoint Scheduling Form.\r\n\r\n## Issue I worked on\r\n<!--- This project only accepts pull requests related to open issues -->\r\n<!--- Want a new feature or change? Discuss it in an issue first! -->\r\n<!--- Found a bug? Point us to the issue/or create one so we can reproduce it! -->\r\n<!--- Just add the issue number at the end: -->\r\nThis fix ensures iframes are not inserted in the Notes section while scheduling appointments. The bug can be reproduced by following the steps mentioned [here](https://docs.google.com/document/d/1vfltuHZEmgh2wELWww70PG1eUH16qZ_71b7h-xMs7NQ/edit?usp=sharing).\r\n\r\n## Link to ticket\r\nhttps://issues.openmrs.org/browse/RA-1865\r\n\r\n## Checklist: I completed these to help reviewers :)\r\n<!--- Put an `x` in the box if you did the task -->\r\n<!--- If you forgot a task please follow the instructions below -->\r\n- [x ] My IDE is configured to follow the [**code style**](https://wiki.openmrs.org/display/docs/Java+Conventions) of this project.\r\n\r\n  No? Unsure? -> [configure your IDE](https://wiki.openmrs.org/display/docs/How-To+Setup+And+Use+Your+IDE), format the code and add the changes with `git add . && git commit --amend`\r\n\r\n- [x ] I have **added tests** to cover my changes. (If you refactored\r\n  existing code that was well tested you do not have to add tests)\r\n\r\n  No? -> write tests and add them to this commit `git add . && git commit --amend`\r\n\r\n- [ x] I ran `mvn clean package` right before creating this pull request and\r\n  added all formatting changes to my commit.\r\n\r\n  No? -> execute above command\r\n\r\n- [x ] All new and existing **tests passed**.\r\n\r\n  No? -> figure out why and add the fix to your commit. It is your responsibility to make sure your code works.\r\n\r\n- [x ] My pull request is **based on the latest changes** of the master branch.\r\n\r\n  No? Unsure? -> execute command `git pull --rebase upstream master`\r\n\r\n",
      "@isears \r\nI looked further into the UiUtils implementation of HTML Encoding and realized that they are directly calling the encodeHtml function. As I encountered problems while using the UiUtils class, I directly used the OWASP standard Encode.forHtml function to handle the XSS issue here. \r\n\r\nI also looked into fixing this at the GSP level, but because the textarea has a two-way binding to a variable using ng-model, I was unsure how to go about it.",
      "This looks fine to me. @isears ?"
    ]
  },
  "Bug Filter": "Security Vulnerability Fix**\n\n**Confidence Score: 1.0**",
  "Bug Filter Confidence": 1.0,
  "Bug Filter Response": "\n\n**Analysis:**\nThe patch modifies the `setNotes` method to use HTML encoding, specifically addressing a reflected XSS vulnerability. The commit message confirms this security fix, indicating that user input was not properly sanitized before being displayed.\n\n**Final Classification: Security Vulnerability Fix**\n\n**Confidence Score: 1.0**"
}