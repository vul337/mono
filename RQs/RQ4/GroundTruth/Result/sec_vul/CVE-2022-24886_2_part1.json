{
  "cve_id": "CVE-2022-24886",
  "cwe_ids": [
    "CWE-732"
  ],
  "cvss_vector": "AV:L/AC:L/Au:N/C:P/I:N/A:N",
  "cvss_is_v3": false,
  "repo_name": "nextcloud/android",
  "commit_msg": "Make PendingIntents immutable\n\nGood practice for security\n\nSigned-off-by: √Ålvaro Brey Vilas <alvaro.brey@nextcloud.com>",
  "commit_hash": "27559efb79d45782e000b762860658d49e9c35e9",
  "git_url": "https://github.com/nextcloud/android/commit/27559efb79d45782e000b762860658d49e9c35e9",
  "file_path": "src/main/java/com/owncloud/android/syncadapter/FileSyncAdapter.java",
  "func_name": "notifyForgottenLocalFiles",
  "func_before": "private void notifyForgottenLocalFiles() {\n        NotificationCompat.Builder notificationBuilder = createNotificationBuilder();\n        notificationBuilder.setTicker(i18n(R.string.sync_foreign_files_forgotten_ticker));\n\n        /// includes a pending intent in the notification showing a more detailed explanation\n        Intent explanationIntent = new Intent(getContext(), ErrorsWhileCopyingHandlerActivity.class);\n        explanationIntent.putExtra(ErrorsWhileCopyingHandlerActivity.EXTRA_USER, getUser());\n        ArrayList<String> remotePaths = new ArrayList<String>();\n        ArrayList<String> localPaths = new ArrayList<String>();\n        remotePaths.addAll(mForgottenLocalFiles.keySet());\n        localPaths.addAll(mForgottenLocalFiles.values());\n        explanationIntent.putExtra(ErrorsWhileCopyingHandlerActivity.EXTRA_LOCAL_PATHS, localPaths);\n        explanationIntent.putExtra(ErrorsWhileCopyingHandlerActivity.EXTRA_REMOTE_PATHS, remotePaths);\n        explanationIntent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);\n\n        notificationBuilder\n            .setContentIntent(PendingIntent.getActivity(\n                getContext(), (int) System.currentTimeMillis(), explanationIntent, 0\n            ))\n            .setContentTitle(i18n(R.string.sync_foreign_files_forgotten_ticker))\n            .setContentText(getQuantityString(\n                    R.plurals.sync_foreign_files_forgotten_content,\n                    mForgottenLocalFiles.size(),\n                    mForgottenLocalFiles.size(),\n                    i18n(R.string.app_name))\n            );\n\n        showNotification(R.string.sync_foreign_files_forgotten_ticker, notificationBuilder);\n    }",
  "abstract_func_before": "private void notifyForgottenLocalFiles() {\n        NotificationCompat.Builder VAR_0 = createNotificationBuilder();\n        VAR_0.setTicker(i18n(VAR_1.string.sync_foreign_files_forgotten_ticker));\n\n        /* COMMENT_0 */\n        Intent VAR_2 = new Intent(getContext(), ErrorsWhileCopyingHandlerActivity.class);\n        VAR_2.putExtra(VAR_3.EXTRA_USER, getUser());\n        ArrayList<String> VAR_4 = new ArrayList<String>();\n        ArrayList<String> VAR_5 = new ArrayList<String>();\n        VAR_4.addAll(VAR_6.keySet());\n        VAR_5.addAll(VAR_6.values());\n        VAR_2.putExtra(VAR_3.EXTRA_LOCAL_PATHS, VAR_5);\n        VAR_2.putExtra(VAR_3.EXTRA_REMOTE_PATHS, VAR_4);\n        VAR_2.setFlags(VAR_7.FLAG_ACTIVITY_CLEAR_TOP);\n\n        VAR_0\n            .setContentIntent(VAR_8.getActivity(\n                getContext(), (int) VAR_9.currentTimeMillis(), VAR_2, 0\n            ))\n            .setContentTitle(i18n(VAR_1.string.sync_foreign_files_forgotten_ticker))\n            .setContentText(getQuantityString(\n                    VAR_1.plurals.sync_foreign_files_forgotten_content,\n                    VAR_6.size(),\n                    VAR_6.size(),\n                    i18n(VAR_1.string.app_name))\n            );\n\n        showNotification(VAR_1.string.sync_foreign_files_forgotten_ticker, VAR_0);\n    }",
  "func_graph_path_before": "nextcloud/android/27559efb79d45782e000b762860658d49e9c35e9/FileSyncAdapter.java/vul/before/0.json",
  "func": "private void notifyForgottenLocalFiles() {\n        NotificationCompat.Builder notificationBuilder = createNotificationBuilder();\n        notificationBuilder.setTicker(i18n(R.string.sync_foreign_files_forgotten_ticker));\n\n        /// includes a pending intent in the notification showing a more detailed explanation\n        Intent explanationIntent = new Intent(getContext(), ErrorsWhileCopyingHandlerActivity.class);\n        explanationIntent.putExtra(ErrorsWhileCopyingHandlerActivity.EXTRA_USER, getUser());\n        ArrayList<String> remotePaths = new ArrayList<String>();\n        ArrayList<String> localPaths = new ArrayList<String>();\n        remotePaths.addAll(mForgottenLocalFiles.keySet());\n        localPaths.addAll(mForgottenLocalFiles.values());\n        explanationIntent.putExtra(ErrorsWhileCopyingHandlerActivity.EXTRA_LOCAL_PATHS, localPaths);\n        explanationIntent.putExtra(ErrorsWhileCopyingHandlerActivity.EXTRA_REMOTE_PATHS, remotePaths);\n        explanationIntent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);\n\n        notificationBuilder\n            .setContentIntent(PendingIntent.getActivity(\n                getContext(), (int) System.currentTimeMillis(), explanationIntent, PendingIntent.FLAG_IMMUTABLE\n                                                       ))\n            .setContentTitle(i18n(R.string.sync_foreign_files_forgotten_ticker))\n            .setContentText(getQuantityString(\n                    R.plurals.sync_foreign_files_forgotten_content,\n                    mForgottenLocalFiles.size(),\n                    mForgottenLocalFiles.size(),\n                    i18n(R.string.app_name))\n            );\n\n        showNotification(R.string.sync_foreign_files_forgotten_ticker, notificationBuilder);\n    }",
  "abstract_func": "private void notifyForgottenLocalFiles() {\n        NotificationCompat.Builder VAR_0 = createNotificationBuilder();\n        VAR_0.setTicker(i18n(VAR_1.string.sync_foreign_files_forgotten_ticker));\n\n        /* COMMENT_0 */\n        Intent VAR_2 = new Intent(getContext(), ErrorsWhileCopyingHandlerActivity.class);\n        VAR_2.putExtra(VAR_3.EXTRA_USER, getUser());\n        ArrayList<String> VAR_4 = new ArrayList<String>();\n        ArrayList<String> VAR_5 = new ArrayList<String>();\n        VAR_4.addAll(VAR_6.keySet());\n        VAR_5.addAll(VAR_6.values());\n        VAR_2.putExtra(VAR_3.EXTRA_LOCAL_PATHS, VAR_5);\n        VAR_2.putExtra(VAR_3.EXTRA_REMOTE_PATHS, VAR_4);\n        VAR_2.setFlags(VAR_7.FLAG_ACTIVITY_CLEAR_TOP);\n\n        VAR_0\n            .setContentIntent(VAR_8.getActivity(\n                getContext(), (int) VAR_9.currentTimeMillis(), VAR_2, VAR_8.FLAG_IMMUTABLE\n                                                       ))\n            .setContentTitle(i18n(VAR_1.string.sync_foreign_files_forgotten_ticker))\n            .setContentText(getQuantityString(\n                    VAR_1.plurals.sync_foreign_files_forgotten_content,\n                    VAR_6.size(),\n                    VAR_6.size(),\n                    i18n(VAR_1.string.app_name))\n            );\n\n        showNotification(VAR_1.string.sync_foreign_files_forgotten_ticker, VAR_0);\n    }",
  "func_graph_path": "nextcloud/android/27559efb79d45782e000b762860658d49e9c35e9/FileSyncAdapter.java/vul/after/0.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -15,8 +15,8 @@\n \n         notificationBuilder\n             .setContentIntent(PendingIntent.getActivity(\n-                getContext(), (int) System.currentTimeMillis(), explanationIntent, 0\n-            ))\n+                getContext(), (int) System.currentTimeMillis(), explanationIntent, PendingIntent.FLAG_IMMUTABLE\n+                                                       ))\n             .setContentTitle(i18n(R.string.sync_foreign_files_forgotten_ticker))\n             .setContentText(getQuantityString(\n                     R.plurals.sync_foreign_files_forgotten_content,",
  "diff_line_info": {
    "deleted_lines": [
      "                getContext(), (int) System.currentTimeMillis(), explanationIntent, 0",
      "            ))"
    ],
    "added_lines": [
      "                getContext(), (int) System.currentTimeMillis(), explanationIntent, PendingIntent.FLAG_IMMUTABLE",
      "                                                       ))"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/nextcloud/android/pull/9726",
  "description": {
    "pr_info": {
      "title": "Make PendingIntents immutable",
      "number": 9726
    },
    "comment": [
      "Good practice for security\n\n\n\n<!--\nTESTING\n\nWriting tests is very important. Please try to write some tests for your PR. \nIf you need help, please do not hesitate to ask in this PR for help.\n\nUnit tests: https://github.com/nextcloud/android/blob/master/CONTRIBUTING.md#unit-tests\nInstrumented tests: https://github.com/nextcloud/android/blob/master/CONTRIBUTING.md#instrumented-tests\nUI tests: https://github.com/nextcloud/android/blob/master/CONTRIBUTING.md#ui-tests\n -->\n- [x] Tests written, or not not needed",
      "/backport to stable-3.19",
      "/rebase",
      "blue-Light-IT test failed: https://www.kaminsky.me/nc-dev/android-integrationTests/9726-Screenshot-blue-Light-12-08 ",
      "# [Codecov](https://codecov.io/gh/nextcloud/android/pull/9726?src=pr&el=h1&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=nextcloud) Report\n> Merging [#9726](https://codecov.io/gh/nextcloud/android/pull/9726?src=pr&el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=nextcloud) (d522236) into [master](https://codecov.io/gh/nextcloud/android/commit/7eaed66ebc9348e9b9893314973233c3bd72cc82?el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=nextcloud) (7eaed66) will **decrease** coverage by `0.87%`.\n> The diff coverage is `0.00%`.\n\n> :exclamation: Current head d522236 differs from pull request most recent head 4ac0baa. Consider uploading reports for the commit 4ac0baa to get more accurate results\n\n```diff\n@@            Coverage Diff             @@\n##           master    #9726      +/-   ##\n==========================================\n- Coverage   31.49%   30.62%   -0.88%     \n==========================================\n  Files         505      505              \n  Lines       38583    38589       +6     \n  Branches     5381     5381              \n==========================================\n- Hits        12152    11816     -336     \n- Misses      24581    24965     +384     \n+ Partials     1850     1808      -42     \n```\n\n\n\n| [Impacted Files](https://codecov.io/gh/nextcloud/android/pull/9726?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=nextcloud) | Coverage Œî | |\n|---|---|---|\n| [...extcloud/client/integrations/deck/DeckApiImpl.java](https://codecov.io/gh/nextcloud/android/pull/9726/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=nextcloud#diff-c3JjL21haW4vamF2YS9jb20vbmV4dGNsb3VkL2NsaWVudC9pbnRlZ3JhdGlvbnMvZGVjay9EZWNrQXBpSW1wbC5qYXZh) | `100.00% <√∏> (√∏)` | |\n| [...nextcloud/client/jobs/MediaFoldersDetectionWork.kt](https://codecov.io/gh/nextcloud/android/pull/9726/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=nextcloud#diff-c3JjL21haW4vamF2YS9jb20vbmV4dGNsb3VkL2NsaWVudC9qb2JzL01lZGlhRm9sZGVyc0RldGVjdGlvbldvcmsua3Q=) | `16.90% <0.00%> (-0.49%)` | :arrow_down: |\n| [...java/com/nextcloud/client/jobs/NotificationWork.kt](https://codecov.io/gh/nextcloud/android/pull/9726/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=nextcloud#diff-c3JjL21haW4vamF2YS9jb20vbmV4dGNsb3VkL2NsaWVudC9qb2JzL05vdGlmaWNhdGlvbldvcmsua3Q=) | `0.00% <0.00%> (√∏)` | |\n| [...n/java/com/nextcloud/client/media/PlayerService.kt](https://codecov.io/gh/nextcloud/android/pull/9726/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=nextcloud#diff-c3JjL21haW4vamF2YS9jb20vbmV4dGNsb3VkL2NsaWVudC9tZWRpYS9QbGF5ZXJTZXJ2aWNlLmt0) | `0.00% <0.00%> (√∏)` | |\n| [...client/notifications/AppNotificationManagerImpl.kt](https://codecov.io/gh/nextcloud/android/pull/9726/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=nextcloud#diff-c3JjL21haW4vamF2YS9jb20vbmV4dGNsb3VkL2NsaWVudC9ub3RpZmljYXRpb25zL0FwcE5vdGlmaWNhdGlvbk1hbmFnZXJJbXBsLmt0) | `49.12% <0.00%> (√∏)` | |\n| [...wncloud/android/files/services/FileDownloader.java](https://codecov.io/gh/nextcloud/android/pull/9726/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=nextcloud#diff-c3JjL21haW4vamF2YS9jb20vb3duY2xvdWQvYW5kcm9pZC9maWxlcy9zZXJ2aWNlcy9GaWxlRG93bmxvYWRlci5qYXZh) | `16.37% <0.00%> (-0.12%)` | :arrow_down: |\n| [.../owncloud/android/files/services/FileUploader.java](https://codecov.io/gh/nextcloud/android/pull/9726/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=nextcloud#diff-c3JjL21haW4vamF2YS9jb20vb3duY2xvdWQvYW5kcm9pZC9maWxlcy9zZXJ2aWNlcy9GaWxlVXBsb2FkZXIuamF2YQ==) | `51.62% <√∏> (√∏)` | |\n| [.../owncloud/android/syncadapter/FileSyncAdapter.java](https://codecov.io/gh/nextcloud/android/pull/9726/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=nextcloud#diff-c3JjL21haW4vamF2YS9jb20vb3duY2xvdWQvYW5kcm9pZC9zeW5jYWRhcHRlci9GaWxlU3luY0FkYXB0ZXIuamF2YQ==) | `4.25% <0.00%> (√∏)` | |\n| [...operations/RemoveRemoteEncryptedFileOperation.java](https://codecov.io/gh/nextcloud/android/pull/9726/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=nextcloud#diff-c3JjL21haW4vamF2YS9jb20vb3duY2xvdWQvYW5kcm9pZC9vcGVyYXRpb25zL1JlbW92ZVJlbW90ZUVuY3J5cHRlZEZpbGVPcGVyYXRpb24uamF2YQ==) | `0.00% <0.00%> (-66.00%)` | :arrow_down: |\n| [.../java/com/nextcloud/client/jobs/OfflineSyncWork.kt](https://codecov.io/gh/nextcloud/android/pull/9726/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=nextcloud#diff-c3JjL21haW4vamF2YS9jb20vbmV4dGNsb3VkL2NsaWVudC9qb2JzL09mZmxpbmVTeW5jV29yay5rdA==) | `15.00% <0.00%> (-50.00%)` | :arrow_down: |\n| ... and [23 more](https://codecov.io/gh/nextcloud/android/pull/9726/diff?src=pr&el=tree-more&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=nextcloud) | |\n",
      "APK file: https://www.kaminsky.me/nc-dev/android-artifacts/9726.apk <br/><br/> ![qrcode](https://www.kaminsky.me/nc-dev/android-artifacts/9726.png) <br/><br/>To test this change/fix you can simply download above APK file and install and test it in parallel to your existing Nextcloud app. ",
      "<h1>Codacy</h1> <h1>Lint</h1><table width='500' cellpadding='5' cellspacing='2'><tr class='tablerow0'><td>Type</td><td><a href='https://www.kaminsky.me/nc-dev/android-lint/master.html'>master</a></td><td><a href='https://www.kaminsky.me/nc-dev/android-lint/129.html'>PR</a></td></tr><tr class='tablerow1'><td>Warnings</td><td>124</td><td>102</td></tr><tr class='tablerow0'><td>Errors</td><td>0</td><td>0</td></tr></table>       <h1><a href='https://www.kaminsky.me/nc-dev/android-findbugs/129.html'>SpotBugs</a> (new)</h1>      <table width='500' cellpadding='5' cellspacing='2'>         <tr class='tableheader'>            <th align='left'>Warning Type</th>            <th align='right'>Number</th>         </tr>         <tr class='tablerow0'>            <td>               Bad practice Warnings            </td>            <td align='right'>28</td>         </tr>         <tr class='tablerow1'>            <td>               Correctness Warnings            </td>            <td align='right'>82</td>         </tr>         <tr class='tablerow0'>            <td>               Experimental Warnings            </td>            <td align='right'>1</td>         </tr>         <tr class='tablerow1'>            <td>               Internationalization Warnings            </td>            <td align='right'>9</td>         </tr>         <tr class='tablerow0'>            <td>               Malicious code vulnerability Warnings            </td>            <td align='right'>57</td>         </tr>         <tr class='tablerow1'>            <td>               Multithreaded correctness Warnings            </td>            <td align='right'>9</td>         </tr>         <tr class='tablerow0'>            <td>               Performance Warnings            </td>            <td align='right'>68</td>         </tr>         <tr class='tablerow1'>            <td>               Security Warnings            </td>            <td align='right'>29</td>         </tr>         <tr class='tablerow0'>            <td>               Dodgy code Warnings            </td>            <td align='right'>358</td>         </tr>         <tr class='tablerow1'>            <td>               <b>Total</b>            </td>            <td align='right'>               <b>641</b>            </td>         </tr>      </table>       <h1><a href='https://www.kaminsky.me/nc-dev/android-findbugs/master.html'>SpotBugs</a> (master)</h1>      <table width='500' cellpadding='5' cellspacing='2'>         <tr class='tableheader'>            <th align='left'>Warning Type</th>            <th align='right'>Number</th>         </tr>         <tr class='tablerow0'>            <td>               Bad practice Warnings            </td>            <td align='right'>28</td>         </tr>         <tr class='tablerow1'>            <td>               Correctness Warnings            </td>            <td align='right'>82</td>         </tr>         <tr class='tablerow0'>            <td>               Experimental Warnings            </td>            <td align='right'>1</td>         </tr>         <tr class='tablerow1'>            <td>               Internationalization Warnings            </td>            <td align='right'>9</td>         </tr>         <tr class='tablerow0'>            <td>               Malicious code vulnerability Warnings            </td>            <td align='right'>57</td>         </tr>         <tr class='tablerow1'>            <td>               Multithreaded correctness Warnings            </td>            <td align='right'>9</td>         </tr>         <tr class='tablerow0'>            <td>               Performance Warnings            </td>            <td align='right'>68</td>         </tr>         <tr class='tablerow1'>            <td>               Security Warnings            </td>            <td align='right'>29</td>         </tr>         <tr class='tablerow0'>            <td>               Dodgy code Warnings            </td>            <td align='right'>358</td>         </tr>         <tr class='tablerow1'>            <td>               <b>Total</b>            </td>            <td align='right'>               <b>641</b>            </td>         </tr>      </table>     ",
      "master-IT test failed: https://www.kaminsky.me/nc-dev/android-integrationTests/3691-IT-master-13-28 ",
      "The backport to stable-3.19 failed. Please do this backport manually."
    ]
  },
  "Bug Filter": "** Security Vulnerability Fix  \n**Confidence Score:** 0.95",
  "Bug Filter Confidence": 0.95,
  "Bug Filter Response": "\n\nThe patch modifies how PendingIntents are created to make them immutable, a security best practice that prevents malicious modification of intents, thus enhancing the app's security.\n\n**Final Classification:** Security Vulnerability Fix  \n**Confidence Score:** 0.95"
}