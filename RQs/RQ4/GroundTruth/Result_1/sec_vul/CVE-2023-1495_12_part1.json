{
  "cve_id": "CVE-2023-1495",
  "cwe_ids": [
    "CWE-89"
  ],
  "cvss_vector": "AV:N/AC:L/Au:S/C:P/I:P/A:P",
  "cvss_is_v3": false,
  "repo_name": "getrebuild/rebuild",
  "commit_msg": "H5 sync2 (#595)\n\n* style: 目录样式gh\r\n\r\n* style: J_new\r\n\r\n* feat: advListFilterTabs\r\n\r\n* feat: nav-copyto\r\n\r\n* enh: 助记码全拼\r\n\r\n* enh: 地图搜索选点\r\n\r\n* enh: topnav\r\n\r\n* list pn\r\n\r\n* .form-line.v33\r\n\r\n* open TAG\r\n\r\n* KVS addShutdownHook\r\n\r\n* fix: #594\r\n\r\n---------\r\n\r\nCo-authored-by: devezhao <zhaofang123@gmail.com>",
  "commit_hash": "c9474f84e5f376dd2ade2078e3039961a9425da7",
  "git_url": "https://github.com/getrebuild/rebuild/commit/c9474f84e5f376dd2ade2078e3039961a9425da7",
  "file_path": "src/main/java/com/rebuild/web/project/ProjectTaskController.java",
  "func_name": "relatedTaskList",
  "func_before": "@RequestMapping(\"tasks/related-list\")\n    public JSON relatedTaskList(@IdParam(name = \"related\", required = false) ID relatedId,\n                                @IdParam(name = \"task\", required = false) ID taskId,\n                                HttpServletRequest request) {\n        Assert.isTrue(relatedId != null || taskId != null, Language.L(\"无效请求参数\"));\n\n        final ID user = getRequestUser(request);\n        String queryWhere = String.format(\"relatedRecord = '%s'\", relatedId);\n\n        // 关键词搜索\n        String search = getParameter(request, \"search\");\n        if (StringUtils.isNotBlank(search)) {\n            queryWhere += \" and taskName like '%\" + StringEscapeUtils.escapeSql(search) + \"%'\";\n        }\n\n        int pageNo = getIntParameter(request, \"pageNo\", 1);\n        int pageSize = getIntParameter(request, \"pageSize\", 40);\n\n        queryWhere += \" order by \" + buildQuerySort(request);\n\n        // 获取指定任务的（其他条件忽略）\n        if (taskId != null) {\n            queryWhere = String.format(\"taskId = '%s'\", taskId);\n        }\n\n        Object[][] tasks = Application.createQueryNoFilter(\n                String.format(\"select %s from ProjectTask where %s\", FMT_FIELDS11, queryWhere))\n                .setLimit(pageSize, pageNo * pageSize - pageSize)\n                .array();\n\n        JSONArray array = new JSONArray();\n        for (Object[] o : tasks) {\n            try {\n                array.add(formatTask(o, user, false));\n            } catch (ConfigurationException ex) {\n                // FIXME 无项目权限会报错（考虑任务在相关项中是否无权限也显示）\n                log.warn(ex.getLocalizedMessage());\n            }\n        }\n        return array;\n    }",
  "abstract_func_before": "@RequestMapping(\"tasks/related-list\")\n    public JSON relatedTaskList(@IdParam(VAR_0 = \"related\", VAR_1 = false) ID VAR_2,\n                                @IdParam(VAR_0 = \"task\", VAR_1 = false) ID VAR_3,\n                                HttpServletRequest VAR_4) {\n        VAR_5.isTrue(VAR_2 != null || VAR_3 != null, VAR_6.L(\"无效请求参数\"));\n\n        final ID VAR_7 = getRequestUser(VAR_4);\n        String VAR_8 = VAR_9.format(\"relatedRecord = '%s'\", VAR_2);\n\n        /* COMMENT_0 */\n        String VAR_10 = getParameter(VAR_4, \"search\");\n        if (VAR_11.isNotBlank(VAR_10)) {\n            VAR_8 += \" and taskName like '%\" + VAR_12.escapeSql(VAR_10) + \"%'\";\n        }\n\n        int VAR_13 = getIntParameter(VAR_4, \"pageNo\", 1);\n        int VAR_14 = getIntParameter(VAR_4, \"pageSize\", 40);\n\n        VAR_8 += \" order by \" + buildQuerySort(VAR_4);\n\n        /* COMMENT_1 */\n        if (VAR_3 != null) {\n            VAR_8 = VAR_9.format(\"taskId = '%s'\", VAR_3);\n        }\n\n        Object[][] VAR_15 = VAR_16.createQueryNoFilter(\n                VAR_9.format(\"select %s from ProjectTask where %s\", VAR_17, VAR_8))\n                .setLimit(VAR_14, VAR_13 * VAR_14 - VAR_14)\n                .array();\n\n        JSONArray VAR_18 = new JSONArray();\n        for (Object[] VAR_19 : VAR_15) {\n            try {\n                VAR_18.add(formatTask(VAR_19, VAR_7, false));\n            } catch (ConfigurationException VAR_20) {\n                /* COMMENT_2 */\n                VAR_21.warn(VAR_20.getLocalizedMessage());\n            }\n        }\n        return VAR_18;\n    }",
  "func_graph_path_before": "getrebuild/rebuild/c9474f84e5f376dd2ade2078e3039961a9425da7/ProjectTaskController.java/vul/before/1.json",
  "func": "@RequestMapping(\"tasks/related-list\")\n    public JSON relatedTaskList(@IdParam(name = \"related\", required = false) ID relatedId,\n                                @IdParam(name = \"task\", required = false) ID taskId,\n                                HttpServletRequest request) {\n        Assert.isTrue(relatedId != null || taskId != null, Language.L(\"无效请求参数\"));\n\n        final ID user = getRequestUser(request);\n        String queryWhere = String.format(\"relatedRecord = '%s'\", relatedId);\n\n        // 关键词搜索\n        String search = getParameter(request, \"search\");\n        if (StringUtils.isNotBlank(search)) {\n            queryWhere += \" and taskName like '%\" + CommonsUtils.escapeSql(search) + \"%'\";\n        }\n\n        int pageNo = getIntParameter(request, \"pageNo\", 1);\n        int pageSize = getIntParameter(request, \"pageSize\", 40);\n\n        queryWhere += \" order by \" + buildQuerySort(request);\n\n        // 获取指定任务的（其他条件忽略）\n        if (taskId != null) {\n            queryWhere = String.format(\"taskId = '%s'\", taskId);\n        }\n\n        Object[][] tasks = Application.createQueryNoFilter(\n                String.format(\"select %s from ProjectTask where %s\", FMT_FIELDS11, queryWhere))\n                .setLimit(pageSize, pageNo * pageSize - pageSize)\n                .array();\n\n        JSONArray array = new JSONArray();\n        for (Object[] o : tasks) {\n            try {\n                array.add(formatTask(o, user, false));\n            } catch (ConfigurationException ex) {\n                // FIXME 无项目权限会报错（考虑任务在相关项中是否无权限也显示）\n                log.warn(ex.getLocalizedMessage());\n            }\n        }\n        return array;\n    }",
  "abstract_func": "@RequestMapping(\"tasks/related-list\")\n    public JSON relatedTaskList(@IdParam(VAR_0 = \"related\", VAR_1 = false) ID VAR_2,\n                                @IdParam(VAR_0 = \"task\", VAR_1 = false) ID VAR_3,\n                                HttpServletRequest VAR_4) {\n        VAR_5.isTrue(VAR_2 != null || VAR_3 != null, VAR_6.L(\"无效请求参数\"));\n\n        final ID VAR_7 = getRequestUser(VAR_4);\n        String VAR_8 = VAR_9.format(\"relatedRecord = '%s'\", VAR_2);\n\n        /* COMMENT_0 */\n        String VAR_10 = getParameter(VAR_4, \"search\");\n        if (VAR_11.isNotBlank(VAR_10)) {\n            VAR_8 += \" and taskName like '%\" + VAR_12.escapeSql(VAR_10) + \"%'\";\n        }\n\n        int VAR_13 = getIntParameter(VAR_4, \"pageNo\", 1);\n        int VAR_14 = getIntParameter(VAR_4, \"pageSize\", 40);\n\n        VAR_8 += \" order by \" + buildQuerySort(VAR_4);\n\n        /* COMMENT_1 */\n        if (VAR_3 != null) {\n            VAR_8 = VAR_9.format(\"taskId = '%s'\", VAR_3);\n        }\n\n        Object[][] VAR_15 = VAR_16.createQueryNoFilter(\n                VAR_9.format(\"select %s from ProjectTask where %s\", VAR_17, VAR_8))\n                .setLimit(VAR_14, VAR_13 * VAR_14 - VAR_14)\n                .array();\n\n        JSONArray VAR_18 = new JSONArray();\n        for (Object[] VAR_19 : VAR_15) {\n            try {\n                VAR_18.add(formatTask(VAR_19, VAR_7, false));\n            } catch (ConfigurationException VAR_20) {\n                /* COMMENT_2 */\n                VAR_21.warn(VAR_20.getLocalizedMessage());\n            }\n        }\n        return VAR_18;\n    }",
  "func_graph_path": "getrebuild/rebuild/c9474f84e5f376dd2ade2078e3039961a9425da7/ProjectTaskController.java/vul/after/1.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -10,7 +10,7 @@\n         // 关键词搜索\n         String search = getParameter(request, \"search\");\n         if (StringUtils.isNotBlank(search)) {\n-            queryWhere += \" and taskName like '%\" + StringEscapeUtils.escapeSql(search) + \"%'\";\n+            queryWhere += \" and taskName like '%\" + CommonsUtils.escapeSql(search) + \"%'\";\n         }\n \n         int pageNo = getIntParameter(request, \"pageNo\", 1);",
  "diff_line_info": {
    "deleted_lines": [
      "            queryWhere += \" and taskName like '%\" + StringEscapeUtils.escapeSql(search) + \"%'\";"
    ],
    "added_lines": [
      "            queryWhere += \" and taskName like '%\" + CommonsUtils.escapeSql(search) + \"%'\";"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/getrebuild/rebuild/pull/595",
  "description": {
    "pr_info": {
      "title": "H5 sync2",
      "number": 595
    },
    "comment": [
      "Most styles:\r\n1. Nav copy\r\n2. Arrow for form line \r\n3. Quick-code full-pinyin\r\n4. Open Tag of field\r\n5. feat: `advListFilterTabs` (boss-key)\r\n6. Map search\r\n7. feat: Can input page-no on list\r\n8. CVE fix"
    ]
  },
  "Bug Filter": "Security Vulnerability Fix  \nConfidence Score: 0.95",
  "Bug Filter Confidence": 0.95,
  "Bug Filter Response": "\n\n**Final Output:**\n\nAnalysis: The code diff shows a change from using StringEscapeUtils.escapeSql to CommonsUtils.escapeSql, which is related to preventing SQL injection. The commit message includes a fix for #594 and mentions a CVE fix, indicating a security vulnerability.\n\nFinal Classification: Security Vulnerability Fix  \nConfidence Score: 0.95"
}