{
  "cve_id": "CVE-2020-35668",
  "cwe_ids": [
    "CWE-476"
  ],
  "cvss_vector": "AV:N/AC:L/Au:N/C:N/I:N/A:P",
  "cvss_is_v3": false,
  "repo_name": "RedisGraph",
  "commit_msg": "Address PR comments",
  "commit_hash": "7810a51d45de614d665506342191943740fe1abe",
  "git_url": "https://github.com/RedisGraph/RedisGraph/commit/7810a51d45de614d665506342191943740fe1abe",
  "file_path": "src/arithmetic/arithmetic_expression_construct.c",
  "func_name": "_AR_EXP_FromIdentifier",
  "func_before": "static AR_ExpNode *_AR_EXP_FromIdentifier(const cypher_astnode_t *expr) {\n\tAST *ast = QueryCtx_GetAST();\n\tif(ast == NULL) {\n\t\t// Attempted to access the AST before it has been constructed.\n\t\tErrorCtx_SetError(\"Attempted to access variable before it has been defined\");\n\t\treturn AR_EXP_NewConstOperandNode(SI_NullVal());\n\t}\n\n\t// check if the identifier is a named path identifier\n\tAnnotationCtx *named_paths_ctx =\n\t\tAST_AnnotationCtxCollection_GetNamedPathsCtx(ast->anot_ctx_collection);\n\n\tconst cypher_astnode_t *named_path_annotation =\n\t\tcypher_astnode_get_annotation(named_paths_ctx, expr);\n\n\t// if the identifier is a named path identifier,\n\t// evaluate the path expression accordingly\n\tif(named_path_annotation) return _AR_EXP_FromASTNode(named_path_annotation);\n\t// else, evalute the identifier\n\treturn _AR_EXP_FromIdentifierExpression(expr);\n}",
  "abstract_func_before": "static AR_ExpNode *_AR_EXP_FromIdentifier(const cypher_astnode_t *VAR_0) {\n\tAST *VAR_1 = QueryCtx_GetAST();\n\tif(VAR_1 == NULL) {\n\t\t/* COMMENT_0 */\n\t\tErrorCtx_SetError(\"Attempted to access variable before it has been defined\");\n\t\treturn AR_EXP_NewConstOperandNode(SI_NullVal());\n\t}\n\n\t/* COMMENT_1 */\n\tAnnotationCtx *VAR_2 =\n\t\tAST_AnnotationCtxCollection_GetNamedPathsCtx(VAR_1->anot_ctx_collection);\n\n\tconst cypher_astnode_t *VAR_3 =\n\t\tcypher_astnode_get_annotation(VAR_2, VAR_0);\n\n\t/* COMMENT_2 */\n\t/* COMMENT_3 */\n\tif(VAR_3) return _AR_EXP_FromASTNode(VAR_3);\n\t/* COMMENT_4 */\n\treturn _AR_EXP_FromIdentifierExpression(VAR_0);\n}",
  "func_graph_path_before": "RedisGraph/7810a51d45de614d665506342191943740fe1abe/arithmetic_expression_construct.c/vul/before/0.json",
  "func": "static AR_ExpNode *_AR_EXP_FromIdentifier(const cypher_astnode_t *expr) {\n\tAST *ast = QueryCtx_GetAST();\n\tif(ast == NULL) {\n\t\t/* Attempted to access the AST before it has been constructed.\n\t\t * This can occur in scenarios like parameter evaluation:\n\t\t * CYPHER param=[a] MATCH (a) RETURN a */\n\t\tErrorCtx_SetError(\"Attempted to access variable before it has been defined\");\n\t\treturn AR_EXP_NewConstOperandNode(SI_NullVal());\n\t}\n\n\t// check if the identifier is a named path identifier\n\tAnnotationCtx *named_paths_ctx =\n\t\tAST_AnnotationCtxCollection_GetNamedPathsCtx(ast->anot_ctx_collection);\n\n\tconst cypher_astnode_t *named_path_annotation =\n\t\tcypher_astnode_get_annotation(named_paths_ctx, expr);\n\n\t// if the identifier is a named path identifier,\n\t// evaluate the path expression accordingly\n\tif(named_path_annotation) return _AR_EXP_FromASTNode(named_path_annotation);\n\t// else, evalute the identifier\n\treturn _AR_EXP_FromIdentifierExpression(expr);\n}",
  "abstract_func": "static AR_ExpNode *_AR_EXP_FromIdentifier(const cypher_astnode_t *VAR_0) {\n\tAST *VAR_1 = QueryCtx_GetAST();\n\tif(VAR_1 == NULL) {\n\t\t/* COMMENT_0 */\n                                                           \n                                           \n\t\tErrorCtx_SetError(\"Attempted to access variable before it has been defined\");\n\t\treturn AR_EXP_NewConstOperandNode(SI_NullVal());\n\t}\n\n\t/* COMMENT_3 */\n\tAnnotationCtx *VAR_2 =\n\t\tAST_AnnotationCtxCollection_GetNamedPathsCtx(VAR_1->anot_ctx_collection);\n\n\tconst cypher_astnode_t *VAR_3 =\n\t\tcypher_astnode_get_annotation(VAR_2, VAR_0);\n\n\t/* COMMENT_4 */\n\t/* COMMENT_5 */\n\tif(VAR_3) return _AR_EXP_FromASTNode(VAR_3);\n\t/* COMMENT_6 */\n\treturn _AR_EXP_FromIdentifierExpression(VAR_0);\n}",
  "func_graph_path": "RedisGraph/7810a51d45de614d665506342191943740fe1abe/arithmetic_expression_construct.c/vul/after/0.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -1,7 +1,9 @@\n static AR_ExpNode *_AR_EXP_FromIdentifier(const cypher_astnode_t *expr) {\n \tAST *ast = QueryCtx_GetAST();\n \tif(ast == NULL) {\n-\t\t// Attempted to access the AST before it has been constructed.\n+\t\t/* Attempted to access the AST before it has been constructed.\n+\t\t * This can occur in scenarios like parameter evaluation:\n+\t\t * CYPHER param=[a] MATCH (a) RETURN a */\n \t\tErrorCtx_SetError(\"Attempted to access variable before it has been defined\");\n \t\treturn AR_EXP_NewConstOperandNode(SI_NullVal());\n \t}",
  "diff_line_info": {
    "deleted_lines": [
      "\t\t// Attempted to access the AST before it has been constructed."
    ],
    "added_lines": [
      "\t\t/* Attempted to access the AST before it has been constructed.",
      "\t\t * This can occur in scenarios like parameter evaluation:",
      "\t\t * CYPHER param=[a] MATCH (a) RETURN a */"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/RedisGraph/RedisGraph/pull/1503",
  "description": {
    "pr_info": {
      "title": "Error on alias references in parameters",
      "number": 1503
    },
    "comment": [
      "Causes a compile-time error to be emitted when parameters refer to AST identifier nodes (unquoted strings).\r\n\r\nResolves #1502."
    ]
  },
  "Bug Filter": "Testing & Validation Updates",
  "Bug Filter Confidence": 0.9,
  "Bug Filter Response": "**Final Classification:** Testing & Validation Updates; **Confidence:** 0.9\n\nThe patch addresses a compile-time error related to unquoted strings in parameters by improving error handling and adding comments, which falls under Testing & Validation Updates. The confidence is high due to clear code changes, though some ambiguity exists regarding the exact purpose."
}