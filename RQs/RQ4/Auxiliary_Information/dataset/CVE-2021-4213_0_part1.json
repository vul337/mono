{
  "cve_id": "CVE-2021-4213",
  "cwe_ids": [
    "CWE-401"
  ],
  "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H",
  "cvss_is_v3": true,
  "repo_name": "dogtagpki/jss",
  "commit_msg": "Fix memory leak on each TLS connection\n\nEach TLS connection is leaking a bunch of data that isn't in the heap\nand so after 25k requests Tomcat uses about 2.5GB resident memory.\n\nThere are large number of relationships that point at each other and we\nneed to break the cycle so JSSEngineReferenceImpl's finalizer can run\nand clear all the native resources these point at.\n\nThe lowest impact place to break the cycle was at SSLAlertEvent.engine.\nThis relationship doesn't seem to be used anywhere.  Once the cycle is\nbroken, JSSEngineReferenceImpl can be garbage collected and the\nfinalizer can run.\n\nSigned-off-by: Chris Kelley <ckelley@redhat.com>",
  "commit_hash": "5922560a78d0dee61af8a33cc9cfbf4cfa291448",
  "git_url": "https://github.com/dogtagpki/jss/commit/5922560a78d0dee61af8a33cc9cfbf4cfa291448",
  "file_path": "src/main/java/org/mozilla/jss/nss/SSLFDProxy.java",
  "func_name": "releaseNativeResources",
  "func_before": "@Override\n    protected synchronized void releaseNativeResources() throws Exception {\n        synchronized (globalRef) {\n            if (globalRef != null) {\n                try {\n                    globalRef.close();\n                } finally {\n                    globalRef = null;\n                }\n            }\n        }\n    }",
  "abstract_func_before": "@Override\n    protected synchronized void releaseNativeResources() throws Exception {\n        synchronized (VAR_0) {\n            if (VAR_0 != null) {\n                try {\n                    VAR_0.close();\n                } finally {\n                    VAR_0 = null;\n                }\n            }\n        }\n    }",
  "func_graph_path_before": "dogtagpki/jss/5922560a78d0dee61af8a33cc9cfbf4cfa291448/SSLFDProxy.java/vul/before/0.json",
  "func": "@Override\n    protected synchronized void releaseNativeResources() throws Exception {\n\n        super.releaseNativeResources();\n\n        if (globalRef != null) {\n            try {\n                globalRef.close();\n            } finally {\n                globalRef = null;\n            }\n        }\n    }",
  "abstract_func": "@Override\n    protected synchronized void releaseNativeResources() throws Exception {\n\n        super.releaseNativeResources();\n\n        if (VAR_0 != null) {\n            try {\n                VAR_0.close();\n            } finally {\n                VAR_0 = null;\n            }\n        }\n    }",
  "func_graph_path": "dogtagpki/jss/5922560a78d0dee61af8a33cc9cfbf4cfa291448/SSLFDProxy.java/vul/after/0.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -1,12 +1,13 @@\n @Override\n     protected synchronized void releaseNativeResources() throws Exception {\n-        synchronized (globalRef) {\n-            if (globalRef != null) {\n-                try {\n-                    globalRef.close();\n-                } finally {\n-                    globalRef = null;\n-                }\n+\n+        super.releaseNativeResources();\n+\n+        if (globalRef != null) {\n+            try {\n+                globalRef.close();\n+            } finally {\n+                globalRef = null;\n             }\n         }\n     }",
  "diff_line_info": {
    "deleted_lines": [
      "        synchronized (globalRef) {",
      "            if (globalRef != null) {",
      "                try {",
      "                    globalRef.close();",
      "                } finally {",
      "                    globalRef = null;",
      "                }"
    ],
    "added_lines": [
      "",
      "        super.releaseNativeResources();",
      "",
      "        if (globalRef != null) {",
      "            try {",
      "                globalRef.close();",
      "            } finally {",
      "                globalRef = null;"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/dogtagpki/jss/pull/844",
  "description": "Failed to get PR details: HTTP Request Error for PR https://github.com/dogtagpki/jss/pull/844: 403 Client Error: Forbidden for url: https://api.github.com/repos/dogtagpki/jss/pulls/844",
  "Bug Filter": "Defect Remediation & Feature Upgrades",
  "Bug Filter Confidence": 0.95,
  "Bug Filter Response": "**Final Classification:** Defect Remediation & Feature Upgrades; **Confidence:** 0.95"
}