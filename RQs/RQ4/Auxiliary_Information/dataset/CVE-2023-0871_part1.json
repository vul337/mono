{
  "cve_id": "CVE-2023-0871",
  "cwe_ids": [
    "CWE-611"
  ],
  "cvss_vector": "CVSS:3.1/AV:A/AC:L/PR:N/UI:N/S:C/C:L/I:L/A:N",
  "cvss_is_v3": true,
  "repo_name": "OpenNMS/opennms",
  "commit_msg": "NMS-15699: Prevent external xml entity loading",
  "commit_hash": "3c17231714e3d55809efc580a05734ed530f9ad4",
  "git_url": "https://github.com/OpenNMS/opennms/commit/3c17231714e3d55809efc580a05734ed530f9ad4",
  "file_path": "core/xml/src/main/java/org/opennms/core/xml/JaxbUtils.java",
  "func_name": "getXMLFilterForClass",
  "func_before": "public static <T> XMLFilter getXMLFilterForClass(final Class<T> clazz, boolean disableDOCTYPE) throws SAXException {\n        final String namespace = getNamespaceForClass(clazz);\n        XMLFilter filter = namespace == null? new SimpleNamespaceFilter(\"\", false) : new SimpleNamespaceFilter(namespace, true);\n\n        LOG.trace(\"namespace filter for class {}: {}\", clazz, filter);\n        final XMLReader xmlReader = XMLReaderFactory.createXMLReader();\n        if (disableDOCTYPE) {\n            xmlReader.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true);\n            xmlReader.setFeature(\"http://xml.org/sax/features/external-general-entities\", false);\n            xmlReader.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false);\n        }\n        xmlReader.setFeature(\"http://apache.org/xml/features/nonvalidating/load-external-dtd\", false);\n\n        filter.setParent(xmlReader);\n        return filter;\n    }",
  "abstract_func_before": "public static <T> XMLFilter getXMLFilterForClass(final Class<T> VAR_0, boolean VAR_1) throws SAXException {\n        final String VAR_2 = getNamespaceForClass(VAR_0);\n        XMLFilter VAR_3 = VAR_2 == null? new SimpleNamespaceFilter(\"\", false) : new SimpleNamespaceFilter(VAR_2, true);\n\n        VAR_4.trace(\"namespace filter for class {}: {}\", VAR_0, VAR_3);\n        final XMLReader VAR_5 = VAR_6.createXMLReader();\n        if (VAR_1) {\n            VAR_5.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true);\n            VAR_5.setFeature(\"http://xml.org/sax/features/external-general-entities\", false);\n            VAR_5.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false);\n        }\n        VAR_5.setFeature(\"http://apache.org/xml/features/nonvalidating/load-external-dtd\", false);\n\n        VAR_3.setParent(VAR_5);\n        return VAR_3;\n    }",
  "func_graph_path_before": "OpenNMS/opennms/3c17231714e3d55809efc580a05734ed530f9ad4/JaxbUtils.java/vul/before/0.json",
  "func": "public static <T> XMLFilter getXMLFilterForClass(final Class<T> clazz, boolean disableDOCTYPE) throws SAXException {\n        final String namespace = getNamespaceForClass(clazz);\n        XMLFilter filter = namespace == null? new SimpleNamespaceFilter(\"\", false) : new SimpleNamespaceFilter(namespace, true);\n\n        LOG.trace(\"namespace filter for class {}: {}\", clazz, filter);\n        final XMLReader xmlReader = XMLReaderFactory.createXMLReader();\n        if (disableDOCTYPE) {\n            xmlReader.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true);\n        }\n        xmlReader.setFeature(\"http://xml.org/sax/features/external-general-entities\", false);\n        xmlReader.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false);\n        xmlReader.setFeature(\"http://apache.org/xml/features/nonvalidating/load-external-dtd\", false);\n\n        filter.setParent(xmlReader);\n        return filter;\n    }",
  "abstract_func": "public static <T> XMLFilter getXMLFilterForClass(final Class<T> VAR_0, boolean VAR_1) throws SAXException {\n        final String VAR_2 = getNamespaceForClass(VAR_0);\n        XMLFilter VAR_3 = VAR_2 == null? new SimpleNamespaceFilter(\"\", false) : new SimpleNamespaceFilter(VAR_2, true);\n\n        VAR_4.trace(\"namespace filter for class {}: {}\", VAR_0, VAR_3);\n        final XMLReader VAR_5 = VAR_6.createXMLReader();\n        if (VAR_1) {\n            VAR_5.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true);\n        }\n        VAR_5.setFeature(\"http://xml.org/sax/features/external-general-entities\", false);\n        VAR_5.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false);\n        VAR_5.setFeature(\"http://apache.org/xml/features/nonvalidating/load-external-dtd\", false);\n\n        VAR_3.setParent(VAR_5);\n        return VAR_3;\n    }",
  "func_graph_path": "OpenNMS/opennms/3c17231714e3d55809efc580a05734ed530f9ad4/JaxbUtils.java/vul/after/0.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -6,9 +6,9 @@\n         final XMLReader xmlReader = XMLReaderFactory.createXMLReader();\n         if (disableDOCTYPE) {\n             xmlReader.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true);\n-            xmlReader.setFeature(\"http://xml.org/sax/features/external-general-entities\", false);\n-            xmlReader.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false);\n         }\n+        xmlReader.setFeature(\"http://xml.org/sax/features/external-general-entities\", false);\n+        xmlReader.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false);\n         xmlReader.setFeature(\"http://apache.org/xml/features/nonvalidating/load-external-dtd\", false);\n \n         filter.setParent(xmlReader);",
  "diff_line_info": {
    "deleted_lines": [
      "            xmlReader.setFeature(\"http://xml.org/sax/features/external-general-entities\", false);",
      "            xmlReader.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false);"
    ],
    "added_lines": [
      "        xmlReader.setFeature(\"http://xml.org/sax/features/external-general-entities\", false);",
      "        xmlReader.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false);"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/OpenNMS/opennms/pull/6355",
  "description": {
    "pr_info": {
      "title": "NMS-15699: Prevent external xml entity loading",
      "number": 6355
    },
    "comment": [
      "### All Contributors\r\n\r\n* [ ] Have you read our [Contribution Guidelines](https://github.com/OpenNMS/opennms/blob/develop/CONTRIBUTING.md)?\r\n* [ ] Have you (electronically) signed the [OpenNMS Contributor Agreement](https://cla-assistant.io/OpenNMS/opennms)?\r\n\r\n### Contribution Checklist\r\n\r\n* Please [make an issue in the OpenNMS issue tracker](https://opennms.atlassian.net/) if there isn't one already.<br />Once there is an issue, please:\r\n  1. update the title of this PR to be in the format: `${JIRA-ISSUE-NUMBER}: subject of pull request`\r\n  2. update the Jira link at the bottom of this comment to refer to the real issue number\r\n  3. prefix your commit messages with the issue number, if possible\r\n  4. once you've created this PR, please link to it in a comment in the Jira issue\r\n  Don't worry if this sounds like a lot, we can help you get things set up properly.\r\n* **If this code is likely to affect the UI, did you name your branch with `-smoke` in it to trigger smoke tests?**\r\n* If this is a new or updated feature, is there documentation for the new behavior?\r\n* If this is new code, are there unit and/or integration tests?\r\n* If this PR targets a `foundation-*` branch, does it try to avoid changing files in `$OPENNMS_HOME/etc/`?\r\n\r\n### What's Next?\r\n\r\nA PR should be assigned at least 2 reviewers.  If you know that someone would be a good person to review your code, feel free to add them.\r\n\r\nIf you need help making additions or changes to the documentation related to your changes, please let us know.\r\n\r\nIn any case, if anything is unclear or you want help getting your PR ready for merge, please don't hesitate to say something in the comments here,\r\nor in [the #opennms-development chat channel](https://chat.opennms.com/opennms/channels/opennms-development).\r\n\r\nOnce reviewer(s) accept the PR and the branch passes continuous integration, the PR is eligible for merge.\r\n\r\nAt that time, if you have commit access (are an OpenNMS Group employee or a member of the OGP) you are welcome to merge the PR when you're ready.\r\nOtherwise, a reviewer can merge it for you.\r\n\r\nThanks for taking time to contribute!\r\n\r\n### External References\r\n\r\n* Jira (Issue Tracker): https://opennms.atlassian.net/browse/NMS-15699\r\n\r\n",
      "> another that should go back to `foundation-2023` or earlier if possible\r\n\r\nThis was just introduced in 2023",
      "@RangerRick @christianpape Do we have a rough idea when this fix will be released? Since the defect was reported by external researchers, they are approaching for a timeframe of the release. Thanks!",
      "> Do we have a rough idea when this fix will be released? Since the defect was reported by external researchers, they are approaching for a timeframe of the release. Thanks!\r\n\r\n@qunhe it's merged, so it'll be in the normal monthly (2nd Wednesday of the month) release schedule, which means it should go out with the August 9th Meridian 2023 and Horizon 32 builds.\r\n\r\n(In general, if you see something has been merged, barring complications you can expect it will apply to the branch it was merged to and up, on the next 2nd Wednesday.)",
      "Readme need to update"
    ]
  },
  "Bug Filter": "Security Vulnerability Fix",
  "Bug Filter Confidence": 0.9,
  "Bug Filter Response": "**Step-by-Step Explanation:**\n\n1. **Commit Message Analysis**: The message indicates a fix to prevent external XML entity loading, suggesting a security issue.\n\n2. **Vulnerability Description**: Lacks specific security terms but the context from the commit and code implies a security focus.\n\n3. **Code Changes**: Disabling external entity processing in XML parsing to prevent potential XXE attacks, a common security measure.\n\n4. **Conclusion**: The changes address a security vulnerability by mitigating external entity risks.\n\n**Final Classification:** Security Vulnerability Fix  \n**Confidence:** 0.9"
}