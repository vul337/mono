{
  "cve_id": "CVE-2024-0822",
  "cwe_ids": [
    "CWE-287"
  ],
  "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:N",
  "cvss_is_v3": true,
  "repo_name": "oVirt/ovirt-engine",
  "commit_msg": "Disable execution of CreateUserSession from GWT code\n\nCreateUserSesssion should be executed only as a part of login flow, so\nexplicitly disable execution from GWT code.\n\nSigned-off-by: Martin Perina <mperina@redhat.com>",
  "commit_hash": "036f617316f6d7077cd213eb613eb4816e33d1fc",
  "git_url": "https://github.com/oVirt/ovirt-engine/commit/036f617316f6d7077cd213eb613eb4816e33d1fc",
  "file_path": "frontend/webadmin/modules/frontend/src/main/java/org/ovirt/engine/ui/frontend/server/gwt/GenericApiGWTServiceImpl.java",
  "func_name": "runAction",
  "func_before": "@Override\n    public ActionReturnValue runAction(ActionType actionType,\n            ActionParametersBase params) {\n        log.debug(\"Server: RunAction invoked!\"); //$NON-NLS-1$\n        debugAction(actionType, params);\n        params.setSessionId(getEngineSessionId());\n        if (params.getCorrelationId() == null) {\n            params.setCorrelationId(CorrelationIdTracker.getCorrelationId());\n        }\n\n        return getBackend().runAction(actionType, params);\n    }",
  "abstract_func_before": "@Override\n    public ActionReturnValue runAction(ActionType VAR_0,\n            ActionParametersBase VAR_1) {\n        VAR_2.debug(\"Server: RunAction invoked!\"); /* COMMENT_0 */\n        debugAction(VAR_0, VAR_1);\n        VAR_1.setSessionId(getEngineSessionId());\n        if (VAR_1.getCorrelationId() == null) {\n            VAR_1.setCorrelationId(VAR_3.getCorrelationId());\n        }\n\n        return getBackend().runAction(VAR_0, VAR_1);\n    }",
  "func_graph_path_before": "oVirt/ovirt-engine/036f617316f6d7077cd213eb613eb4816e33d1fc/GenericApiGWTServiceImpl.java/vul/before/0.json",
  "func": "@Override\n    public ActionReturnValue runAction(ActionType actionType,\n            ActionParametersBase params) {\n        log.debug(\"Server: RunAction invoked!\"); //$NON-NLS-1$\n        debugAction(actionType, params);\n\n        // CreateUserSession should never be invoked from GWT code\n        if (actionType == ActionType.CreateUserSession) {\n            ActionReturnValue error = new ActionReturnValue();\n            error.setSucceeded(false);\n            error.setFault(new EngineFault(new RuntimeException(\"Command cannot be executed from client\"))); //$NON-NLS-1$\n            return error;\n        }\n\n        params.setSessionId(getEngineSessionId());\n        if (params.getCorrelationId() == null) {\n            params.setCorrelationId(CorrelationIdTracker.getCorrelationId());\n        }\n\n        return getBackend().runAction(actionType, params);\n    }",
  "abstract_func": "@Override\n    public ActionReturnValue runAction(ActionType VAR_0,\n            ActionParametersBase VAR_1) {\n        VAR_2.debug(\"Server: RunAction invoked!\"); /* COMMENT_0 */\n        debugAction(VAR_0, VAR_1);\n\n        /* COMMENT_1 */\n        if (VAR_0 == VAR_3.CreateUserSession) {\n            ActionReturnValue VAR_4 = new ActionReturnValue();\n            VAR_4.setSucceeded(false);\n            VAR_4.setFault(new EngineFault(new RuntimeException(\"Command cannot be executed from client\"))); /* COMMENT_0 */\n            return VAR_4;\n        }\n\n        VAR_1.setSessionId(getEngineSessionId());\n        if (VAR_1.getCorrelationId() == null) {\n            VAR_1.setCorrelationId(VAR_5.getCorrelationId());\n        }\n\n        return getBackend().runAction(VAR_0, VAR_1);\n    }",
  "func_graph_path": "oVirt/ovirt-engine/036f617316f6d7077cd213eb613eb4816e33d1fc/GenericApiGWTServiceImpl.java/vul/after/0.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -3,6 +3,15 @@\n             ActionParametersBase params) {\n         log.debug(\"Server: RunAction invoked!\"); //$NON-NLS-1$\n         debugAction(actionType, params);\n+\n+        // CreateUserSession should never be invoked from GWT code\n+        if (actionType == ActionType.CreateUserSession) {\n+            ActionReturnValue error = new ActionReturnValue();\n+            error.setSucceeded(false);\n+            error.setFault(new EngineFault(new RuntimeException(\"Command cannot be executed from client\"))); //$NON-NLS-1$\n+            return error;\n+        }\n+\n         params.setSessionId(getEngineSessionId());\n         if (params.getCorrelationId() == null) {\n             params.setCorrelationId(CorrelationIdTracker.getCorrelationId());",
  "diff_line_info": {
    "deleted_lines": [],
    "added_lines": [
      "",
      "        // CreateUserSession should never be invoked from GWT code",
      "        if (actionType == ActionType.CreateUserSession) {",
      "            ActionReturnValue error = new ActionReturnValue();",
      "            error.setSucceeded(false);",
      "            error.setFault(new EngineFault(new RuntimeException(\"Command cannot be executed from client\"))); //$NON-NLS-1$",
      "            return error;",
      "        }",
      ""
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/oVirt/ovirt-engine/pull/914",
  "description": {
    "pr_info": {
      "title": "Disable execution of CreateUserSession from GWT code",
      "number": 914
    },
    "comment": [
      "CreateUserSesssion should be executed only as a part of login flow, so\nexplicitly disable execution from GWT code.\n\nSigned-off-by: Martin Perina <mperina@redhat.com>\n",
      "/ost",
      "/ost basic-suite-master el9stream",
      "(it won't pass all the way, but el9stream should get all the way till UI tests, IIRC)",
      "/ost basic-suite-master el9stream",
      "/ost basic-suite-master el9stream",
      "/ost basic-suite-master el9stream",
      "OST passed on CS9, merging"
    ]
  },
  "Bug Filter": "Security Vulnerability Fix",
  "Bug Filter Confidence": 0.9,
  "Bug Filter Response": "**Final Classification:** Security Vulnerability Fix;  \n**Confidence:** 0.9"
}