{
  "cve_id": "CVE-2016-7031",
  "cwe_ids": [
    "CWE-254",
    "CWE-200"
  ],
  "cvss_vector": "AV:N/AC:M/Au:N/C:P/I:N/A:N",
  "cvss_is_v3": false,
  "repo_name": "ceph",
  "commit_msg": "13207: Rados Gateway: Anonymous user is able to read bucket with authenticated read ACL\n\nSigned-off-by: root <rahul.1aggarwal@gmail.com>",
  "commit_hash": "99ba6610a8f437604cadf68cbe9969def893e870",
  "git_url": "https://github.com/ceph/ceph/commit/99ba6610a8f437604cadf68cbe9969def893e870",
  "file_path": "src/rgw/rgw_acl_s3.cc",
  "func_name": "RGWAccessControlPolicy_S3::compare_group_name",
  "func_before": "bool RGWAccessControlPolicy_S3::compare_group_name(string& id, ACLGroupTypeEnum group)\n{\n  switch (group) {\n  case ACL_GROUP_ALL_USERS:\n    return (id.compare(rgw_uri_all_users) == 0);\n  case ACL_GROUP_AUTHENTICATED_USERS:\n    return (id.compare(rgw_uri_auth_users) == 0);\n  default:\n    return id.empty();\n  }\n\n  // shouldn't get here\n  return false;\n}",
  "abstract_func_before": "bool RGWAccessControlPolicy_S3::compare_group_name(string& VAR_0, ACLGroupTypeEnum VAR_1)\n{\n  switch (VAR_1) {\n  case VAR_2:\n    return (VAR_0.compare(VAR_3) == 0);\n  case VAR_4:\n    return (VAR_0.compare(VAR_5) == 0);\n  default:\n    return VAR_0.empty();\n  }\n\n  /* COMMENT_0 */\n  return false;\n}",
  "func_graph_path_before": "ceph/99ba6610a8f437604cadf68cbe9969def893e870/rgw_acl_s3.cc/vul/before/0.json",
  "func": "bool RGWAccessControlPolicy_S3::compare_group_name(string& id, ACLGroupTypeEnum group)\n{\n  switch (group) {\n  case ACL_GROUP_ALL_USERS:\n    return (id.compare(RGW_USER_ANON_ID) == 0);\n  case ACL_GROUP_AUTHENTICATED_USERS:\n    return (id.compare(rgw_uri_auth_users) == 0);\n  default:\n    return id.empty();\n  }\n\n  // shouldn't get here\n  return false;\n}",
  "abstract_func": "bool RGWAccessControlPolicy_S3::compare_group_name(string& VAR_0, ACLGroupTypeEnum VAR_1)\n{\n  switch (VAR_1) {\n  case VAR_2:\n    return (VAR_0.compare(VAR_3) == 0);\n  case VAR_4:\n    return (VAR_0.compare(VAR_5) == 0);\n  default:\n    return VAR_0.empty();\n  }\n\n  /* COMMENT_0 */\n  return false;\n}",
  "func_graph_path": "ceph/99ba6610a8f437604cadf68cbe9969def893e870/rgw_acl_s3.cc/vul/after/0.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -2,7 +2,7 @@\n {\n   switch (group) {\n   case ACL_GROUP_ALL_USERS:\n-    return (id.compare(rgw_uri_all_users) == 0);\n+    return (id.compare(RGW_USER_ANON_ID) == 0);\n   case ACL_GROUP_AUTHENTICATED_USERS:\n     return (id.compare(rgw_uri_auth_users) == 0);\n   default:",
  "diff_line_info": {
    "deleted_lines": [
      "    return (id.compare(rgw_uri_all_users) == 0);"
    ],
    "added_lines": [
      "    return (id.compare(RGW_USER_ANON_ID) == 0);"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/ceph/ceph/pull/6057",
  "description": {
    "pr_info": {
      "title": "Bug #13207:  Rados Gateway: Anonymous user is able to read bucket with authenticated read ACL",
      "number": 6057
    },
    "comment": [
      "Fix for http://tracker.ceph.com/issues/13207\n\nThe public user id in rados gateway is \"anonymous\" defined by RGW_USER_ANON_ID\nDuring a public read of a bucket (for example by generating a public url and accessing it), the method to know whether the user is public or not, the id is being compared with the public user group's uri and not with RGW_USER_ANON_ID. This led to the public user being considered as an authenticated user and hence read of a bucket is working even when the canned acl for the bucket is set to \"authenticated-read\".\nAlso, the bucket_acl  object is always being created of the base type RGWAccessControlPolicy while it should be created based on the dialect of the the request (s3 or swift)\n",
      "@yehudasa \nWhen \"authenticated-read\" ACL is applied on a bucket; anonymous user is also able to read (eg. list) the bucket. But as per S3 documentation only authenticated users should be allowed to access the bucket.\nThis commit tries to fix this problem. A testcase is listed in the bug at http://tracker.ceph.com/issues/13207 \nPlease let me know if this sounds like a genuine issue\n",
      "@rahul1aggarwal I understand. My question was about the specific lines change in rgw_op.cc.\n",
      "SUCCESS: http://jenkins.ceph.dachary.org/job/ceph/7986/\n- SUCCESS http://jenkins.ceph.dachary.org/job/ceph/LABELS=centos-7&&x86_64/7986/\n",
      "SUCCESS: http://jenkins.ceph.dachary.org/job/ceph/7987/\n- SUCCESS http://jenkins.ceph.dachary.org/job/ceph/LABELS=centos-7&&x86_64/7987/\n",
      "@rahul1aggarwal ,\ncan you please remove the merge commit and sign the commits.\n",
      "SUCCESS: http://jenkins.ceph.dachary.org/job/ceph/9426/\n- SUCCESS http://jenkins.ceph.dachary.org/job/ceph/LABELS=centos-7&&x86_64/9426/\n",
      "@oritwas ,\nremoved the merge commit and signed the commit. thanks\n",
      "SUCCESS: http://jenkins.ceph.dachary.org/job/ceph/9427/\n- SUCCESS http://jenkins.ceph.dachary.org/job/ceph/LABELS=centos-7&&x86_64/9427/\n",
      "SUCCESS: http://jenkins.ceph.dachary.org/job/ceph/9428/\n- SUCCESS http://jenkins.ceph.dachary.org/job/ceph/LABELS=centos-7&&x86_64/9428/\n",
      "@oritwas\nthanks for merging\n"
    ]
  },
  "Bug Filter": "Security Vulnerability Fix",
  "Bug Filter Confidence": 1.0,
  "Bug Filter Response": "**Final Classification:** Security Vulnerability Fix; **Confidence:** 1.0"
}