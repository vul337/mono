{
  "cve_id": "CVE-2020-28346",
  "cwe_ids": [
    "CWE-476"
  ],
  "cvss_vector": "AV:N/AC:L/Au:N/C:N/I:N/A:P",
  "cvss_is_v3": false,
  "repo_name": "projectacrn/acrn-hypervisor",
  "commit_msg": "dm: virtio: check for paddr_guest2host return value\n\npaddr_guest2host can return NULL, but code paths in virtio\nare not checking the return value.\n_vq_record() initializes iov_base pointer using paddr_guest2host()\nbut there is nothing in the flow that checks for NULL.\nChane _vq_record to return -1 in case the address translation\nhas failed.\n\nTracked-On: #5452\nSigned-off-by: Tomas Winkler <tomas.winkler@intel.com>\nAcked-by: Wang, Yu1 <yu1.wang@intel.com>",
  "commit_hash": "ae0ab82434509d6e75f4a2f1e1a0dd2ee3dc3681",
  "git_url": "https://github.com/projectacrn/acrn-hypervisor/commit/ae0ab82434509d6e75f4a2f1e1a0dd2ee3dc3681",
  "file_path": "devicemodel/hw/pci/virtio/virtio.c",
  "func_name": "_vq_record",
  "func_before": "static inline void\n_vq_record(int i, volatile struct vring_desc *vd, struct vmctx *ctx,\n\t   struct iovec *iov, int n_iov, uint16_t *flags) {\n\n\tif (i >= n_iov)\n\t\treturn;\n\tiov[i].iov_base = paddr_guest2host(ctx, vd->addr, vd->len);\n\tiov[i].iov_len = vd->len;\n\tif (flags != NULL)\n\t\tflags[i] = vd->flags;\n}",
  "abstract_func_before": "static inline void\n_vq_record(int VAR_0, volatile struct vring_desc *VAR_1, struct vmctx *VAR_2,\n\t   struct iovec *VAR_3, int VAR_4, uint16_t *VAR_5) {\n\n\tif (VAR_0 >= VAR_4)\n\t\treturn;\n\tVAR_3[VAR_0].iov_base = paddr_guest2host(VAR_2, VAR_1->addr, VAR_1->len);\n\tVAR_3[VAR_0].iov_len = VAR_1->len;\n\tif (VAR_5 != NULL)\n\t\tVAR_5[VAR_0] = VAR_1->flags;\n}",
  "func_graph_path_before": "projectacrn/acrn-hypervisor/ae0ab82434509d6e75f4a2f1e1a0dd2ee3dc3681/virtio.c/vul/before/1.json",
  "func": "static inline int\n_vq_record(int i, volatile struct vring_desc *vd, struct vmctx *ctx,\n\t   struct iovec *iov, int n_iov, uint16_t *flags) {\n\n\tvoid *host_addr;\n\n\tif (i >= n_iov)\n\t\treturn -1;\n\thost_addr = paddr_guest2host(ctx, vd->addr, vd->len);\n\tif (!host_addr)\n\t\treturn -1;\n\tiov[i].iov_base = host_addr;\n\tiov[i].iov_len = vd->len;\n\tif (flags != NULL)\n\t\tflags[i] = vd->flags;\n\treturn 0;\n}",
  "abstract_func": "static inline int\n_vq_record(int VAR_0, volatile struct vring_desc *VAR_1, struct vmctx *VAR_2,\n\t   struct iovec *VAR_3, int VAR_4, uint16_t *VAR_5) {\n\n\tvoid *VAR_6;\n\n\tif (VAR_0 >= VAR_4)\n\t\treturn -1;\n\tVAR_6 = paddr_guest2host(VAR_2, VAR_1->addr, VAR_1->len);\n\tif (!VAR_6)\n\t\treturn -1;\n\tVAR_3[VAR_0].iov_base = VAR_6;\n\tVAR_3[VAR_0].iov_len = VAR_1->len;\n\tif (VAR_5 != NULL)\n\t\tVAR_5[VAR_0] = VAR_1->flags;\n\treturn 0;\n}",
  "func_graph_path": "projectacrn/acrn-hypervisor/ae0ab82434509d6e75f4a2f1e1a0dd2ee3dc3681/virtio.c/vul/after/1.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -1,11 +1,17 @@\n-static inline void\n+static inline int\n _vq_record(int i, volatile struct vring_desc *vd, struct vmctx *ctx,\n \t   struct iovec *iov, int n_iov, uint16_t *flags) {\n \n+\tvoid *host_addr;\n+\n \tif (i >= n_iov)\n-\t\treturn;\n-\tiov[i].iov_base = paddr_guest2host(ctx, vd->addr, vd->len);\n+\t\treturn -1;\n+\thost_addr = paddr_guest2host(ctx, vd->addr, vd->len);\n+\tif (!host_addr)\n+\t\treturn -1;\n+\tiov[i].iov_base = host_addr;\n \tiov[i].iov_len = vd->len;\n \tif (flags != NULL)\n \t\tflags[i] = vd->flags;\n+\treturn 0;\n }",
  "diff_line_info": {
    "deleted_lines": [
      "static inline void",
      "\t\treturn;",
      "\tiov[i].iov_base = paddr_guest2host(ctx, vd->addr, vd->len);"
    ],
    "added_lines": [
      "static inline int",
      "\tvoid *host_addr;",
      "",
      "\t\treturn -1;",
      "\thost_addr = paddr_guest2host(ctx, vd->addr, vd->len);",
      "\tif (!host_addr)",
      "\t\treturn -1;",
      "\tiov[i].iov_base = host_addr;",
      "\treturn 0;"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/projectacrn/acrn-hypervisor/pull/5453",
  "description": "Failed to get PR details: HTTP Request Error for PR https://github.com/projectacrn/acrn-hypervisor/pull/5453: 403 Client Error: Forbidden for url: https://api.github.com/repos/projectacrn/acrn-hypervisor/pulls/5453",
  "Bug Filter": "Defect Remediation & Feature Upgrades",
  "Bug Filter Confidence": 0.8,
  "Bug Filter Response": "The patch addresses a potential issue where a function's return value isn't checked, which could cause bugs. Since it's not explicitly mentioned as a security issue, it falls under defect remediation.\n\n**Final Classification:** Defect Remediation & Feature Upgrades  \n**Confidence:** 0.8  \n\nThe change adds a necessary NULL check in core functionality without security implications."
}