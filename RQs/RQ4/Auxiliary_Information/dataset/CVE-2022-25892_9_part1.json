{
  "cve_id": "CVE-2022-25892",
  "cwe_ids": [
    "CWE-Other"
  ],
  "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H",
  "cvss_is_v3": true,
  "repo_name": "galkahana/HummusJS",
  "commit_msg": "corrections",
  "commit_hash": "a9bf2520ab5abb69f9328906e406fbebfb36159a",
  "git_url": "https://github.com/galkahana/HummusJS/commit/a9bf2520ab5abb69f9328906e406fbebfb36159a",
  "file_path": "src/deps/PDFWriter/PDFParser.cpp",
  "func_name": "PDFParser::ParseLastXrefPosition",
  "func_before": "EStatusCode PDFParser::ParseLastXrefPosition()\n{\n\tEStatusCode status = PDFHummus::eSuccess;\n\n\t// next two lines should be the xref position and then \"startxref\"\n\n\tdo\n\t{\n\n\t\t// find and read xref position\n\t\tif(!GoBackTillToken())\n\t\t{\n\t\t\tstatus = PDFHummus::eFailure;\n\t\t\tTRACE_LOG(\"PDFParser::ParseXrefPosition, couldn't find xref position token\");\n\t\t\tbreak;\n\t\t}\n\n\t\tGoBackTillLineStart();\n\n\t\t// now go forward, and here i'm guessing a bit, till you get to either and integer, or the startxref keyword\n\t\tmStream->SetPositionFromEnd(GetCurrentPositionFromEnd());\n\n\t\tmObjectParser.ResetReadState();\n\t\tRefCountPtr<PDFObject> anObject(mObjectParser.ParseNewObject());\n\n\t\tif(anObject->GetType() == PDFObject::ePDFObjectInteger)\n\t\t{\n\t\t\tmLastXrefPosition = (LongFilePositionType)((PDFInteger*)anObject.GetPtr())->GetValue();\n\n\t\t\t// find and read startxref keyword\n\t\t\tif(!GoBackTillToken())\n\t\t\t{\n\t\t\t\tstatus = PDFHummus::eFailure;\n\t\t\t\tTRACE_LOG(\"PDFParser::ParseXrefPosition, couldn't find startxref keyword\");\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tGoBackTillLineStart();\n\t\t\tmStream->SetPositionFromEnd(GetCurrentPositionFromEnd());\n\n\t\t\tmObjectParser.ResetReadState();\n\t\t\tPDFObjectCastPtr<PDFSymbol> startxRef(mObjectParser.ParseNewObject());\n\n\t\t\tif(!startxRef || startxRef->GetValue() != scStartxref)\n\t\t\t{\n\t\t\t\tstatus = PDFHummus::eFailure;\n\t\t\t\tTRACE_LOG(\"PDFParser::ParseXrefPosition, syntax error in reading xref position\");\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\telse // this means that the line is not only integer, a bit more complicated path, look for startxref and then the next would be the number\n\t\t{\n\t\t\tbool foundStartXref = (anObject->GetType() == PDFObject::ePDFObjectSymbol) && (((PDFSymbol*)anObject.GetPtr())->GetValue() == scStartxref);\n\n\t\t\twhile(!foundStartXref && mStream->NotEnded())\n\t\t\t{\n\t\t\t\tPDFObjectCastPtr<PDFSymbol> startxRef(mObjectParser.ParseNewObject());\n\t\t\t\tfoundStartXref = startxRef.GetPtr() && (startxRef->GetValue() == scStartxref);\n\t\t\t}\n\n\t\t\tif(!foundStartXref)\n\t\t\t{\n\t\t\t\tstatus = PDFHummus::eFailure;\n\t\t\t\tTRACE_LOG(\"PDFParser::ParseXrefPosition, could not find startxref keyword\");\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tPDFObjectCastPtr<PDFInteger> xrefPosition(mObjectParser.ParseNewObject());\n\t\t\tif(!xrefPosition)\n\t\t\t{\n\t\t\t\tstatus = PDFHummus::eFailure;\n\t\t\t\tTRACE_LOG(\"PDFParser::ParseXrefPosition, syntax error in reading xref position\");\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tmLastXrefPosition = xrefPosition->GetValue();\n\t\t}\n\n\t}while(false);\n\n\treturn status;\n\n}",
  "abstract_func_before": "EStatusCode PDFParser::ParseLastXrefPosition()\n{\n\tEStatusCode VAR_0 = PDFHummus::eSuccess;\n\n\t/* COMMENT_0 */\n\n\tdo\n\t{\n\n\t\t/* COMMENT_1 */\n\t\tif(!GoBackTillToken())\n\t\t{\n\t\t\tVAR_0 = PDFHummus::eFailure;\n\t\t\tTRACE_LOG(\"PDFParser::ParseXrefPosition, couldn't find xref position token\");\n\t\t\tbreak;\n\t\t}\n\n\t\tGoBackTillLineStart();\n\n\t\t/* COMMENT_2 */\n\t\tVAR_1->SetPositionFromEnd(GetCurrentPositionFromEnd());\n\n\t\tVAR_2.ResetReadState();\n\t\tRefCountPtr<PDFObject> VAR_3(VAR_2.ParseNewObject());\n\n\t\tif(VAR_3->GetType() == PDFObject::ePDFObjectInteger)\n\t\t{\n\t\t\tVAR_4 = (VAR_5)((PDFInteger*)VAR_3.GetPtr())->GetValue();\n\n\t\t\t/* COMMENT_3 */\n\t\t\tif(!GoBackTillToken())\n\t\t\t{\n\t\t\t\tVAR_0 = PDFHummus::eFailure;\n\t\t\t\tTRACE_LOG(\"PDFParser::ParseXrefPosition, couldn't find startxref keyword\");\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tGoBackTillLineStart();\n\t\t\tVAR_1->SetPositionFromEnd(GetCurrentPositionFromEnd());\n\n\t\t\tVAR_2.ResetReadState();\n\t\t\tPDFObjectCastPtr<PDFSymbol> VAR_6(VAR_2.ParseNewObject());\n\n\t\t\tif(!VAR_6 || VAR_6->GetValue() != VAR_7)\n\t\t\t{\n\t\t\t\tVAR_0 = PDFHummus::eFailure;\n\t\t\t\tTRACE_LOG(\"PDFParser::ParseXrefPosition, syntax error in reading xref position\");\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\telse /* COMMENT_4 */\n\t\t{\n\t\t\tbool VAR_8 = (VAR_3->GetType() == PDFObject::ePDFObjectSymbol) && (((PDFSymbol*)VAR_3.GetPtr())->GetValue() == VAR_7);\n\n\t\t\twhile(!VAR_8 && VAR_1->NotEnded())\n\t\t\t{\n\t\t\t\tPDFObjectCastPtr<PDFSymbol> VAR_6(VAR_2.ParseNewObject());\n\t\t\t\tVAR_8 = VAR_6.GetPtr() && (VAR_6->GetValue() == VAR_7);\n\t\t\t}\n\n\t\t\tif(!VAR_8)\n\t\t\t{\n\t\t\t\tVAR_0 = PDFHummus::eFailure;\n\t\t\t\tTRACE_LOG(\"PDFParser::ParseXrefPosition, could not find startxref keyword\");\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tPDFObjectCastPtr<PDFInteger> VAR_9(VAR_2.ParseNewObject());\n\t\t\tif(!VAR_9)\n\t\t\t{\n\t\t\t\tVAR_0 = PDFHummus::eFailure;\n\t\t\t\tTRACE_LOG(\"PDFParser::ParseXrefPosition, syntax error in reading xref position\");\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tVAR_4 = VAR_9->GetValue();\n\t\t}\n\n\t}while(false);\n\n\treturn VAR_0;\n\n}",
  "func_graph_path_before": "galkahana/HummusJS/a9bf2520ab5abb69f9328906e406fbebfb36159a/PDFParser.cpp/vul/before/0.json",
  "func": "EStatusCode PDFParser::ParseLastXrefPosition()\n{\n\tEStatusCode status = PDFHummus::eSuccess;\n\n\t// next two lines should be the xref position and then \"startxref\"\n\n\tdo\n\t{\n\n\t\t// find and read xref position\n\t\tif(!GoBackTillToken())\n\t\t{\n\t\t\tstatus = PDFHummus::eFailure;\n\t\t\tTRACE_LOG(\"PDFParser::ParseXrefPosition, couldn't find xref position token\");\n\t\t\tbreak;\n\t\t}\n\n\t\tGoBackTillLineStart();\n\n\t\t// now go forward, and here i'm guessing a bit, till you get to either and integer, or the startxref keyword\n\t\tmStream->SetPositionFromEnd(GetCurrentPositionFromEnd());\n\n\t\tmObjectParser.ResetReadState();\n\t\tRefCountPtr<PDFObject> anObject(mObjectParser.ParseNewObject());\n\n\t\tif (!anObject) {\n\t\t\tstatus = PDFHummus::eFailure;\n\t\t\tTRACE_LOG(\"PDFParser::ParseXrefPosition: Unable to find any object\");\n\t\t\tbreak;\n\t\t}\n\n\t\tif(anObject->GetType() == PDFObject::ePDFObjectInteger)\n\t\t{\n\t\t\tmLastXrefPosition = (LongFilePositionType)((PDFInteger*)anObject.GetPtr())->GetValue();\n\n\t\t\t// find and read startxref keyword\n\t\t\tif(!GoBackTillToken())\n\t\t\t{\n\t\t\t\tstatus = PDFHummus::eFailure;\n\t\t\t\tTRACE_LOG(\"PDFParser::ParseXrefPosition, couldn't find startxref keyword\");\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tGoBackTillLineStart();\n\t\t\tmStream->SetPositionFromEnd(GetCurrentPositionFromEnd());\n\n\t\t\tmObjectParser.ResetReadState();\n\t\t\tPDFObjectCastPtr<PDFSymbol> startxRef(mObjectParser.ParseNewObject());\n\n\t\t\tif(!startxRef || startxRef->GetValue() != scStartxref)\n\t\t\t{\n\t\t\t\tstatus = PDFHummus::eFailure;\n\t\t\t\tTRACE_LOG(\"PDFParser::ParseXrefPosition, syntax error in reading xref position\");\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\telse // this means that the line is not only integer, a bit more complicated path, look for startxref and then the next would be the number\n\t\t{\n\t\t\tbool foundStartXref = (anObject->GetType() == PDFObject::ePDFObjectSymbol) && (((PDFSymbol*)anObject.GetPtr())->GetValue() == scStartxref);\n\n\t\t\twhile(!foundStartXref && mStream->NotEnded())\n\t\t\t{\n\t\t\t\tPDFObjectCastPtr<PDFSymbol> startxRef(mObjectParser.ParseNewObject());\n\t\t\t\tfoundStartXref = startxRef.GetPtr() && (startxRef->GetValue() == scStartxref);\n\t\t\t}\n\n\t\t\tif(!foundStartXref)\n\t\t\t{\n\t\t\t\tstatus = PDFHummus::eFailure;\n\t\t\t\tTRACE_LOG(\"PDFParser::ParseXrefPosition, could not find startxref keyword\");\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tPDFObjectCastPtr<PDFInteger> xrefPosition(mObjectParser.ParseNewObject());\n\t\t\tif(!xrefPosition)\n\t\t\t{\n\t\t\t\tstatus = PDFHummus::eFailure;\n\t\t\t\tTRACE_LOG(\"PDFParser::ParseXrefPosition, syntax error in reading xref position\");\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tmLastXrefPosition = xrefPosition->GetValue();\n\t\t}\n\n\t}while(false);\n\n\treturn status;\n\n}",
  "abstract_func": "EStatusCode PDFParser::ParseLastXrefPosition()\n{\n\tEStatusCode VAR_0 = PDFHummus::eSuccess;\n\n\t/* COMMENT_0 */\n\n\tdo\n\t{\n\n\t\t/* COMMENT_1 */\n\t\tif(!GoBackTillToken())\n\t\t{\n\t\t\tVAR_0 = PDFHummus::eFailure;\n\t\t\tTRACE_LOG(\"PDFParser::ParseXrefPosition, couldn't find xref position token\");\n\t\t\tbreak;\n\t\t}\n\n\t\tGoBackTillLineStart();\n\n\t\t/* COMMENT_2 */\n\t\tVAR_1->SetPositionFromEnd(GetCurrentPositionFromEnd());\n\n\t\tVAR_2.ResetReadState();\n\t\tRefCountPtr<PDFObject> VAR_3(VAR_2.ParseNewObject());\n\n\t\tif (!VAR_3) {\n\t\t\tVAR_0 = PDFHummus::eFailure;\n\t\t\tTRACE_LOG(\"PDFParser::ParseXrefPosition: Unable to find any object\");\n\t\t\tbreak;\n\t\t}\n\n\t\tif(VAR_3->GetType() == PDFObject::ePDFObjectInteger)\n\t\t{\n\t\t\tVAR_4 = (VAR_5)((PDFInteger*)VAR_3.GetPtr())->GetValue();\n\n\t\t\t/* COMMENT_3 */\n\t\t\tif(!GoBackTillToken())\n\t\t\t{\n\t\t\t\tVAR_0 = PDFHummus::eFailure;\n\t\t\t\tTRACE_LOG(\"PDFParser::ParseXrefPosition, couldn't find startxref keyword\");\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tGoBackTillLineStart();\n\t\t\tVAR_1->SetPositionFromEnd(GetCurrentPositionFromEnd());\n\n\t\t\tVAR_2.ResetReadState();\n\t\t\tPDFObjectCastPtr<PDFSymbol> VAR_6(VAR_2.ParseNewObject());\n\n\t\t\tif(!VAR_6 || VAR_6->GetValue() != VAR_7)\n\t\t\t{\n\t\t\t\tVAR_0 = PDFHummus::eFailure;\n\t\t\t\tTRACE_LOG(\"PDFParser::ParseXrefPosition, syntax error in reading xref position\");\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\telse /* COMMENT_4 */\n\t\t{\n\t\t\tbool VAR_8 = (VAR_3->GetType() == PDFObject::ePDFObjectSymbol) && (((PDFSymbol*)VAR_3.GetPtr())->GetValue() == VAR_7);\n\n\t\t\twhile(!VAR_8 && VAR_1->NotEnded())\n\t\t\t{\n\t\t\t\tPDFObjectCastPtr<PDFSymbol> VAR_6(VAR_2.ParseNewObject());\n\t\t\t\tVAR_8 = VAR_6.GetPtr() && (VAR_6->GetValue() == VAR_7);\n\t\t\t}\n\n\t\t\tif(!VAR_8)\n\t\t\t{\n\t\t\t\tVAR_0 = PDFHummus::eFailure;\n\t\t\t\tTRACE_LOG(\"PDFParser::ParseXrefPosition, could not find startxref keyword\");\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tPDFObjectCastPtr<PDFInteger> VAR_9(VAR_2.ParseNewObject());\n\t\t\tif(!VAR_9)\n\t\t\t{\n\t\t\t\tVAR_0 = PDFHummus::eFailure;\n\t\t\t\tTRACE_LOG(\"PDFParser::ParseXrefPosition, syntax error in reading xref position\");\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tVAR_4 = VAR_9->GetValue();\n\t\t}\n\n\t}while(false);\n\n\treturn VAR_0;\n\n}",
  "func_graph_path": "galkahana/HummusJS/a9bf2520ab5abb69f9328906e406fbebfb36159a/PDFParser.cpp/vul/after/0.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -22,6 +22,12 @@\n \n \t\tmObjectParser.ResetReadState();\n \t\tRefCountPtr<PDFObject> anObject(mObjectParser.ParseNewObject());\n+\n+\t\tif (!anObject) {\n+\t\t\tstatus = PDFHummus::eFailure;\n+\t\t\tTRACE_LOG(\"PDFParser::ParseXrefPosition: Unable to find any object\");\n+\t\t\tbreak;\n+\t\t}\n \n \t\tif(anObject->GetType() == PDFObject::ePDFObjectInteger)\n \t\t{",
  "diff_line_info": {
    "deleted_lines": [],
    "added_lines": [
      "",
      "\t\tif (!anObject) {",
      "\t\t\tstatus = PDFHummus::eFailure;",
      "\t\t\tTRACE_LOG(\"PDFParser::ParseXrefPosition: Unable to find any object\");",
      "\t\t\tbreak;",
      "\t\t}"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/galkahana/HummusJS/pull/464",
  "description": {
    "pr_info": {
      "title": "Npe corrections",
      "number": 464
    },
    "comment": [
      "corrections based on discussion in:\r\nhttps://github.com/galkahana/HummusJS/issues/463\r\n\r\n+ note recommending transition to muhammara\r\n+ safe metadata release with deletable instead of void* which never got here apparently\r\n",
      "pending on travis build enablement"
    ]
  },
  "Bug Filter": "Security Vulnerability Fix",
  "Bug Filter Confidence": 0.9,
  "Bug Filter Response": "**Final Classification:** Security Vulnerability Fix  \n**Confidence:** 0.9"
}