{
  "cve_id": "CVE-2018-16391",
  "cwe_ids": [
    "CWE-415",
    "CWE-119"
  ],
  "cvss_vector": "AV:L/AC:L/Au:N/C:P/I:P/A:P",
  "cvss_is_v3": false,
  "repo_name": "OpenSC",
  "commit_msg": "fixed out of bounds writes\n\nThanks to Eric Sesterhenn from X41 D-SEC GmbH\nfor reporting the problems.",
  "commit_hash": "360e95d45ac4123255a4c796db96337f332160ad",
  "git_url": "https://github.com/OpenSC/OpenSC/commit/360e95d45ac4123255a4c796db96337f332160ad",
  "file_path": "src/libopensc/sc.c",
  "func_name": "sc_file_set_sec_attr",
  "func_before": "int sc_file_set_sec_attr(sc_file_t *file, const u8 *sec_attr,\n\t\t\t size_t sec_attr_len)\n{\n\tu8 *tmp;\n\tif (!sc_file_valid(file)) {\n\t\treturn SC_ERROR_INVALID_ARGUMENTS;\n\t}\n\n\tif (sec_attr == NULL) {\n\t\tif (file->sec_attr != NULL)\n\t\t\tfree(file->sec_attr);\n\t\tfile->sec_attr = NULL;\n\t\tfile->sec_attr_len = 0;\n\t\treturn 0;\n\t }\n\ttmp = (u8 *) realloc(file->sec_attr, sec_attr_len);\n\tif (!tmp) {\n\t\tif (file->sec_attr)\n\t\t\tfree(file->sec_attr);\n\t\tfile->sec_attr     = NULL;\n\t\tfile->sec_attr_len = 0;\n\t\treturn SC_ERROR_OUT_OF_MEMORY;\n\t}\n\tfile->sec_attr = tmp;\n\tmemcpy(file->sec_attr, sec_attr, sec_attr_len);\n\tfile->sec_attr_len = sec_attr_len;\n\n\treturn 0;\n}",
  "abstract_func_before": "int sc_file_set_sec_attr(sc_file_t *VAR_0, const u8 *VAR_1,\n\t\t\t size_t VAR_2)\n{\n\tu8 *VAR_3;\n\tif (!sc_file_valid(VAR_0)) {\n\t\treturn VAR_4;\n\t}\n\n\tif (VAR_1 == NULL) {\n\t\tif (VAR_0->sec_attr != NULL)\n\t\t\tfree(VAR_0->sec_attr);\n\t\tVAR_0->sec_attr = NULL;\n\t\tVAR_0->sec_attr_len = 0;\n\t\treturn 0;\n\t }\n\tVAR_3 = (u8 *) realloc(VAR_0->sec_attr, VAR_2);\n\tif (!VAR_3) {\n\t\tif (VAR_0->sec_attr)\n\t\t\tfree(VAR_0->sec_attr);\n\t\tVAR_0->sec_attr     = NULL;\n\t\tVAR_0->sec_attr_len = 0;\n\t\treturn VAR_5;\n\t}\n\tVAR_0->sec_attr = VAR_3;\n\tmemcpy(VAR_0->sec_attr, VAR_1, VAR_2);\n\tVAR_0->sec_attr_len = VAR_2;\n\n\treturn 0;\n}",
  "func_graph_path_before": "OpenSC/360e95d45ac4123255a4c796db96337f332160ad/sc.c/vul/before/0.json",
  "func": "int sc_file_set_sec_attr(sc_file_t *file, const u8 *sec_attr,\n\t\t\t size_t sec_attr_len)\n{\n\tu8 *tmp;\n\tif (!sc_file_valid(file)) {\n\t\treturn SC_ERROR_INVALID_ARGUMENTS;\n\t}\n\n\tif (sec_attr == NULL || sec_attr_len) {\n\t\tif (file->sec_attr != NULL)\n\t\t\tfree(file->sec_attr);\n\t\tfile->sec_attr = NULL;\n\t\tfile->sec_attr_len = 0;\n\t\treturn 0;\n\t }\n\ttmp = (u8 *) realloc(file->sec_attr, sec_attr_len);\n\tif (!tmp) {\n\t\tif (file->sec_attr)\n\t\t\tfree(file->sec_attr);\n\t\tfile->sec_attr     = NULL;\n\t\tfile->sec_attr_len = 0;\n\t\treturn SC_ERROR_OUT_OF_MEMORY;\n\t}\n\tfile->sec_attr = tmp;\n\tmemcpy(file->sec_attr, sec_attr, sec_attr_len);\n\tfile->sec_attr_len = sec_attr_len;\n\n\treturn 0;\n}",
  "abstract_func": "int sc_file_set_sec_attr(sc_file_t *VAR_0, const u8 *VAR_1,\n\t\t\t size_t VAR_2)\n{\n\tu8 *VAR_3;\n\tif (!sc_file_valid(VAR_0)) {\n\t\treturn VAR_4;\n\t}\n\n\tif (VAR_1 == NULL || VAR_2) {\n\t\tif (VAR_0->sec_attr != NULL)\n\t\t\tfree(VAR_0->sec_attr);\n\t\tVAR_0->sec_attr = NULL;\n\t\tVAR_0->sec_attr_len = 0;\n\t\treturn 0;\n\t }\n\tVAR_3 = (u8 *) realloc(VAR_0->sec_attr, VAR_2);\n\tif (!VAR_3) {\n\t\tif (VAR_0->sec_attr)\n\t\t\tfree(VAR_0->sec_attr);\n\t\tVAR_0->sec_attr     = NULL;\n\t\tVAR_0->sec_attr_len = 0;\n\t\treturn VAR_5;\n\t}\n\tVAR_0->sec_attr = VAR_3;\n\tmemcpy(VAR_0->sec_attr, VAR_1, VAR_2);\n\tVAR_0->sec_attr_len = VAR_2;\n\n\treturn 0;\n}",
  "func_graph_path": "OpenSC/360e95d45ac4123255a4c796db96337f332160ad/sc.c/vul/after/0.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -6,7 +6,7 @@\n \t\treturn SC_ERROR_INVALID_ARGUMENTS;\n \t}\n \n-\tif (sec_attr == NULL) {\n+\tif (sec_attr == NULL || sec_attr_len) {\n \t\tif (file->sec_attr != NULL)\n \t\t\tfree(file->sec_attr);\n \t\tfile->sec_attr = NULL;",
  "diff_line_info": {
    "deleted_lines": [
      "\tif (sec_attr == NULL) {"
    ],
    "added_lines": [
      "\tif (sec_attr == NULL || sec_attr_len) {"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/OpenSC/OpenSC/pull/1447",
  "description": {
    "pr_info": {
      "title": "Security issues identified by fuzzing",
      "number": 1447
    },
    "comment": [
      "This PR merges changes addressing issues identified by fuzzing OpenSC driver by Eric Sesterhenn. The separate commits are authored mostly by @frankmorgner, @dengert, Eric and me.\r\n\r\nFor more information, see the blog post:\r\n\r\nhttps://www.x41-dsec.de/lab/blog/smartcards/\r\n\r\nThe changes were tested to ensure they still work for the cards we have, but testing with more cards would be always appreciated.\r\n\r\n##### Checklist\r\n<!-- Remove items that do not apply. For completed items, change [ ] to [x]. -->\r\n- [X] PKCS#11 module is tested\r\n- [ ] Windows minidriver is tested\r\n- [ ] macOS tokend is tested\r\n"
    ]
  },
  "Bug Filter": "Security Vulnerability Fix",
  "Bug Filter Confidence": 1.0,
  "Bug Filter Response": "**Final Classification:** Security Vulnerability Fix; **Confidence:** 1.0"
}