{
  "cve_id": "CVE-2024-0822",
  "cwe_ids": [
    "CWE-287"
  ],
  "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:N",
  "cvss_is_v3": true,
  "repo_name": "oVirt/ovirt-engine",
  "commit_msg": "Disable execution of CreateUserSession from GWT code\n\nCreateUserSesssion should be executed only as a part of login flow, so\nexplicitly disable execution from GWT code.\n\nSigned-off-by: Martin Perina <mperina@redhat.com>",
  "commit_hash": "036f617316f6d7077cd213eb613eb4816e33d1fc",
  "git_url": "https://github.com/oVirt/ovirt-engine/commit/036f617316f6d7077cd213eb613eb4816e33d1fc",
  "file_path": "frontend/webadmin/modules/frontend/src/main/java/org/ovirt/engine/ui/frontend/server/gwt/GenericApiGWTServiceImpl.java",
  "func_name": "runMultipleActions",
  "func_before": "@Override\n    public List<ActionReturnValue> runMultipleActions(ActionType actionType,\n            ArrayList<ActionParametersBase> multipleParams, boolean isRunOnlyIfAllValidationPass, boolean isWaitForResult) {\n        log.debug(\"Server: RunMultipleAction invoked! [amount of actions: {}]\", multipleParams.size()); //$NON-NLS-1$\n\n        String correlationId = CorrelationIdTracker.getCorrelationId();\n        for (ActionParametersBase params : multipleParams) {\n            params.setSessionId(getEngineSessionId());\n            if (params.getCorrelationId() == null) {\n                params.setCorrelationId(correlationId);\n            }\n        }\n\n        List<ActionReturnValue> returnValues =\n                getBackend().runMultipleActions(actionType, multipleParams, isRunOnlyIfAllValidationPass, isWaitForResult);\n\n        return returnValues;\n    }",
  "abstract_func_before": "@Override\n    public List<ActionReturnValue> runMultipleActions(ActionType VAR_0,\n            ArrayList<ActionParametersBase> VAR_1, boolean VAR_2, boolean VAR_3) {\n        VAR_4.debug(\"Server: RunMultipleAction invoked! [amount of actions: {}]\", VAR_1.size()); /* COMMENT_0 */\n\n        String VAR_5 = VAR_6.getCorrelationId();\n        for (ActionParametersBase VAR_7 : VAR_1) {\n            VAR_7.setSessionId(getEngineSessionId());\n            if (VAR_7.getCorrelationId() == null) {\n                VAR_7.setCorrelationId(VAR_5);\n            }\n        }\n\n        List<ActionReturnValue> VAR_8 =\n                getBackend().runMultipleActions(VAR_0, VAR_1, VAR_2, VAR_3);\n\n        return VAR_8;\n    }",
  "func_graph_path_before": "oVirt/ovirt-engine/036f617316f6d7077cd213eb613eb4816e33d1fc/GenericApiGWTServiceImpl.java/vul/before/1.json",
  "func": "@Override\n    public List<ActionReturnValue> runMultipleActions(ActionType actionType,\n            ArrayList<ActionParametersBase> multipleParams, boolean isRunOnlyIfAllValidationPass, boolean isWaitForResult) {\n        log.debug(\"Server: RunMultipleAction invoked! [amount of actions: {}]\", multipleParams.size()); //$NON-NLS-1$\n\n        // CreateUserSession should never be invoked from GWT code\n        if (actionType == ActionType.CreateUserSession) {\n            ActionReturnValue error = new ActionReturnValue();\n            error.setSucceeded(false);\n            error.setFault(new EngineFault(new RuntimeException(\"Command cannot be executed from client\"))); //$NON-NLS-1$\n            return Arrays.asList(error);\n        }\n\n        String correlationId = CorrelationIdTracker.getCorrelationId();\n        for (ActionParametersBase params : multipleParams) {\n            params.setSessionId(getEngineSessionId());\n            if (params.getCorrelationId() == null) {\n                params.setCorrelationId(correlationId);\n            }\n\n        }\n\n        List<ActionReturnValue> returnValues =\n                getBackend().runMultipleActions(actionType, multipleParams, isRunOnlyIfAllValidationPass, isWaitForResult);\n\n        return returnValues;\n    }",
  "abstract_func": "@Override\n    public List<ActionReturnValue> runMultipleActions(ActionType VAR_0,\n            ArrayList<ActionParametersBase> VAR_1, boolean VAR_2, boolean VAR_3) {\n        VAR_4.debug(\"Server: RunMultipleAction invoked! [amount of actions: {}]\", VAR_1.size()); /* COMMENT_0 */\n\n        /* COMMENT_1 */\n        if (VAR_0 == VAR_5.CreateUserSession) {\n            ActionReturnValue VAR_6 = new ActionReturnValue();\n            VAR_6.setSucceeded(false);\n            VAR_6.setFault(new EngineFault(new RuntimeException(\"Command cannot be executed from client\"))); /* COMMENT_0 */\n            return VAR_7.asList(VAR_6);\n        }\n\n        String VAR_8 = VAR_9.getCorrelationId();\n        for (ActionParametersBase VAR_10 : VAR_1) {\n            VAR_10.setSessionId(getEngineSessionId());\n            if (VAR_10.getCorrelationId() == null) {\n                VAR_10.setCorrelationId(VAR_8);\n            }\n\n        }\n\n        List<ActionReturnValue> VAR_11 =\n                getBackend().runMultipleActions(VAR_0, VAR_1, VAR_2, VAR_3);\n\n        return VAR_11;\n    }",
  "func_graph_path": "oVirt/ovirt-engine/036f617316f6d7077cd213eb613eb4816e33d1fc/GenericApiGWTServiceImpl.java/vul/after/1.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -2,6 +2,14 @@\n     public List<ActionReturnValue> runMultipleActions(ActionType actionType,\n             ArrayList<ActionParametersBase> multipleParams, boolean isRunOnlyIfAllValidationPass, boolean isWaitForResult) {\n         log.debug(\"Server: RunMultipleAction invoked! [amount of actions: {}]\", multipleParams.size()); //$NON-NLS-1$\n+\n+        // CreateUserSession should never be invoked from GWT code\n+        if (actionType == ActionType.CreateUserSession) {\n+            ActionReturnValue error = new ActionReturnValue();\n+            error.setSucceeded(false);\n+            error.setFault(new EngineFault(new RuntimeException(\"Command cannot be executed from client\"))); //$NON-NLS-1$\n+            return Arrays.asList(error);\n+        }\n \n         String correlationId = CorrelationIdTracker.getCorrelationId();\n         for (ActionParametersBase params : multipleParams) {\n@@ -9,6 +17,7 @@\n             if (params.getCorrelationId() == null) {\n                 params.setCorrelationId(correlationId);\n             }\n+\n         }\n \n         List<ActionReturnValue> returnValues =",
  "diff_line_info": {
    "deleted_lines": [],
    "added_lines": [
      "",
      "        // CreateUserSession should never be invoked from GWT code",
      "        if (actionType == ActionType.CreateUserSession) {",
      "            ActionReturnValue error = new ActionReturnValue();",
      "            error.setSucceeded(false);",
      "            error.setFault(new EngineFault(new RuntimeException(\"Command cannot be executed from client\"))); //$NON-NLS-1$",
      "            return Arrays.asList(error);",
      "        }",
      ""
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/oVirt/ovirt-engine/pull/914",
  "description": {
    "pr_info": {
      "title": "Disable execution of CreateUserSession from GWT code",
      "number": 914
    },
    "comment": [
      "CreateUserSesssion should be executed only as a part of login flow, so\nexplicitly disable execution from GWT code.\n\nSigned-off-by: Martin Perina <mperina@redhat.com>\n",
      "/ost",
      "/ost basic-suite-master el9stream",
      "(it won't pass all the way, but el9stream should get all the way till UI tests, IIRC)",
      "/ost basic-suite-master el9stream",
      "/ost basic-suite-master el9stream",
      "/ost basic-suite-master el9stream",
      "OST passed on CS9, merging"
    ]
  },
  "Bug Filter": "Security Vulnerability Fix",
  "Bug Filter Confidence": 0.9,
  "Bug Filter Response": "**Final Classification:** Security Vulnerability Fix; **Confidence:** 0.9"
}