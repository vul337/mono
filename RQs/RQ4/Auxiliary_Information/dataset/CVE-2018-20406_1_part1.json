{
  "cve_id": "CVE-2018-20406",
  "cwe_ids": [
    "CWE-190"
  ],
  "cvss_vector": "AV:N/AC:L/Au:N/C:N/I:N/A:P",
  "cvss_is_v3": false,
  "repo_name": "python/cpython",
  "commit_msg": "closes bpo-34656: Avoid relying on signed overflow in _pickle memos. (GH-9261)",
  "commit_hash": "a4ae828ee416a66d8c7bf5ee71d653c2cc6a26dd",
  "git_url": "https://github.com/python/cpython/commit/a4ae828ee416a66d8c7bf5ee71d653c2cc6a26dd",
  "file_path": "Modules/_pickle.c",
  "func_name": "_pickle_UnpicklerMemoProxy_copy_impl",
  "func_before": "static PyObject *\n_pickle_UnpicklerMemoProxy_copy_impl(UnpicklerMemoProxyObject *self)\n/*[clinic end generated code: output=e12af7e9bc1e4c77 input=97769247ce032c1d]*/\n{\n    Py_ssize_t i;\n    PyObject *new_memo = PyDict_New();\n    if (new_memo == NULL)\n        return NULL;\n\n    for (i = 0; i < self->unpickler->memo_size; i++) {\n        int status;\n        PyObject *key, *value;\n\n        value = self->unpickler->memo[i];\n        if (value == NULL)\n            continue;\n\n        key = PyLong_FromSsize_t(i);\n        if (key == NULL)\n            goto error;\n        status = PyDict_SetItem(new_memo, key, value);\n        Py_DECREF(key);\n        if (status < 0)\n            goto error;\n    }\n    return new_memo;\n\nerror:\n    Py_DECREF(new_memo);\n    return NULL;\n}",
  "abstract_func_before": "static PyObject *\n_pickle_UnpicklerMemoProxy_copy_impl(UnpicklerMemoProxyObject *VAR_0)\n/* COMMENT_0 */\n{\n    Py_ssize_t VAR_1;\n    PyObject *VAR_2 = PyDict_New();\n    if (VAR_2 == NULL)\n        return NULL;\n\n    for (VAR_1 = 0; VAR_1 < VAR_0->unpickler->memo_size; VAR_1++) {\n        int VAR_3;\n        PyObject *VAR_4, *VAR_5;\n\n        VAR_5 = VAR_0->unpickler->memo[VAR_1];\n        if (VAR_5 == NULL)\n            continue;\n\n        VAR_4 = PyLong_FromSsize_t(VAR_1);\n        if (VAR_4 == NULL)\n            goto error;\n        VAR_3 = PyDict_SetItem(VAR_2, VAR_4, VAR_5);\n        Py_DECREF(VAR_4);\n        if (VAR_3 < 0)\n            goto error;\n    }\n    return VAR_2;\n\nerror:\n    Py_DECREF(VAR_2);\n    return NULL;\n}",
  "func_graph_path_before": "python/cpython/a4ae828ee416a66d8c7bf5ee71d653c2cc6a26dd/_pickle.c/vul/before/2.json",
  "func": "static PyObject *\n_pickle_UnpicklerMemoProxy_copy_impl(UnpicklerMemoProxyObject *self)\n/*[clinic end generated code: output=e12af7e9bc1e4c77 input=97769247ce032c1d]*/\n{\n    size_t i;\n    PyObject *new_memo = PyDict_New();\n    if (new_memo == NULL)\n        return NULL;\n\n    for (i = 0; i < self->unpickler->memo_size; i++) {\n        int status;\n        PyObject *key, *value;\n\n        value = self->unpickler->memo[i];\n        if (value == NULL)\n            continue;\n\n        key = PyLong_FromSsize_t(i);\n        if (key == NULL)\n            goto error;\n        status = PyDict_SetItem(new_memo, key, value);\n        Py_DECREF(key);\n        if (status < 0)\n            goto error;\n    }\n    return new_memo;\n\nerror:\n    Py_DECREF(new_memo);\n    return NULL;\n}",
  "abstract_func": "static PyObject *\n_pickle_UnpicklerMemoProxy_copy_impl(UnpicklerMemoProxyObject *VAR_0)\n/* COMMENT_0 */\n{\n    size_t VAR_1;\n    PyObject *VAR_2 = PyDict_New();\n    if (VAR_2 == NULL)\n        return NULL;\n\n    for (VAR_1 = 0; VAR_1 < VAR_0->unpickler->memo_size; VAR_1++) {\n        int VAR_3;\n        PyObject *VAR_4, *VAR_5;\n\n        VAR_5 = VAR_0->unpickler->memo[VAR_1];\n        if (VAR_5 == NULL)\n            continue;\n\n        VAR_4 = PyLong_FromSsize_t(VAR_1);\n        if (VAR_4 == NULL)\n            goto error;\n        VAR_3 = PyDict_SetItem(VAR_2, VAR_4, VAR_5);\n        Py_DECREF(VAR_4);\n        if (VAR_3 < 0)\n            goto error;\n    }\n    return VAR_2;\n\nerror:\n    Py_DECREF(VAR_2);\n    return NULL;\n}",
  "func_graph_path": "python/cpython/a4ae828ee416a66d8c7bf5ee71d653c2cc6a26dd/_pickle.c/vul/after/2.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -2,7 +2,7 @@\n _pickle_UnpicklerMemoProxy_copy_impl(UnpicklerMemoProxyObject *self)\n /*[clinic end generated code: output=e12af7e9bc1e4c77 input=97769247ce032c1d]*/\n {\n-    Py_ssize_t i;\n+    size_t i;\n     PyObject *new_memo = PyDict_New();\n     if (new_memo == NULL)\n         return NULL;",
  "diff_line_info": {
    "deleted_lines": [
      "    Py_ssize_t i;"
    ],
    "added_lines": [
      "    size_t i;"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/python/cpython/pull/9261",
  "description": "Failed to get PR details: HTTP Request Error for PR https://github.com/python/cpython/pull/9261: 403 Client Error: Forbidden for url: https://api.github.com/repos/python/cpython/pulls/9261",
  "Bug Filter": "Security Vulnerability Fix",
  "Bug Filter Confidence": 0.85,
  "Bug Filter Response": "**Final Classification:** Security Vulnerability Fix; **Confidence:** 0.85"
}