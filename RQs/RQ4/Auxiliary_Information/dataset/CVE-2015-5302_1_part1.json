{
  "cve_id": "CVE-2015-5302",
  "cwe_ids": [
    "CWE-200"
  ],
  "cvss_vector": "AV:N/AC:L/Au:N/C:P/I:N/A:N",
  "cvss_is_v3": false,
  "repo_name": "abrt/libreport",
  "commit_msg": "wizard: fix save users changes after reviewing dump dir files\n\nIf the user reviewed the dump dir's files during reporting the crash, the\nchanges was thrown away and original data was passed to the bugzilla bug\nreport.\n\nreport-gtk saves the first text view buffer and then reloads data from the\nreported problem directory, which causes that the changes made to those text\nviews are thrown away.\n\nFunction save_text_if_changed(), except of saving text, also reload the files\nfrom dump dir and update gui state from the dump dir. The commit moves the\nreloading and updating gui functions away from this function.\n\nRelated to rhbz#1270235\n\nSigned-off-by: Matej Habrnal <mhabrnal@redhat.com>",
  "commit_hash": "257578a23d1537a2d235aaa2b1488ee4f818e360",
  "git_url": "https://github.com/abrt/libreport/commit/257578a23d1537a2d235aaa2b1488ee4f818e360",
  "file_path": "src/gui-wizard-gtk/wizard.c",
  "func_name": "save_text_if_changed",
  "func_before": "static void save_text_if_changed(const char *name, const char *new_value)\n{\n    /* a text value can't be change if the file is not loaded */\n    /* returns NULL if the name is not found; otherwise nonzero */\n    if (!g_hash_table_lookup(g_loaded_texts, name))\n        return;\n\n    const char *old_value = g_cd ? problem_data_get_content_or_NULL(g_cd, name) : \"\";\n    if (!old_value)\n        old_value = \"\";\n    if (strcmp(new_value, old_value) != 0)\n    {\n        struct dump_dir *dd = wizard_open_directory_for_writing(g_dump_dir_name);\n        if (dd)\n            dd_save_text(dd, name, new_value);\n\n//FIXME: else: what to do with still-unsaved data in the widget??\n        dd_close(dd);\n        problem_data_reload_from_dump_dir();\n        update_gui_state_from_problem_data(/* don't update selected event */ 0);\n    }\n}",
  "abstract_func_before": "static void save_text_if_changed(const char *VAR_0, const char *VAR_1)\n{\n    /* COMMENT_0 */\n    /* COMMENT_1 */\n    if (!g_hash_table_lookup(VAR_2, VAR_0))\n        return;\n\n    const char *VAR_3 = VAR_4 ? problem_data_get_content_or_NULL(VAR_4, VAR_0) : \"\";\n    if (!VAR_3)\n        VAR_3 = \"\";\n    if (strcmp(VAR_1, VAR_3) != 0)\n    {\n        struct dump_dir *VAR_5 = wizard_open_directory_for_writing(VAR_6);\n        if (VAR_5)\n            dd_save_text(VAR_5, VAR_0, VAR_1);\n\n/* COMMENT_2 */\n        dd_close(VAR_5);\n        problem_data_reload_from_dump_dir();\n        update_gui_state_from_problem_data(/* COMMENT_3 */ 0);\n    }\n}",
  "func_graph_path_before": "abrt/libreport/257578a23d1537a2d235aaa2b1488ee4f818e360/wizard.c/vul/before/2.json",
  "func": "static void save_text_if_changed(const char *name, const char *new_value)\n{\n    /* a text value can't be change if the file is not loaded */\n    /* returns NULL if the name is not found; otherwise nonzero */\n    if (!g_hash_table_lookup(g_loaded_texts, name))\n        return;\n\n    const char *old_value = g_cd ? problem_data_get_content_or_NULL(g_cd, name) : \"\";\n    if (!old_value)\n        old_value = \"\";\n    if (strcmp(new_value, old_value) != 0)\n    {\n        struct dump_dir *dd = wizard_open_directory_for_writing(g_dump_dir_name);\n        if (dd)\n            dd_save_text(dd, name, new_value);\n\n//FIXME: else: what to do with still-unsaved data in the widget??\n        dd_close(dd);\n    }\n}",
  "abstract_func": "static void save_text_if_changed(const char *VAR_0, const char *VAR_1)\n{\n    /* COMMENT_0 */\n    /* COMMENT_1 */\n    if (!g_hash_table_lookup(VAR_2, VAR_0))\n        return;\n\n    const char *VAR_3 = VAR_4 ? problem_data_get_content_or_NULL(VAR_4, VAR_0) : \"\";\n    if (!VAR_3)\n        VAR_3 = \"\";\n    if (strcmp(VAR_1, VAR_3) != 0)\n    {\n        struct dump_dir *VAR_5 = wizard_open_directory_for_writing(VAR_6);\n        if (VAR_5)\n            dd_save_text(VAR_5, VAR_0, VAR_1);\n\n/* COMMENT_2 */\n        dd_close(VAR_5);\n    }\n}",
  "func_graph_path": "abrt/libreport/257578a23d1537a2d235aaa2b1488ee4f818e360/wizard.c/vul/after/2.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -16,7 +16,5 @@\n \n //FIXME: else: what to do with still-unsaved data in the widget??\n         dd_close(dd);\n-        problem_data_reload_from_dump_dir();\n-        update_gui_state_from_problem_data(/* don't update selected event */ 0);\n     }\n }",
  "diff_line_info": {
    "deleted_lines": [
      "        problem_data_reload_from_dump_dir();",
      "        update_gui_state_from_problem_data(/* don't update selected event */ 0);"
    ],
    "added_lines": []
  },
  "is_vul": true,
  "pr_url": "https://github.com/abrt/libreport/pull/385",
  "description": {
    "pr_info": {
      "title": "wizard: fix save users changes after reviewing dump dir files",
      "number": 385
    },
    "comment": [
      "If the user reviewed the dump dir's files during reporting the crash, the\nchanges was thrown away and original data was passed to the bugzilla bug\nreport.\n\nreport-gtk saves the first text view buffer and then reloads data from the\nreported problem directory, which causes that the changes made to those text\nviews are thrown away.\n\nThis commit fixes the security issue described above.\n\nRelated to rhbz#1270235\n\nSigned-off-by: Matej Habrnal mhabrnal@redhat.com\n"
    ]
  },
  "Bug Filter": "Security Vulnerability Fix",
  "Bug Filter Confidence": 0.7,
  "Bug Filter Response": "**Final Classification:** Security Vulnerability Fix; **Confidence:** 0.7"
}