{
  "cve_id": "CVE-2023-36812",
  "cwe_ids": [
    "CWE-74"
  ],
  "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H",
  "cvss_is_v3": true,
  "repo_name": "OpenTSDB/opentsdb",
  "commit_msg": "Improved fix for #2261.\nRegular expressions wouldn't catch the newlines or possibly other\ncontrol characters. Now we'll use the TAG validation code to make\nsure the inputs are only plain ASCII printables first.\nFixes CVE-2018-12972, CVE-2020-35476",
  "commit_hash": "07c4641471c6f5c2ab5aab615969e97211eb50d9",
  "git_url": "https://github.com/OpenTSDB/opentsdb/commit/07c4641471c6f5c2ab5aab615969e97211eb50d9",
  "file_path": "test/tsd/TestGraphHandler.java",
  "func_name": "setYRangeParams",
  "func_before": "@Test  \n  public void setYRangeParams() throws Exception {\n    assertPlotParam(\"yrange\",\"[0:1]\");\n    assertPlotParam(\"yrange\", \"[:]\");\n    assertPlotParam(\"yrange\", \"[:0]\");\n    assertPlotParam(\"yrange\", \"[:42]\");\n    assertPlotParam(\"yrange\", \"[:-42]\");\n    assertPlotParam(\"yrange\", \"[:0.8]\");\n    assertPlotParam(\"yrange\", \"[:-0.8]\");\n    assertPlotParam(\"yrange\", \"[:42.4]\");\n    assertPlotParam(\"yrange\", \"[:-42.4]\");\n    assertPlotParam(\"yrange\", \"[:4e4]\");\n    assertPlotParam(\"yrange\", \"[:-4e4]\");\n    assertPlotParam(\"yrange\", \"[:4e-4]\");\n    assertPlotParam(\"yrange\", \"[:-4e-4]\");\n    assertPlotParam(\"yrange\", \"[:4.2e4]\");\n    assertPlotParam(\"yrange\", \"[:-4.2e4]\");\n    assertPlotParam(\"yrange\", \"[0:]\");\n    assertPlotParam(\"yrange\", \"[5:]\");\n    assertPlotParam(\"yrange\", \"[-5:]\");\n    assertPlotParam(\"yrange\", \"[0.5:]\");\n    assertPlotParam(\"yrange\", \"[-0.5:]\");\n    assertPlotParam(\"yrange\", \"[10.5:]\");\n    assertPlotParam(\"yrange\", \"[-10.5:]\");\n    assertPlotParam(\"yrange\", \"[10e5:]\");\n    assertPlotParam(\"yrange\", \"[-10e5:]\");\n    assertPlotParam(\"yrange\", \"[10e-5:]\");\n    assertPlotParam(\"yrange\", \"[-10e-5:]\");\n    assertPlotParam(\"yrange\", \"[10.1e-5:]\");\n    assertPlotParam(\"yrange\", \"[-10.1e-5:]\");\n    assertPlotParam(\"yrange\", \"[-10.1e-5:-10.1e-6]\");\n    assertInvalidPlotParam(\"yrange\", \"[33:system('touch /tmp/poc.txt')]\");\n  }",
  "abstract_func_before": "@Test  \n  public void setYRangeParams() throws Exception {\n    assertPlotParam(\"yrange\",\"[0:1]\");\n    assertPlotParam(\"yrange\", \"[:]\");\n    assertPlotParam(\"yrange\", \"[:0]\");\n    assertPlotParam(\"yrange\", \"[:42]\");\n    assertPlotParam(\"yrange\", \"[:-42]\");\n    assertPlotParam(\"yrange\", \"[:0.8]\");\n    assertPlotParam(\"yrange\", \"[:-0.8]\");\n    assertPlotParam(\"yrange\", \"[:42.4]\");\n    assertPlotParam(\"yrange\", \"[:-42.4]\");\n    assertPlotParam(\"yrange\", \"[:4e4]\");\n    assertPlotParam(\"yrange\", \"[:-4e4]\");\n    assertPlotParam(\"yrange\", \"[:4e-4]\");\n    assertPlotParam(\"yrange\", \"[:-4e-4]\");\n    assertPlotParam(\"yrange\", \"[:4.2e4]\");\n    assertPlotParam(\"yrange\", \"[:-4.2e4]\");\n    assertPlotParam(\"yrange\", \"[0:]\");\n    assertPlotParam(\"yrange\", \"[5:]\");\n    assertPlotParam(\"yrange\", \"[-5:]\");\n    assertPlotParam(\"yrange\", \"[0.5:]\");\n    assertPlotParam(\"yrange\", \"[-0.5:]\");\n    assertPlotParam(\"yrange\", \"[10.5:]\");\n    assertPlotParam(\"yrange\", \"[-10.5:]\");\n    assertPlotParam(\"yrange\", \"[10e5:]\");\n    assertPlotParam(\"yrange\", \"[-10e5:]\");\n    assertPlotParam(\"yrange\", \"[10e-5:]\");\n    assertPlotParam(\"yrange\", \"[-10e-5:]\");\n    assertPlotParam(\"yrange\", \"[10.1e-5:]\");\n    assertPlotParam(\"yrange\", \"[-10.1e-5:]\");\n    assertPlotParam(\"yrange\", \"[-10.1e-5:-10.1e-6]\");\n    assertInvalidPlotParam(\"yrange\", \"[33:system('touch /tmp/poc.txt')]\");\n  }",
  "func_graph_path_before": "OpenTSDB/opentsdb/07c4641471c6f5c2ab5aab615969e97211eb50d9/TestGraphHandler.java/vul/before/1.json",
  "func": "@Test  \n  public void setYRangeParams() throws Exception {\n    assertPlotParam(\"yrange\",\"[0:1]\");\n    assertPlotParam(\"yrange\", \"[:]\");\n    assertPlotParam(\"yrange\", \"[:0]\");\n    assertPlotParam(\"yrange\", \"[:42]\");\n    assertPlotParam(\"yrange\", \"[:-42]\");\n    assertPlotParam(\"yrange\", \"[:0.8]\");\n    assertPlotParam(\"yrange\", \"[:-0.8]\");\n    assertPlotParam(\"yrange\", \"[:42.4]\");\n    assertPlotParam(\"yrange\", \"[:-42.4]\");\n    assertPlotParam(\"yrange\", \"[:4e4]\");\n    assertPlotParam(\"yrange\", \"[:-4e4]\");\n    assertPlotParam(\"yrange\", \"[:4e-4]\");\n    assertPlotParam(\"yrange\", \"[:-4e-4]\");\n    assertPlotParam(\"yrange\", \"[:4.2e4]\");\n    assertPlotParam(\"yrange\", \"[:-4.2e4]\");\n    assertPlotParam(\"yrange\", \"[0:]\");\n    assertPlotParam(\"yrange\", \"[5:]\");\n    assertPlotParam(\"yrange\", \"[-5:]\");\n    assertPlotParam(\"yrange\", \"[0.5:]\");\n    assertPlotParam(\"yrange\", \"[-0.5:]\");\n    assertPlotParam(\"yrange\", \"[10.5:]\");\n    assertPlotParam(\"yrange\", \"[-10.5:]\");\n    assertPlotParam(\"yrange\", \"[10e5:]\");\n    assertPlotParam(\"yrange\", \"[-10e5:]\");\n    assertPlotParam(\"yrange\", \"[10e-5:]\");\n    assertPlotParam(\"yrange\", \"[-10e-5:]\");\n    assertPlotParam(\"yrange\", \"[10.1e-5:]\");\n    assertPlotParam(\"yrange\", \"[-10.1e-5:]\");\n    assertPlotParam(\"yrange\", \"[-10.1e-5:-10.1e-6]\");\n    assertInvalidPlotParam(\"yrange\", \"[33:system('touch /tmp/poc.txt')]\");\n    assertInvalidPlotParam(\"y2range\", \"[42:%0a[33:system('touch /tmp/poc.txt')]\");\n  }",
  "abstract_func": "@Test  \n  public void setYRangeParams() throws Exception {\n    assertPlotParam(\"yrange\",\"[0:1]\");\n    assertPlotParam(\"yrange\", \"[:]\");\n    assertPlotParam(\"yrange\", \"[:0]\");\n    assertPlotParam(\"yrange\", \"[:42]\");\n    assertPlotParam(\"yrange\", \"[:-42]\");\n    assertPlotParam(\"yrange\", \"[:0.8]\");\n    assertPlotParam(\"yrange\", \"[:-0.8]\");\n    assertPlotParam(\"yrange\", \"[:42.4]\");\n    assertPlotParam(\"yrange\", \"[:-42.4]\");\n    assertPlotParam(\"yrange\", \"[:4e4]\");\n    assertPlotParam(\"yrange\", \"[:-4e4]\");\n    assertPlotParam(\"yrange\", \"[:4e-4]\");\n    assertPlotParam(\"yrange\", \"[:-4e-4]\");\n    assertPlotParam(\"yrange\", \"[:4.2e4]\");\n    assertPlotParam(\"yrange\", \"[:-4.2e4]\");\n    assertPlotParam(\"yrange\", \"[0:]\");\n    assertPlotParam(\"yrange\", \"[5:]\");\n    assertPlotParam(\"yrange\", \"[-5:]\");\n    assertPlotParam(\"yrange\", \"[0.5:]\");\n    assertPlotParam(\"yrange\", \"[-0.5:]\");\n    assertPlotParam(\"yrange\", \"[10.5:]\");\n    assertPlotParam(\"yrange\", \"[-10.5:]\");\n    assertPlotParam(\"yrange\", \"[10e5:]\");\n    assertPlotParam(\"yrange\", \"[-10e5:]\");\n    assertPlotParam(\"yrange\", \"[10e-5:]\");\n    assertPlotParam(\"yrange\", \"[-10e-5:]\");\n    assertPlotParam(\"yrange\", \"[10.1e-5:]\");\n    assertPlotParam(\"yrange\", \"[-10.1e-5:]\");\n    assertPlotParam(\"yrange\", \"[-10.1e-5:-10.1e-6]\");\n    assertInvalidPlotParam(\"yrange\", \"[33:system('touch /tmp/poc.txt')]\");\n    assertInvalidPlotParam(\"y2range\", \"[42:%0a[33:system('touch /tmp/poc.txt')]\");\n  }",
  "func_graph_path": "OpenTSDB/opentsdb/07c4641471c6f5c2ab5aab615969e97211eb50d9/TestGraphHandler.java/vul/after/1.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -30,4 +30,5 @@\n     assertPlotParam(\"yrange\", \"[-10.1e-5:]\");\n     assertPlotParam(\"yrange\", \"[-10.1e-5:-10.1e-6]\");\n     assertInvalidPlotParam(\"yrange\", \"[33:system('touch /tmp/poc.txt')]\");\n+    assertInvalidPlotParam(\"y2range\", \"[42:%0a[33:system('touch /tmp/poc.txt')]\");\n   }",
  "diff_line_info": {
    "deleted_lines": [],
    "added_lines": [
      "    assertInvalidPlotParam(\"y2range\", \"[42:%0a[33:system('touch /tmp/poc.txt')]\");"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/OpenTSDB/opentsdb/pull/2275",
  "description": {
    "pr_info": {
      "title": "Improved fix for #2261.",
      "number": 2275
    },
    "comment": [
      "Regular expressions wouldn't catch the newlines or possibly other control characters. Now we'll use the TAG validation code to make sure the inputs are only plain ASCII printables first. Fixes CVE-2018-12972, CVE-2020-35476",
      "@manolama - this seems to fix the [RCE we reported](https://github.com/OpenTSDB/opentsdb/issues/2261) before Synopsis on Dec 12, 2022. Seems like they have also issued a CVE for the vulnerability we found. Could you please open a Github security advisory? Thanks."
    ]
  },
  "Bug Filter": "Security Vulnerability Fix",
  "Bug Filter Confidence": 1.0,
  "Bug Filter Response": "**Final Classification:** Security Vulnerability Fix  \n**Confidence:** 1.0"
}