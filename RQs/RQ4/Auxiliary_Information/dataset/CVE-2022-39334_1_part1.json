{
  "cve_id": "CVE-2022-39334",
  "cwe_ids": [
    "CWE-295"
  ],
  "cvss_vector": "CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:H/A:N",
  "cvss_is_v3": true,
  "repo_name": "nextcloud/desktop",
  "commit_msg": "Fix error in logic.\n\nSigned-off-by: alex-z <blackslayer4@gmail.com>",
  "commit_hash": "564a3ad987a40135c9d6dedd5a1238caf0ce2d52",
  "git_url": "https://github.com/nextcloud/desktop/commit/564a3ad987a40135c9d6dedd5a1238caf0ce2d52",
  "file_path": "src/cmd/simplesslerrorhandler.cpp",
  "func_name": "SimpleSslErrorHandler::handleErrors",
  "func_before": "bool SimpleSslErrorHandler::handleErrors(QList<QSslError> errors, const QSslConfiguration &conf, QList<QSslCertificate> *certs, OCC::AccountPtr account)\n{\n    Q_UNUSED(conf);\n\n    if (!account || !certs) {\n        qDebug() << \"account and certs parameters are required!\";\n        return false;\n    }\n\n    if (account->trustCertificates()) {\n        for (const auto &error : qAsConst(errors)) {\n            certs->append(error.certificate());\n        }\n        return true;\n    }\n\n    for (const auto &error : qAsConst(errors)) {\n        if (!account->approvedCerts().contains(error.certificate())) {\n            certs->append(error.certificate());\n            return false;\n        }\n    }\n\n    return true;\n}",
  "abstract_func_before": "bool SimpleSslErrorHandler::handleErrors(QList<QSslError> VAR_0, const QSslConfiguration &VAR_1, QList<QSslCertificate> *VAR_2, OCC::AccountPtr VAR_3)\n{\n    Q_UNUSED(VAR_1);\n\n    if (!VAR_3 || !VAR_2) {\n        qDebug() << \"account and certs parameters are required!\";\n        return false;\n    }\n\n    if (VAR_3->trustCertificates()) {\n        for (const auto &VAR_4 : qAsConst(VAR_0)) {\n            VAR_2->append(VAR_4.certificate());\n        }\n        return true;\n    }\n\n    for (const auto &VAR_4 : qAsConst(VAR_0)) {\n        if (!VAR_3->approvedCerts().contains(VAR_4.certificate())) {\n            VAR_2->append(VAR_4.certificate());\n            return false;\n        }\n    }\n\n    return true;\n}",
  "func_graph_path_before": "nextcloud/desktop/564a3ad987a40135c9d6dedd5a1238caf0ce2d52/simplesslerrorhandler.cpp/vul/before/0.json",
  "func": "bool SimpleSslErrorHandler::handleErrors(QList<QSslError> errors, const QSslConfiguration &conf, QList<QSslCertificate> *certs, OCC::AccountPtr account)\n{\n    Q_UNUSED(conf);\n\n    if (!account || !certs) {\n        qDebug() << \"account and certs parameters are required!\";\n        return false;\n    }\n\n    if (account->trustCertificates()) {\n        for (const auto &error : qAsConst(errors)) {\n            certs->append(error.certificate());\n        }\n        return true;\n    }\n\n    bool allTrusted = true;\n\n    for (const auto &error : qAsConst(errors)) {\n        if (!account->approvedCerts().contains(error.certificate())) {\n            allTrusted = false;\n        }\n        certs->append(error.certificate());\n    }\n\n    return allTrusted;\n}",
  "abstract_func": "bool SimpleSslErrorHandler::handleErrors(QList<QSslError> VAR_0, const QSslConfiguration &VAR_1, QList<QSslCertificate> *VAR_2, OCC::AccountPtr VAR_3)\n{\n    Q_UNUSED(VAR_1);\n\n    if (!VAR_3 || !VAR_2) {\n        qDebug() << \"account and certs parameters are required!\";\n        return false;\n    }\n\n    if (VAR_3->trustCertificates()) {\n        for (const auto &VAR_4 : qAsConst(VAR_0)) {\n            VAR_2->append(VAR_4.certificate());\n        }\n        return true;\n    }\n\n    bool VAR_5 = true;\n\n    for (const auto &VAR_4 : qAsConst(VAR_0)) {\n        if (!VAR_3->approvedCerts().contains(VAR_4.certificate())) {\n            VAR_5 = false;\n        }\n        VAR_2->append(VAR_4.certificate());\n    }\n\n    return VAR_5;\n}",
  "func_graph_path": "nextcloud/desktop/564a3ad987a40135c9d6dedd5a1238caf0ce2d52/simplesslerrorhandler.cpp/vul/after/0.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -14,12 +14,14 @@\n         return true;\n     }\n \n+    bool allTrusted = true;\n+\n     for (const auto &error : qAsConst(errors)) {\n         if (!account->approvedCerts().contains(error.certificate())) {\n-            certs->append(error.certificate());\n-            return false;\n+            allTrusted = false;\n         }\n+        certs->append(error.certificate());\n     }\n \n-    return true;\n+    return allTrusted;\n }",
  "diff_line_info": {
    "deleted_lines": [
      "            certs->append(error.certificate());",
      "            return false;",
      "    return true;"
    ],
    "added_lines": [
      "    bool allTrusted = true;",
      "",
      "            allTrusted = false;",
      "        certs->append(error.certificate());",
      "    return allTrusted;"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/nextcloud/desktop/pull/5022",
  "description": {
    "pr_info": {
      "title": "Command-line client. Do not trust SSL certificates by default, unless '--trust' option is set.",
      "number": 5022
    },
    "comment": [
      "Signed-off-by: allexzander <blackslayer4@gmail.com>\r\n<!-- \r\nThanks for opening a pull request on the Nextcloud desktop client.\r\n\r\nInstead of a Contributor License Agreement (CLA) we use a Developer Certificate of Origin (DCO).\r\nhttps://en.wikipedia.org/wiki/Developer_Certificate_of_Origin\r\n\r\nTo accept that DCO, please make sure that you add a line like\r\nSigned-off-by: Random Developer <random@developer.example.org>\r\nat the end of each commit message.\r\n\r\nThis Signed-off-by trailer can be added automatically by git if you pass --signoff or -s to git commit.\r\nSee also:\r\nhttps://git-scm.com/docs/git-commit#Documentation/git-commit.txt---no-signoff\r\n-->",
      "# [Codecov](https://codecov.io/gh/nextcloud/desktop/pull/5022?src=pr&el=h1&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=nextcloud) Report\n> Merging [#5022](https://codecov.io/gh/nextcloud/desktop/pull/5022?src=pr&el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=nextcloud) (e721f93) into [master](https://codecov.io/gh/nextcloud/desktop/commit/256aa522020610d41d7fd2e1b6f7a604b42f4fcc?el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=nextcloud) (256aa52) will **decrease** coverage by `0.12%`.\n> The diff coverage is `14.28%`.\n\n> :exclamation: Current head e721f93 differs from pull request most recent head 564a3ad. Consider uploading reports for the commit 564a3ad to get more accurate results\n\n<details><summary>Additional details and impacted files</summary>\n\n\n```diff\n@@            Coverage Diff             @@\n##           master    #5022      +/-   ##\n==========================================\n- Coverage   57.28%   57.16%   -0.13%     \n==========================================\n  Files         138      138              \n  Lines       17394    17401       +7     \n==========================================\n- Hits         9965     9947      -18     \n- Misses       7429     7454      +25     \n```\n\n\n\n| [Impacted Files](https://codecov.io/gh/nextcloud/desktop/pull/5022?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=nextcloud) | Coverage Î” | |\n|---|---|---|\n| [src/libsync/account.cpp](https://codecov.io/gh/nextcloud/desktop/pull/5022/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=nextcloud#diff-c3JjL2xpYnN5bmMvYWNjb3VudC5jcHA=) | `38.00% <0.00%> (-0.47%)` | :arrow_down: |\n| [src/libsync/account.h](https://codecov.io/gh/nextcloud/desktop/pull/5022/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=nextcloud#diff-c3JjL2xpYnN5bmMvYWNjb3VudC5o) | `33.33% <100.00%> (+3.92%)` | :arrow_up: |\n| [src/libsync/vfs/cfapi/hydrationjob.cpp](https://codecov.io/gh/nextcloud/desktop/pull/5022/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=nextcloud#diff-c3JjL2xpYnN5bmMvdmZzL2NmYXBpL2h5ZHJhdGlvbmpvYi5jcHA=) | `52.38% <0.00%> (-3.71%)` | :arrow_down: |\n| [src/libsync/filesystem.cpp](https://codecov.io/gh/nextcloud/desktop/pull/5022/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=nextcloud#diff-c3JjL2xpYnN5bmMvZmlsZXN5c3RlbS5jcHA=) | `73.11% <0.00%> (-3.23%)` | :arrow_down: |\n| [src/libsync/vfs/cfapi/vfs\\_cfapi.cpp](https://codecov.io/gh/nextcloud/desktop/pull/5022/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=nextcloud#diff-c3JjL2xpYnN5bmMvdmZzL2NmYXBpL3Zmc19jZmFwaS5jcHA=) | `83.39% <0.00%> (-2.38%)` | :arrow_down: |\n| [src/libsync/vfs/cfapi/cfapiwrapper.cpp](https://codecov.io/gh/nextcloud/desktop/pull/5022/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=nextcloud#diff-c3JjL2xpYnN5bmMvdmZzL2NmYXBpL2NmYXBpd3JhcHBlci5jcHA=) | `72.50% <0.00%> (-1.82%)` | :arrow_down: |\n| [src/libsync/syncengine.cpp](https://codecov.io/gh/nextcloud/desktop/pull/5022/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=nextcloud#diff-c3JjL2xpYnN5bmMvc3luY2VuZ2luZS5jcHA=) | `82.88% <0.00%> (-0.46%)` | :arrow_down: |\n| [src/libsync/propagatedownload.cpp](https://codecov.io/gh/nextcloud/desktop/pull/5022/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=nextcloud#diff-c3JjL2xpYnN5bmMvcHJvcGFnYXRlZG93bmxvYWQuY3Bw) | `64.61% <0.00%> (+1.17%)` | :arrow_up: |\n\n</details>",
      "@claucambra I had to fix a small logic error and re-request a review. It does not really affect much but it's best to keep it right.",
      "AppImage file: [nextcloud-PR-5022-564a3ad987a40135c9d6dedd5a1238caf0ce2d52-x86_64.AppImage](https://github.com/nextcloud-desktop-bot/ci-builds/releases/download/PR-5022/nextcloud-PR-5022-564a3ad987a40135c9d6dedd5a1238caf0ce2d52-x86_64.AppImage) <br/><br/>To test this change/fix you can simply download above AppImage file and test it. <br/><br/>Please make sure to quit your existing Nextcloud app and backup your data. ",
      "SonarCloud Quality Gate failed.&nbsp; &nbsp; [![Quality Gate failed](https://sonarsource.github.io/sonarcloud-github-static-resources/v2/checks/QualityGateBadge/failed-16px.png 'Quality Gate failed')](https://sonarcloud.io/dashboard?id=nextcloud_desktop&pullRequest=5022)\n\n[![Bug](https://sonarsource.github.io/sonarcloud-github-static-resources/v2/common/bug-16px.png 'Bug')](https://sonarcloud.io/project/issues?id=nextcloud_desktop&pullRequest=5022&resolved=false&types=BUG) [![A](https://sonarsource.github.io/sonarcloud-github-static-resources/v2/checks/RatingBadge/A-16px.png 'A')](https://sonarcloud.io/project/issues?id=nextcloud_desktop&pullRequest=5022&resolved=false&types=BUG) [0 Bugs](https://sonarcloud.io/project/issues?id=nextcloud_desktop&pullRequest=5022&resolved=false&types=BUG)  \n[![Vulnerability](https://sonarsource.github.io/sonarcloud-github-static-resources/v2/common/vulnerability-16px.png 'Vulnerability')](https://sonarcloud.io/project/issues?id=nextcloud_desktop&pullRequest=5022&resolved=false&types=VULNERABILITY) [![A](https://sonarsource.github.io/sonarcloud-github-static-resources/v2/checks/RatingBadge/A-16px.png 'A')](https://sonarcloud.io/project/issues?id=nextcloud_desktop&pullRequest=5022&resolved=false&types=VULNERABILITY) [0 Vulnerabilities](https://sonarcloud.io/project/issues?id=nextcloud_desktop&pullRequest=5022&resolved=false&types=VULNERABILITY)  \n[![Security Hotspot](https://sonarsource.github.io/sonarcloud-github-static-resources/v2/common/security_hotspot-16px.png 'Security Hotspot')](https://sonarcloud.io/project/security_hotspots?id=nextcloud_desktop&pullRequest=5022&resolved=false&types=SECURITY_HOTSPOT) [![A](https://sonarsource.github.io/sonarcloud-github-static-resources/v2/checks/RatingBadge/A-16px.png 'A')](https://sonarcloud.io/project/security_hotspots?id=nextcloud_desktop&pullRequest=5022&resolved=false&types=SECURITY_HOTSPOT) [0 Security Hotspots](https://sonarcloud.io/project/security_hotspots?id=nextcloud_desktop&pullRequest=5022&resolved=false&types=SECURITY_HOTSPOT)  \n[![Code Smell](https://sonarsource.github.io/sonarcloud-github-static-resources/v2/common/code_smell-16px.png 'Code Smell')](https://sonarcloud.io/project/issues?id=nextcloud_desktop&pullRequest=5022&resolved=false&types=CODE_SMELL) [![A](https://sonarsource.github.io/sonarcloud-github-static-resources/v2/checks/RatingBadge/A-16px.png 'A')](https://sonarcloud.io/project/issues?id=nextcloud_desktop&pullRequest=5022&resolved=false&types=CODE_SMELL) [2 Code Smells](https://sonarcloud.io/project/issues?id=nextcloud_desktop&pullRequest=5022&resolved=false&types=CODE_SMELL)\n\n[![0.0%](https://sonarsource.github.io/sonarcloud-github-static-resources/v2/checks/CoverageChart/0-16px.png '0.0%')](https://sonarcloud.io/component_measures?id=nextcloud_desktop&pullRequest=5022&metric=new_coverage&view=list) [0.0% Coverage](https://sonarcloud.io/component_measures?id=nextcloud_desktop&pullRequest=5022&metric=new_coverage&view=list)  \n[![0.0%](https://sonarsource.github.io/sonarcloud-github-static-resources/v2/checks/Duplications/3-16px.png '0.0%')](https://sonarcloud.io/component_measures?id=nextcloud_desktop&pullRequest=5022&metric=new_duplicated_lines_density&view=list) [0.0% Duplication](https://sonarcloud.io/component_measures?id=nextcloud_desktop&pullRequest=5022&metric=new_duplicated_lines_density&view=list)\n\n",
      "/backport to stable-3.6"
    ]
  },
  "Bug Filter": "Defect Remediation & Feature Upgrades",
  "Bug Filter Confidence": 0.9,
  "Bug Filter Response": "**Final Classification:** Defect Remediation & Feature Upgrades;  \n**Confidence:** 0.9"
}