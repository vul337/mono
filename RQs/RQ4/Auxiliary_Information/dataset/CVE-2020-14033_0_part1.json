{
  "cve_id": "CVE-2020-14033",
  "cwe_ids": [
    "CWE-120"
  ],
  "cvss_vector": "AV:N/AC:L/Au:N/C:P/I:P/A:P",
  "cvss_is_v3": false,
  "repo_name": "meetecho/janus-gateway",
  "commit_msg": "Fix sscanf-related security issues",
  "commit_hash": "fb85040405495748dbc7c4850b97da9b67b7b47b",
  "git_url": "https://github.com/meetecho/janus-gateway/commit/fb85040405495748dbc7c4850b97da9b67b7b47b",
  "file_path": "rtp.c",
  "func_name": "janus_rtp_header_extension_get_from_id",
  "func_before": "const char *janus_rtp_header_extension_get_from_id(const char *sdp, int id) {\n\tif(!sdp || id < 0)\n\t\treturn NULL;\n\t/* Look for the mapping */\n\tchar extmap[100];\n\tg_snprintf(extmap, 100, \"a=extmap:%d \", id);\n\tconst char *line = strstr(sdp, \"m=\");\n\twhile(line) {\n\t\tchar *next = strchr(line, '\\n');\n\t\tif(next) {\n\t\t\t*next = '\\0';\n\t\t\tif(strstr(line, extmap)) {\n\t\t\t\t/* Gotcha! */\n\t\t\t\tchar extension[100];\n\t\t\t\tif(sscanf(line, \"a=extmap:%d %s\", &id, extension) == 2) {\n\t\t\t\t\t*next = '\\n';\n\t\t\t\t\tif(strstr(extension, JANUS_RTP_EXTMAP_AUDIO_LEVEL))\n\t\t\t\t\t\treturn JANUS_RTP_EXTMAP_AUDIO_LEVEL;\n\t\t\t\t\tif(strstr(extension, JANUS_RTP_EXTMAP_VIDEO_ORIENTATION))\n\t\t\t\t\t\treturn JANUS_RTP_EXTMAP_VIDEO_ORIENTATION;\n\t\t\t\t\tif(strstr(extension, JANUS_RTP_EXTMAP_PLAYOUT_DELAY))\n\t\t\t\t\t\treturn JANUS_RTP_EXTMAP_PLAYOUT_DELAY;\n\t\t\t\t\tif(strstr(extension, JANUS_RTP_EXTMAP_TOFFSET))\n\t\t\t\t\t\treturn JANUS_RTP_EXTMAP_TOFFSET;\n\t\t\t\t\tif(strstr(extension, JANUS_RTP_EXTMAP_ABS_SEND_TIME))\n\t\t\t\t\t\treturn JANUS_RTP_EXTMAP_ABS_SEND_TIME;\n\t\t\t\t\tif(strstr(extension, JANUS_RTP_EXTMAP_TRANSPORT_WIDE_CC))\n\t\t\t\t\t\treturn JANUS_RTP_EXTMAP_TRANSPORT_WIDE_CC;\n\t\t\t\t\tif(strstr(extension, JANUS_RTP_EXTMAP_MID))\n\t\t\t\t\t\treturn JANUS_RTP_EXTMAP_MID;\n\t\t\t\t\tif(strstr(extension, JANUS_RTP_EXTMAP_RID))\n\t\t\t\t\t\treturn JANUS_RTP_EXTMAP_RID;\n\t\t\t\t\tif(strstr(extension, JANUS_RTP_EXTMAP_REPAIRED_RID))\n\t\t\t\t\t\treturn JANUS_RTP_EXTMAP_REPAIRED_RID;\n\t\t\t\t\tJANUS_LOG(LOG_ERR, \"Unsupported extension '%s'\\n\", extension);\n\t\t\t\t\treturn NULL;\n\t\t\t\t}\n\t\t\t}\n\t\t\t*next = '\\n';\n\t\t}\n\t\tline = next ? (next+1) : NULL;\n\t}\n\treturn NULL;\n}",
  "abstract_func_before": "const char *janus_rtp_header_extension_get_from_id(const char *VAR_0, int VAR_1) {\n\tif(!VAR_0 || VAR_1 < 0)\n\t\treturn NULL;\n\t/* COMMENT_0 */\n\tchar VAR_2[100];\n\tg_snprintf(VAR_2, 100, \"a=extmap:%d \", VAR_1);\n\tconst char *VAR_3 = strstr(VAR_0, \"m=\");\n\twhile(VAR_3) {\n\t\tchar *VAR_4 = strchr(VAR_3, '\\n');\n\t\tif(VAR_4) {\n\t\t\t*VAR_4 = '\\0';\n\t\t\tif(strstr(VAR_3, VAR_2)) {\n\t\t\t\t/* COMMENT_1 */\n\t\t\t\tchar VAR_5[100];\n\t\t\t\tif(sscanf(VAR_3, \"a=extmap:%d %s\", &VAR_1, VAR_5) == 2) {\n\t\t\t\t\t*VAR_4 = '\\n';\n\t\t\t\t\tif(strstr(VAR_5, VAR_6))\n\t\t\t\t\t\treturn VAR_6;\n\t\t\t\t\tif(strstr(VAR_5, VAR_7))\n\t\t\t\t\t\treturn VAR_7;\n\t\t\t\t\tif(strstr(VAR_5, VAR_8))\n\t\t\t\t\t\treturn VAR_8;\n\t\t\t\t\tif(strstr(VAR_5, VAR_9))\n\t\t\t\t\t\treturn VAR_9;\n\t\t\t\t\tif(strstr(VAR_5, VAR_10))\n\t\t\t\t\t\treturn VAR_10;\n\t\t\t\t\tif(strstr(VAR_5, VAR_11))\n\t\t\t\t\t\treturn VAR_11;\n\t\t\t\t\tif(strstr(VAR_5, VAR_12))\n\t\t\t\t\t\treturn VAR_12;\n\t\t\t\t\tif(strstr(VAR_5, VAR_13))\n\t\t\t\t\t\treturn VAR_13;\n\t\t\t\t\tif(strstr(VAR_5, VAR_14))\n\t\t\t\t\t\treturn VAR_14;\n\t\t\t\t\tJANUS_LOG(VAR_15, \"Unsupported extension '%s'\\n\", VAR_5);\n\t\t\t\t\treturn NULL;\n\t\t\t\t}\n\t\t\t}\n\t\t\t*VAR_4 = '\\n';\n\t\t}\n\t\tVAR_3 = VAR_4 ? (VAR_4+1) : NULL;\n\t}\n\treturn NULL;\n}",
  "func_graph_path_before": "meetecho/janus-gateway/fb85040405495748dbc7c4850b97da9b67b7b47b/rtp.c/vul/before/0.json",
  "func": "const char *janus_rtp_header_extension_get_from_id(const char *sdp, int id) {\n\tif(!sdp || id < 0)\n\t\treturn NULL;\n\t/* Look for the mapping */\n\tchar extmap[100];\n\tg_snprintf(extmap, 100, \"a=extmap:%d \", id);\n\tconst char *line = strstr(sdp, \"m=\");\n\twhile(line) {\n\t\tchar *next = strchr(line, '\\n');\n\t\tif(next) {\n\t\t\t*next = '\\0';\n\t\t\tif(strstr(line, extmap)) {\n\t\t\t\t/* Gotcha! */\n\t\t\t\tchar extension[100];\n\t\t\t\tif(sscanf(line, \"a=extmap:%d %99s\", &id, extension) == 2) {\n\t\t\t\t\t*next = '\\n';\n\t\t\t\t\tif(strstr(extension, JANUS_RTP_EXTMAP_AUDIO_LEVEL))\n\t\t\t\t\t\treturn JANUS_RTP_EXTMAP_AUDIO_LEVEL;\n\t\t\t\t\tif(strstr(extension, JANUS_RTP_EXTMAP_VIDEO_ORIENTATION))\n\t\t\t\t\t\treturn JANUS_RTP_EXTMAP_VIDEO_ORIENTATION;\n\t\t\t\t\tif(strstr(extension, JANUS_RTP_EXTMAP_PLAYOUT_DELAY))\n\t\t\t\t\t\treturn JANUS_RTP_EXTMAP_PLAYOUT_DELAY;\n\t\t\t\t\tif(strstr(extension, JANUS_RTP_EXTMAP_TOFFSET))\n\t\t\t\t\t\treturn JANUS_RTP_EXTMAP_TOFFSET;\n\t\t\t\t\tif(strstr(extension, JANUS_RTP_EXTMAP_ABS_SEND_TIME))\n\t\t\t\t\t\treturn JANUS_RTP_EXTMAP_ABS_SEND_TIME;\n\t\t\t\t\tif(strstr(extension, JANUS_RTP_EXTMAP_TRANSPORT_WIDE_CC))\n\t\t\t\t\t\treturn JANUS_RTP_EXTMAP_TRANSPORT_WIDE_CC;\n\t\t\t\t\tif(strstr(extension, JANUS_RTP_EXTMAP_MID))\n\t\t\t\t\t\treturn JANUS_RTP_EXTMAP_MID;\n\t\t\t\t\tif(strstr(extension, JANUS_RTP_EXTMAP_RID))\n\t\t\t\t\t\treturn JANUS_RTP_EXTMAP_RID;\n\t\t\t\t\tif(strstr(extension, JANUS_RTP_EXTMAP_REPAIRED_RID))\n\t\t\t\t\t\treturn JANUS_RTP_EXTMAP_REPAIRED_RID;\n\t\t\t\t\tJANUS_LOG(LOG_ERR, \"Unsupported extension '%s'\\n\", extension);\n\t\t\t\t\treturn NULL;\n\t\t\t\t}\n\t\t\t}\n\t\t\t*next = '\\n';\n\t\t}\n\t\tline = next ? (next+1) : NULL;\n\t}\n\treturn NULL;\n}",
  "abstract_func": "const char *janus_rtp_header_extension_get_from_id(const char *VAR_0, int VAR_1) {\n\tif(!VAR_0 || VAR_1 < 0)\n\t\treturn NULL;\n\t/* COMMENT_0 */\n\tchar VAR_2[100];\n\tg_snprintf(VAR_2, 100, \"a=extmap:%d \", VAR_1);\n\tconst char *VAR_3 = strstr(VAR_0, \"m=\");\n\twhile(VAR_3) {\n\t\tchar *VAR_4 = strchr(VAR_3, '\\n');\n\t\tif(VAR_4) {\n\t\t\t*VAR_4 = '\\0';\n\t\t\tif(strstr(VAR_3, VAR_2)) {\n\t\t\t\t/* COMMENT_1 */\n\t\t\t\tchar VAR_5[100];\n\t\t\t\tif(sscanf(VAR_3, \"a=extmap:%d %99s\", &VAR_1, VAR_5) == 2) {\n\t\t\t\t\t*VAR_4 = '\\n';\n\t\t\t\t\tif(strstr(VAR_5, VAR_6))\n\t\t\t\t\t\treturn VAR_6;\n\t\t\t\t\tif(strstr(VAR_5, VAR_7))\n\t\t\t\t\t\treturn VAR_7;\n\t\t\t\t\tif(strstr(VAR_5, VAR_8))\n\t\t\t\t\t\treturn VAR_8;\n\t\t\t\t\tif(strstr(VAR_5, VAR_9))\n\t\t\t\t\t\treturn VAR_9;\n\t\t\t\t\tif(strstr(VAR_5, VAR_10))\n\t\t\t\t\t\treturn VAR_10;\n\t\t\t\t\tif(strstr(VAR_5, VAR_11))\n\t\t\t\t\t\treturn VAR_11;\n\t\t\t\t\tif(strstr(VAR_5, VAR_12))\n\t\t\t\t\t\treturn VAR_12;\n\t\t\t\t\tif(strstr(VAR_5, VAR_13))\n\t\t\t\t\t\treturn VAR_13;\n\t\t\t\t\tif(strstr(VAR_5, VAR_14))\n\t\t\t\t\t\treturn VAR_14;\n\t\t\t\t\tJANUS_LOG(VAR_15, \"Unsupported extension '%s'\\n\", VAR_5);\n\t\t\t\t\treturn NULL;\n\t\t\t\t}\n\t\t\t}\n\t\t\t*VAR_4 = '\\n';\n\t\t}\n\t\tVAR_3 = VAR_4 ? (VAR_4+1) : NULL;\n\t}\n\treturn NULL;\n}",
  "func_graph_path": "meetecho/janus-gateway/fb85040405495748dbc7c4850b97da9b67b7b47b/rtp.c/vul/after/0.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -12,7 +12,7 @@\n \t\t\tif(strstr(line, extmap)) {\n \t\t\t\t/* Gotcha! */\n \t\t\t\tchar extension[100];\n-\t\t\t\tif(sscanf(line, \"a=extmap:%d %s\", &id, extension) == 2) {\n+\t\t\t\tif(sscanf(line, \"a=extmap:%d %99s\", &id, extension) == 2) {\n \t\t\t\t\t*next = '\\n';\n \t\t\t\t\tif(strstr(extension, JANUS_RTP_EXTMAP_AUDIO_LEVEL))\n \t\t\t\t\t\treturn JANUS_RTP_EXTMAP_AUDIO_LEVEL;",
  "diff_line_info": {
    "deleted_lines": [
      "\t\t\t\tif(sscanf(line, \"a=extmap:%d %s\", &id, extension) == 2) {"
    ],
    "added_lines": [
      "\t\t\t\tif(sscanf(line, \"a=extmap:%d %99s\", &id, extension) == 2) {"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/meetecho/janus-gateway/pull/2229",
  "description": {
    "pr_info": {
      "title": "Fix sscanf-related security issues",
      "number": 2229
    },
    "comment": [
      "We've been notified about a couple of security issues related to a broken usage of sscanf (reserved IDs: CVE-2020-14033, CVE-2020-14034, discovered by Marat Gayanov at Digital Security dsec.ru). Using that information, we extended the fix to a couple of other locations where the issue was present but not reported.\r\n\r\nMerging right away, considering these are important fixes and I can't replicate them anymore."
    ]
  },
  "Bug Filter": "Security Vulnerability Fix",
  "Bug Filter Confidence": 1.0,
  "Bug Filter Response": "**Final Classification:** Security Vulnerability Fix; **Confidence:** 1.0"
}