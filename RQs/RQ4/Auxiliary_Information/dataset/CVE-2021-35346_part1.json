{
  "cve_id": "CVE-2021-35346",
  "cwe_ids": [
    "CWE-787"
  ],
  "cvss_vector": "AV:N/AC:L/Au:N/C:P/I:P/A:P",
  "cvss_is_v3": false,
  "repo_name": "justdan96/tsMuxer",
  "commit_msg": "[Bug] Buffer overflow with non-hevc stream\n\nAs per T-REC-H265 standard sub-clause 7.4.2.2., when nal_unit_type == VPS_NUT or SPS_NUT or EOS_NUT or EOB_NUT, nuh_temporal_id shall be equal to 0.\r\n\r\nThis patch allows early return when this condition is not fulfilled therefore the stream is obviously not hevc.\r\n\r\nFixes issues #418 and #420.",
  "commit_hash": "df7c4ef77136b5aeb07e5ddde1699decc6029951",
  "git_url": "https://github.com/justdan96/tsMuxer/commit/df7c4ef77136b5aeb07e5ddde1699decc6029951",
  "file_path": "tsMuxer/hevc.cpp",
  "func_name": "HevcUnit::deserialize",
  "func_before": "int HevcUnit::deserialize()\n{\n    m_reader.setBuffer(m_nalBuffer, m_nalBuffer + m_nalBufferLen);\n    try\n    {\n        m_reader.skipBit();\n        nal_unit_type = m_reader.getBits(6);\n        nuh_layer_id = m_reader.getBits(6);\n        nuh_temporal_id_plus1 = m_reader.getBits(3);\n        if (nuh_temporal_id_plus1 == 0)\n            return 1;\n        return 0;\n    }\n    catch (BitStreamException& e)\n    {\n        return NOT_ENOUGH_BUFFER;\n    }\n}",
  "abstract_func_before": "int HevcUnit::deserialize()\n{\n    VAR_0.setBuffer(VAR_1, VAR_1 + VAR_2);\n    try\n    {\n        VAR_0.skipBit();\n        VAR_3 = VAR_0.getBits(6);\n        VAR_4 = VAR_0.getBits(6);\n        VAR_5 = VAR_0.getBits(3);\n        if (VAR_5 == 0)\n            return 1;\n        return 0;\n    }\n    catch (BitStreamException& VAR_6)\n    {\n        return VAR_7;\n    }\n}",
  "func_graph_path_before": "justdan96/tsMuxer/df7c4ef77136b5aeb07e5ddde1699decc6029951/hevc.cpp/vul/before/0.json",
  "func": "int HevcUnit::deserialize()\n{\n    m_reader.setBuffer(m_nalBuffer, m_nalBuffer + m_nalBufferLen);\n    try\n    {\n        m_reader.skipBit();\n        nal_unit_type = m_reader.getBits(6);\n        nuh_layer_id = m_reader.getBits(6);\n        nuh_temporal_id_plus1 = m_reader.getBits(3);\n        if (nuh_temporal_id_plus1 == 0 || (nuh_temporal_id_plus1 != 1 && (nal_unit_type == 32 || nal_unit_type == 33 ||\n                                                                          nal_unit_type == 36 || nal_unit_type == 37)))\n            return 1;\n        return 0;\n    }\n    catch (BitStreamException& e)\n    {\n        return NOT_ENOUGH_BUFFER;\n    }\n}",
  "abstract_func": "int HevcUnit::deserialize()\n{\n    VAR_0.setBuffer(VAR_1, VAR_1 + VAR_2);\n    try\n    {\n        VAR_0.skipBit();\n        VAR_3 = VAR_0.getBits(6);\n        VAR_4 = VAR_0.getBits(6);\n        VAR_5 = VAR_0.getBits(3);\n        if (VAR_5 == 0 || (VAR_5 != 1 && (VAR_3 == 32 || VAR_3 == 33 ||\n                                                                          VAR_3 == 36 || VAR_3 == 37)))\n            return 1;\n        return 0;\n    }\n    catch (BitStreamException& VAR_6)\n    {\n        return VAR_7;\n    }\n}",
  "func_graph_path": "justdan96/tsMuxer/df7c4ef77136b5aeb07e5ddde1699decc6029951/hevc.cpp/vul/after/0.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -7,7 +7,8 @@\n         nal_unit_type = m_reader.getBits(6);\n         nuh_layer_id = m_reader.getBits(6);\n         nuh_temporal_id_plus1 = m_reader.getBits(3);\n-        if (nuh_temporal_id_plus1 == 0)\n+        if (nuh_temporal_id_plus1 == 0 || (nuh_temporal_id_plus1 != 1 && (nal_unit_type == 32 || nal_unit_type == 33 ||\n+                                                                          nal_unit_type == 36 || nal_unit_type == 37)))\n             return 1;\n         return 0;\n     }",
  "diff_line_info": {
    "deleted_lines": [
      "        if (nuh_temporal_id_plus1 == 0)"
    ],
    "added_lines": [
      "        if (nuh_temporal_id_plus1 == 0 || (nuh_temporal_id_plus1 != 1 && (nal_unit_type == 32 || nal_unit_type == 33 ||",
      "                                                                          nal_unit_type == 36 || nal_unit_type == 37)))"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/justdan96/tsMuxer/pull/422",
  "description": {
    "pr_info": {
      "title": "[Bug] Buffer overflow with non-hevc stream",
      "number": 422
    },
    "comment": [
      "As per T-REC-H265 standard sub-clause 7.4.2.2., when `nal_unit_type `== `VPS_NUT `or `SPS_NUT `or `EOS_NUT `or `EOB_NUT`, `nuh_temporal_id `shall be equal to 0.\r\n\r\nThis patch allows early return when this condition is not fulfilled therefore the stream is obviously not an hevc stream (or is not compliant).\r\n\r\nFixes issues #418, #419, #420, #424, #436 and #437."
    ]
  },
  "Bug Filter": "Security Vulnerability Fix",
  "Bug Filter Confidence": 0.95,
  "Bug Filter Response": "**Final Classification:** Security Vulnerability Fix; **Confidence:** 0.95"
}