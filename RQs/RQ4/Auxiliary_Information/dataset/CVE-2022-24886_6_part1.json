{
  "cve_id": "CVE-2022-24886",
  "cwe_ids": [
    "CWE-732"
  ],
  "cvss_vector": "AV:L/AC:L/Au:N/C:P/I:N/A:N",
  "cvss_is_v3": false,
  "repo_name": "nextcloud/android",
  "commit_msg": "Make more PendingIntents immutable\n\nThis should be all of them. Picked up by lint.\n\nSigned-off-by: √Ålvaro Brey Vilas <alvaro.brey@nextcloud.com>",
  "commit_hash": "c01fa0b17050cdcf77a468cc22f4071eae29d464",
  "git_url": "https://github.com/nextcloud/android/commit/c01fa0b17050cdcf77a468cc22f4071eae29d464",
  "file_path": "src/main/java/com/owncloud/android/files/services/FileUploader.java",
  "func_name": "notifyUploadStart",
  "func_before": "private void notifyUploadStart(UploadFileOperation upload) {\n        // / create status notification with a progress bar\n        mLastPercent = 0;\n        mNotificationBuilder = NotificationUtils.newNotificationBuilder(this);\n        mNotificationBuilder\n            .setOngoing(true)\n            .setSmallIcon(R.drawable.notification_icon)\n            .setTicker(getString(R.string.uploader_upload_in_progress_ticker))\n            .setContentTitle(getString(R.string.uploader_upload_in_progress_ticker))\n            .setProgress(100, 0, false)\n            .setContentText(\n                String.format(getString(R.string.uploader_upload_in_progress_content), 0, upload.getFileName())\n            );\n\n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {\n            mNotificationBuilder.setChannelId(NotificationUtils.NOTIFICATION_CHANNEL_UPLOAD);\n        }\n\n        /// includes a pending intent in the notification showing the details\n        Intent intent = UploadListActivity.createIntent(upload.getFile(),\n                                                        upload.getUser(),\n                                                        Intent.FLAG_ACTIVITY_CLEAR_TOP,\n                                                        this);\n        mNotificationBuilder.setContentIntent(PendingIntent.getActivity(this,\n                                                                        (int) System.currentTimeMillis(),\n                                                                        intent,\n                                                                        0)\n                                             );\n\n        if (!upload.isInstantPicture() && !upload.isInstantVideo()) {\n            if (mNotificationManager == null) {\n                mNotificationManager = (NotificationManager) getSystemService(NOTIFICATION_SERVICE);\n            }\n\n            mNotificationManager.notify(FOREGROUND_SERVICE_ID, mNotificationBuilder.build());\n        }   // else wait until the upload really start (onTransferProgress is called), so that if it's discarded\n        // due to lack of Wifi, no notification is shown\n        // TODO generalize for automated uploads\n    }",
  "abstract_func_before": "private void notifyUploadStart(UploadFileOperation VAR_0) {\n        /* COMMENT_0 */\n        VAR_1 = 0;\n        VAR_2 = VAR_3.newNotificationBuilder(this);\n        VAR_2\n            .setOngoing(true)\n            .setSmallIcon(VAR_4.drawable.notification_icon)\n            .setTicker(getString(VAR_4.string.uploader_upload_in_progress_ticker))\n            .setContentTitle(getString(VAR_4.string.uploader_upload_in_progress_ticker))\n            .setProgress(100, 0, false)\n            .setContentText(\n                VAR_5.format(getString(VAR_4.string.uploader_upload_in_progress_content), 0, VAR_0.getFileName())\n            );\n\n        if (VAR_6.VERSION.SDK_INT >= VAR_6.VERSION_CODES.O) {\n            VAR_2.setChannelId(VAR_3.NOTIFICATION_CHANNEL_UPLOAD);\n        }\n\n        /* COMMENT_1 */\n        Intent VAR_7 = VAR_8.createIntent(VAR_0.getFile(),\n                                                        VAR_0.getUser(),\n                                                        VAR_9.FLAG_ACTIVITY_CLEAR_TOP,\n                                                        this);\n        VAR_2.setContentIntent(VAR_10.getActivity(this,\n                                                                        (int) VAR_11.currentTimeMillis(),\n                                                                        VAR_7,\n                                                                        0)\n                                             );\n\n        if (!VAR_0.isInstantPicture() && !VAR_0.isInstantVideo()) {\n            if (VAR_12 == null) {\n                VAR_12 = (NotificationManager) getSystemService(VAR_13);\n            }\n\n            VAR_12.notify(VAR_14, VAR_2.build());\n        }   /* COMMENT_2 */\n        /* COMMENT_3 */\n        /* COMMENT_4 */\n    }",
  "func_graph_path_before": "nextcloud/android/c01fa0b17050cdcf77a468cc22f4071eae29d464/FileUploader.java/vul/before/0.json",
  "func": "private void notifyUploadStart(UploadFileOperation upload) {\n        // / create status notification with a progress bar\n        mLastPercent = 0;\n        mNotificationBuilder = NotificationUtils.newNotificationBuilder(this);\n        mNotificationBuilder\n            .setOngoing(true)\n            .setSmallIcon(R.drawable.notification_icon)\n            .setTicker(getString(R.string.uploader_upload_in_progress_ticker))\n            .setContentTitle(getString(R.string.uploader_upload_in_progress_ticker))\n            .setProgress(100, 0, false)\n            .setContentText(\n                String.format(getString(R.string.uploader_upload_in_progress_content), 0, upload.getFileName())\n            );\n\n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {\n            mNotificationBuilder.setChannelId(NotificationUtils.NOTIFICATION_CHANNEL_UPLOAD);\n        }\n\n        /// includes a pending intent in the notification showing the details\n        Intent intent = UploadListActivity.createIntent(upload.getFile(),\n                                                        upload.getUser(),\n                                                        Intent.FLAG_ACTIVITY_CLEAR_TOP,\n                                                        this);\n        mNotificationBuilder.setContentIntent(PendingIntent.getActivity(this,\n                                                                        (int) System.currentTimeMillis(),\n                                                                        intent,\n                                                                        PendingIntent.FLAG_IMMUTABLE)\n                                             );\n\n        if (!upload.isInstantPicture() && !upload.isInstantVideo()) {\n            if (mNotificationManager == null) {\n                mNotificationManager = (NotificationManager) getSystemService(NOTIFICATION_SERVICE);\n            }\n\n            mNotificationManager.notify(FOREGROUND_SERVICE_ID, mNotificationBuilder.build());\n        }   // else wait until the upload really start (onTransferProgress is called), so that if it's discarded\n        // due to lack of Wifi, no notification is shown\n        // TODO generalize for automated uploads\n    }",
  "abstract_func": "private void notifyUploadStart(UploadFileOperation VAR_0) {\n        /* COMMENT_0 */\n        VAR_1 = 0;\n        VAR_2 = VAR_3.newNotificationBuilder(this);\n        VAR_2\n            .setOngoing(true)\n            .setSmallIcon(VAR_4.drawable.notification_icon)\n            .setTicker(getString(VAR_4.string.uploader_upload_in_progress_ticker))\n            .setContentTitle(getString(VAR_4.string.uploader_upload_in_progress_ticker))\n            .setProgress(100, 0, false)\n            .setContentText(\n                VAR_5.format(getString(VAR_4.string.uploader_upload_in_progress_content), 0, VAR_0.getFileName())\n            );\n\n        if (VAR_6.VERSION.SDK_INT >= VAR_6.VERSION_CODES.O) {\n            VAR_2.setChannelId(VAR_3.NOTIFICATION_CHANNEL_UPLOAD);\n        }\n\n        /* COMMENT_1 */\n        Intent VAR_7 = VAR_8.createIntent(VAR_0.getFile(),\n                                                        VAR_0.getUser(),\n                                                        VAR_9.FLAG_ACTIVITY_CLEAR_TOP,\n                                                        this);\n        VAR_2.setContentIntent(VAR_10.getActivity(this,\n                                                                        (int) VAR_11.currentTimeMillis(),\n                                                                        VAR_7,\n                                                                        VAR_10.FLAG_IMMUTABLE)\n                                             );\n\n        if (!VAR_0.isInstantPicture() && !VAR_0.isInstantVideo()) {\n            if (VAR_12 == null) {\n                VAR_12 = (NotificationManager) getSystemService(VAR_13);\n            }\n\n            VAR_12.notify(VAR_14, VAR_2.build());\n        }   /* COMMENT_2 */\n        /* COMMENT_3 */\n        /* COMMENT_4 */\n    }",
  "func_graph_path": "nextcloud/android/c01fa0b17050cdcf77a468cc22f4071eae29d464/FileUploader.java/vul/after/0.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -24,7 +24,7 @@\n         mNotificationBuilder.setContentIntent(PendingIntent.getActivity(this,\n                                                                         (int) System.currentTimeMillis(),\n                                                                         intent,\n-                                                                        0)\n+                                                                        PendingIntent.FLAG_IMMUTABLE)\n                                              );\n \n         if (!upload.isInstantPicture() && !upload.isInstantVideo()) {",
  "diff_line_info": {
    "deleted_lines": [
      "                                                                        0)"
    ],
    "added_lines": [
      "                                                                        PendingIntent.FLAG_IMMUTABLE)"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/nextcloud/android/pull/9726",
  "description": "Failed to get PR details: HTTP Request Error for PR https://github.com/nextcloud/android/pull/9726: 403 Client Error: Forbidden for url: https://api.github.com/repos/nextcloud/android/pulls/9726",
  "Bug Filter": "Security Vulnerability Fix",
  "Bug Filter Confidence": 0.95,
  "Bug Filter Response": "The patch modifies PendingIntents to be immutable, enhancing security by preventing potential intent attacks. The code change is straightforward and directly relates to a security best practice.\n\n**Final Classification:** Security Vulnerability Fix; **Confidence:** 0.95"
}