{
  "cve_id": "CVE-2021-21253",
  "cwe_ids": [
    "CWE-916"
  ],
  "cvss_vector": "AV:N/AC:L/Au:N/C:P/I:N/A:N",
  "cvss_is_v3": false,
  "repo_name": "bijaythapaa/OnlineVotingSystem",
  "commit_msg": "Add a salt to SHA-256 hash",
  "commit_hash": "0181cb0272857696c8eb3e44fcf6cb014ff90f09",
  "git_url": "https://github.com/bijaythapaa/OnlineVotingSystem/commit/0181cb0272857696c8eb3e44fcf6cb014ff90f09",
  "file_path": "src/com/bijay/onlinevotingsystem/dao/AdminDaoImpl.java",
  "func_name": "loginValidate",
  "func_before": "@Override\n\tpublic boolean loginValidate(String userName, String password) {\n\n\t\tString sql = \"select * from admin_table where admin_name=? and password=?\";\n\t\ttry {\n\t\t\tps=DbUtil.getConnection().prepareStatement(sql);\n\t\t\tps.setString(1, userName);\n\t\t\tps.setString(2,password);\n\t\t\tResultSet rs =ps.executeQuery();\n\t\t\tif (rs.next()) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} catch (SQLException | ClassNotFoundException e) {\n\t\t\te.printStackTrace();\n\t\t}\n\t\treturn false;\n\t}",
  "abstract_func_before": "@Override\n\tpublic boolean loginValidate(String VAR_0, String VAR_1) {\n\n\t\tString VAR_2 = \"select * from admin_table where admin_name=? and password=?\";\n\t\ttry {\n\t\t\tVAR_3=VAR_4.getConnection().prepareStatement(VAR_2);\n\t\t\tVAR_3.setString(1, VAR_0);\n\t\t\tVAR_3.setString(2,VAR_1);\n\t\t\tResultSet VAR_5 =VAR_3.executeQuery();\n\t\t\tif (VAR_5.next()) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} catch (SQLException | ClassNotFoundException VAR_6) {\n\t\t\tVAR_6.printStackTrace();\n\t\t}\n\t\treturn false;\n\t}",
  "func_graph_path_before": "bijaythapaa/OnlineVotingSystem/0181cb0272857696c8eb3e44fcf6cb014ff90f09/AdminDaoImpl.java/vul/before/0.json",
  "func": "@Override\n\tpublic boolean loginValidate(String userName, String password) {\n\n\t\tString sql = \"select * from admin_table where admin_name=?\";\n\t\ttry {\n\t\t\tps=DbUtil.getConnection().prepareStatement(sql);\n\t\t\tps.setString(1, userName);\n\t\t\tResultSet rs =ps.executeQuery();\n\t\t\tif (rs.next()) {\n\t\t\t\tString cipherText = rs.getString(\"password\");\n\t\t\t\treturn SHA256.validatePassword(password, cipherText);\n\t\t\t}\n\t\t} catch (SQLException | ClassNotFoundException e) {\n\t\t\te.printStackTrace();\n\t\t}\n\t\treturn false;\n\t}",
  "abstract_func": "@Override\n\tpublic boolean loginValidate(String VAR_0, String VAR_1) {\n\n\t\tString VAR_2 = \"select * from admin_table where admin_name=?\";\n\t\ttry {\n\t\t\tVAR_3=VAR_4.getConnection().prepareStatement(VAR_2);\n\t\t\tVAR_3.setString(1, VAR_0);\n\t\t\tResultSet VAR_5 =VAR_3.executeQuery();\n\t\t\tif (VAR_5.next()) {\n\t\t\t\tString VAR_6 = VAR_5.getString(\"password\");\n\t\t\t\treturn VAR_7.validatePassword(VAR_1, VAR_6);\n\t\t\t}\n\t\t} catch (SQLException | ClassNotFoundException VAR_8) {\n\t\t\tVAR_8.printStackTrace();\n\t\t}\n\t\treturn false;\n\t}",
  "func_graph_path": "bijaythapaa/OnlineVotingSystem/0181cb0272857696c8eb3e44fcf6cb014ff90f09/AdminDaoImpl.java/vul/after/0.json",
  "diff_func": "--- func_before\n+++ func_after\n@@ -1,14 +1,14 @@\n @Override\n \tpublic boolean loginValidate(String userName, String password) {\n \n-\t\tString sql = \"select * from admin_table where admin_name=? and password=?\";\n+\t\tString sql = \"select * from admin_table where admin_name=?\";\n \t\ttry {\n \t\t\tps=DbUtil.getConnection().prepareStatement(sql);\n \t\t\tps.setString(1, userName);\n-\t\t\tps.setString(2,password);\n \t\t\tResultSet rs =ps.executeQuery();\n \t\t\tif (rs.next()) {\n-\t\t\t\treturn true;\n+\t\t\t\tString cipherText = rs.getString(\"password\");\n+\t\t\t\treturn SHA256.validatePassword(password, cipherText);\n \t\t\t}\n \t\t} catch (SQLException | ClassNotFoundException e) {\n \t\t\te.printStackTrace();",
  "diff_line_info": {
    "deleted_lines": [
      "\t\tString sql = \"select * from admin_table where admin_name=? and password=?\";",
      "\t\t\tps.setString(2,password);",
      "\t\t\t\treturn true;"
    ],
    "added_lines": [
      "\t\tString sql = \"select * from admin_table where admin_name=?\";",
      "\t\t\t\tString cipherText = rs.getString(\"password\");",
      "\t\t\t\treturn SHA256.validatePassword(password, cipherText);"
    ]
  },
  "is_vul": true,
  "pr_url": "https://github.com/bijaythapaa/OnlineVotingSystem/pull/2",
  "description": {
    "pr_info": {
      "title": "Add a salt to SHA-256 hash",
      "number": 2
    },
    "comment": [
      "Use a 16 byte salt in the class <code>src/com/bijay/onlinevotingsystem/controller/SHA256.java</code> to avoid dictionary attacks.\r\n\r\nAnd add a <code>validatePassword</code> method to check whether a hashed password with salt is valid or not."
    ]
  },
  "Bug Filter": "Security Vulnerability Fix",
  "Bug Filter Confidence": 1.0,
  "Bug Filter Response": "**Final Classification:** Security Vulnerability Fix  \n**Confidence:** 1.0\n\nThe patch modifies the login validation to use a salted SHA-256 hash and includes a new method to validate passwords, effectively addressing a security vulnerability by preventing dictionary attacks. The changes are consistent with the commit message and vulnerability description, clearly indicating a security fix."
}